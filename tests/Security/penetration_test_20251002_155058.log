
[1m[0;34m═══════════════════════════════════════════════════════════════[0m
[1m[0;34m  PHASE B - SECURITY PENETRATION TEST SUITE[0m
[1m[0;34m═══════════════════════════════════════════════════════════════[0m

Test Start Time: Do 2. Okt 15:50:58 CEST 2025
Target: http://localhost
Database: testing
Log File: /var/www/api-gateway/tests/Security/penetration_test_20251002_155058.log

[1m[0;34m═══════════════════════════════════════════════════════════════[0m
[1m[0;34m  SETUP PHASE[0m
[1m[0;34m═══════════════════════════════════════════════════════════════[0m

[0;34mℹ INFO[0m: Setting up test data...

[1m[0;34m═══════════════════════════════════════════════════════════════[0m
[1m[0;34m  ATTACK SCENARIOS[0m
[1m[0;34m═══════════════════════════════════════════════════════════════[0m


[1m━━━ TEST #1: Cross-Tenant Data Access via Model Queries ━━━[0m
[1;33mCVSS Score: 9.8 CRITICAL | Category: Authorization Bypass[0m

[0;34mℹ INFO[0m: Attack: Attempting to query appointments from another company using raw queries
[0;32m✓ PASS[0m: CompanyScope successfully blocked cross-tenant model access

[1m━━━ TEST #2: Admin Role Privilege Escalation Attempt ━━━[0m
[1;33mCVSS Score: 8.8 HIGH | Category: Privilege Escalation[0m

[0;34mℹ INFO[0m: Attack: Regular user attempting to escalate to super_admin role
[0;31m✗ FAIL[0m: Privilege escalation SUCCEEDED
[0;31m   Details: 
   WARNING  Attempt to read property "id" on null in /var/www/api-gatewayeval()'d code.


   Error  Call to a member function getRoleNames() on null.

= null[0m

[1m━━━ TEST #3: Webhook Forgery Attack on Legacy Route ━━━[0m
[1;33mCVSS Score: 9.3 CRITICAL | Category: Authentication Bypass[0m

[0;34mℹ INFO[0m: Attack: Sending forged webhook without valid signature
[0;31m✗ FAIL[0m: Webhook forgery ACCEPTED - signature verification bypassed
[0;31m   Details: HTTP 500: <!DOCTYPE html>
<html>
<head>
    <title>500 Server Error</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        h1 { color: #dc3545; }
        .error-details { background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 4px; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; overflow-x: auto; }
        .back-link { display: inline-block; margin-top: 20px; color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>500 - Server Error</h1>

                    <p>Ein unerwarteter Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.</p>
        
        <a href="/admin" class="back-link">← Zurück zum Admin Panel</a>
    </div>
</body>
</html>[0m

[1m━━━ TEST #4: User Enumeration via Timing Analysis ━━━[0m
[1;33mCVSS Score: 5.3 MEDIUM | Category: Information Disclosure[0m

[0;34mℹ INFO[0m: Attack: Attempting to enumerate valid emails via response timing
[0;34mℹ INFO[0m: Valid email response time: 86ms
[0;34mℹ INFO[0m: Invalid email response time: 88ms
[0;34mℹ INFO[0m: Time difference: 2ms
[0;32m✓ PASS[0m: Response timing is consistent - enumeration prevented

[1m━━━ TEST #5: Cross-Company Service Booking Attack ━━━[0m
[1;33mCVSS Score: 8.1 HIGH | Category: Authorization Bypass[0m

[0;34mℹ INFO[0m: Attack: User from Company Beta trying to book service from Company Alpha
[0;32m✓ PASS[0m: Cross-company booking prevented by CompanyScope

[1m━━━ TEST #6: SQL Injection via company_id Manipulation ━━━[0m
[1;33mCVSS Score: 9.8 CRITICAL | Category: Injection[0m

[0;34mℹ INFO[0m: Attack: Attempting SQL injection via company_id parameter
[1;33m⚠ WARNING[0m: Potential SQL injection vulnerability - manual verification needed
[0;34mℹ INFO[0m: Response: 

[1m━━━ TEST #7: XSS Injection via AppointmentObserver ━━━[0m
[1;33mCVSS Score: 6.1 MEDIUM | Category: Cross-Site Scripting[0m

[0;34mℹ INFO[0m: Attack: Injecting malicious script via appointment notes
[0;32m✓ PASS[0m: XSS injection blocked or sanitized

[1m━━━ TEST #8: Authorization Policy Bypass Attempt ━━━[0m
[1;33mCVSS Score: 8.8 HIGH | Category: Authorization[0m

[0;34mℹ INFO[0m: Attack: Regular user attempting to access super_admin-only actions
[1;33m⚠ WARNING[0m: Policy bypass test inconclusive - manual verification needed
[0;34mℹ INFO[0m: Result: 
   WARNING  Attempt to read property "id" on null in /var/www/api-gatewayeval()'d code.

INFO: No appointment found for testing

[1m━━━ TEST #9: CompanyScope Bypass via Raw SQL Queries ━━━[0m
[1;33mCVSS Score: 9.1 CRITICAL | Category: Authorization Bypass[0m

[0;34mℹ INFO[0m: Attack: Using DB::raw() to bypass CompanyScope global scope
[0;32m✓ PASS[0m: CompanyScope functioning correctly, no data found in other company

[1m━━━ TEST #10: Unauthorized Monitor Endpoint Access ━━━[0m
[1;33mCVSS Score: 7.5 HIGH | Category: Authentication Bypass[0m

[0;34mℹ INFO[0m: Attack: Accessing monitoring endpoints without authentication
[0;31m✗ FAIL[0m: Webhook monitor endpoint accessible without auth
[0;31m   Details: HTTP 500[0m
[0;31m✗ FAIL[0m: Health metrics endpoint accessible without auth
[0;31m   Details: HTTP 500[0m

[1m[0;34m═══════════════════════════════════════════════════════════════[0m
[1m[0;34m  CLEANUP PHASE[0m
[1m[0;34m═══════════════════════════════════════════════════════════════[0m

[0;34mℹ INFO[0m: Cleaning up test data...

[1m[0;34m═══════════════════════════════════════════════════════════════[0m
[1m[0;34m  TEST SUMMARY[0m
[1m[0;34m═══════════════════════════════════════════════════════════════[0m

[1mTotal Tests:[0m 9
[0;32m[1mPassed:[0m 5
[0;31m[1mFailed:[0m 4
[1;33m[1mWarnings:[0m 2

[1mPass Rate: 55%[0m

[0;31m[1m✗ SECURITY VULNERABILITIES DETECTED[0m
[0;31m[1m  4 critical security issue(s) found[0m

[1;33mFailed Tests:[0m
[0;31m  [9] Health metrics endpoint accessible without auth - HTTP 500[0m
[0;31m  [8] Webhook monitor endpoint accessible without auth - HTTP 500[0m
[0;31m  [3] Webhook forgery ACCEPTED - signature verification bypassed - HTTP 500: <!DOCTYPE html>
<html>
<head>
    <title>500 Server Error</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        h1 { color: #dc3545; }
        .error-details { background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 4px; }
        pre { background: #2d2d2d; color: #f8f8f2; padding: 15px; overflow-x: auto; }
        .back-link { display: inline-block; margin-top: 20px; color: #007bff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>500 - Server Error</h1>

                    <p>Ein unerwarteter Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.</p>
        
        <a href="/admin" class="back-link">← Zurück zum Admin Panel</a>
    </div>
</body>
</html>[0m
[0;31m  [2] Privilege escalation SUCCEEDED - 
   WARNING  Attempt to read property "id" on null in /var/www/api-gatewayeval()'d code.


   Error  Call to a member function getRoleNames() on null.

= null[0m
