# =============================================================================
# Fail2ban Configuration for AskProAI
# =============================================================================
# CRITICAL: Place files in appropriate fail2ban directories
# /etc/fail2ban/jail.local (main config)
# /etc/fail2ban/filter.d/ (custom filters)

# -----------------------------------------------------------------------------
# Main Jail Configuration (/etc/fail2ban/jail.local)
# -----------------------------------------------------------------------------

[DEFAULT]
# Ban settings
bantime = 3600
findtime = 600
maxretry = 5
backend = auto
usedns = warn

# Email notifications (configure SMTP)
destemail = admin@askproai.de
sendername = AskProAI-Fail2ban
mta = sendmail

# Ban action (ban + email notification)
action = %(action_mwl)s

# Ignore trusted IPs (customize these)
ignoreip = 127.0.0.1/8 ::1
           192.168.1.0/24
           10.0.0.0/8

# -----------------------------------------------------------------------------
# SSH Protection
# -----------------------------------------------------------------------------
[sshd]
enabled = true
port = ssh
filter = sshd
logpath = /var/log/auth.log
maxretry = 3
bantime = 7200

# -----------------------------------------------------------------------------
# Nginx Protection
# -----------------------------------------------------------------------------
[nginx-http-auth]
enabled = true
filter = nginx-http-auth
port = http,https
logpath = /var/log/nginx/error.log
maxretry = 3
bantime = 1800

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
port = http,https
logpath = /var/log/nginx/error.log
maxretry = 5
bantime = 3600

[nginx-noscript]
enabled = true
port = http,https
filter = nginx-noscript
logpath = /var/log/nginx/access.log
maxretry = 6
bantime = 86400

[nginx-badbots]
enabled = true
port = http,https
filter = nginx-badbots
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

[nginx-noproxy]
enabled = true
port = http,https
filter = nginx-noproxy
logpath = /var/log/nginx/access.log
maxretry = 2
bantime = 86400

# -----------------------------------------------------------------------------
# AskProAI Application Protection
# -----------------------------------------------------------------------------
[askproai-auth]
enabled = true
port = http,https
filter = askproai-auth
logpath = /var/log/nginx/access.log
maxretry = 5
bantime = 1800
findtime = 300

[askproai-admin]
enabled = true
port = http,https
filter = askproai-admin
logpath = /var/log/nginx/access.log
maxretry = 3
bantime = 3600
findtime = 600

[askproai-webhook-abuse]
enabled = true
port = http,https
filter = askproai-webhook-abuse
logpath = /var/log/nginx/access.log
maxretry = 10
bantime = 7200
findtime = 60

# -----------------------------------------------------------------------------
# PHP Protection
# -----------------------------------------------------------------------------
[php-url-fopen]
enabled = true
port = http,https
filter = php-url-fopen
logpath = /var/log/nginx/access.log
maxretry = 1
bantime = 86400

# -----------------------------------------------------------------------------
# Custom Filter: AskProAI Auth (/etc/fail2ban/filter.d/askproai-auth.conf)
# -----------------------------------------------------------------------------

# [Definition]
# failregex = ^<HOST> .* "POST /api/(login|auth|verify) .* 401
#             ^<HOST> .* "POST /api/(login|auth|verify) .* 403
#             ^<HOST> .* "POST /api/(login|auth|verify) .* 422
# ignoreregex =

# -----------------------------------------------------------------------------
# Custom Filter: AskProAI Admin (/etc/fail2ban/filter.d/askproai-admin.conf)
# -----------------------------------------------------------------------------

# [Definition]
# failregex = ^<HOST> .* "GET /admin .* 401
#             ^<HOST> .* "GET /admin .* 403
#             ^<HOST> .* "POST /admin .* 401
#             ^<HOST> .* "POST /admin .* 403
# ignoreregex =

# -----------------------------------------------------------------------------
# Custom Filter: Webhook Abuse (/etc/fail2ban/filter.d/askproai-webhook-abuse.conf)
# -----------------------------------------------------------------------------

# [Definition]
# failregex = ^<HOST> .* "POST /api/(retell|calcom|stripe)/webhook .* 403
#             ^<HOST> .* "POST /api/(retell|calcom|stripe)/webhook .* 400
#             ^<HOST> .* "POST /api/(retell|calcom|stripe)/webhook .* 401
# ignoreregex =

# -----------------------------------------------------------------------------
# Custom Filter: PHP URL Fopen (/etc/fail2ban/filter.d/php-url-fopen.conf)
# -----------------------------------------------------------------------------

# [Definition]
# failregex = ^<HOST> .* "(GET|POST) .*(http|https|ftp|ftps)%3A%2F%2F
#             ^<HOST> .* "(GET|POST) .*file%3A%2F%2F
#             ^<HOST> .* "(GET|POST) .*php%3A%2F%2F
# ignoreregex =