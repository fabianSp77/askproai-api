<x-filament::widget>
    <x-filament::card>
        <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
            <span class="animate-pulse text-yellow-400 text-2xl">‚ö°</span>
            Integrationsstatus
            <span class="ml-2 text-xs text-gray-400 font-normal">(Live & Animated)</span>
        </h2>
        <div class="grid grid-cols-1 gap-8 sm:grid-cols-2 md:grid-cols-4">
            @foreach($this->getIntegrationStates() as $name => $info)
                <div class="flex flex-col items-center rounded-2xl shadow bg-white p-6 border border-gray-100 relative group transition-all duration-300 hover:scale-105 hover:shadow-lg min-h-[210px]">
                    <div>
                        @if($info['flowing'])
                            <span class="relative flex h-10 w-10 mb-3">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-10 w-10 bg-green-500 shadow-md"></span>
                            </span>
                        @elseif($info['status'] === 'online')
                            <span class="inline-block h-10 w-10 rounded-full bg-green-400 shadow-md mb-3"></span>
                        @else
                            <span class="inline-block h-10 w-10 rounded-full bg-red-500 animate-pulse shadow-md mb-3"></span>
                        @endif
                    </div>
                    <div class="mt-1 text-base font-semibold text-gray-900 flex items-center gap-2">
                        {{-- Ersatz f√ºr Heroicons, simple Emoji-Icons --}}
                        @if(Str::contains($name, 'Cal.com'))
                            <span class="text-blue-400 text-lg">üìÖ</span>
                        @elseif(Str::contains($name, 'Retell'))
                            <span class="text-rose-400 text-lg">üìû</span>
                        @elseif(Str::contains($name, 'Datenbank'))
                            <span class="text-indigo-400 text-lg">üíæ</span>
                        @elseif(Str::contains($name, 'Server'))
                            <span class="text-gray-400 text-lg">üñ•Ô∏è</span>
                        @endif
                        <span>{{ $name }}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        @if($info['last_success'])
                            <span>Zuletzt: {{ \Carbon\Carbon::parse($info['last_success'])->diffForHumans() }}</span>
                        @else
                            <span>Noch kein Erfolg</span>
                        @endif
                    </div>
                    <div class="text-sm mt-2 font-bold">
                        Status:
                        @if($info['status'] === 'online')
                            <span class="text-green-600">Online</span>
                        @else
                            <span class="text-red-600">Offline</span>
                        @endif
                    </div>
                    @if(!empty($info['history']))
                        <canvas id="chart-{{ md5($name) }}" width="120" height="30" class="mt-4"></canvas>
                        <script>
                            setTimeout(() => {
                                if(document.getElementById("chart-{{ md5($name) }}")) {
                                    new Chart(document.getElementById("chart-{{ md5($name) }}").getContext('2d'), {
                                        type: 'line',
                                        data: {
                                            labels: {!! json_encode(array_map(fn($t) => date('H:i', $t), $info['history'])) !!},
                                            datasets: [{
                                                data: {!! json_encode(array_map(fn($t) => 1, $info['history'])) !!},
                                                borderColor: "{{ $info['status']==='online' ? '#22c55e' : '#ef4444' }}",
                                                backgroundColor: 'rgba(34,197,94,0.12)',
                                                borderWidth: 2,
                                                pointRadius: 0,
                                                fill: true,
                                                tension: 0.4
                                            }]
                                        },
                                        options: {
                                            plugins: { legend: { display: false } },
                                            scales: { y: { display: false }, x: { display: false } },
                                            responsive: false,
                                        }
                                    });
                                }
                            }, 150);
                        </script>
                    @endif
                    <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition pointer-events-none text-xs text-gray-400">Live</div>
                </div>
            @endforeach
        </div>
    </x-filament::card>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</x-filament::widget>
