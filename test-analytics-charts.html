=== TEST 1: No Company Selected (Super Admin View) ===
CompanyId: NULL
Stats loaded: 11 items
Chart data: EMPTY
Heatmap data: EMPTY

=== TEST 2: Company Selected (ID: 1) ===
CompanyId: 1
Stats loaded: 8 items
Chart data: Has 4 keys
  - Labels: 31 days
  - Appointments: 31 data points
  - Revenue: 31 data points
  - Calls: 31 data points
Heatmap data: Has 7 days

=== TEST 3: HTML Output Test ===
<!DOCTYPE html>
<html>
<head>
    <title>Analytics Charts Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts@3.44.0/dist/apexcharts.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f3f4f6; }
        .container { max-width: 1200px; margin: 0 auto; }
        .chart-container { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        h2 { color: #333; margin-top: 0; }
        .status { padding: 10px; background: #e0f2fe; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Analytics Dashboard - Charts Test</h1>
        
        <div class="status">
            <strong>Company ID:</strong> 1<br>
            <strong>Date Range:</strong> 2025-07-07 to 2025-08-06<br>
            <strong>Has Chart Data:</strong> YES<br>
            <strong>Has Heatmap Data:</strong> YES        </div>

                    <div class="grid">
                <div class="chart-container">
                    <h2>Termine</h2>
                    <canvas id="appointmentsChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-container">
                    <h2>Umsatz</h2>
                    <canvas id="revenueChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-container">
                    <h2>Anrufverteilung</h2>
                    <canvas id="callDistributionChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-container">
                    <h2>Anrufe Timeline</h2>
                    <canvas id="callsTimelineChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h2>Heatmap</h2>
                <div id="heatmap"></div>
            </div>

            <script>
                // Chart data from PHP
                const chartData = {"labels":["07.07","08.07","09.07","10.07","11.07","12.07","13.07","14.07","15.07","16.07","17.07","18.07","19.07","20.07","21.07","22.07","23.07","24.07","25.07","26.07","27.07","28.07","29.07","30.07","31.07","01.08","02.08","03.08","04.08","05.08","06.08"],"appointments":[1,7,4,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,4],"revenue":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,174],"calls":[5,0,0,0,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};
                const heatmapData = [{"name":"Mo","data":[0,0,1,0,0,0,0,1,0,0,0,0,0]},{"name":"Di","data":[0,2,3,1,0,0,2,0,1,0,0,0,0]},{"name":"Mi","data":[0,1,1,0,0,0,0,2,0,0,0,0,0]},{"name":"Do","data":[0,0,0,0,0,0,0,0,0,0,0,0,0]},{"name":"Fr","data":[0,0,0,1,0,0,0,0,0,0,0,0,0]},{"name":"Sa","data":[0,0,0,0,0,0,0,0,0,0,0,0,0]},{"name":"So","data":[0,1,0,0,0,0,0,0,0,0,0,0,0]}];
                const callMetrics = {"inbound":{"total_calls":35,"answered_calls":15,"missed_calls":0,"answer_rate":42.9,"appointment_conversion_rate":0,"avg_call_duration":1.6,"peak_hours":[{"hour":12,"count":13},{"hour":13,"count":8},{"hour":18,"count":4}]},"outbound":{"total_calls":0,"connected_calls":0,"failed_calls":0,"connect_rate":0,"qualification_rate":0,"appointment_rate":0,"campaigns":[]}};
                
                console.log('Chart Data:', chartData);
                console.log('Heatmap Data:', heatmapData);
                
                // Initialize charts
                window.addEventListener('DOMContentLoaded', function() {
                    // 1. Appointments Chart
                    if (chartData.labels && chartData.appointments) {
                        const appointmentsCtx = document.getElementById('appointmentsChart').getContext('2d');
                        new Chart(appointmentsCtx, {
                            type: 'bar',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    label: 'Termine',
                                    data: chartData.appointments,
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    borderColor: 'rgb(59, 130, 246)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { beginAtZero: true } }
                            }
                        });
                    }
                    
                    // 2. Revenue Chart
                    if (chartData.labels && chartData.revenue) {
                        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                        new Chart(revenueCtx, {
                            type: 'line',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    label: 'Umsatz',
                                    data: chartData.revenue,
                                    borderColor: 'rgb(34, 197, 94)',
                                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            callback: function(value) {
                                                return value.toLocaleString('de-DE') + ' â‚¬';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                    
                    // 3. Call Distribution
                    const inbound = callMetrics?.inbound?.total_calls || 0;
                    const outbound = callMetrics?.outbound?.total_calls || 0;
                    if (inbound > 0 || outbound > 0) {
                        const callDistCtx = document.getElementById('callDistributionChart').getContext('2d');
                        new Chart(callDistCtx, {
                            type: 'doughnut',
                            data: {
                                labels: ['Eingehend', 'Ausgehend'],
                                datasets: [{
                                    data: [inbound, outbound],
                                    backgroundColor: [
                                        'rgba(34, 197, 94, 0.8)',
                                        'rgba(59, 130, 246, 0.8)'
                                    ],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { position: 'bottom' } }
                            }
                        });
                    }
                    
                    // 4. Calls Timeline
                    if (chartData.labels && chartData.calls) {
                        const callsTimelineCtx = document.getElementById('callsTimelineChart').getContext('2d');
                        new Chart(callsTimelineCtx, {
                            type: 'line',
                            data: {
                                labels: chartData.labels,
                                datasets: [{
                                    label: 'Anrufe',
                                    data: chartData.calls,
                                    borderColor: 'rgb(168, 85, 247)',
                                    backgroundColor: 'rgba(168, 85, 247, 0.1)',
                                    tension: 0.4
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: false } },
                                scales: { y: { beginAtZero: true } }
                            }
                        });
                    }
                    
                    // 5. Heatmap
                    if (heatmapData && heatmapData.length > 0) {
                        const heatmapOptions = {
                            series: heatmapData,
                            chart: {
                                height: 350,
                                type: 'heatmap',
                                toolbar: { show: false }
                            },
                            plotOptions: {
                                heatmap: {
                                    shadeIntensity: 0.5,
                                    colorScale: {
                                        ranges: [
                                            { from: 0, to: 0, name: 'Keine', color: '#E5E7EB' },
                                            { from: 1, to: 3, name: 'Wenig', color: '#DBEAFE' },
                                            { from: 4, to: 7, name: 'Mittel', color: '#93C5FD' },
                                            { from: 8, to: 12, name: 'Viel', color: '#3B82F6' }
                                        ]
                                    }
                                }
                            },
                            xaxis: {
                                type: 'category',
                                categories: ['8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00']
                            },
                            title: { text: 'Termine nach Wochentag und Uhrzeit' }
                        };
                        
                        const heatmap = new ApexCharts(document.querySelector("#heatmap"), heatmapOptions);
                        heatmap.render();
                    }
                    
                    console.log('âœ… All charts initialized!');
                });
            </script>
            </div>
</body>
</html>