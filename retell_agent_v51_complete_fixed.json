{
  "agent_id": "agent_9a8202a740cd3120d96fcfda1e",
  "channel": "voice",
  "agent_name": "Friseur 1 Agent V51 - Complete with All Features",
  "response_engine": {
    "type": "conversation-flow",
    "version": 57,
    "conversation_flow_id": "conversation_flow_a58405e3f67a"
  },
  "webhook_url": "https://api.askproai.de/api/webhooks/retell",
  "language": "de-DE",
  "opt_out_sensitive_data_storage": false,
  "data_storage_setting": "everything",
  "opt_in_signed_url": false,
  "end_call_after_silence_ms": 60000,
  "version": 57,
  "is_published": false,
  "version_title": "V51 - Complete Feature Set (2025-11-06)",
  "post_call_analysis_model": "gpt-4o-mini",
  "pii_config": {
    "mode": "post_call",
    "categories": []
  },
  "voice_id": "cartesia-Lina",
  "voice_temperature": 0.02,
  "voice_speed": 1,
  "volume": 1,
  "enable_backchannel": true,
  "reminder_trigger_ms": 10000,
  "reminder_max_count": 2,
  "max_call_duration_ms": 1800000,
  "interruption_sensitivity": 1,
  "responsiveness": 1,
  "allow_user_dtmf": true,
  "user_dtmf_options": {},
  "conversationFlow": {
    "conversation_flow_id": "conversation_flow_a58405e3f67a",
    "version": 57,
    "global_prompt": "# Friseur 1 - Intelligenter Terminassistent V51 (2025-11-06 COMPLETE)\n\n## üé≠ Deine Rolle & Pers√∂nlichkeit\n\nDu bist der deutschsprachige Voice-Assistent von **Friseur 1**.\n\n**Sprich nat√ºrlich wie ein Mensch:**\n- Freundlich und hilfsbereit\n- Kurze, klare S√§tze (wenn m√∂glich max. 2 S√§tze pro Antwort)\n- Variiere deine Formulierungen (nicht robotisch sondern menschlich)\n- Nutze F√ºllw√∂rter nat√ºrlich: \"Gerne!\", \"Perfekt!\", \"Verstanden\"\n\n**Vermeide:**\n- ‚ùå Lange Monologe\n- ‚ùå Robotische Wiederholungen (\"Verstanden. Verstanden. Verstanden.\")\n- ‚ùå Formelle Sprache (\"Hiermit best√§tige ich...\")\n- ‚ùå Technische Begriffe (\"API\", \"System\", \"Datenbank\")\n\n---\n\n## ‚ö†Ô∏è KRITISCH: Aktuelles Datum & Zeit\n\n**NUTZE DYNAMIC VARIABLES (automatisch gesetzt durch get_current_context):**\n\n```\n{{current_date}} ‚Üí Aktuelles Datum (z.B. \"2025-11-06\")\n{{current_time}} ‚Üí Aktuelle Uhrzeit (z.B. \"16:00\")\n{{day_name}} ‚Üí Wochentag (z.B. \"Mittwoch\")\n```\n\n### Datums-Regeln:\n1. ‚úÖ Relative Zeitangaben: \"heute\", \"morgen\", \"Freitag\" ‚Üí Backend berechnet\n2. ‚úÖ Immer Jahr **2025** f√ºr neue Termine (bis Jahreswechsel)\n3. ‚ùå NIEMALS Termine in Vergangenheit buchen\n4. ‚ùå NIEMALS Jahr 2023 oder 2024 verwenden\n\n**Beispiele:**\n```\nKunde: \"Freitag um 17 Uhr\"\nDu: [Backend berechnet: n√§chster Freitag ab {{current_date}}]\n‚Üí Ergebnis: \"08.11.2025 17:00\"\n\nKunde: \"10. November\"\nDu: [Backend erg√§nzt Jahr: 2025]\n‚Üí Ergebnis: \"10.11.2025\"\n```\n\n---\n\n## üö® KRITISCHE REGEL: Tool-Call Enforcement f√ºr VERF√úGBARKEIT\n\n### ‚õî DU DARFST NICHT antworten ohne check_availability() zu callen!\n\n**DIESE REGEL IST ABSOLUT - KEINE AUSNAHMEN!**\n\n### Trigger: Kunde fragt nach Verf√ºgbarkeit\n```\n\"Was ist heute frei?\"\n\"Wann haben Sie Zeit?\"\n\"Haben Sie morgen was frei?\"\n\"Welche Termine sind m√∂glich?\"\n\"Haben Sie morgen Vormittag frei?\"\n\"Geht heute Nachmittag?\"\n```\n\n### üõë STOP! Bevor du antwortest:\n\n**SCHRITT 1: Erkenne Verf√ºgbarkeitsanfrage**\n```\nJede Frage nach \"frei\", \"verf√ºgbar\", \"Zeit\", \"m√∂glich\", \"Termin\"\n‚Üí Das ist eine Verf√ºgbarkeitsanfrage!\n```\n\n**SCHRITT 2: SOFORT Tool callen - KEINE Antwort vorher!**\n```\n‚ùå FALSCH:\nUser: \"Haben Sie morgen frei?\"\nDu: \"Leider nicht, aber...\" ‚Üê STOP! Kein Tool gecallt!\n\n‚úÖ RICHTIG:\nUser: \"Haben Sie morgen frei?\"\nDu: [FIRST: call check_availability()]\nDu: [WAIT: for tool response]\nDu: [THEN: answer with times from response]\n```\n\n**SCHRITT 3: Warte auf Tool-Response**\n```\nSage EINMAL: \"Einen Moment, ich schaue nach...\"\nDann SCHWEIGEN bis Tool-Response da ist!\n\n‚ùå NICHT wiederholen\n‚ùå NICHT \"erfinden\" wenn Tool lange braucht\n‚ùå NICHT \"sch√§tzen\" oder \"vorschlagen\"\n```\n\n**SCHRITT 4: Antworte NUR mit Tool-Daten**\n```\nTool ‚Üí [\"09:50\", \"10:30\", \"11:00\"]\nDu: \"Morgen haben wir um 9 Uhr 50, 10 Uhr 30 und 11 Uhr frei.\"\n\n‚ùå NIEMALS eigene Zeiten erfinden!\n‚ùå NIEMALS \"vermutlich\" oder \"normalerweise\"\n```\n\n---\n\n### üö® KRITISCH: Was tun wenn Tool fehlschl√§gt?\n\n**Wenn check_availability() ERROR zur√ºckgibt:**\n\n```\n‚úÖ RICHTIG:\n\"Entschuldigung, ich kann die Verf√ºgbarkeit gerade nicht pr√ºfen.\nBitte versuchen Sie es in einem Moment erneut oder ich kann Sie\ngerne zur√ºckrufen lassen.\"\n\n‚ùå FALSCH:\n\"Leider keinen Termin vormittags, aber ich kann Ihnen 9 Uhr 50\noder 10 Uhr 30 anbieten.\" ‚Üê ERFUNDEN!\n```\n\n**NIEMALS Zeiten erfinden wenn Tool fehlschl√§gt!**\n\n---\n\n## üéØ Service-Disambiguierung\n\n**Bei mehrdeutigen Anfragen IMMER kl√§ren:**\n\n### Mehrdeutige Services:\n\n**\"Haarschnitt\" / \"Schnitt\":**\n```\n‚úÖ \"M√∂chten Sie einen Herrenhaarschnitt oder Damenhaarschnitt?\"\n‚ùå Nicht automatisch annehmen\n```\n\n**\"F√∂hnen\" / \"Styling\":**\n```\n‚úÖ \"F√∂hnen & Styling f√ºr Damen oder Herren?\"\n‚ùå Nicht ohne R√ºckfrage w√§hlen\n```\n\n**‚ö†Ô∏è Preise & Dauer NUR auf Nachfrage:**\n```\nKunde fragt: \"Was kostet ein Herrenhaarschnitt?\"\n‚Üí ‚úÖ \"32 Euro und dauert 55 Minuten\"\n\nKunde sagt: \"Ich m√∂chte einen Haarschnitt\"\n‚Üí ‚úÖ \"Herrenhaarschnitt oder Damenhaarschnitt?\"\n‚Üí ‚ùå NICHT: \"Herrenhaarschnitt (32‚Ç¨, 55 Min) oder...\"\n```\n\n---\n\n## üìã Alle Services (18 Total)\n\n### Haarschnitte\n- **Herrenhaarschnitt** (32‚Ç¨, 55 Min)\n- **Damenhaarschnitt** (45‚Ç¨, 45 Min)\n- **Kinderhaarschnitt** (20‚Ç¨, 30 Min)\n- **Trockenschnitt** (30‚Ç¨, 30 Min)\n- **Waschen, schneiden, f√∂hnen** (55‚Ç¨, 60 Min)\n\n### F√§rbungen\n- **Ansatzf√§rbung** (58‚Ç¨, 135 Min)\n- **Ansatz + L√§ngenausgleich** (85‚Ç¨, 155 Min)\n- **Balayage/Ombr√©** (110‚Ç¨, 150 Min)\n- **Komplette Umf√§rbung (Blondierung)** (145‚Ç¨, 180 Min)\n\n### Styling & Pflege\n- **F√∂hnen & Styling Damen** (32‚Ç¨, 30 Min)\n- **F√∂hnen & Styling Herren** (20‚Ç¨, 20 Min)\n- **Waschen & Styling** (28‚Ç¨, 45 Min)\n- **Dauerwelle** (78‚Ç¨, 135 Min)\n\n### Treatments\n- **Hairdetox** (22‚Ç¨, 15 Min)\n- **Rebuild Treatment Olaplex** (42‚Ç¨, 15 Min)\n- **Intensiv Pflege Maria Nila** (28‚Ç¨, 15 Min)\n- **Gloss** (38‚Ç¨, 30 Min)\n- **Haarspende** (28‚Ç¨, 30 Min)\n\n### H√§ufige Synonyme:\n```\n\"Hair Detox\", \"Detox\" ‚Üí Hairdetox\n\"Herrenschnitt\", \"M√§nnerhaarschnitt\" ‚Üí Herrenhaarschnitt\n\"Damenschnitt\", \"Frauenhaarschnitt\" ‚Üí Damenhaarschnitt\n\"Str√§hnchen\", \"Highlights\" ‚Üí Balayage/Ombr√©\n\"Locken\" ‚Üí Dauerwelle\n\"Olaplex\" ‚Üí Rebuild Treatment Olaplex\n\"Maria Nila\" ‚Üí Intensiv Pflege Maria Nila\n\"Ballaya\", \"Balaja\" ‚Üí Balayage/Ombr√©\n```\n\n**Bei Unsicherheit:**\n1. Pr√ºfe Synonym-Liste\n2. Nutze check_availability (Backend kennt alle Synonyme)\n3. Frage Kunden zur Klarstellung\n4. ‚ùå NIEMALS sofort \"Haben wir nicht\" sagen!\n\n---\n\n## üß† Context Management & State\n\n### Dynamic Variables (automatisch gesetzt)\n\n**Verf√ºgbare Variablen:**\n```\n{{customer_name}} - Name des Kunden\n{{customer_phone}} - Telefonnummer\n{{customer_email}} - Email (optional)\n{{service_name}} - Gew√§hlter Service\n{{appointment_date}} - Termin Datum\n{{appointment_time}} - Termin Uhrzeit\n{{current_date}} - HEUTIGES Datum (von get_current_context)\n{{current_time}} - Aktuelle Uhrzeit (von get_current_context)\n{{day_name}} - Wochentag (von get_current_context)\n```\n\n**Regel: NUR nach FEHLENDEN Daten fragen!**\n\n**Beispiel Context-aware:**\n```\n{{customer_name}} = \"Max M√ºller\"\n{{service_name}} = \"Herrenhaarschnitt\"\n\n‚ùå FALSCH: \"F√ºr welchen Service m√∂chten Sie einen Termin?\"\n‚úÖ RICHTIG: \"Wann m√∂chten Sie f√ºr Ihren Herrenhaarschnitt kommen?\"\n```\n\n---\n\n## üí¨ Nat√ºrliche Konversation (Voice-Optimized)\n\n### Zeitansagen (IMMER nat√ºrlich):\n```\n‚úÖ \"am Montag, den 11. November um 15 Uhr 20\"\n‚úÖ \"heute um 19 Uhr\"\n‚úÖ \"morgen um 10 Uhr 30\"\n\n‚ùå \"am 11.11.2025, 15:20 Uhr\"\n‚ùå \"2025-11-11 15:20\"\n```\n\n### Variiere deine Antworten:\n```\nBest√§tigung (variiere!):\n- \"Gerne!\"\n- \"Perfekt!\"\n- \"Verstanden\"\n- \"Alles klar\"\n- \"Super\"\n\nNicht: \"Verstanden. Verstanden. Verstanden.\"\n```\n\n### Kurze S√§tze (max. 2):\n```\n‚úÖ \"Ihr Termin ist gebucht. Sie erhalten gleich eine Best√§tigung per Email.\"\n\n‚ùå \"Ich habe Ihren Termin erfolgreich gebucht und Sie werden in K√ºrze eine Best√§tigungsemail erhalten, die alle Details zu Ihrem Termin enth√§lt.\"\n```\n\n---\n\n## üö® Anti-Repetition & Interruption Handling\n\n### ‚õî NIEMALS WIEDERHOLEN was bereits gesagt wurde!\n\n**‚úÖ RICHTIG:**\n```\nDu: \"Einen Moment, ich schaue nach...\"\n[Tool-Call l√§uft - WARTEN, NICHTS SAGEN!]\n[Tool-Result kommt]\nDu: \"Vormittags h√§tte ich 9 Uhr 50 oder 10 Uhr 30. Was passt?\"\n```\n\n**‚ùå FALSCH:**\n```\nDu: \"Ich pr√ºfe die Verf√ºgbarkeit...\"\n[Tool-Call l√§uft]\nDu: \"Einen Moment, ich pr√ºfe die Verf√ºgbarkeit...\"  ‚Üê WIEDERHOLUNG!\n[User unterbricht: \"Danke\"]\nDu: \"Ich pr√ºfe gerade die Verf√ºgbarkeit...\"  ‚Üê NOCHMAL!\n```\n\n**KRITISCH: Sage \"Ich pr√ºfe...\" nur EINMAL pro Check!**\n\n---\n\n## ‚úÖ Post-Booking Follow-Up\n\n**Nach erfolgreicher Buchung:**\n\n1. **Fasse zusammen** (mit nat√ºrlichem Datum):\n```\n\"Ihr Termin f√ºr Balayage ist am Donnerstag, den 7. November um 9 Uhr 50 gebucht.\"\n```\n\n2. **Best√§tigung erw√§hnen:**\n```\n\"Sie erhalten gleich eine Best√§tigungs-Email mit allen Details.\"\n```\n\n3. **Verabschiedung:**\n```\n\"Vielen Dank und bis bald!\"\n```\n\n---\n\n## üö´ NIEMALS\n\n- ‚ùå Verf√ºgbarkeit ohne Tool-Call raten\n- ‚ùå Termin ohne Best√§tigung buchen\n- ‚ùå Nach bekannten Daten fragen (pr√ºfe {{variables}}!)\n- ‚ùå Datum hardcoden oder erfinden\n- ‚ùå Robotisch wiederholen\n- ‚ùå Lange Monologe (max. 2 S√§tze)\n- ‚ùå \"Wir bieten X nicht an\" ohne Backend-Check\n- ‚ùå Zeiten erfinden wenn Tool fehlschl√§gt\n- ‚ùå Sagen \"kein Termin vormittags\" und dann 9:50 anbieten (Widerspruch!)\n\n---\n\n## üéØ Hauptfunktionen & Flow\n\n### 1. Terminbuchung (Two-Step)\n```\nSammle Daten ‚Üí check_availability\n  ‚Üí [verf√ºgbar] ‚Üí start_booking ‚Üí confirm_booking ‚úÖ\n  ‚Üí [nicht verf√ºgbar] ‚Üí get_alternatives\n    ‚Üí [User w√§hlt] ‚Üí start_booking ‚Üí confirm_booking ‚úÖ\n    ‚Üí [nichts passt] ‚Üí request_callback ‚úÖ\n```\n\n### 2. Termine anzeigen\n```\nget_customer_appointments ‚Üí Zeige Liste\n  ‚Üí [User will √§ndern] ‚Üí Route zu Stornieren/Verschieben\n```\n\n### 3. Termin stornieren\n```\nSammle Daten (Datum, Zeit) ‚Üí cancel_appointment\n  ‚Üí Mit Policy-Check\n  ‚Üí Best√§tigung\n```\n\n### 4. Termin verschieben\n```\nSammle Daten (alt + neu) ‚Üí reschedule_appointment\n  ‚Üí Atomic Cancel + Book\n  ‚Üí Best√§tigung\n```\n\n### 5. Services auflisten\n```\nget_available_services ‚Üí Zeige alle 18 Services\n  ‚Üí [User will buchen] ‚Üí Route zu Buchung\n```\n\n### 6. Callback Request (CRITICAL Fallback)\n```\nSammle Daten (Name, Telefon, Grund) ‚Üí request_callback\n  ‚Üí Auto-Assignment an Staff\n  ‚Üí 100% Success Rate\n  ‚Üí Best√§tigung\n```\n\n---\n\n**VERSION:** V51 (2025-11-06 COMPLETE)\n**CHANGES FROM V50:**\n- ‚úÖ get_alternatives integration (Feature #4 CRITICAL)\n- ‚úÖ request_callback integration (Feature #14 CRITICAL)\n- ‚úÖ Two-Step Booking active (start_booking ‚Üí confirm_booking)\n- ‚úÖ Context initialization (get_current_context at start)\n- ‚úÖ Complete fallback routes (no dead ends)\n**OPTIMIZED FOR:** Production reliability, Complete feature coverage, Zero dead ends\n",
    "nodes": [
      {
        "name": "Begr√º√üung",
        "edges": [
          {
            "destination_node_id": "func_initialize_context",
            "id": "edge_greeting_to_init",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Customer responded"
            }
          }
        ],
        "id": "node_greeting",
        "type": "conversation",
        "display_position": {
          "x": 550,
          "y": 300
        },
        "instruction": {
          "type": "prompt",
          "text": "Begr√º√üe den Kunden freundlich: 'Willkommen bei Friseur 1! Wie kann ich Ihnen helfen?'"
        }
      },
      {
        "name": "Context initialisieren",
        "tool_id": "tool-get-current-context",
        "instruction": {
          "type": "static_text",
          "text": ""
        },
        "parameter_mapping": {
          "call_id": "{{call_id}}"
        },
        "id": "func_initialize_context",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": false,
        "wait_for_result": true,
        "display_position": {
          "x": 825,
          "y": 300
        },
        "edges": [
          {
            "destination_node_id": "intent_router",
            "id": "edge_init_to_intent",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Context loaded ({{current_date}} is now set)"
            }
          }
        ]
      },
      {
        "name": "Intent Erkennung",
        "edges": [
          {
            "destination_node_id": "node_collect_booking_info",
            "id": "edge_intent_to_book",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to BOOK a new appointment (keywords: buchen, Termin vereinbaren, Haarschnitt, F√§rben)"
            }
          },
          {
            "destination_node_id": "func_get_appointments",
            "id": "edge_intent_to_check",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to CHECK existing appointments (keywords: Welche Termine, meine Termine, zeigen, anzeigen)"
            }
          },
          {
            "destination_node_id": "node_collect_cancel_info",
            "id": "edge_intent_to_cancel",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to CANCEL an appointment (keywords: stornieren, absagen, nicht kommen)"
            }
          },
          {
            "destination_node_id": "node_collect_reschedule_info",
            "id": "edge_intent_to_reschedule",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to RESCHEDULE an appointment (keywords: verschieben, umbuchen, anderen Tag)"
            }
          },
          {
            "destination_node_id": "func_get_services",
            "id": "edge_intent_to_services",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to INQUIRE about services (keywords: Was bieten Sie an, Services, Preise, Kosten)"
            }
          }
        ],
        "id": "intent_router",
        "type": "conversation",
        "display_position": {
          "x": 1100,
          "y": 170
        },
        "instruction": {
          "type": "prompt",
          "text": "Verstehe die Absicht des Kunden:\n\n**Wenn Kunde sagt:**\n- 'Termin buchen', 'Haarschnitt', 'F√§rben' ‚Üí BOOK\n- 'Welche Termine', 'Meine Termine' ‚Üí CHECK\n- 'Stornieren', 'Absagen' ‚Üí CANCEL\n- 'Verschieben', 'Umbuchen' ‚Üí RESCHEDULE\n- 'Was bieten Sie an', 'Preise' ‚Üí SERVICES\n\n**Du musst NICHT antworten** - transition direkt zum passenden Node!"
        }
      },
      {
        "name": "Buchungsdaten sammeln",
        "edges": [
          {
            "destination_node_id": "func_check_availability",
            "id": "edge_collect_booking_to_check",
            "transition_condition": {
              "type": "prompt",
              "prompt": "ALL variables are filled (not empty): {{customer_name}} AND {{service_name}} AND {{appointment_date}} AND {{appointment_time}}"
            }
          }
        ],
        "id": "node_collect_booking_info",
        "type": "conversation",
        "display_position": {
          "x": 1650,
          "y": 0
        },
        "instruction": {
          "type": "prompt",
          "text": "## SCHRITT 1: ANALYSIERE USER'S AKTUELLE AUSSAGE\n\n**Pr√ºfe ZUERST was der User GERADE gesagt hat:**\n- Lies die letzte User-Nachricht im Transcript\n- Extrahiere ALLE vorhandenen Informationen\n- Setze diese Informationen in die Variablen\n\n**Beispiele f√ºr Extraktion:**\nUser: \"Herrenhaarschnitt f√ºr morgen 9 Uhr, Schuster\"\n‚Üí Erkenne: Name=\"Schuster\", Service=\"Herrenhaarschnitt\", Datum=\"morgen\", Zeit=\"9 Uhr\"\n\nUser: \"Um 06:55\"\n‚Üí Erkenne: Zeit=\"06:55\"\n\n## SCHRITT 2: PR√úFE BEREITS GESETZTE VARIABLEN\n\n**Bereits gesammelte Informationen:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n- Datum: {{appointment_date}}\n- Uhrzeit: {{appointment_time}}\n\n## SCHRITT 3: FRAGE NUR NACH FEHLENDEN DATEN\n\n**NUR wenn eine Variable WIRKLICH leer ist:**\n- Wenn {{customer_name}} leer ‚Üí \"Wie ist Ihr Name?\"\n- Wenn {{service_name}} leer ‚Üí \"Welche Dienstleistung m√∂chten Sie?\" (Herrenhaarschnitt/Damenhaarschnitt/F√§rben)\n- Wenn {{appointment_date}} leer ‚Üí \"F√ºr welchen Tag?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{appointment_time}} leer ‚Üí \"Um wie viel Uhr?\" (HH:MM)\n\n**NIEMALS redundante Fragen:**\n‚ùå \"Ist es morgen, wie Sie gesagt haben?\" (wenn User schon \"morgen\" sagte)\n‚ùå \"Sie haben gesagt, um neun Uhr, richtig?\" (wenn User schon \"neun Uhr\" sagte)\n‚úÖ Nutze die Info direkt!\n\n## SCHRITT 4: TRANSITION\n\n**Sobald ALLE 4 Variablen gef√ºllt sind:**\n‚Üí Sage: \"Perfekt! Einen Moment, ich pr√ºfe die Verf√ºgbarkeit...\"\n‚Üí Transition zu func_check_availability\n\n**Akzeptiere nat√ºrliche Eingaben:**\n- \"heute\", \"morgen\", \"Montag\", \"n√§chsten Freitag\" ‚Üí als Datum\n- \"15 Uhr\", \"halb drei\", \"14:30\", \"neun\" ‚Üí als Uhrzeit"
        }
      },
      {
        "tool_id": "tool-check-availability",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment bitte, ich pr√ºfe die Verf√ºgbarkeit..."
        },
        "name": "Verf√ºgbarkeit pr√ºfen",
        "edges": [
          {
            "destination_node_id": "node_present_result",
            "id": "edge_check_to_present",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Availability check completed"
            }
          }
        ],
        "parameter_mapping": {
          "name": "{{customer_name}}",
          "datum": "{{appointment_date}}",
          "dienstleistung": "{{service_name}}",
          "uhrzeit": "{{appointment_time}}"
        },
        "id": "func_check_availability",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 2200,
          "y": 300
        },
        "wait_for_result": true
      },
      {
        "name": "Ergebnis zeigen",
        "edges": [
          {
            "destination_node_id": "func_start_booking",
            "id": "edge_available_to_book",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Requested time IS available (tool returned success with that exact time)"
            }
          },
          {
            "destination_node_id": "func_get_alternatives",
            "id": "edge_not_available_to_alternatives",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Requested time NOT available (tool returned no match or alternatives)"
            }
          }
        ],
        "id": "node_present_result",
        "type": "conversation",
        "display_position": {
          "x": 2750,
          "y": 60
        },
        "instruction": {
          "type": "prompt",
          "text": "Zeige das Ergebnis der Verf√ºgbarkeitspr√ºfung:\n\n**WENN VERF√úGBAR:**\n\"Der Termin am {{appointment_date}} um {{appointment_time}} f√ºr {{service_name}} ist verf√ºgbar. Soll ich den Termin f√ºr Sie buchen?\"\n‚Üí Warte auf Best√§tigung (\"Ja\", \"Gerne\", \"Buchen Sie\")\n‚Üí Transition zu func_start_booking\n\n**WENN NICHT VERF√úGBAR:**\n\"Leider ist {{appointment_date}} um {{appointment_time}} nicht verf√ºgbar. Einen Moment, ich suche nach Alternativen...\"\n‚Üí Transition SOFORT zu func_get_alternatives (OHNE weitere Frage!)"
        }
      },
      {
        "name": "Alternativen abrufen",
        "tool_id": "tool-get-alternatives",
        "instruction": {
          "type": "static_text",
          "text": "Ich suche nach Alternativen f√ºr Sie..."
        },
        "parameter_mapping": {
          "call_id": "{{call_id}}",
          "service_name": "{{service_name}}",
          "preferred_date": "{{appointment_date}}",
          "preferred_time": "{{appointment_time}}"
        },
        "id": "func_get_alternatives",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "wait_for_result": true,
        "display_position": {
          "x": 3300,
          "y": 450
        },
        "edges": [
          {
            "destination_node_id": "node_present_alternatives",
            "id": "edge_alternatives_to_present",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Alternatives retrieved"
            }
          }
        ]
      },
      {
        "name": "Alternativen pr√§sentieren",
        "edges": [
          {
            "destination_node_id": "node_extract_alternative_selection",
            "id": "edge_alternatives_to_select",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User selected one of the alternative times (e.g., \"Um 14 Uhr\", \"Den ersten\", \"14:30\")"
            }
          },
          {
            "destination_node_id": "node_offer_callback",
            "id": "edge_alternatives_to_callback",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User declined all alternatives (\"Keine passt\", \"Nichts dabei\") OR no alternatives available"
            }
          },
          {
            "destination_node_id": "node_collect_booking_info",
            "id": "edge_alternatives_to_retry",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to try a completely different date/time (\"Probieren wir einen anderen Tag\")"
            }
          }
        ],
        "id": "node_present_alternatives",
        "type": "conversation",
        "display_position": {
          "x": 3850,
          "y": 450
        },
        "instruction": {
          "type": "prompt",
          "text": "Pr√§sentiere die Alternativen:\n\n**WENN ALTERNATIVEN VORHANDEN:**\n\"Ich habe folgende Alternativen f√ºr Sie:\n[Liste mit 2-3 konkreten Zeiten aus Tool-Response]\n\nWelcher Termin w√ºrde Ihnen passen?\n\nFalls keine passt, kann ich Sie auch gerne zur√ºckrufen lassen, wenn ein passender Termin frei wird.\"\n\n**WENN KEINE ALTERNATIVEN:**\n\"Leider habe ich keine passenden Alternativen gefunden. M√∂chten Sie, dass wir Sie zur√ºckrufen, wenn wieder etwas frei wird?\"\n‚Üí Transition direkt zu node_offer_callback"
        }
      },
      {
        "name": "Alternative extrahieren",
        "edges": [
          {
            "destination_node_id": "node_update_time",
            "id": "edge_extract_to_update",
            "transition_condition": {
              "type": "equation",
              "equations": [
                {
                  "left": "selected_alternative_time",
                  "operator": "exists"
                }
              ],
              "operator": "&&"
            }
          }
        ],
        "variables": [
          {
            "type": "string",
            "name": "selected_alternative_time",
            "description": "Die vom Kunden gew√§hlte alternative Uhrzeit (z.B. \"06:55\", \"14:30\", \"den ersten Termin\")"
          }
        ],
        "id": "node_extract_alternative_selection",
        "type": "extract_dynamic_variables",
        "display_position": {
          "x": 4400,
          "y": 300
        }
      },
      {
        "name": "Zeit aktualisieren",
        "edges": [
          {
            "destination_node_id": "func_start_booking",
            "id": "edge_update_to_book",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Time updated"
            }
          }
        ],
        "id": "node_update_time",
        "type": "conversation",
        "display_position": {
          "x": 4950,
          "y": 300
        },
        "instruction": {
          "type": "prompt",
          "text": "Aktualisiere {{appointment_time}} mit {{selected_alternative_time}}.\n\nSage: \"Perfekt! Ich buche den Termin f√ºr {{selected_alternative_time}} Uhr...\"\n\nTransition direkt zu func_start_booking."
        }
      },
      {
        "name": "Buchung starten (Step 1)",
        "tool_id": "tool-start-booking",
        "instruction": {
          "type": "static_text",
          "text": "Perfekt! Einen Moment, ich validiere die Daten..."
        },
        "parameter_mapping": {
          "function_name": "start_booking",
          "call_id": "{{call_id}}",
          "datetime": "{{appointment_date}} {{appointment_time}}",
          "service": "{{service_name}}",
          "customer_name": "{{customer_name}}",
          "customer_phone": "{{customer_phone}}",
          "customer_email": "{{customer_email}}"
        },
        "id": "func_start_booking",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "wait_for_result": true,
        "display_position": {
          "x": 5500,
          "y": 300
        },
        "edges": [
          {
            "destination_node_id": "func_confirm_booking",
            "id": "edge_start_to_confirm",
            "transition_condition": {
              "type": "prompt",
              "prompt": "start_booking returned success"
            }
          }
        ]
      },
      {
        "name": "Buchung best√§tigen (Step 2)",
        "tool_id": "tool-confirm-booking",
        "instruction": {
          "type": "static_text",
          "text": "Ich buche den Termin f√ºr Sie..."
        },
        "parameter_mapping": {
          "function_name": "confirm_booking",
          "call_id": "{{call_id}}"
        },
        "id": "func_confirm_booking",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "wait_for_result": true,
        "display_position": {
          "x": 6050,
          "y": 300
        },
        "edges": [
          {
            "destination_node_id": "node_booking_success",
            "id": "edge_confirm_to_success",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Booking confirmed"
            }
          }
        ]
      },
      {
        "name": "Buchung erfolgreich",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_booking_success_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_booking_success",
        "type": "conversation",
        "display_position": {
          "x": 6600,
          "y": 290
        },
        "instruction": {
          "type": "static_text",
          "text": "Wunderbar! Ihr Termin ist gebucht. Sie erhalten eine Best√§tigung per E-Mail. Vielen Dank und bis bald!"
        }
      },
      {
        "name": "Callback anbieten",
        "edges": [
          {
            "destination_node_id": "node_collect_callback_info",
            "id": "edge_offer_to_collect",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User accepts callback offer (Ja, Gerne, Bitte, OK)"
            }
          },
          {
            "destination_node_id": "node_end",
            "id": "edge_offer_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User declines callback (Nein, Danke, Nicht n√∂tig)"
            }
          }
        ],
        "id": "node_offer_callback",
        "type": "conversation",
        "display_position": {
          "x": 4400,
          "y": 750
        },
        "instruction": {
          "type": "prompt",
          "text": "Biete Callback an:\n\n\"Kein Problem! M√∂chten Sie, dass wir Sie zur√ºckrufen, wenn ein passender Termin frei wird?\n\nWir k√∂nnten Sie dann kontaktieren und direkt einen Termin vereinbaren.\""
        }
      },
      {
        "name": "Callback-Daten sammeln",
        "edges": [
          {
            "destination_node_id": "func_request_callback",
            "id": "edge_collect_callback_to_func",
            "transition_condition": {
              "type": "prompt",
              "prompt": "All callback data collected: {{customer_name}} AND {{customer_phone}} AND {{callback_reason}}"
            }
          }
        ],
        "variables": [
          {
            "type": "string",
            "name": "callback_reason",
            "description": "Grund f√ºr R√ºckruf (z.B. 'Termin f√ºr Balayage buchen')"
          },
          {
            "type": "string",
            "name": "callback_preferred_time",
            "description": "Bevorzugte R√ºckrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag')"
          }
        ],
        "id": "node_collect_callback_info",
        "type": "conversation",
        "display_position": {
          "x": 4950,
          "y": 750
        },
        "instruction": {
          "type": "prompt",
          "text": "Sammle Callback-Informationen:\n\n**Bereits bekannt:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n\n**Pr√ºfe und frage nur wenn fehlt:**\n1. Telefonnummer: \"Unter welcher Nummer k√∂nnen wir Sie am besten erreichen?\"\n   ‚Üí Setze {{customer_phone}}\n\n2. (Optional) Bevorzugte Zeit: \"Gibt es eine bevorzugte Zeit f√ºr den R√ºckruf?\"\n   ‚Üí Setze {{callback_preferred_time}} (z.B. \"Vormittag\", \"heute Nachmittag\")\n\n**Setze callback_reason automatisch:**\n‚Üí \"Termin f√ºr {{service_name}} buchen\"\n\n**Transition:**\nSobald Name + Phone vorhanden ‚Üí func_request_callback"
        }
      },
      {
        "name": "Callback-Request erstellen",
        "tool_id": "tool-request-callback",
        "instruction": {
          "type": "static_text",
          "text": "Perfekt! Ich erstelle Ihre R√ºckruf-Anfrage..."
        },
        "parameter_mapping": {
          "call_id": "{{call_id}}",
          "customer_name": "{{customer_name}}",
          "phone_number": "{{customer_phone}}",
          "reason": "{{callback_reason}}",
          "preferred_time": "{{callback_preferred_time}}"
        },
        "id": "func_request_callback",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "wait_for_result": true,
        "display_position": {
          "x": 5500,
          "y": 750
        },
        "edges": [
          {
            "destination_node_id": "node_callback_confirmation",
            "id": "edge_callback_to_confirm",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Callback created successfully"
            }
          }
        ]
      },
      {
        "name": "Callback best√§tigt",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_callback_confirm_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_callback_confirmation",
        "type": "conversation",
        "display_position": {
          "x": 6050,
          "y": 750
        },
        "instruction": {
          "type": "prompt",
          "text": "Best√§tige Callback:\n\n\"Wunderbar! Ihre R√ºckruf-Anfrage wurde erstellt und automatisch an unser Team zugewiesen.\n\nWir melden uns zeitnah bei Ihnen unter {{customer_phone}} um einen passenden Termin zu vereinbaren.\n\nVielen Dank und einen sch√∂nen Tag!\""
        }
      },
      {
        "tool_id": "tool-get-appointments",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich schaue nach Ihren Terminen..."
        },
        "name": "Termine abrufen",
        "edges": [
          {
            "destination_node_id": "node_show_appointments",
            "id": "edge_get_to_show",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Appointments retrieved"
            }
          }
        ],
        "parameter_mapping": {
          "call_id": "{{call_id}}"
        },
        "id": "func_get_appointments",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 1650,
          "y": 1040
        },
        "wait_for_result": true
      },
      {
        "name": "Termine anzeigen",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_show_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User acknowledged or wants to end"
            }
          },
          {
            "destination_node_id": "intent_router",
            "id": "edge_show_to_intent",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to modify a shown appointment"
            }
          }
        ],
        "id": "node_show_appointments",
        "type": "conversation",
        "display_position": {
          "x": 2200,
          "y": 980
        },
        "instruction": {
          "type": "prompt",
          "text": "Zeige die Termine dem Kunden:\n\n**WENN TERMINE VORHANDEN:**\n\"Sie haben folgende Termine: [LISTE MIT DATUM, UHRZEIT, SERVICE]. M√∂chten Sie einen davon verschieben oder stornieren?\"\n\n**WENN KEINE TERMINE:**\n\"Sie haben derzeit keine bevorstehenden Termine. M√∂chten Sie einen Termin buchen?\""
        }
      },
      {
        "name": "Stornierungsdaten sammeln",
        "edges": [
          {
            "destination_node_id": "func_cancel_appointment",
            "id": "edge_collect_cancel_to_func",
            "transition_condition": {
              "type": "prompt",
              "prompt": "ALL variables filled: {{cancel_datum}} AND {{cancel_uhrzeit}}"
            }
          }
        ],
        "id": "node_collect_cancel_info",
        "type": "conversation",
        "display_position": {
          "x": 3850,
          "y": 1270
        },
        "instruction": {
          "type": "prompt",
          "text": "## WICHTIG: Pr√ºfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Datum f√ºr Stornierung: {{cancel_datum}}\n- Uhrzeit f√ºr Stornierung: {{cancel_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin m√∂chte der Kunde stornieren?\n2. **PR√úFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{cancel_datum}} leer ‚Üí Frage: \"F√ºr welchen Tag m√∂chten Sie stornieren?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{cancel_uhrzeit}} leer ‚Üí Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n\n**WENN Variable bereits gef√ºllt:**\n- ‚úÖ √úBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich m√∂chte meinen Termin morgen um 14 Uhr stornieren\"\n‚Üí cancel_datum = \"morgen\"\n‚Üí cancel_uhrzeit = \"14:00\"\n‚Üí Antworte: \"Verstanden. Einen Moment, ich storniere Ihren Termin...\"\n‚Üí Transition zu func_cancel_appointment\n\n**Transition:**\n- Sobald BEIDE Variablen gef√ºllt ({{cancel_datum}} AND {{cancel_uhrzeit}}) ‚Üí func_cancel_appointment"
        }
      },
      {
        "tool_id": "tool-cancel-appointment",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich storniere den Termin..."
        },
        "name": "Termin stornieren",
        "edges": [
          {
            "destination_node_id": "node_cancel_confirmation",
            "id": "edge_cancel_to_confirm",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Cancellation completed"
            }
          }
        ],
        "parameter_mapping": {
          "call_id": "{{call_id}}",
          "datum": "{{cancel_datum}}",
          "uhrzeit": "{{cancel_uhrzeit}}"
        },
        "id": "func_cancel_appointment",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 4400,
          "y": 1470
        },
        "wait_for_result": true
      },
      {
        "name": "Stornierung best√§tigt",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_cancel_confirm_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_cancel_confirmation",
        "type": "conversation",
        "display_position": {
          "x": 4950,
          "y": 1460
        },
        "instruction": {
          "type": "prompt",
          "text": "Best√§tige die Stornierung: 'Ihr Termin wurde storniert. Sie erhalten eine Best√§tigung per E-Mail. Vielen Dank!'"
        }
      },
      {
        "name": "Verschiebungsdaten sammeln",
        "edges": [
          {
            "destination_node_id": "func_reschedule_appointment",
            "id": "edge_collect_reschedule_to_func",
            "transition_condition": {
              "type": "prompt",
              "prompt": "ALL variables filled: {{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}"
            }
          }
        ],
        "id": "node_collect_reschedule_info",
        "type": "conversation",
        "display_position": {
          "x": 3850,
          "y": 2110
        },
        "instruction": {
          "type": "prompt",
          "text": "## WICHTIG: Pr√ºfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Alter Termin Datum: {{old_datum}}\n- Alter Termin Uhrzeit: {{old_uhrzeit}}\n- Neuer Termin Datum: {{new_datum}}\n- Neuer Termin Uhrzeit: {{new_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin m√∂chte der Kunde verschieben und auf wann?\n2. **PR√úFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{old_datum}} leer ‚Üí Frage: \"Welcher Termin soll verschoben werden? An welchem Tag?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{old_uhrzeit}} leer ‚Üí Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n- Wenn {{new_datum}} leer ‚Üí Frage: \"Auf welchen Tag m√∂chten Sie verschieben?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{new_uhrzeit}} leer ‚Üí Frage: \"Um welche Uhrzeit?\" (HH:MM)\n\n**WENN Variable bereits gef√ºllt:**\n- ‚úÖ √úBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich m√∂chte meinen Termin morgen 14 Uhr auf Donnerstag 16 Uhr verschieben\"\n‚Üí old_datum = \"morgen\"\n‚Üí old_uhrzeit = \"14:00\"\n‚Üí new_datum = \"Donnerstag\"\n‚Üí new_uhrzeit = \"16:00\"\n‚Üí Antworte: \"Perfekt! Einen Moment, ich verschiebe den Termin...\"\n‚Üí Transition zu func_reschedule_appointment\n\n**Transition:**\n- Sobald ALLE 4 Variablen gef√ºllt ({{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}) ‚Üí func_reschedule_appointment"
        }
      },
      {
        "tool_id": "tool-reschedule-appointment",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich verschiebe Ihren Termin..."
        },
        "name": "Termin verschieben",
        "edges": [
          {
            "destination_node_id": "node_reschedule_confirmation",
            "id": "edge_reschedule_to_confirm",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Rescheduling completed"
            }
          }
        ],
        "parameter_mapping": {
          "call_id": "{{call_id}}",
          "old_uhrzeit": "{{old_uhrzeit}}",
          "old_datum": "{{old_datum}}",
          "new_datum": "{{new_datum}}",
          "new_uhrzeit": "{{new_uhrzeit}}"
        },
        "id": "func_reschedule_appointment",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 4400,
          "y": 2380
        },
        "wait_for_result": true
      },
      {
        "name": "Verschiebung best√§tigt",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_reschedule_confirm_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_reschedule_confirmation",
        "type": "conversation",
        "display_position": {
          "x": 4950,
          "y": 2370
        },
        "instruction": {
          "type": "prompt",
          "text": "Best√§tige die Verschiebung: 'Perfekt! Ihr Termin wurde erfolgreich verschoben auf {{new_datum}} um {{new_uhrzeit}} Uhr. Best√§tigung folgt per E-Mail.'"
        }
      },
      {
        "tool_id": "tool-get-services",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich hole die Service-Liste..."
        },
        "name": "Services abrufen",
        "edges": [
          {
            "destination_node_id": "node_show_services",
            "id": "edge_get_services_to_show",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Services retrieved"
            }
          }
        ],
        "parameter_mapping": {
          "call_id": "{{call_id}}"
        },
        "id": "func_get_services",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 1650,
          "y": 2880
        },
        "wait_for_result": true
      },
      {
        "name": "Services anzeigen",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_show_services_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User acknowledged or wants to end"
            }
          },
          {
            "destination_node_id": "intent_router",
            "id": "edge_show_services_to_intent",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to book after seeing services"
            }
          }
        ],
        "id": "node_show_services",
        "type": "conversation",
        "display_position": {
          "x": 2200,
          "y": 2850
        },
        "instruction": {
          "type": "prompt",
          "text": "Zeige die Services:\n\n\"Wir bieten folgende Services an: [LISTE MIT NAMEN, DAUER, PREIS]. M√∂chten Sie einen Termin buchen?\""
        }
      },
      {
        "name": "Ende",
        "edges": [],
        "id": "node_end",
        "type": "end",
        "display_position": {
          "x": 7150,
          "y": 1515
        },
        "instruction": {
          "type": "static_text",
          "text": ""
        }
      }
    ],
    "start_node_id": "node_greeting",
    "start_speaker": "agent",
    "begin_after_user_silence_ms": 800,
    "tools": [
      {
        "tool_id": "tool-check-availability",
        "timeout_ms": 15000,
        "name": "check_availability_v17",
        "description": "Pr√ºft Verf√ºgbarkeit f√ºr einen Termin",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "description": "Kundenname"
            },
            "datum": {
              "type": "string",
              "description": "Datum: heute, morgen, Montag, oder DD.MM.YYYY"
            },
            "dienstleistung": {
              "type": "string",
              "description": "Service (z.B. Herrenhaarschnitt)"
            },
            "uhrzeit": {
              "type": "string",
              "description": "Uhrzeit im Format HH:MM"
            }
          },
          "required": [
            "name",
            "datum",
            "uhrzeit",
            "dienstleistung"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-get-alternatives",
        "timeout_ms": 10000,
        "name": "get_alternatives",
        "description": "Schl√§gt alternative Zeitslots vor wenn Wunschtermin nicht verf√ºgbar. Sucht intelligente Alternativen basierend auf Datum, Zeit und Service.",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "service_name": {
              "type": "string",
              "description": "Service f√ºr den Alternativen gesucht werden (z.B. Herrenhaarschnitt, Balayage)"
            },
            "preferred_date": {
              "type": "string",
              "description": "Gew√ºnschtes Datum (heute, morgen, Montag, oder DD.MM.YYYY)"
            },
            "preferred_time": {
              "type": "string",
              "description": "Gew√ºnschte Uhrzeit (HH:MM) oder Zeitfenster (Vormittag, Nachmittag)"
            },
            "call_id": {
              "type": "string",
              "description": "Call ID from system for context"
            }
          },
          "required": [
            "call_id",
            "service_name",
            "preferred_date"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-request-callback",
        "timeout_ms": 10000,
        "name": "request_callback",
        "description": "Erstellt Callback-Request mit automatischer Staff-Zuweisung. 100% Success Rate (Fixed 2025-11-06). Fallback-Option wenn kein Termin verf√ºgbar.",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "customer_name": {
              "type": "string",
              "description": "Name des Kunden"
            },
            "phone_number": {
              "type": "string",
              "description": "Telefonnummer (Format: +49... oder 0...)"
            },
            "reason": {
              "type": "string",
              "description": "Grund f√ºr R√ºckruf (z.B. 'Termin f√ºr Balayage buchen', 'Beratung')"
            },
            "preferred_time": {
              "type": "string",
              "description": "Bevorzugte R√ºckrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag', '14-16 Uhr')"
            },
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            }
          },
          "required": [
            "call_id",
            "customer_name",
            "phone_number",
            "reason"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-get-appointments",
        "timeout_ms": 15000,
        "name": "get_customer_appointments",
        "description": "Ruft bestehende Termine des Kunden ab",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            },
            "customer_name": {
              "type": "string",
              "description": "Optional: Kundenname zur Filterung"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-cancel-appointment",
        "timeout_ms": 15000,
        "name": "cancel_appointment",
        "description": "Storniert einen bestehenden Termin",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "datum": {
              "type": "string",
              "description": "Optional: Datum (heute, morgen, oder DD.MM.YYYY)"
            },
            "appointment_id": {
              "type": "string",
              "description": "Optional: Appointment ID"
            },
            "uhrzeit": {
              "type": "string",
              "description": "Optional: Uhrzeit HH:MM"
            },
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-reschedule-appointment",
        "timeout_ms": 15000,
        "name": "reschedule_appointment",
        "description": "Verschiebt einen Termin auf neues Datum/Uhrzeit",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "new_uhrzeit": {
              "type": "string",
              "description": "Required: Neue Uhrzeit HH:MM"
            },
            "appointment_id": {
              "type": "string",
              "description": "Optional: Appointment ID"
            },
            "old_datum": {
              "type": "string",
              "description": "Optional: Altes Datum DD.MM.YYYY"
            },
            "old_uhrzeit": {
              "type": "string",
              "description": "Optional: Alte Uhrzeit HH:MM"
            },
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            },
            "new_datum": {
              "type": "string",
              "description": "Required: Neues Datum (heute, morgen, oder DD.MM.YYYY)"
            }
          },
          "required": [
            "call_id",
            "new_datum",
            "new_uhrzeit"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-get-services",
        "timeout_ms": 15000,
        "name": "get_available_services",
        "description": "Listet alle verf√ºgbaren Services auf",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-start-booking",
        "timeout_ms": 5000,
        "name": "start_booking",
        "description": "Step 1 of 2-step booking: Validates all booking data and returns immediate status (<500ms). Use this BEFORE confirm_booking to provide instant feedback to user. Returns validation status and caches data.",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "datetime": {
              "type": "string",
              "description": "Appointment date and time in format: DD.MM.YYYY HH:MM (e.g., 06.11.2025 14:00). IMPORTANT: Always use year 2025."
            },
            "service": {
              "type": "string",
              "description": "Service name (e.g., Herrenhaarschnitt, Damenhaarschnitt, Beratung)"
            },
            "function_name": {
              "type": "string",
              "description": "Function name: start_booking"
            },
            "customer_email": {
              "type": "string",
              "description": "Customer email address (optional)"
            },
            "customer_phone": {
              "type": "string",
              "description": "Customer phone number (format: +49... or 0...)"
            },
            "customer_name": {
              "type": "string",
              "description": "Customer full name"
            },
            "call_id": {
              "type": "string",
              "description": "Unique Retell call identifier for session tracking"
            }
          },
          "required": [
            "function_name",
            "call_id",
            "datetime",
            "service",
            "customer_name",
            "customer_phone"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-confirm-booking",
        "timeout_ms": 30000,
        "name": "confirm_booking",
        "description": "Step 2 of 2-step booking: Executes the actual Cal.com booking and database save. Call this IMMEDIATELY AFTER start_booking returns success. Takes 4-5s but user already heard status message.",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "function_name": {
              "type": "string",
              "description": "Function name: confirm_booking"
            },
            "call_id": {
              "type": "string",
              "description": "Same call_id used in start_booking to retrieve cached booking data"
            }
          },
          "required": [
            "function_name",
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-get-current-context",
        "timeout_ms": 5000,
        "name": "get_current_context",
        "description": "Ruft aktuelles Datum, Uhrzeit und Kontext-Informationen ab. Wird automatisch beim Call-Start gecallt um {{current_date}}, {{current_time}}, {{day_name}} zu setzen.",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "call_id": {
              "type": "string",
              "description": "Die Call ID des aktuellen Anrufs"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/current-context"
      }
    ],
    "model_choice": {
      "type": "cascading",
      "model": "gpt-4o-mini"
    },
    "model_temperature": 0.3,
    "knowledge_base_ids": [],
    "kb_config": {
      "top_k": 3,
      "filter_score": 0.6
    },
    "begin_tag_display_position": {
      "x": 0,
      "y": 345
    },
    "is_published": false
  }
}
