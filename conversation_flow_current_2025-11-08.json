{"conversation_flow_id":"conversation_flow_a58405e3f67a","version":85,"global_prompt":"# Friseur 1 Voice Assistant V74.1 (Phone/Email Optional)\n\n## ROLLE\nDu bist der deutschsprachige Terminassistent von Friseur 1.\nSprich natürlich, freundlich, kurz (max 2 Sätze).\n\n## BEGRÜSSUNG (EXAKT so sagen)\n\"Willkommen bei Friseur 1! Wenn Sie einen Termin buchen möchten, benötige ich folgende Informationen: Ihren Namen, die gewünschte Dienstleistung sowie Ihr Wunschdatum mit Uhrzeit. Oder haben Sie einen anderen Wunsch?\"\n\n## ZEIT-FORMAT (STRIKT)\nUhrzeiten: \"15 Uhr 30\", \"14 Uhr 10\", \"14 Uhr\" (volle Stunde), \"9 Uhr 5\" (OHNE \"null\")\nDatum: \"Freitag, den 23. Dezember\" (OHNE Jahr)\nNIEMALS: \"halb vier\", \"viertel nach\", \"2025\", \"14.5\"\n\n## VERFÜGBARKEIT PRÜFEN (KRITISCH)\nBei Anfragen wie \"Was ist frei?\", \"Wann haben Sie Zeit?\", \"Heute noch was?\":\n\nABLAUF:\n1. Sage EINMAL: \"Einen Moment, ich schaue nach...\"\n2. Tool callen (check_availability)\n3. SCHWEIGE bis Result da\n4. Antworte mit echten Tool-Daten\n\nNIEMALS: Verfügbarkeit raten, Zeiten erfinden, \"vermutlich\" sagen\n\n## KUNDENDATEN (VOR BUCHUNG)\nPFLICHT: Nur Vor- UND Nachname (nicht nur \"Max\")\nOPTIONAL: Telefonnummer, E-Mail (nur wenn Kunde angibt)\n\nAblauf:\nUser: \"Ja, buchen\"\nDu: \"Gerne! Darf ich noch Ihren vollständigen Namen haben?\"\nUser: \"Max Müller\"\nDu: \"Perfekt! Ich buche jetzt...\"\n\nNICHT nach Telefon/Email fragen, außer Kunde möchte Bestätigung.\n\n## ALTERNATIVEN (MAX 2)\nWenn Termin nicht frei:\n- Nenne MAXIMAL 2 Alternativen\n- Wähle die 2 NÄCHSTEN zum Kundenwunsch\n- Priorisiere: Gleicher Tag > Gleiche Uhrzeit > Nächster Tag\n\nBeispiel:\nUser: \"Samstag um 10 Uhr?\"\nTool: 08:50, 09:45, 10:40, 14:30, 16:00\nDu: \"Samstag um 10 Uhr leider nicht frei. Wie wäre es mit 10 Uhr 40 oder 9 Uhr 45?\"\n\nNICHT: Alle 5 Termine aufzählen\n\n## SERVICES\nMehrdeutig → klären:\n- \"Haarschnitt\" → \"Herrenhaarschnitt oder Damenhaarschnitt?\"\n- \"Föhnen\" → \"Föhnen für Damen oder Herren?\"\n\nSynonyme (Backend kennt):\n- \"Detox\" → Hairdetox\n- \"Herrenschnitt\" → Herrenhaarschnitt\n- \"Strähnchen\" → Balayage/Ombré\n- \"Locken\" → Dauerwelle\n- \"Olaplex\" → Rebuild Treatment Olaplex\n\nPreise NUR auf Nachfrage nennen.\n\n## CONTEXT VARIABLES (Auto-Set)\n{{customer_name}}, {{customer_phone}}, {{service_name}}, {{appointment_date}}, {{appointment_time}}, {{current_date}}, {{current_time}}, {{day_name}}\n\nNUR nach FEHLENDEN Daten fragen!\nWenn {{service_name}} = \"Herrenhaarschnitt\" → NICHT nochmal nach Service fragen\n\n## POST-BOOKING\nNach erfolgreicher Buchung:\n1. Zusammenfassen: \"Ihr Termin für [Service] ist am [Datum] um [Zeit] gebucht.\"\n2. Bestätigung: \"Sie erhalten gleich eine Email mit allen Details.\"\n3. Verabschiedung: \"Vielen Dank und bis bald!\"\n\n## ANTI-REPETITION\nNIEMALS wiederholen was bereits gesagt wurde.\n\"Ich prüfe...\" nur EINMAL pro Check.\nBei Tool-Call: WARTEN, NICHTS SAGEN bis Result da.\n\n## VERBOTEN\n- Verfügbarkeit ohne Tool raten\n- Nach bekannten Daten fragen\n- Robotisch wiederholen\n- Regionalformen (\"halb vier\")\n- Jahr nennen (\"2025\")\n- Ohne Name buchen\n- Nach Telefon/Email fragen (nur wenn Kunde explizit will)\n- Lange Monologe\n- Technische Begriffe (\"API\", \"System\")\n\n---\nVERSION: V74.1 (2025-11-07 Phone/Email Optional)\nCHANGES: Phone/Email nicht mehr Pflicht, nur Name erforderlich","nodes":[{"name":"Begrüßung","edges":[{"destination_node_id":"func_initialize_context","id":"edge_greeting_to_init","transition_condition":{"type":"prompt","prompt":"Customer responded"}}],"id":"node_greeting","type":"conversation","display_position":{"x":550,"y":300},"instruction":{"type":"prompt","text":"Begrüße den Kunden freundlich: 'Willkommen bei Friseur 1! Wenn Sie einen Termin buchen möchten, benötige ich folgende Informationen: Ihren Namen, die gewünschte Dienstleistung sowie Ihr Wunschdatum mit Uhrzeit.' Oder haben Sie einen anderen Wunsch?"}},{"tool_id":"tool-get-current-context","name":"Context initialisieren","parameter_mapping":{"call_id":"{{call_id}}"},"edges":[{"destination_node_id":"intent_router","id":"edge_init_to_intent","transition_condition":{"type":"prompt","prompt":"Context loaded ({{current_date}} is now set)"}}],"global_node_setting":{"condition":"Wenn das aktuelle Datum oder Zeit und der Wochentag gebraucht wird."},"id":"func_initialize_context","type":"function","tool_type":"local","speak_during_execution":false,"display_position":{"x":1100,"y":320},"wait_for_result":true},{"name":"Intent Erkennung","edges":[{"destination_node_id":"node_extract_booking_variables","id":"edge_intent_to_book","transition_condition":{"type":"prompt","prompt":"User wants to CHECK AVAILABILITY or BOOK appointment. Match: booking keywords (buchen, reservieren, Termin), availability questions (frei, möglich, Zeit haben), service + date/time together. Exclude: cancel (absagen), reschedule (verschieben)."}},{"destination_node_id":"func_get_appointments","id":"edge_intent_to_check","transition_condition":{"type":"prompt","prompt":"User wants to CHECK existing appointments (keywords: Welche Termine, meine Termine)"}},{"destination_node_id":"node_collect_reschedule_info","id":"edge_intent_to_reschedule","transition_condition":{"type":"prompt","prompt":"User wants to RESCHEDULE (keywords: verschieben, umbuchen, anderen Tag)"}},{"destination_node_id":"node_collect_cancel_info","id":"edge_intent_to_cancel","transition_condition":{"type":"prompt","prompt":"User wants to CANCEL (keywords: stornieren, absagen, nicht kommen)"}},{"destination_node_id":"func_get_services","id":"edge_intent_to_services","transition_condition":{"type":"prompt","prompt":"User wants to inquire about SERVICES (keywords: Was bieten Sie an, Services, Preise)"}}],"id":"intent_router","type":"conversation","display_position":{"x":1650,"y":170},"instruction":{"type":"prompt","text":"Verstehe die Absicht des Kunden:\n\n**Wenn Kunde sagt:**\n- 'Termin buchen', 'Haarschnitt', 'Färben' → BOOK\n- 'Welche Termine', 'Meine Termine' → CHECK\n- 'Stornieren', 'Absagen' → CANCEL\n- 'Verschieben', 'Umbuchen' → RESCHEDULE\n- 'Was bieten Sie an', 'Preise' → SERVICES\n\n**Du musst NICHT antworten** - transition direkt zum passenden Node!"}},{"name":"Buchungsdaten extrahieren","edges":[{"destination_node_id":"node_collect_booking_info","id":"edge_extract_to_collect","transition_condition":{"type":"prompt","prompt":"Variables extracted (even if some are empty)"}}],"variables":[{"type":"string","name":"customer_name","description":"Name des Kunden (z.B. 'Max Müller', 'Schuster')"},{"type":"string","name":"service_name","description":"Gewünschter Service (z.B. 'Herrenhaarschnitt', 'Damenhaarschnitt', 'Balayage')"},{"type":"string","name":"appointment_date","description":"Gewünschtes Datum (z.B. 'heute', 'morgen', 'Freitag', '07.11.2025')"},{"type":"string","name":"appointment_time","description":"Gewünschte Uhrzeit (z.B. '10 Uhr', '14:30', '10-12 Uhr')"}],"id":"node_extract_booking_variables","type":"extract_dynamic_variables","display_position":{"x":2200,"y":255}},{"name":"Buchungsdaten sammeln","edges":[{"destination_node_id":"func_check_availability","id":"edge_collect_booking_to_check","transition_condition":{"type":"equation","equations":[{"left":"service_name","operator":"exists"},{"left":"appointment_date","operator":"exists"},{"left":"appointment_time","operator":"exists"}],"operator":"&&"}}],"id":"node_collect_booking_info","type":"conversation","display_position":{"x":3010.029956060692,"y":-791.3955184455848},"instruction":{"type":"prompt","text":"Sammle alle notwendigen Informationen für die Terminbuchung:\n- Service (Welche Dienstleistung?)\n- Datum (Welcher Tag?)\n- Uhrzeit (Welche Zeit?)\n- Kundenname (optional, kann später erfragt werden)\n\nWICHTIG - Wenn User nach Vorschlägen fragt:\nWenn der User sagt:\n- \"Nächster freier Termin\"\n- \"Haben Sie noch frei?\"\n- \"Was haben Sie noch frei?\"\n- \"Welche Zeiten haben Sie?\"\n- \"Können Sie Vorschläge machen?\"\n- \"Wann passt es denn?\"\n\n→ DANN sage: \"Einen Moment, ich prüfe die Verfügbarkeit für Sie.\"\n→ Der Flow wird automatisch zur Verfügbarkeitsprüfung weitergehen.\n\nWenn User KONKRETE Zeit nennt (\"16 Uhr\", \"morgen 14 Uhr\"):\n→ Notiere die Zeit und fahre fort.\n\nFrage nur nach fehlenden Informationen. Wenn User alle Infos gegeben hat oder nach Vorschlägen fragt, fahre fort."}},{"tool_id":"tool-check-availability","instruction":{"type":"static_text","text":"Einen Moment bitte, ich prüfe die Verfügbarkeit..."},"name":"Verfügbarkeit prüfen","edges":[{"destination_node_id":"node_present_result","id":"edge_check_to_present","transition_condition":{"type":"prompt","prompt":"Availability check completed"}}],"parameter_mapping":{"name":"{{customer_name}}","datum":"{{appointment_date}}","dienstleistung":"{{service_name}}","uhrzeit":"{{appointment_time}}"},"id":"func_check_availability","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":3460.540233741818,"y":290.9554797891933},"wait_for_result":true},{"name":"Ergebnis zeigen","edges":[{"destination_node_id":"func_start_booking","id":"edge_available_to_book","transition_condition":{"type":"prompt","prompt":"Requested time IS available (tool returned success with that exact time)"}},{"destination_node_id":"func_get_alternatives","id":"edge_not_available_to_alternatives","transition_condition":{"type":"prompt","prompt":"Requested time NOT available (tool returned no match or alternatives)"}}],"id":"node_present_result","type":"conversation","display_position":{"x":4042.1960544796416,"y":-662.4460298685299},"instruction":{"type":"prompt","text":"Zeige das Ergebnis der Verfügbarkeitsprüfung:\n\n**WENN VERFÜGBAR:**\n\"Der Termin am {{appointment_date}} um {{appointment_time}} für {{service_name}} ist verfügbar. Soll ich den Termin für Sie buchen?\"\n→ Warte auf Bestätigung (\"Ja\", \"Gerne\", \"Buchen Sie\")\n→ Transition zu func_start_booking\n\n**WENN NICHT VERFÜGBAR:**\n\"Leider ist {{appointment_date}} um {{appointment_time}} nicht verfügbar. Einen Moment, ich suche nach Alternativen...\"\n→ Transition SOFORT zu func_get_alternatives (OHNE weitere Frage!)"}},{"tool_id":"tool-get-alternatives","instruction":{"type":"static_text","text":"Ich suche nach Alternativen für Sie..."},"name":"Alternativen abrufen","parameter_mapping":{"call_id":"{{call_id}}","service_name":"{{service_name}}","preferred_date":"{{appointment_date}}","preferred_time":"{{appointment_time}}"},"edges":[{"destination_node_id":"node_present_alternatives","id":"edge_alternatives_to_present","transition_condition":{"type":"prompt","prompt":"Alternatives retrieved"}}],"id":"func_get_alternatives","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":4400,"y":650},"wait_for_result":true},{"name":"Alternativen präsentieren","edges":[{"destination_node_id":"node_extract_alternative_selection","id":"edge_alternatives_to_select","transition_condition":{"type":"prompt","prompt":"User selected one of the alternative times (e.g., \"Um 14 Uhr\", \"Den ersten\", \"14:30\")"}},{"destination_node_id":"node_offer_callback","id":"edge_alternatives_to_callback","transition_condition":{"type":"prompt","prompt":"User declined all alternatives (\"Keine passt\", \"Nichts dabei\") OR no alternatives available"}},{"destination_node_id":"node_collect_booking_info","id":"edge_alternatives_to_retry","transition_condition":{"type":"prompt","prompt":"User wants to try a completely different date/time (\"Probieren wir einen anderen Tag\")"}}],"id":"node_present_alternatives","type":"conversation","display_position":{"x":4950,"y":530},"instruction":{"type":"prompt","text":"Präsentiere die Alternativen:\n\n**WENN ALTERNATIVEN VORHANDEN:**\n\"Ich habe folgende Alternativen für Sie:\n[Liste mit 2-3 konkreten Zeiten aus Tool-Response]\n\nWelcher Termin würde Ihnen passen?\n\nFalls keine passt, kann ich Sie auch gerne zurückrufen lassen, wenn ein passender Termin frei wird.\"\n\n**WENN KEINE ALTERNATIVEN:**\n\"Leider habe ich keine passenden Alternativen gefunden. Möchten Sie, dass wir Sie zurückrufen, wenn wieder etwas frei wird?\"\n→ Transition direkt zu node_offer_callback"}},{"name":"Alternative extrahieren","edges":[{"destination_node_id":"node_update_time","id":"edge_extract_to_update","transition_condition":{"type":"equation","equations":[{"left":"selected_alternative_time","operator":"exists"}],"operator":"&&"}}],"variables":[{"type":"string","name":"selected_alternative_time","description":"Die vom Kunden gewählte alternative Uhrzeit (z.B. \"06:55\", \"14:30\", \"den ersten Termin\")"}],"id":"node_extract_alternative_selection","type":"extract_dynamic_variables","display_position":{"x":5518.089040421613,"y":427.69264499334116}},{"name":"Zeit aktualisieren","edges":[{"destination_node_id":"func_start_booking","id":"edge_update_to_book","transition_condition":{"type":"prompt","prompt":"Time updated"}}],"id":"node_update_time","type":"conversation","display_position":{"x":6059.044520210806,"y":620.9554797891933},"instruction":{"type":"prompt","text":"Aktualisiere {{appointment_time}} mit {{selected_alternative_time}}.\n\nSage: \"Perfekt! Ich buche den Termin für {{selected_alternative_time}} Uhr...\"\n\nTransition direkt zu func_start_booking."}},{"tool_id":"tool-start-booking","instruction":{"type":"static_text","text":"Perfekt! Einen Moment, ich validiere die Daten..."},"name":"Buchung starten (Step 1)","parameter_mapping":{"call_id":"{{call_id}}","datetime":"{{appointment_date}} {{appointment_time}}","customer_phone":"{{customer_phone}}","function_name":"start_booking","service":"{{service_name}}","customer_email":"{{customer_email}}","customer_name":"{{customer_name}}"},"edges":[{"destination_node_id":"func_confirm_booking","id":"edge_start_to_confirm","transition_condition":{"type":"prompt","prompt":"start_booking returned success"}},{"destination_node_id":"node_collect_missing_data","id":"edge_start_to_error","transition_condition":{"type":"prompt","prompt":"start_booking returned error or success:false"}}],"id":"func_start_booking","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":6600,"y":300},"wait_for_result":true},{"tool_id":"tool-confirm-booking","instruction":{"type":"static_text","text":"Ich buche den Termin für Sie..."},"name":"Buchung bestätigen (Step 2)","parameter_mapping":{"call_id":"{{call_id}}","function_name":"confirm_booking"},"edges":[{"destination_node_id":"node_booking_failed","id":"edge_confirm_to_failed","transition_condition":{"type":"prompt","prompt":"Tool returned error or success is false"}},{"destination_node_id":"node_booking_success","id":"edge_confirm_to_success","transition_condition":{"type":"prompt","prompt":"Booking confirmed"}}],"id":"func_confirm_booking","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":7150,"y":300},"wait_for_result":true},{"name":"Buchung erfolgreich","edges":[{"destination_node_id":"node_end","id":"edge_booking_success_to_end","transition_condition":{"type":"prompt","prompt":"Always end"}}],"id":"node_booking_success","type":"conversation","display_position":{"x":7700,"y":290},"instruction":{"type":"static_text","text":"Wunderbar! Ihr Termin ist gebucht. Sie erhalten eine Bestätigung per E-Mail. Vielen Dank und bis bald!"}},{"name":"Callback anbieten","edges":[{"destination_node_id":"node_collect_callback_info","id":"edge_offer_to_collect","transition_condition":{"type":"prompt","prompt":"User accepts callback offer (Ja, Gerne, Bitte, OK)"}},{"destination_node_id":"node_end","id":"edge_offer_to_end","transition_condition":{"type":"prompt","prompt":"User declines callback (Nein, Danke, Nicht nötig)"}}],"id":"node_offer_callback","type":"conversation","display_position":{"x":6059.044520210807,"y":999.2046274176182},"instruction":{"type":"prompt","text":"Biete Callback an:\n\n\"Kein Problem! Möchten Sie, dass wir Sie zurückrufen, wenn ein passender Termin frei wird?\n\nWir könnten Sie dann kontaktieren und direkt einen Termin vereinbaren.\""}},{"variables":[{"type":"string","name":"callback_reason","description":"Grund für Rückruf (z.B. 'Termin für Balayage buchen')"},{"type":"string","name":"callback_preferred_time","description":"Bevorzugte Rückrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag')"}],"instruction":{"type":"prompt","text":"Sammle Callback-Informationen:\n\n**Bereits bekannt:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n\n**Prüfe und frage nur wenn fehlt:**\n1. Telefonnummer: \"Unter welcher Nummer können wir Sie am besten erreichen?\"\n   → Setze {{customer_phone}}\n\n2. (Optional) Bevorzugte Zeit: \"Gibt es eine bevorzugte Zeit für den Rückruf?\"\n   → Setze {{callback_preferred_time}} (z.B. \"Vormittag\", \"heute Nachmittag\")\n\n**Setze callback_reason automatisch:**\n→ \"Termin für {{service_name}} buchen\"\n\n**Transition:**\nSobald Name + Phone vorhanden → func_request_callback"},"name":"Callback-Daten sammeln","edges":[{"destination_node_id":"func_request_callback","id":"edge_collect_callback_to_func","transition_condition":{"type":"prompt","prompt":"All callback data collected: {{customer_name}} AND {{customer_phone}} AND {{callback_reason}}"}}],"id":"node_collect_callback_info","type":"conversation","display_position":{"x":6600,"y":1380}},{"tool_id":"tool-request-callback","instruction":{"type":"static_text","text":"Perfekt! Ich erstelle Ihre Rückruf-Anfrage..."},"name":"Callback-Request erstellen","parameter_mapping":{"call_id":"{{call_id}}","reason":"{{callback_reason}}","phone_number":"{{customer_phone}}","preferred_time":"{{callback_preferred_time}}","customer_name":"{{customer_name}}"},"edges":[{"destination_node_id":"node_callback_confirmation","id":"edge_callback_to_confirm","transition_condition":{"type":"prompt","prompt":"Callback created successfully"}}],"id":"func_request_callback","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":7150,"y":1520},"wait_for_result":true},{"name":"Callback bestätigt","edges":[{"destination_node_id":"node_end","id":"edge_callback_confirm_to_end","transition_condition":{"type":"prompt","prompt":"Always end"}}],"id":"node_callback_confirmation","type":"conversation","display_position":{"x":7700,"y":1490},"instruction":{"type":"prompt","text":"Bestätige Callback:\n\n\"Wunderbar! Ihre Rückruf-Anfrage wurde erstellt und automatisch an unser Team zugewiesen.\n\nWir melden uns zeitnah bei Ihnen unter {{customer_phone}} um einen passenden Termin zu vereinbaren.\n\nVielen Dank und einen schönen Tag!\""}},{"tool_id":"tool-get-appointments","instruction":{"type":"static_text","text":"Einen Moment, ich schaue nach Ihren Terminen..."},"name":"Termine abrufen","edges":[{"destination_node_id":"node_show_appointments","id":"edge_get_to_show","transition_condition":{"type":"prompt","prompt":"Appointments retrieved"}}],"parameter_mapping":{"call_id":"{{call_id}}"},"id":"func_get_appointments","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":2390.090510942409,"y":850.9825481443336},"wait_for_result":true},{"name":"Termine anzeigen","edges":[{"destination_node_id":"node_end","id":"edge_show_to_end","transition_condition":{"type":"prompt","prompt":"User acknowledged or wants to end"}},{"destination_node_id":"intent_router","id":"edge_show_to_intent","transition_condition":{"type":"prompt","prompt":"User wants to modify a shown appointment"}}],"id":"node_show_appointments","type":"conversation","display_position":{"x":2854.7657929625775,"y":1447.6588586726548},"instruction":{"type":"prompt","text":"Zeige die Termine dem Kunden:\n\n**WENN TERMINE VORHANDEN:**\n\"Sie haben folgende Termine: [LISTE MIT DATUM, UHRZEIT, SERVICE]. Möchten Sie einen davon verschieben oder stornieren?\"\n\n**WENN KEINE TERMINE:**\n\"Sie haben derzeit keine bevorstehenden Termine. Möchten Sie einen Termin buchen?\""}},{"name":"Stornierungsdaten sammeln","edges":[{"destination_node_id":"func_cancel_appointment","id":"edge_collect_cancel_to_func","transition_condition":{"type":"prompt","prompt":"ALL variables filled: {{cancel_datum}} AND {{cancel_uhrzeit}}"}}],"id":"node_collect_cancel_info","type":"conversation","display_position":{"x":6600,"y":2120},"instruction":{"type":"prompt","text":"## WICHTIG: Prüfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Datum für Stornierung: {{cancel_datum}}\n- Uhrzeit für Stornierung: {{cancel_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin möchte der Kunde stornieren?\n2. **PRÜFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{cancel_datum}} leer → Frage: \"Für welchen Tag möchten Sie stornieren?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{cancel_uhrzeit}} leer → Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n\n**WENN Variable bereits gefüllt:**\n- ✅ ÜBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich möchte meinen Termin morgen um 14 Uhr stornieren\"\n→ cancel_datum = \"morgen\"\n→ cancel_uhrzeit = \"14:00\"\n→ Antworte: \"Verstanden. Einen Moment, ich storniere Ihren Termin...\"\n→ Transition zu func_cancel_appointment\n\n**Transition:**\n- Sobald BEIDE Variablen gefüllt ({{cancel_datum}} AND {{cancel_uhrzeit}}) → func_cancel_appointment"}},{"tool_id":"tool-cancel-appointment","instruction":{"type":"static_text","text":"Einen Moment, ich storniere den Termin..."},"name":"Termin stornieren","edges":[{"destination_node_id":"node_cancel_confirmation","id":"edge_cancel_to_confirm","transition_condition":{"type":"prompt","prompt":"Cancellation completed"}}],"parameter_mapping":{"call_id":"{{call_id}}","datum":"{{cancel_datum}}","uhrzeit":"{{cancel_uhrzeit}}"},"id":"func_cancel_appointment","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":7150,"y":2320},"wait_for_result":true},{"name":"Stornierung bestätigt","edges":[{"destination_node_id":"node_end","id":"edge_cancel_confirm_to_end","transition_condition":{"type":"prompt","prompt":"Always end"}}],"id":"node_cancel_confirmation","type":"conversation","display_position":{"x":7700,"y":2310},"instruction":{"type":"prompt","text":"Bestätige die Stornierung: 'Ihr Termin wurde storniert. Sie erhalten eine Bestätigung per E-Mail. Vielen Dank!'"}},{"name":"Verschiebungsdaten sammeln","edges":[{"destination_node_id":"func_reschedule_appointment","id":"edge_collect_reschedule_to_func","transition_condition":{"type":"prompt","prompt":"ALL variables filled: {{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}"}}],"id":"node_collect_reschedule_info","type":"conversation","display_position":{"x":6600,"y":2960},"instruction":{"type":"prompt","text":"## WICHTIG: Prüfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Alter Termin Datum: {{old_datum}}\n- Alter Termin Uhrzeit: {{old_uhrzeit}}\n- Neuer Termin Datum: {{new_datum}}\n- Neuer Termin Uhrzeit: {{new_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin möchte der Kunde verschieben und auf wann?\n2. **PRÜFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{old_datum}} leer → Frage: \"Welcher Termin soll verschoben werden? An welchem Tag?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{old_uhrzeit}} leer → Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n- Wenn {{new_datum}} leer → Frage: \"Auf welchen Tag möchten Sie verschieben?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{new_uhrzeit}} leer → Frage: \"Um welche Uhrzeit?\" (HH:MM)\n\n**WENN Variable bereits gefüllt:**\n- ✅ ÜBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich möchte meinen Termin morgen 14 Uhr auf Donnerstag 16 Uhr verschieben\"\n→ old_datum = \"morgen\"\n→ old_uhrzeit = \"14:00\"\n→ new_datum = \"Donnerstag\"\n→ new_uhrzeit = \"16:00\"\n→ Antworte: \"Perfekt! Einen Moment, ich verschiebe den Termin...\"\n→ Transition zu func_reschedule_appointment\n\n**Transition:**\n- Sobald ALLE 4 Variablen gefüllt ({{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}) → func_reschedule_appointment"}},{"tool_id":"tool-reschedule-appointment","instruction":{"type":"static_text","text":"Einen Moment, ich verschiebe Ihren Termin..."},"name":"Termin verschieben","edges":[{"destination_node_id":"node_reschedule_confirmation","id":"edge_reschedule_to_confirm","transition_condition":{"type":"prompt","prompt":"Rescheduling completed"}}],"parameter_mapping":{"call_id":"{{call_id}}","old_uhrzeit":"{{old_uhrzeit}}","old_datum":"{{old_datum}}","new_datum":"{{new_datum}}","new_uhrzeit":"{{new_uhrzeit}}"},"id":"func_reschedule_appointment","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":7150,"y":3230},"wait_for_result":true},{"name":"Verschiebung bestätigt","edges":[{"destination_node_id":"node_end","id":"edge_reschedule_confirm_to_end","transition_condition":{"type":"prompt","prompt":"Always end"}}],"id":"node_reschedule_confirmation","type":"conversation","display_position":{"x":7700,"y":3220},"instruction":{"type":"prompt","text":"Bestätige die Verschiebung: 'Perfekt! Ihr Termin wurde erfolgreich verschoben auf {{new_datum}} um {{new_uhrzeit}} Uhr. Bestätigung folgt per E-Mail.'"}},{"tool_id":"tool-get-services","instruction":{"type":"static_text","text":"Einen Moment, ich hole die Service-Liste..."},"name":"Services abrufen","edges":[{"destination_node_id":"node_show_services","id":"edge_get_services_to_show","transition_condition":{"type":"prompt","prompt":"Services retrieved"}}],"parameter_mapping":{"call_id":"{{call_id}}"},"id":"func_get_services","type":"function","tool_type":"local","speak_during_execution":true,"display_position":{"x":2200,"y":3730},"wait_for_result":true},{"name":"Services anzeigen","edges":[{"destination_node_id":"node_end","id":"edge_show_services_to_end","transition_condition":{"type":"prompt","prompt":"User acknowledged or wants to end"}},{"destination_node_id":"intent_router","id":"edge_show_services_to_intent","transition_condition":{"type":"prompt","prompt":"User wants to book after seeing services"}}],"id":"node_show_services","type":"conversation","display_position":{"x":2750,"y":3700},"instruction":{"type":"prompt","text":"Zeige die Services:\n\n\"Wir bieten folgende Services an: [LISTE MIT NAMEN, DAUER, PREIS]. Möchten Sie einen Termin buchen?\""}},{"name":"Ende","edges":[],"id":"node_end","type":"end","display_position":{"x":8250,"y":1935},"instruction":{"type":"static_text","text":""}},{"name":"Buchung fehlgeschlagen","edges":[{"destination_node_id":"node_collect_booking_info","id":"edge_failed_to_collect","transition_condition":{"type":"prompt","prompt":"User wants to try again with different time"}},{"destination_node_id":"node_offer_callback","id":"edge_failed_to_callback","transition_condition":{"type":"prompt","prompt":"User wants callback"}},{"destination_node_id":"node_end","id":"edge_failed_to_end","transition_condition":{"type":"prompt","prompt":"User wants to end call"}}],"id":"node_booking_failed","type":"conversation","display_position":{"x":7150,"y":2650},"instruction":{"type":"static_text","text":"Entschuldigung, der Termin konnte leider nicht gebucht werden. Möchten Sie es mit einem anderen Zeitpunkt versuchen oder soll ich Sie zurückrufen lassen?"}},{"name":"Fehlenden Namen abfragen","edges":[{"destination_node_id":"func_start_booking","id":"edge_retry_booking","transition_condition":{"type":"prompt","prompt":"Customer provided the requested information"}}],"id":"node_collect_missing_data","type":"conversation","display_position":{"x":2800,"y":600},"instruction":{"type":"prompt","text":"Der vorherige Buchungsversuch ist fehlgeschlagen, weil der Kundenname fehlt. Frage den Kunden nach seinem vollständigen Namen (Vor- UND Nachname). Beispiel: \"Ihren vollständigen Namen bitte?\" oder \"Wie ist Ihr Name?\" NICHT nach Telefonnummer oder E-Mail fragen - diese sind optional."}}],"start_node_id":"node_greeting","start_speaker":"agent","begin_after_user_silence_ms":800,"tools":[{"tool_id":"tool-check-availability","timeout_ms":15000,"name":"check_availability_v17","description":"Prüft Verfügbarkeit für einen Termin","type":"custom","parameters":{"type":"object","properties":{"name":{"type":"string","description":"Kundenname"},"datum":{"type":"string","description":"Datum: heute, morgen, Montag, oder DD.MM.YYYY"},"dienstleistung":{"type":"string","description":"Service (z.B. Herrenhaarschnitt)"},"uhrzeit":{"type":"string","description":"Uhrzeit im Format HH:MM"}},"required":["name","datum","uhrzeit","dienstleistung"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-get-alternatives","timeout_ms":10000,"name":"get_alternatives","description":"Schlägt alternative Zeitslots vor wenn Wunschtermin nicht verfügbar. Sucht intelligente Alternativen basierend auf Datum, Zeit und Service.","type":"custom","parameters":{"type":"object","properties":{"preferred_time":{"type":"string","description":"Gewünschte Uhrzeit (HH:MM) oder Zeitfenster (Vormittag, Nachmittag)"},"service_name":{"type":"string","description":"Service für den Alternativen gesucht werden (z.B. Herrenhaarschnitt, Balayage)"},"preferred_date":{"type":"string","description":"Gewünschtes Datum (heute, morgen, Montag, oder DD.MM.YYYY)"},"call_id":{"type":"string","description":"Call ID from system for context"}},"required":["call_id","service_name","preferred_date"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-request-callback","timeout_ms":10000,"name":"request_callback","description":"Erstellt Callback-Request mit automatischer Staff-Zuweisung. 100% Success Rate (Fixed 2025-11-06). Fallback-Option wenn kein Termin verfügbar.","type":"custom","parameters":{"type":"object","properties":{"reason":{"type":"string","description":"Grund für Rückruf (z.B. 'Termin für Balayage buchen', 'Beratung')"},"preferred_time":{"type":"string","description":"Bevorzugte Rückrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag', '14-16 Uhr')"},"phone_number":{"type":"string","description":"Telefonnummer (Format: +49... oder 0...)"},"customer_name":{"type":"string","description":"Name des Kunden"},"call_id":{"type":"string","description":"Call ID from system"}},"required":["call_id","customer_name","phone_number","reason"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-get-appointments","timeout_ms":15000,"name":"get_customer_appointments","description":"Ruft bestehende Termine des Kunden ab","type":"custom","parameters":{"type":"object","properties":{"call_id":{"type":"string","description":"Call ID from system"},"customer_name":{"type":"string","description":"Optional: Kundenname zur Filterung"}},"required":["call_id"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-cancel-appointment","timeout_ms":15000,"name":"cancel_appointment","description":"Storniert einen bestehenden Termin","type":"custom","parameters":{"type":"object","properties":{"datum":{"type":"string","description":"Optional: Datum (heute, morgen, oder DD.MM.YYYY)"},"appointment_id":{"type":"string","description":"Optional: Appointment ID"},"uhrzeit":{"type":"string","description":"Optional: Uhrzeit HH:MM"},"call_id":{"type":"string","description":"Call ID from system"}},"required":["call_id"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-reschedule-appointment","timeout_ms":15000,"name":"reschedule_appointment","description":"Verschiebt einen Termin auf neues Datum/Uhrzeit","type":"custom","parameters":{"type":"object","properties":{"new_uhrzeit":{"type":"string","description":"Required: Neue Uhrzeit HH:MM"},"appointment_id":{"type":"string","description":"Optional: Appointment ID"},"old_datum":{"type":"string","description":"Optional: Altes Datum DD.MM.YYYY"},"old_uhrzeit":{"type":"string","description":"Optional: Alte Uhrzeit HH:MM"},"call_id":{"type":"string","description":"Call ID from system"},"new_datum":{"type":"string","description":"Required: Neues Datum (heute, morgen, oder DD.MM.YYYY)"}},"required":["call_id","new_datum","new_uhrzeit"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-get-services","timeout_ms":15000,"name":"get_available_services","description":"Listet alle verfügbaren Services auf","type":"custom","parameters":{"type":"object","properties":{"call_id":{"type":"string","description":"Call ID from system"}},"required":["call_id"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-start-booking","timeout_ms":5000,"name":"start_booking","parameter_mapping":{"call_id":"{{call_id}}"},"description":"Step 1 of 2-step booking: Validates all booking data and returns immediate status (<500ms). Use this BEFORE confirm_booking to provide instant feedback to user. Returns validation status and caches data.","type":"custom","parameters":{"type":"object","properties":{"datetime":{"type":"string","description":"Appointment date and time in format: DD.MM.YYYY HH:MM (e.g., 06.11.2025 14:00). IMPORTANT: Always use year 2025."},"service":{"type":"string","description":"Service name (e.g., Herrenhaarschnitt, Damenhaarschnitt, Beratung)"},"function_name":{"type":"string","description":"Function name: start_booking"},"customer_email":{"type":"string","description":"Customer email address (optional)"},"customer_phone":{"type":"string","description":"Customer phone number (format: +49... or 0...)"},"customer_name":{"type":"string","description":"Customer full name"},"call_id":{"type":"string","description":"Unique Retell call identifier for session tracking"}},"required":["function_name","call_id","datetime","service","customer_name","customer_phone"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-confirm-booking","timeout_ms":30000,"name":"confirm_booking","parameter_mapping":{"call_id":"{{call_id}}"},"description":"Step 2 of 2-step booking: Executes the actual Cal.com booking and database save. Call this IMMEDIATELY AFTER start_booking returns success. Takes 4-5s but user already heard status message.","type":"custom","parameters":{"type":"object","properties":{"function_name":{"type":"string","description":"Function name: confirm_booking"},"call_id":{"type":"string","description":"Same call_id used in start_booking to retrieve cached booking data"}},"required":["function_name","call_id"]},"url":"https://api.askproai.de/api/webhooks/retell/function"},{"tool_id":"tool-get-current-context","timeout_ms":5000,"name":"get_current_context","description":"Ruft aktuelles Datum, Uhrzeit und Kontext-Informationen ab. Wird automatisch beim Call-Start gecallt um {{current_date}}, {{current_time}}, {{day_name}} zu setzen.","type":"custom","parameters":{"type":"object","properties":{"call_id":{"type":"string","description":"Die Call ID des aktuellen Anrufs"}},"required":["call_id"]},"url":"https://api.askproai.de/api/webhooks/retell/current-context"}],"model_choice":{"type":"cascading","model":"gpt-4.1-mini","high_priority":true},"model_temperature":0.3,"tool_call_strict_mode":false,"knowledge_base_ids":[],"kb_config":{"top_k":3,"filter_score":0.6},"begin_tag_display_position":{"x":0,"y":345},"is_published":false}