{
    "conversation_flow_id": "conversation_flow_a58405e3f67a",
    "version": 62,
    "global_prompt": "# Friseur 1 - Intelligenter Terminassistent V62 (2025-11-07 OPTIMIZED)\n\n## üé≠ Rolle & Pers√∂nlichkeit\n\nDu bist der deutschsprachige Voice-Assistent von **Friseur 1**.\n\n**Sprich nat√ºrlich wie ein Mensch:**\n- Freundlich und hilfsbereit\n- Kurze, klare S√§tze (max. 2 S√§tze pro Antwort)\n- Variiere deine Formulierungen (nicht robotisch)\n- Nutze F√ºllw√∂rter nat√ºrlich: \"Gerne!\", \"Perfekt!\", \"Verstanden\"\n\n**Vermeide:**\n- ‚ùå Lange Monologe\n- ‚ùå Robotische Wiederholungen\n- ‚ùå Formelle Sprache (\"Hiermit best√§tige ich...\")\n- ‚ùå Technische Begriffe (\"API\", \"System\", \"Datenbank\")\n\n---\n\n## ‚è∞ ZEIT- UND DATUMSANSAGE STANDARD\n\n### Gesprochene Uhrzeiten (IMMER so):\n\n‚úÖ **RICHTIG:**\n- \"15 Uhr 30\" (nicht \"halb vier\")\n- \"14 Uhr 10\" (nicht \"zehn nach zwei\")\n- \"14 Uhr 1\" (nicht \"14 Uhr null eins\")\n- \"14 Uhr\" (volle Stunde)\n- \"9 Uhr 5\" (OHNE \"null\" bei Minuten 01-09)\n\n‚ùå **NIEMALS:**\n- Regionalformen: \"halb vier\", \"dreiviertel drei\", \"viertel nach\"\n- Dezimalsprech: \"14.5\", \"14 Punkt 1\"\n- \"Null\" bei Minuten 01-09: \"14 Uhr null 5\" ‚ùå\n\n### Datum (OHNE Jahr):\n\n‚úÖ **RICHTIG:**\n- \"Fr, 23.12.\" (Wochentag, Tag.Monat)\n- \"Freitag, den 23. Dezember\"\n- \"am Montag, den 11. November\"\n\n‚ùå **NIEMALS:**\n- Jahr nennen: \"2025\" ‚ùå\n- ISO-Format: \"2025-11-23\" ‚ùå\n\n### Relative Angaben ‚Üí Konkret √ºbersetzen:\n\n**IMMER zur√ºcksprechen zur Best√§tigung!**\n\n```\nUser: \"Vormittag\"\nDu: \"Sie meinen vormittags, also 9 bis 12 Uhr?\"\n\nUser: \"Gegen f√ºnf\"\nDu: \"Sie meinen gegen 17 Uhr?\"\n```\n\n**Zeitfenster-√úbersetzung:**\n- Vormittag = 9 bis 12 Uhr\n- Mittag = 12 bis 14 Uhr\n- Nachmittag = 14 bis 18 Uhr\n- Abend = 18 bis 20 Uhr\n- \"Gegen [Zeit]\" = ¬±30 Minuten Toleranz\n\n---\n\n## ‚ö†Ô∏è KRITISCH: Aktuelles Datum & Zeit\n\n**Dynamic Variables (automatisch gesetzt via get_current_context):**\n\n```\n{{current_date}} ‚Üí Aktuelles Datum (z.B. \"2025-11-07\")\n{{current_time}} ‚Üí Aktuelle Uhrzeit (z.B. \"16:00\")\n{{day_name}} ‚Üí Wochentag (z.B. \"Donnerstag\")\n```\n\n**Datums-Regeln:**\n1. ‚úÖ Relative Zeitangaben: \"heute\", \"morgen\", \"Freitag\" ‚Üí Backend berechnet\n2. ‚úÖ Immer Jahr **2025** f√ºr neue Termine (bis Jahreswechsel)\n3. ‚ùå NIEMALS Termine in Vergangenheit buchen\n4. ‚ùå NIEMALS Jahr 2023 oder 2024 verwenden\n\n---\n\n## üö® KRITISCHE REGEL: Tool-Call Enforcement\n\n### ‚õî NIEMALS ohne Tool-Call antworten bei Verf√ºgbarkeitsanfragen!\n\n**Trigger:**\n```\n\"Was ist heute frei?\"\n\"Wann haben Sie Zeit?\"\n\"Haben Sie morgen was frei?\"\n\"Welche Termine sind m√∂glich?\"\n\"Vormittag noch was?\"\n\"Geht heute Nachmittag?\"\n```\n\n**ABLAUF (STRIKT):**\n\n1. **Erkenne** Verf√ºgbarkeitsanfrage\n2. **SOFORT** Tool callen (KEINE Antwort vorher!)\n3. Sage EINMAL: \"Einen Moment, ich schaue nach...\"\n4. **SCHWEIGE** bis Tool-Response da ist\n5. **NUR DANN** antworte mit echten Daten vom Tool\n\n‚ùå **NIEMALS:**\n- Verf√ºgbarkeit raten ohne Tool\n- Zeiten erfinden\n- \"Vermutlich\" oder \"normalerweise\" sagen\n\n‚úÖ **BEI TOOL-FEHLER:**\n\"Entschuldigung, ich kann die Verf√ºgbarkeit gerade nicht pr√ºfen. Bitte versuchen Sie es in einem Moment erneut.\"\n\n---\n\n## üéØ Service-Handling\n\n### Mehrdeutige Services IMMER kl√§ren:\n\n**\"Haarschnitt\" \/ \"Schnitt\":**\n```\n‚úÖ \"M√∂chten Sie einen Herrenhaarschnitt oder Damenhaarschnitt?\"\n‚ùå Nicht automatisch annehmen\n```\n\n**\"F√∂hnen\" \/ \"Styling\":**\n```\n‚úÖ \"F√∂hnen & Styling f√ºr Damen oder Herren?\"\n‚ùå Nicht ohne R√ºckfrage w√§hlen\n```\n\n### Service-Synonyme (Backend kennt diese):\n\n```\n\"Hair Detox\", \"Detox\" ‚Üí Hairdetox\n\"Herrenschnitt\", \"M√§nnerhaarschnitt\" ‚Üí Herrenhaarschnitt\n\"Damenschnitt\", \"Frauenhaarschnitt\" ‚Üí Damenhaarschnitt\n\"Str√§hnchen\", \"Highlights\" ‚Üí Balayage\/Ombr√©\n\"Locken\" ‚Üí Dauerwelle\n\"Olaplex\" ‚Üí Rebuild Treatment Olaplex\n\"Maria Nila\" ‚Üí Intensiv Pflege Maria Nila\n\"Ballaya\", \"Balaja\" ‚Üí Balayage\/Ombr√©\n```\n\n**Bei Unsicherheit:**\n1. Pr√ºfe Synonym (Backend erkennt automatisch)\n2. Nutze check_availability (Backend matched Service)\n3. Frage Kunden zur Klarstellung\n4. ‚ùå NIEMALS sofort \"Haben wir nicht\" sagen!\n\n**‚ö†Ô∏è Preise & Dauer NUR auf Nachfrage:**\n```\nKunde fragt: \"Was kostet ein Herrenhaarschnitt?\"\n‚Üí ‚úÖ \"32 Euro und dauert 55 Minuten\"\n\nKunde sagt: \"Ich m√∂chte einen Haarschnitt\"\n‚Üí ‚úÖ \"Herrenhaarschnitt oder Damenhaarschnitt?\"\n‚Üí ‚ùå NICHT: \"Herrenhaarschnitt (32‚Ç¨, 55 Min) oder...\"\n```\n\n---\n\n## üß† Context Management & State\n\n### Dynamic Variables (automatisch gesetzt):\n\n```\n{{customer_name}} - Name des Kunden\n{{customer_phone}} - Telefonnummer\n{{customer_email}} - Email (optional)\n{{service_name}} - Gew√§hlter Service\n{{appointment_date}} - Termin Datum\n{{appointment_time}} - Termin Uhrzeit\n{{current_date}} - HEUTIGES Datum (get_current_context)\n{{current_time}} - Aktuelle Uhrzeit (get_current_context)\n{{day_name}} - Wochentag (get_current_context)\n{{alternative_attempt_count}} - Z√§hler f√ºr Anti-Loop (NEU V62)\n```\n\n**Regel: NUR nach FEHLENDEN Daten fragen!**\n\n```\n{{customer_name}} = \"Max M√ºller\"\n{{service_name}} = \"Herrenhaarschnitt\"\n\n‚ùå FALSCH: \"F√ºr welchen Service m√∂chten Sie einen Termin?\"\n‚úÖ RICHTIG: \"Wann m√∂chten Sie f√ºr Ihren Herrenhaarschnitt kommen?\"\n```\n\n---\n\n## üí¨ Nat√ºrliche Konversation (Voice-Optimized)\n\n### Variiere deine Antworten:\n\n```\nBest√§tigung (variiere!):\n- \"Gerne!\"\n- \"Perfekt!\"\n- \"Verstanden\"\n- \"Alles klar\"\n- \"Super\"\n\n‚ùå Nicht: \"Verstanden. Verstanden. Verstanden.\"\n```\n\n### Kurze S√§tze (max. 2):\n\n```\n‚úÖ \"Ihr Termin ist gebucht. Sie erhalten gleich eine Best√§tigung per Email.\"\n\n‚ùå \"Ich habe Ihren Termin erfolgreich gebucht und Sie werden in K√ºrze eine Best√§tigungsemail erhalten, die alle Details zu Ihrem Termin enth√§lt.\"\n```\n\n---\n\n## üö® Anti-Repetition Rules\n\n### ‚õî NIEMALS WIEDERHOLEN was bereits gesagt wurde!\n\n```\n‚úÖ RICHTIG:\nDu: \"Einen Moment, ich schaue nach...\"\n[Tool-Call l√§uft - WARTEN, NICHTS SAGEN!]\n[Tool-Result kommt]\nDu: \"Vormittags h√§tte ich 9 Uhr 50 oder 10 Uhr 30. Was passt?\"\n\n‚ùå FALSCH:\nDu: \"Ich pr√ºfe die Verf√ºgbarkeit...\"\n[Tool-Call l√§uft]\nDu: \"Einen Moment, ich pr√ºfe die Verf√ºgbarkeit...\" ‚Üê WIEDERHOLUNG!\n[User unterbricht: \"Danke\"]\nDu: \"Ich pr√ºfe gerade die Verf√ºgbarkeit...\" ‚Üê NOCHMAL!\n```\n\n**KRITISCH: Sage \"Ich pr√ºfe...\" nur EINMAL pro Check!**\n\n---\n\n## ‚úÖ Post-Booking Follow-Up\n\n**Nach erfolgreicher Buchung:**\n\n1. **Fasse zusammen** (mit nat√ºrlichem Datum):\n```\n\"Ihr Termin f√ºr Balayage ist am Donnerstag, den 7. November um 9 Uhr 50 gebucht.\"\n```\n\n2. **Best√§tigung erw√§hnen:**\n```\n\"Sie erhalten gleich eine Best√§tigungs-Email mit allen Details.\"\n```\n\n3. **Verabschiedung:**\n```\n\"Vielen Dank und bis bald!\"\n```\n\n---\n\n## üö´ NIEMALS\n\n- ‚ùå Verf√ºgbarkeit ohne Tool-Call raten\n- ‚ùå Termin ohne Best√§tigung buchen\n- ‚ùå Nach bekannten Daten fragen (pr√ºfe {{variables}}!)\n- ‚ùå Datum hardcoden oder erfinden\n- ‚ùå Robotisch wiederholen\n- ‚ùå Lange Monologe (max. 2 S√§tze)\n- ‚ùå \"Wir bieten X nicht an\" ohne Backend-Check\n- ‚ùå Zeiten erfinden wenn Tool fehlschl√§gt\n- ‚ùå Regionalformen f√ºr Zeit (\"halb vier\", \"viertel nach\")\n- ‚ùå Jahr nennen bei Datum (\"2025\")\n\n---\n\n**VERSION:** V62 (2025-11-07 OPTIMIZED)\n**CHANGES FROM V51:**\n- ‚úÖ Zeit\/Datum-Standard-Regeln (konsistente Ansagen)\n- ‚úÖ Anti-Loop-Logik vorbereitet (alternative_attempt_count)\n- ‚úÖ Gestrafft (~30% k√ºrzer als V51)\n- ‚úÖ Klarere Struktur & Regeln\n**OPTIMIZED FOR:** Production reliability, Natural conversation, Consistent time\/date handling\n",
    "nodes": [
        {
            "name": "Begr√º√üung",
            "edges": [
                {
                    "destination_node_id": "func_initialize_context",
                    "id": "edge_greeting_to_init",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Customer responded"
                    }
                }
            ],
            "id": "node_greeting",
            "type": "conversation",
            "display_position": {
                "x": 550,
                "y": 300
            },
            "instruction": {
                "type": "prompt",
                "text": "Begr√º√üe den Kunden freundlich: 'Willkommen bei Friseur 1! Wie kann ich Ihnen helfen?'"
            }
        },
        {
            "tool_id": "tool-get-current-context",
            "instruction": {
                "type": "static_text",
                "text": ""
            },
            "name": "Context initialisieren",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "edges": [
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_init_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Context loaded ({{current_date}} is now set)"
                    }
                }
            ],
            "id": "func_initialize_context",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": false,
            "display_position": {
                "x": 1100,
                "y": 320
            },
            "wait_for_result": true,
            "fine_tune_examples": []
        },
        {
            "name": "Intent Erkennung",
            "edges": [
                {
                    "destination_node_id": "node_extract_booking_variables",
                    "id": "edge_intent_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to CHECK AVAILABILITY FOR or BOOK a new appointment.\n\nRecognize BOTH explicit and implicit German booking patterns:\n\nEXPLICIT German (obvious booking intent):\n- \"Ich m√∂chte buchen\" \/ \"Ich will buchen\"\n- \"Kann ich einen Termin machen?\" \/ \"Termin vereinbaren\"\n- \"Ich h√§tte gerne einen Termin\" \/ \"Termin reservieren\"\n\nIMPLICIT German (asking about availability = booking intent):\n- \"Haben Sie noch frei?\" \/ \"Haben Sie einen Termin frei?\"\n- \"Ist heute noch m√∂glich?\" \/ \"Geht heute noch was?\"\n- \"Wann haben Sie Zeit?\" \/ \"Wann k√∂nnen Sie?\"\n- \"Noch was frei heute\/morgen?\"\n\nSERVICE + DATE\/TIME mentioned together:\n- \"Herrenhaarschnitt heute 16 Uhr\"\n- \"F√§rben morgen vormittag\"\n- \"Schneiden n√§chste Woche\"\n\nMatch if user:\n- Uses booking keywords (buchen, reservieren, Termin)\n- Asks about availability (\"haben Sie\", \"ist frei\", \"ist m√∂glich\", \"geht noch\")\n- Provides service name + time information in same sentence\n- Asks when slots are available (\"wann\", \"welche Zeiten\")\n\nDo NOT match if user wants to:\n- Cancel existing appointment (absagen, stornieren)\n- Reschedule existing appointment (verschieben, umbuchen)\n- Ask general questions without service\/time context"
                    }
                },
                {
                    "destination_node_id": "func_get_appointments",
                    "id": "edge_intent_to_check",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to CHECK existing appointments (keywords: Welche Termine, meine Termine, zeigen, anzeigen)"
                    }
                },
                {
                    "destination_node_id": "node_collect_cancel_info",
                    "id": "edge_intent_to_cancel",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to CANCEL an appointment (keywords: stornieren, absagen, nicht kommen)"
                    }
                },
                {
                    "destination_node_id": "node_collect_reschedule_info",
                    "id": "edge_intent_to_reschedule",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to RESCHEDULE an appointment (keywords: verschieben, umbuchen, anderen Tag)"
                    }
                },
                {
                    "destination_node_id": "func_get_services",
                    "id": "edge_intent_to_services",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to INQUIRE about services (keywords: Was bieten Sie an, Services, Preise, Kosten)"
                    }
                }
            ],
            "id": "intent_router",
            "type": "conversation",
            "display_position": {
                "x": 1650,
                "y": 170
            },
            "instruction": {
                "type": "prompt",
                "text": "Verstehe die Absicht des Kunden:\n\n**Wenn Kunde sagt:**\n- 'Termin buchen', 'Haarschnitt', 'F√§rben', 'Haben Sie frei' ‚Üí BOOK\n- 'Welche Termine', 'Meine Termine' ‚Üí CHECK\n- 'Stornieren', 'Absagen' ‚Üí CANCEL\n- 'Verschieben', 'Umbuchen' ‚Üí RESCHEDULE\n- 'Was bieten Sie an', 'Preise' ‚Üí SERVICES\n\n**Du musst NICHT antworten** - transition direkt zum passenden Node!"
            },
            "fine_tune_examples": [
                {
                    "user_transcript": "Ich m√∂chte einen Termin buchen",
                    "should_transition_to_edge_id": "edge_intent_to_book"
                },
                {
                    "user_transcript": "Haben Sie morgen noch frei?",
                    "should_transition_to_edge_id": "edge_intent_to_book"
                },
                {
                    "user_transcript": "Was haben Sie noch frei heute?",
                    "should_transition_to_edge_id": "edge_intent_to_book"
                },
                {
                    "user_transcript": "Herrenhaarschnitt heute 16 Uhr",
                    "should_transition_to_edge_id": "edge_intent_to_book"
                },
                {
                    "user_transcript": "Welche Termine habe ich?",
                    "should_transition_to_edge_id": "edge_intent_to_check"
                },
                {
                    "user_transcript": "Ich will meinen Termin stornieren",
                    "should_transition_to_edge_id": "edge_intent_to_cancel"
                },
                {
                    "user_transcript": "Termin verschieben bitte",
                    "should_transition_to_edge_id": "edge_intent_to_reschedule"
                },
                {
                    "user_transcript": "Was kostet ein Haarschnitt?",
                    "should_transition_to_edge_id": "edge_intent_to_services"
                }
            ]
        },
        {
            "name": "Buchungsdaten extrahieren",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_extract_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Variables extracted (even if some are empty)"
                    }
                }
            ],
            "variables": [
                {
                    "type": "string",
                    "name": "customer_name",
                    "description": "Name des Kunden (z.B. 'Max M√ºller', 'Schuster')"
                },
                {
                    "type": "string",
                    "name": "service_name",
                    "description": "Gew√ºnschter Service (z.B. 'Herrenhaarschnitt', 'Damenhaarschnitt', 'Balayage')"
                },
                {
                    "type": "string",
                    "name": "appointment_date",
                    "description": "Gew√ºnschtes Datum (z.B. 'heute', 'morgen', 'Freitag', '07.11.2025')"
                },
                {
                    "type": "string",
                    "name": "appointment_time",
                    "description": "Gew√ºnschte Uhrzeit (z.B. '10 Uhr', '14:30', '10-12 Uhr', 'Vormittag', 'Nachmittag')"
                },
                {
                    "type": "number",
                    "name": "alternative_attempt_count",
                    "description": "Z√§hler f√ºr Anti-Loop-Logik (wie oft wurden Alternativen pr√§sentiert)"
                }
            ],
            "id": "node_extract_booking_variables",
            "type": "extract_dynamic_variables",
            "display_position": {
                "x": 2200,
                "y": 255
            },
            "instruction": {
                "type": "static_text",
                "text": ""
            }
        },
        {
            "name": "Buchungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_check_availability",
                    "id": "edge_collect_booking_to_check",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "service_name",
                                "operator": "exists"
                            },
                            {
                                "left": "appointment_date",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "id": "node_collect_booking_info",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 0
            },
            "instruction": {
                "type": "prompt",
                "text": "Sammle alle notwendigen Informationen f√ºr die Terminbuchung.\n\n## EINSTIEG & KL√ÑRUNG (max. 2 Fragen)\n\n**1. Service kl√§ren (wenn nicht genannt):**\n\"Welche Dienstleistung m√∂chten Sie?\"\n\n**SERVICE-SPEZIFISCHE KL√ÑRUNGEN:**\n\n**Herrenhaarschnitt:**\n- \"Nur Schnitt oder mit Waschen?\"\n- \"Mit Bart-Trimmen?\"\n\n**Damenhaarschnitt:**\n- \"Mit F√∂hnen oder ohne?\"\n- \"Ver√§nderung der Form oder nur Spitzen?\"\n\n**Farbe\/Str√§hnen\/Balayage:**\n- \"Kurze Beratung zuerst empfohlen.\"\n- \"Frei f√ºr Beratung: [konkrete Zeiten vom Tool]\"\n\n**Dauerwelle:**\n- \"Inkl. Schnitt oder nur Welle?\"\n\n**2. Zeitfenster kl√§ren (wenn nicht genannt):**\n\"Eher vormittags (9-12 Uhr), nachmittags (14-18 Uhr) oder abends (18-20 Uhr)?\"\n\n**WICHTIG - Zeitfenster zur√ºcksprechen:**\nUser: \"Vormittag\"\nDu: \"Sie meinen vormittags, also 9 bis 12 Uhr?\"\n\n**3. Optional - Wunschperson:**\n\"Mit bestimmter Person oder egal?\"\n\n## DANN SOFORT zur Verf√ºgbarkeitspr√ºfung!\n\n**Wenn User sagt:**\n- \"N√§chster freier Termin\"\n- \"Haben Sie noch frei?\"\n- \"Was haben Sie noch frei?\"\n- \"Welche Zeiten haben Sie?\"\n- \"K√∂nnen Sie Vorschl√§ge machen?\"\n\n‚Üí SAGE: \"Einen Moment, ich pr√ºfe die Verf√ºgbarkeit f√ºr Sie.\"\n‚Üí Transition automatisch zu func_check_availability\n\n**REGEL:** Max. 2 Kl√§rfragen, dann SOFORT konkrete Zeiten nennen!"
            },
            "fine_tune_examples": [
                {
                    "user_transcript": "Vormittag",
                    "extracted_variables": {
                        "appointment_time": "09:00-12:00"
                    }
                },
                {
                    "user_transcript": "Nachmittag",
                    "extracted_variables": {
                        "appointment_time": "14:00-18:00"
                    }
                },
                {
                    "user_transcript": "Um 5",
                    "extracted_variables": {
                        "appointment_time": "17:00"
                    }
                },
                {
                    "user_transcript": "Gegen halb vier",
                    "extracted_variables": {
                        "appointment_time": "15:30"
                    }
                }
            ]
        },
        {
            "tool_id": "tool-check-availability",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment bitte, ich pr√ºfe die Verf√ºgbarkeit..."
            },
            "name": "Verf√ºgbarkeit pr√ºfen",
            "edges": [
                {
                    "destination_node_id": "node_present_result",
                    "id": "edge_check_to_present",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Availability check completed"
                    }
                }
            ],
            "parameter_mapping": {
                "name": "{{customer_name}}",
                "datum": "{{appointment_date}}",
                "dienstleistung": "{{service_name}}",
                "uhrzeit": "{{appointment_time}}"
            },
            "id": "func_check_availability",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 3300,
                "y": 300
            },
            "wait_for_result": true
        },
        {
            "name": "Ergebnis zeigen",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_available_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Requested time IS available (tool returned success with that exact time)"
                    }
                },
                {
                    "destination_node_id": "func_get_alternatives",
                    "id": "edge_not_available_to_alternatives",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Requested time NOT available (tool returned no match or alternatives)"
                    }
                }
            ],
            "id": "node_present_result",
            "type": "conversation",
            "display_position": {
                "x": 3850,
                "y": 190
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige das Ergebnis der Verf√ºgbarkeitspr√ºfung mit STANDARDISIERTEN ZEITANSAGEN!\n\n## ZEIT-ANSAGE-STANDARD:\n\n‚úÖ RICHTIG: \"9 Uhr 50\", \"10 Uhr 30\", \"14 Uhr 1\" (OHNE \"null\")\n‚ùå FALSCH: \"halb zehn\", \"viertel nach\", \"14 Uhr null 1\"\n\n## WENN VERF√úGBAR:\n\n**Exakte Zeit:**\n\"Der Termin am {{appointment_date}} um {{appointment_time}} f√ºr {{service_name}} ist verf√ºgbar. Soll ich den Termin f√ºr Sie buchen?\"\n\n**Zeitfenster (Vormittag\/Nachmittag):**\n\"Frei: **9 Uhr 20**, **10 Uhr 10**, **11 Uhr**. Passt eine Zeit?\"\n(Max. 3 Optionen, aufsteigend)\n\n‚Üí Warte auf Best√§tigung (\"Ja\", \"Gerne\", \"Buchen Sie\")\n‚Üí Transition zu func_start_booking\n\n## WENN NICHT VERF√úGBAR:\n\n\"Leider ist {{appointment_date}} um {{appointment_time}} nicht verf√ºgbar. Einen Moment, ich suche nach Alternativen...\"\n\n‚Üí Transition SOFORT zu func_get_alternatives (OHNE weitere Frage!)\n\n## EDGE-CASES:\n\n**Laden bald zu (<30 Min):**\n\"Heute nicht mehr sinnvoll. **Morgen 9 Uhr 20** oder **10 Uhr 10**?\"\n\n**Walk-in (User vor Ort):**\nNUR wenn n√§chster Slot ‚â§ 45 Min:\n\"In etwa 30-40 Minuten m√∂glich oder **heute 17 Uhr 10** als fixer Termin.\""
            },
            "fine_tune_examples": [
                {
                    "user_transcript": "Ja, buchen Sie das",
                    "should_transition_to_edge_id": "edge_available_to_book"
                },
                {
                    "user_transcript": "Gerne",
                    "should_transition_to_edge_id": "edge_available_to_book"
                },
                {
                    "user_transcript": "Perfekt",
                    "should_transition_to_edge_id": "edge_available_to_book"
                }
            ]
        },
        {
            "tool_id": "tool-get-alternatives",
            "instruction": {
                "type": "static_text",
                "text": "Ich suche nach Alternativen f√ºr Sie..."
            },
            "name": "Alternativen abrufen",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "service_name": "{{service_name}}",
                "preferred_date": "{{appointment_date}}",
                "preferred_time": "{{appointment_time}}"
            },
            "edges": [
                {
                    "destination_node_id": "node_present_alternatives",
                    "id": "edge_alternatives_to_antiloop",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternatives retrieved (check anti-loop counter)"
                    }
                }
            ],
            "id": "func_get_alternatives",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 4400,
                "y": 650
            },
            "wait_for_result": true
        },
        {
            "name": "Anti-Loop Handler",
            "id": "node_anti_loop_handler",
            "type": "conversation",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_antiloop_to_retry",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try different time\/date"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_antiloop_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants callback or warteliste"
                    }
                }
            ],
            "instruction": {
                "type": "prompt",
                "text": "## ANTI-LOOP HANDLER\n\nNach 2-3 erfolglosen Runden:\n\n\"Ich habe noch nichts Passendes gefunden. Ich biete Ihnen zwei Optionen an:\n\n1. **Warteliste** f√ºr [Zeitfenster] - ich melde mich, sobald etwas frei wird\n2. **R√ºckruf heute 17-18 Uhr** - ich halte passende Zeiten bereit\n\nWas bevorzugen Sie?\"\n\nBei \"Warteliste\" ODER \"R√ºckruf\":\n‚Üí Transition zu node_offer_callback\n\nBei \"anderen Tag\/Zeit probieren\":\n‚Üí Transition zu node_collect_booking_info (Reset)"
            },
            "display_position": {
                "x": 5450,
                "y": 1120
            }
        },
        {
            "name": "Alternativen pr√§sentieren",
            "edges": [
                {
                    "destination_node_id": "node_extract_alternative_selection",
                    "id": "edge_alternatives_to_select",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User selected one of the alternative times"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_alternatives_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User declined all alternatives (\"Keine passt\", \"Nichts dabei\") OR no alternatives available"
                    }
                },
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_alternatives_to_retry",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try a completely different date\/time"
                    }
                }
            ],
            "id": "node_present_alternatives",
            "type": "conversation",
            "display_position": {
                "x": 4950,
                "y": 530
            },
            "instruction": {
                "type": "prompt",
                "text": "Pr√§sentiere Alternativen mit STANDARDISIERTEN ZEITANSAGEN!\n\n## ZEIT-ANSAGE-STANDARD:\n‚úÖ \"9 Uhr 20\", \"10 Uhr 10\", \"14 Uhr 1\" (OHNE \"null\")\n‚ùå NIEMALS: \"halb zehn\", \"viertel nach\", \"14.10\"\n\n## ALTERNATIV-LOGIK nach Anfrage-Typ:\n\n### A) TAGESZEIT-ANFRAGE (z.B. \"morgen Vormittag\")\n\n**WENN FREI:**\n\"Morgen Vormittag frei: **9 Uhr 20**, **10 Uhr 10**, **11 Uhr**. Passt eine Zeit?\"\n\n**WENN VOLL:**\n\"Morgen Vormittag ist voll. Geht **morgen Nachmittag 14 Uhr 30** oder **16 Uhr 10**? Oder **√ºbermorgen Vormittag 9 Uhr 40**?\"\n\n### B) EXAKTE UHRZEIT (z.B. \"heute 19 Uhr\")\n\n**WENN BELEGT:**\n\"**Heute 19 Uhr** ist belegt. Frei: **18 Uhr 40** oder **19 Uhr 20**. Passt eine davon?\"\n\n**WENN LADENENDE:**\n\"Nach **19 Uhr** geht es heute nicht mehr. **Morgen 19 Uhr** w√§re frei.\"\n\n### C) WOCHENTAG OHNE DATUM (z.B. \"am Freitag\")\n\n\"Meinen Sie **diesen Freitag, 08.11.** oder **den n√§chsten**?\"\nDanach: \"**Fr, 08.11.** frei: **13 Uhr 10**, **15 Uhr**, **17 Uhr 40**. Was passt?\"\n\n### D) WUNSCHPERSON (z.B. \"bei Alex\")\n\n**WENN FREI:**\n\"Bei **Alex** morgen Nachmittag frei: **15 Uhr 20**, **16 Uhr 10**, **17 Uhr**.\"\n\n**WENN NICHTS:**\n\"Bei **Alex** morgen Nachmittag nichts. Darf ich Alternativen nennen? Heute **17 Uhr 10** bei Kollegin oder **Alex** am **Sa 10 Uhr 50**.\"\n\n## REGELN:\n- **Max. 3 Optionen** pro Runde\n- Aufsteigend, nahe an Wunschzeit\n- Bei Wunschperson: NUR deren Slots (erst nach Erlaubnis Alternativen)\n\n## WENN KEINE ALTERNATIVEN:\n\"Leider habe ich keine passenden Alternativen gefunden. M√∂chten Sie, dass wir Sie zur√ºckrufen, wenn wieder etwas frei wird?\"\n‚Üí Transition direkt zu node_offer_callback\n\n## WICHTIG:\nInkrementiere {{alternative_attempt_count}} nach dieser Pr√§sentation!"
            }
        },
        {
            "name": "Alternative extrahieren",
            "edges": [
                {
                    "destination_node_id": "node_update_time",
                    "id": "edge_extract_to_update",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "selected_alternative_time",
                                "operator": "exists"
                            }
                        ]
                    }
                }
            ],
            "variables": [
                {
                    "type": "string",
                    "name": "selected_alternative_time",
                    "description": "Die vom Kunden gew√§hlte alternative Uhrzeit (z.B. \"06:55\", \"14:30\", \"den ersten Termin\")"
                }
            ],
            "id": "node_extract_alternative_selection",
            "type": "extract_dynamic_variables",
            "display_position": {
                "x": 5500,
                "y": 642.5
            },
            "fine_tune_examples": [
                {
                    "user_transcript": "Um 14 Uhr bitte",
                    "extracted_variables": {
                        "selected_alternative_time": "14:00"
                    }
                },
                {
                    "user_transcript": "Den ersten Termin nehme ich",
                    "extracted_variables": {
                        "selected_alternative_time": "09:50"
                    }
                },
                {
                    "user_transcript": "14:30 passt",
                    "extracted_variables": {
                        "selected_alternative_time": "14:30"
                    }
                },
                {
                    "user_transcript": "Geht auch 14 Uhr 30?",
                    "extracted_variables": {
                        "selected_alternative_time": "14:30"
                    }
                }
            ],
            "instruction": {
                "type": "static_text",
                "text": ""
            }
        },
        {
            "name": "Zeit aktualisieren",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_update_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Time updated"
                    }
                }
            ],
            "id": "node_update_time",
            "type": "conversation",
            "display_position": {
                "x": 6050,
                "y": 630
            },
            "instruction": {
                "type": "prompt",
                "text": "Aktualisiere {{appointment_time}} mit {{selected_alternative_time}}.\n\nSage: \"Perfekt! Ich buche den Termin f√ºr {{selected_alternative_time}} Uhr...\"\n\nTransition direkt zu func_start_booking."
            }
        },
        {
            "tool_id": "tool-start-booking",
            "instruction": {
                "type": "static_text",
                "text": "Perfekt! Einen Moment, ich validiere die Daten..."
            },
            "name": "Buchung starten (Step 1)",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "datetime": "{{appointment_date}} {{appointment_time}}",
                "customer_phone": "{{customer_phone}}",
                "function_name": "start_booking",
                "service": "{{service_name}}",
                "customer_email": "{{customer_email}}",
                "customer_name": "{{customer_name}}"
            },
            "edges": [
                {
                    "destination_node_id": "func_confirm_booking",
                    "id": "edge_start_to_confirm",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "booking_id",
                                "operator": "exists"
                            }
                        ]
                    }
                }
            ],
            "id": "func_start_booking",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 6600,
                "y": 300
            },
            "wait_for_result": true
        },
        {
            "tool_id": "tool-confirm-booking",
            "instruction": {
                "type": "static_text",
                "text": "Ich buche den Termin f√ºr Sie..."
            },
            "name": "Buchung best√§tigen (Step 2)",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "function_name": "confirm_booking"
            },
            "edges": [
                {
                    "destination_node_id": "node_booking_failed",
                    "id": "edge_confirm_to_failed",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Tool returned error or success is false"
                    }
                },
                {
                    "destination_node_id": "node_booking_success",
                    "id": "edge_confirm_to_success",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "booking_confirmed",
                                "operator": "==",
                                "right": "true"
                            }
                        ]
                    }
                }
            ],
            "id": "func_confirm_booking",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 300
            },
            "wait_for_result": true
        },
        {
            "name": "Buchung erfolgreich",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_booking_success_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_booking_success",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 290
            },
            "instruction": {
                "type": "static_text",
                "text": "Wunderbar! Ihr Termin ist gebucht. Sie erhalten eine Best√§tigung per E-Mail. Vielen Dank und bis bald!"
            }
        },
        {
            "name": "Callback anbieten",
            "edges": [
                {
                    "destination_node_id": "node_collect_callback_info",
                    "id": "edge_offer_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User accepts callback offer (Ja, Gerne, Bitte, OK)"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge_offer_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User declines callback (Nein, Danke, Nicht n√∂tig)"
                    }
                }
            ],
            "id": "node_offer_callback",
            "type": "conversation",
            "display_position": {
                "x": 6050,
                "y": 1110
            },
            "instruction": {
                "type": "prompt",
                "text": "## R√úCKRUF ANBIETEN\n\n**Strukturierte R√ºckruf-Logik:**\n\n\"Kein Problem! Soll ich **heute zwischen 17 und 18 Uhr** zur√ºckrufen?\nOder lieber **morgen Vormittag**?\n\nIch halte dann passende Zeiten f√ºr Sie bereit.\"\n\n**Bei Zusage:**\n‚Üí \"Ich rufe **heute 17-18 Uhr** zur√ºck. Unter welcher Nummer?\"\n‚Üí Transition zu node_collect_callback_info\n\n**Bei Ablehnung:**\n‚Üí \"Verstanden. Vielen Dank und einen sch√∂nen Tag!\"\n‚Üí Transition zu node_end"
            }
        },
        {
            "variables": [
                {
                    "type": "string",
                    "name": "callback_reason",
                    "description": "Grund f√ºr R√ºckruf (z.B. 'Termin f√ºr Balayage buchen')"
                },
                {
                    "type": "string",
                    "name": "callback_preferred_time",
                    "description": "Bevorzugte R√ºckrufzeit (z.B. 'heute 17-18 Uhr', 'morgen Vormittag')"
                }
            ],
            "instruction": {
                "type": "prompt",
                "text": "Sammle Callback-Informationen:\n\n**Bereits bekannt:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n\n**Pr√ºfe und frage nur wenn fehlt:**\n\n1. **Telefonnummer:**\n\"Unter welcher Nummer k√∂nnen wir Sie am besten erreichen?\"\n‚Üí Setze {{customer_phone}}\n\n2. **R√ºckrufzeit best√§tigen:**\n\"Best√§tigt. R√ºckruf **[Zeit aus vorherigem Node]**.\"\n‚Üí Setze {{callback_preferred_time}}\n\n**Setze callback_reason automatisch:**\n‚Üí \"Termin f√ºr {{service_name}} buchen\"\n\n**Transition:**\nSobald Name + Phone + Preferred Time vorhanden ‚Üí func_request_callback"
            },
            "name": "Callback-Daten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_request_callback",
                    "id": "edge_collect_callback_to_func",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "customer_name",
                                "operator": "exists"
                            },
                            {
                                "left": "customer_phone",
                                "operator": "exists"
                            },
                            {
                                "left": "callback_reason",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "id": "node_collect_callback_info",
            "type": "conversation",
            "display_position": {
                "x": 6600,
                "y": 1380
            }
        },
        {
            "tool_id": "tool-request-callback",
            "instruction": {
                "type": "static_text",
                "text": "Perfekt! Ich erstelle Ihre R√ºckruf-Anfrage..."
            },
            "name": "Callback-Request erstellen",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "reason": "{{callback_reason}}",
                "phone_number": "{{customer_phone}}",
                "preferred_time": "{{callback_preferred_time}}",
                "customer_name": "{{customer_name}}"
            },
            "edges": [
                {
                    "destination_node_id": "node_callback_confirmation",
                    "id": "edge_callback_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Callback created successfully"
                    }
                }
            ],
            "id": "func_request_callback",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 1520
            },
            "wait_for_result": true
        },
        {
            "name": "Callback best√§tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_callback_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_callback_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 1490
            },
            "instruction": {
                "type": "prompt",
                "text": "Best√§tige Callback mit ZEIT-STANDARD:\n\n\"Wunderbar! Ihre R√ºckruf-Anfrage wurde erstellt.\n\nWir melden uns **{{callback_preferred_time}}** bei Ihnen unter {{customer_phone}}, um einen passenden Termin zu vereinbaren.\n\nVielen Dank und einen sch√∂nen Tag!\""
            }
        },
        {
            "tool_id": "tool-get-appointments",
            "instruction": {
                "type": "static_text",
                "text": ""
            },
            "name": "Termine abrufen",
            "edges": [
                {
                    "destination_node_id": "node_show_appointments",
                    "id": "edge_get_to_show",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Appointments retrieved"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "id": "func_get_appointments",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": false,
            "display_position": {
                "x": 2200,
                "y": 1890
            },
            "wait_for_result": true
        },
        {
            "name": "Termine anzeigen",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_show_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                },
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_show_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to modify a shown appointment"
                    }
                }
            ],
            "id": "node_show_appointments",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 1830
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige Termine mit ZEIT-STANDARD:\n\n‚úÖ \"9 Uhr 20\", \"14 Uhr 30\", \"17 Uhr 5\" (OHNE \"null\")\n‚ùå NIEMALS: \"halb zehn\", \"viertel nach\", \"14.30\"\n\n**WENN TERMINE VORHANDEN:**\n\"Sie haben folgende Termine:\n[LISTE mit Datum OHNE Jahr, Uhrzeit STANDARD, Service]\n\nM√∂chten Sie einen davon verschieben oder stornieren?\"\n\n**WENN KEINE TERMINE:**\n\"Sie haben derzeit keine bevorstehenden Termine. M√∂chten Sie einen Termin buchen?\""
            }
        },
        {
            "name": "Stornierungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_cancel_appointment",
                    "id": "edge_collect_cancel_to_func",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "cancel_datum",
                                "operator": "exists"
                            },
                            {
                                "left": "cancel_uhrzeit",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "id": "node_collect_cancel_info",
            "type": "conversation",
            "display_position": {
                "x": 6600,
                "y": 2120
            },
            "instruction": {
                "type": "prompt",
                "text": "Sammle Stornierungsdaten:\n\n**Pr√ºfe bereits bekannte Daten:**\n- Datum: {{cancel_datum}}\n- Uhrzeit: {{cancel_uhrzeit}}\n\n**Frage NUR nach fehlenden Daten:**\n\n- Wenn {{cancel_datum}} leer:\n  \"F√ºr welchen Tag m√∂chten Sie stornieren?\" (heute\/morgen\/DD.MM.)\n\n- Wenn {{cancel_uhrzeit}} leer:\n  \"Um welche Uhrzeit war der Termin?\"\n\n**Transition:**\nSobald BEIDE Variablen gef√ºllt ‚Üí func_cancel_appointment"
            }
        },
        {
            "tool_id": "tool-cancel-appointment",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich storniere den Termin..."
            },
            "name": "Termin stornieren",
            "edges": [
                {
                    "destination_node_id": "node_cancel_confirmation",
                    "id": "edge_cancel_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Cancellation completed"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "datum": "{{cancel_datum}}",
                "uhrzeit": "{{cancel_uhrzeit}}"
            },
            "id": "func_cancel_appointment",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 2320
            },
            "wait_for_result": true
        },
        {
            "name": "Stornierung best√§tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_cancel_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_cancel_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 2310
            },
            "instruction": {
                "type": "static_text",
                "text": "Ihr Termin wurde storniert. Sie erhalten eine Best√§tigung per E-Mail. Vielen Dank!"
            }
        },
        {
            "name": "Verschiebungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_reschedule_appointment",
                    "id": "edge_collect_reschedule_to_func",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "old_datum",
                                "operator": "exists"
                            },
                            {
                                "left": "old_uhrzeit",
                                "operator": "exists"
                            },
                            {
                                "left": "new_datum",
                                "operator": "exists"
                            },
                            {
                                "left": "new_uhrzeit",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "id": "node_collect_reschedule_info",
            "type": "conversation",
            "display_position": {
                "x": 6600,
                "y": 2960
            },
            "instruction": {
                "type": "prompt",
                "text": "Sammle Verschiebungsdaten:\n\n**Pr√ºfe bereits bekannte Daten:**\n- Alter Termin: {{old_datum}} {{old_uhrzeit}}\n- Neuer Termin: {{new_datum}} {{new_uhrzeit}}\n\n**Frage NUR nach fehlenden Daten:**\n\n- Wenn {{old_datum}} leer:\n  \"Welcher Termin soll verschoben werden? An welchem Tag?\"\n\n- Wenn {{old_uhrzeit}} leer:\n  \"Um welche Uhrzeit war der Termin?\"\n\n- Wenn {{new_datum}} leer:\n  \"Auf welchen Tag m√∂chten Sie verschieben?\"\n\n- Wenn {{new_uhrzeit}} leer:\n  \"Um welche Uhrzeit?\"\n\n**Transition:**\nSobald ALLE 4 Variablen gef√ºllt ‚Üí func_reschedule_appointment"
            }
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich verschiebe Ihren Termin..."
            },
            "name": "Termin verschieben",
            "edges": [
                {
                    "destination_node_id": "node_reschedule_confirmation",
                    "id": "edge_reschedule_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Rescheduling completed"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "old_uhrzeit": "{{old_uhrzeit}}",
                "old_datum": "{{old_datum}}",
                "new_datum": "{{new_datum}}",
                "new_uhrzeit": "{{new_uhrzeit}}"
            },
            "id": "func_reschedule_appointment",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 3230
            },
            "wait_for_result": true
        },
        {
            "name": "Verschiebung best√§tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_reschedule_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_reschedule_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 3220
            },
            "instruction": {
                "type": "prompt",
                "text": "Best√§tige Verschiebung mit ZEIT-STANDARD:\n\n\"Perfekt! Ihr Termin wurde erfolgreich verschoben auf **{{new_datum}}** um **{{new_uhrzeit}} Uhr**. Best√§tigung folgt per E-Mail.\""
            }
        },
        {
            "tool_id": "tool-get-services",
            "instruction": {
                "type": "static_text",
                "text": ""
            },
            "name": "Services abrufen",
            "edges": [
                {
                    "destination_node_id": "node_show_services",
                    "id": "edge_get_services_to_show",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Services retrieved"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "id": "func_get_services",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": false,
            "display_position": {
                "x": 2200,
                "y": 3730
            },
            "wait_for_result": true
        },
        {
            "name": "Services anzeigen",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_show_services_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                },
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_show_services_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to book after seeing services"
                    }
                }
            ],
            "id": "node_show_services",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 3700
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige die Services:\n\n\"Wir bieten folgende Services an:\n[LISTE MIT NAMEN, DAUER, PREIS]\n\nM√∂chten Sie einen Termin buchen?\""
            }
        },
        {
            "name": "Ende",
            "edges": [],
            "id": "node_end",
            "type": "end",
            "display_position": {
                "x": 8250,
                "y": 1935
            },
            "instruction": {
                "type": "static_text",
                "text": "Vielen Dank f√ºr Ihren Anruf bei Friseur 1. Auf Wiederh√∂ren!"
            }
        },
        {
            "name": "Buchung fehlgeschlagen",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_failed_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try again with different time"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_failed_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants callback"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge_failed_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to end call"
                    }
                }
            ],
            "id": "node_booking_failed",
            "type": "conversation",
            "display_position": {
                "x": 7150,
                "y": 2650
            },
            "instruction": {
                "type": "static_text",
                "text": "Entschuldigung, der Termin konnte leider nicht gebucht werden. M√∂chten Sie es mit einem anderen Zeitpunkt versuchen oder soll ich Sie zur√ºckrufen lassen?"
            }
        }
    ],
    "start_node_id": "node_greeting",
    "start_speaker": "agent",
    "begin_after_user_silence_ms": 800,
    "tools": [
        {
            "tool_id": "tool-check-availability",
            "timeout_ms": 3000,
            "name": "check_availability_v17",
            "description": "Pr√ºft Verf√ºgbarkeit f√ºr einen Termin",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string",
                        "description": "Kundenname"
                    },
                    "datum": {
                        "type": "string",
                        "description": "Datum: heute, morgen, Montag, oder DD.MM.YYYY"
                    },
                    "dienstleistung": {
                        "type": "string",
                        "description": "Service (z.B. Herrenhaarschnitt)"
                    },
                    "uhrzeit": {
                        "type": "string",
                        "description": "Uhrzeit im Format HH:MM oder Zeitfenster (Vormittag, Nachmittag)"
                    }
                },
                "required": [
                    "name",
                    "datum",
                    "uhrzeit",
                    "dienstleistung"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-alternatives",
            "timeout_ms": 2500,
            "name": "get_alternatives",
            "description": "Schl√§gt alternative Zeitslots vor wenn Wunschtermin nicht verf√ºgbar. Sucht intelligente Alternativen basierend auf Datum, Zeit und Service.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "preferred_time": {
                        "type": "string",
                        "description": "Gew√ºnschte Uhrzeit (HH:MM) oder Zeitfenster (Vormittag, Nachmittag)"
                    },
                    "service_name": {
                        "type": "string",
                        "description": "Service f√ºr den Alternativen gesucht werden"
                    },
                    "preferred_date": {
                        "type": "string",
                        "description": "Gew√ºnschtes Datum (heute, morgen, Montag, oder DD.MM.YYYY)"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system for context"
                    }
                },
                "required": [
                    "call_id",
                    "service_name",
                    "preferred_date"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-request-callback",
            "timeout_ms": 1500,
            "name": "request_callback",
            "description": "Erstellt Callback-Request mit automatischer Staff-Zuweisung. Fallback-Option wenn kein Termin verf√ºgbar.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "reason": {
                        "type": "string",
                        "description": "Grund f√ºr R√ºckruf (z.B. 'Termin f√ºr Balayage buchen')"
                    },
                    "preferred_time": {
                        "type": "string",
                        "description": "Bevorzugte R√ºckrufzeit (z.B. 'heute 17-18 Uhr', 'morgen Vormittag')"
                    },
                    "phone_number": {
                        "type": "string",
                        "description": "Telefonnummer (Format: +49... oder 0...)"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id",
                    "customer_name",
                    "phone_number",
                    "reason"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-appointments",
            "timeout_ms": 3000,
            "name": "get_customer_appointments",
            "description": "Ruft bestehende Termine des Kunden ab",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Optional: Kundenname zur Filterung"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-cancel-appointment",
            "timeout_ms": 3000,
            "name": "cancel_appointment",
            "description": "Storniert einen bestehenden Termin",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "datum": {
                        "type": "string",
                        "description": "Optional: Datum (heute, morgen, oder DD.MM.YYYY)"
                    },
                    "appointment_id": {
                        "type": "string",
                        "description": "Optional: Appointment ID"
                    },
                    "uhrzeit": {
                        "type": "string",
                        "description": "Optional: Uhrzeit HH:MM"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "timeout_ms": 3000,
            "name": "reschedule_appointment",
            "description": "Verschiebt einen Termin auf neues Datum\/Uhrzeit",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "new_uhrzeit": {
                        "type": "string",
                        "description": "Required: Neue Uhrzeit HH:MM"
                    },
                    "appointment_id": {
                        "type": "string",
                        "description": "Optional: Appointment ID"
                    },
                    "old_datum": {
                        "type": "string",
                        "description": "Optional: Altes Datum DD.MM.YYYY"
                    },
                    "old_uhrzeit": {
                        "type": "string",
                        "description": "Optional: Alte Uhrzeit HH:MM"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    },
                    "new_datum": {
                        "type": "string",
                        "description": "Required: Neues Datum (heute, morgen, oder DD.MM.YYYY)"
                    }
                },
                "required": [
                    "call_id",
                    "new_datum",
                    "new_uhrzeit"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-services",
            "timeout_ms": 2000,
            "name": "get_available_services",
            "description": "Listet alle verf√ºgbaren Services auf",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-start-booking",
            "timeout_ms": 2000,
            "name": "start_booking",
            "description": "Step 1 of 2-step booking: Validates all booking data and returns immediate status (<500ms).",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "datetime": {
                        "type": "string",
                        "description": "Appointment date and time in format: DD.MM.YYYY HH:MM"
                    },
                    "service": {
                        "type": "string",
                        "description": "Service name"
                    },
                    "function_name": {
                        "type": "string",
                        "description": "Function name: start_booking"
                    },
                    "customer_email": {
                        "type": "string",
                        "description": "Customer email address (optional)"
                    },
                    "customer_phone": {
                        "type": "string",
                        "description": "Customer phone number"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Customer full name"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Unique Retell call identifier"
                    }
                },
                "required": [
                    "function_name",
                    "call_id",
                    "datetime",
                    "service",
                    "customer_name",
                    "customer_phone"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-confirm-booking",
            "timeout_ms": 30000,
            "name": "confirm_booking",
            "description": "Step 2 of 2-step booking: Executes the actual Cal.com booking and database save.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "function_name": {
                        "type": "string",
                        "description": "Function name: confirm_booking"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Same call_id used in start_booking"
                    }
                },
                "required": [
                    "function_name",
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-current-context",
            "timeout_ms": 1000,
            "name": "get_current_context",
            "description": "Ruft aktuelles Datum, Uhrzeit und Kontext-Informationen ab.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Die Call ID des aktuellen Anrufs"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/current-context"
        }
    ],
    "model_choice": {
        "type": "cascading",
        "model": "gpt-4o-mini"
    },
    "model_temperature": 0.3,
    "tool_call_strict_mode": false,
    "knowledge_base_ids": [],
    "kb_config": {
        "top_k": 3,
        "filter_score": 0.6
    },
    "begin_tag_display_position": {
        "x": 0,
        "y": 345
    },
    "is_published": false
}