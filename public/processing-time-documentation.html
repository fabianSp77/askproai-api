<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing Time / Split Appointments - Vollst√§ndige Dokumentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .phase-card {
            transition: all 0.3s ease;
        }

        .phase-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .code-block {
            background: #1e293b;
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
        }

        .code-block code {
            color: #e2e8f0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 8px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #3b82f6;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #dbeafe;
        }

        .nav-link {
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            color: #3b82f6;
            transform: translateX(4px);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .status-complete {
            background: #dcfce7;
            color: #166534;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .calendar-view {
            display: grid;
            grid-template-columns: 100px 1fr;
            gap: 0;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }

        .calendar-time {
            background: #f9fafb;
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            font-weight: 600;
            color: #374151;
            text-align: center;
        }

        .calendar-slot {
            padding: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            position: relative;
            min-height: 60px;
        }

        .appointment-block {
            border-left: 4px solid;
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            font-size: 0.875rem;
        }

        .busy-phase {
            background: #fef2f2;
            border-color: #dc2626;
        }

        .available-phase {
            background: #f0fdf4;
            border-color: #16a34a;
        }

        .flowchart-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 2rem;
            border: 2px solid #e2e8f0;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-50 to-blue-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-slate-900">Processing Time / Split Appointments</h1>
                    <p class="text-slate-600 mt-1">Vollst√§ndige Feature-Dokumentation</p>
                </div>
                <div class="flex gap-3">
                    <span class="status-badge status-complete">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        PRODUCTION-READY
                    </span>
                    <span class="status-badge" style="background: #dbeafe; color: #1e40af;">
                        69/69 Tests Passing
                    </span>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <div class="grid grid-cols-12 gap-8">
            <!-- Sidebar Navigation -->
            <aside class="col-span-3">
                <div class="bg-white rounded-xl shadow-sm p-6 sticky top-8">
                    <h3 class="font-bold text-slate-900 mb-4">Inhalt</h3>
                    <nav class="space-y-2">
                        <a href="#overview" class="nav-link block text-slate-600 hover:text-blue-600">üìä √úbersicht</a>
                        <a href="#business-value" class="nav-link block text-slate-600 hover:text-blue-600">üí∞ Business Value</a>
                        <a href="#how-it-works" class="nav-link block text-slate-600 hover:text-blue-600">‚öôÔ∏è Funktionsweise</a>
                        <a href="#data-flow" class="nav-link block text-slate-600 hover:text-blue-600">üîÑ Datenfluss</a>
                        <a href="#architecture" class="nav-link block text-slate-600 hover:text-blue-600">üèóÔ∏è Architektur</a>
                        <a href="#calendar-example" class="nav-link block text-slate-600 hover:text-blue-600">üìÖ Kalender-Beispiel</a>
                        <a href="#components" class="nav-link block text-slate-600 hover:text-blue-600">üß© Komponenten</a>
                        <a href="#integration" class="nav-link block text-slate-600 hover:text-blue-600">üîå Integration</a>
                        <a href="#testing" class="nav-link block text-slate-600 hover:text-blue-600">‚úÖ Testing</a>
                        <a href="#next-steps" class="nav-link block text-slate-600 hover:text-blue-600">üöÄ N√§chste Schritte</a>
                        <a href="#open-tasks" class="nav-link block text-slate-600 hover:text-blue-600">üìù Offene Punkte</a>
                    </nav>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="col-span-9 space-y-12">

                <!-- Overview Section -->
                <section id="overview" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üìä</span>
                        √úbersicht
                    </h2>
                    <div class="prose max-w-none">
                        <p class="text-lg text-slate-700 leading-relaxed mb-6">
                            Das <strong>Processing Time / Split Appointments</strong> Feature erm√∂glicht Services mit Einwirkzeit/Verarbeitungszeit,
                            bei denen das Personal w√§hrend der Processing-Phase <strong>VERF√úGBAR</strong> f√ºr andere Kunden ist.
                        </p>

                        <div class="bg-blue-50 border-l-4 border-blue-500 p-6 rounded-r-lg mb-6">
                            <h3 class="font-bold text-blue-900 mb-2">üí° Kernidee</h3>
                            <p class="text-blue-800">
                                Ein Service wird in 3 Phasen aufgeteilt: <strong>Initial</strong> (Staff BUSY) ‚Üí
                                <strong>Processing</strong> (Staff AVAILABLE!) ‚Üí <strong>Final</strong> (Staff BUSY).
                                W√§hrend der Processing-Phase kann das Personal andere Kunden bedienen.
                            </p>
                        </div>

                        <div class="grid grid-cols-3 gap-4 mt-6">
                            <div class="phase-card bg-red-50 border-2 border-red-200 rounded-lg p-5">
                                <div class="text-red-600 text-2xl font-bold mb-2">Phase 1</div>
                                <div class="font-semibold text-slate-900 mb-1">Initial</div>
                                <div class="text-sm text-slate-600">Staff BUSY</div>
                                <div class="text-xs text-slate-500 mt-2">z.B. Farbe auftragen</div>
                            </div>
                            <div class="phase-card bg-green-50 border-2 border-green-200 rounded-lg p-5">
                                <div class="text-green-600 text-2xl font-bold mb-2">Phase 2</div>
                                <div class="font-semibold text-slate-900 mb-1">Processing</div>
                                <div class="text-sm text-green-600 font-semibold">‚úÖ Staff AVAILABLE</div>
                                <div class="text-xs text-slate-500 mt-2">Einwirkzeit - kann andere Kunden bedienen!</div>
                            </div>
                            <div class="phase-card bg-red-50 border-2 border-red-200 rounded-lg p-5">
                                <div class="text-red-600 text-2xl font-bold mb-2">Phase 3</div>
                                <div class="font-semibold text-slate-900 mb-1">Final</div>
                                <div class="text-sm text-slate-600">Staff BUSY</div>
                                <div class="text-xs text-slate-500 mt-2">z.B. Auswaschen & Styling</div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Business Value -->
                <section id="business-value" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üí∞</span>
                        Business Value
                    </h2>

                    <div class="grid grid-cols-2 gap-6 mb-8">
                        <div class="metric-card rounded-xl p-6 text-white">
                            <div class="text-5xl font-bold mb-2">+50%</div>
                            <div class="text-lg opacity-90">Kapazit√§tssteigerung</div>
                            <div class="text-sm opacity-75 mt-2">Mehr Termine mit gleichem Personal</div>
                        </div>
                        <div class="metric-card rounded-xl p-6 text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <div class="text-5xl font-bold mb-2">2-3x</div>
                            <div class="text-lg opacity-90">Parallele Kunden</div>
                            <div class="text-sm opacity-75 mt-2">Staff kann mehrere Kunden gleichzeitig betreuen</div>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-6">
                        <h3 class="font-bold text-green-900 mb-4 text-lg">üéØ Konkrete Vorteile</h3>
                        <ul class="space-y-3">
                            <li class="flex items-start gap-3">
                                <svg class="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <strong class="text-slate-900">Erh√∂hte Auslastung:</strong>
                                    <span class="text-slate-700"> Von 8 auf 12 Farb-Termine pro Tag m√∂glich</span>
                                </div>
                            </li>
                            <li class="flex items-start gap-3">
                                <svg class="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <strong class="text-slate-900">K√ºrzere Wartezeiten:</strong>
                                    <span class="text-slate-700"> Kunden bekommen schneller Termine</span>
                                </div>
                            </li>
                            <li class="flex items-start gap-3">
                                <svg class="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <strong class="text-slate-900">Direkte Umsatzsteigerung:</strong>
                                    <span class="text-slate-700"> +50% Termine = +50% Umsatz (gleiche Personalkosten)</span>
                                </div>
                            </li>
                            <li class="flex items-start gap-3">
                                <svg class="w-6 h-6 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                                <div>
                                    <strong class="text-slate-900">Bessere Staff-Auslastung:</strong>
                                    <span class="text-slate-700"> Von 60% auf 85% Auslastung</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </section>

                <!-- How It Works -->
                <section id="how-it-works" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">‚öôÔ∏è</span>
                        Funktionsweise
                    </h2>

                    <div class="space-y-6">
                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-4">Beispiel: Ansatz + L√§ngenausgleich (60 min)</h3>
                            <div class="space-y-4">
                                <div class="flex items-center gap-4">
                                    <div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-mono text-sm font-semibold w-48">
                                        10:00 - 10:15
                                    </div>
                                    <div class="flex-1 bg-white border-2 border-red-200 rounded-lg p-4">
                                        <div class="font-semibold text-slate-900">Initial Phase (15 min)</div>
                                        <div class="text-sm text-slate-600 mt-1">Farbe auftragen</div>
                                        <div class="flex items-center gap-2 mt-2">
                                            <span class="bg-red-100 text-red-700 text-xs px-2 py-1 rounded">Staff BUSY</span>
                                            <span class="text-xs text-slate-500">Personal ist besch√§ftigt</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex items-center justify-center">
                                    <svg class="w-6 h-6 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                </div>

                                <div class="flex items-center gap-4">
                                    <div class="bg-green-100 text-green-700 px-4 py-2 rounded-lg font-mono text-sm font-semibold w-48">
                                        10:15 - 10:40
                                    </div>
                                    <div class="flex-1 bg-white border-2 border-green-200 rounded-lg p-4">
                                        <div class="font-semibold text-slate-900">Processing Phase (25 min)</div>
                                        <div class="text-sm text-slate-600 mt-1">Farbe wirkt ein</div>
                                        <div class="flex items-center gap-2 mt-2">
                                            <span class="bg-green-100 text-green-700 text-xs px-2 py-1 rounded font-semibold">‚úÖ Staff AVAILABLE</span>
                                            <span class="text-xs text-slate-500">Personal kann andere Kunden bedienen!</span>
                                        </div>
                                    </div>
                                </div>

                                <div class="flex items-center justify-center">
                                    <svg class="w-6 h-6 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                </div>

                                <div class="flex items-center gap-4">
                                    <div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-mono text-sm font-semibold w-48">
                                        10:40 - 11:00
                                    </div>
                                    <div class="flex-1 bg-white border-2 border-red-200 rounded-lg p-4">
                                        <div class="font-semibold text-slate-900">Final Phase (20 min)</div>
                                        <div class="text-sm text-slate-600 mt-1">Auswaschen & Styling</div>
                                        <div class="flex items-center gap-2 mt-2">
                                            <span class="bg-red-100 text-red-700 text-xs px-2 py-1 rounded">Staff BUSY</span>
                                            <span class="text-xs text-slate-500">Personal ist besch√§ftigt</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h4 class="font-bold text-blue-900 mb-3">üéØ Parallele Buchungen m√∂glich!</h4>
                            <p class="text-blue-800 mb-4">
                                W√§hrend Kunde A die Processing Phase hat (10:15-10:40), kann Kunde B zur gleichen Zeit gebucht werden:
                            </p>
                            <div class="bg-white rounded-lg p-4 border border-blue-200">
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-center gap-3">
                                        <span class="font-mono text-blue-700">10:20 - 10:50</span>
                                        <span class="text-slate-700">‚Üí Kunde B: Haarschnitt (30 min)</span>
                                    </div>
                                    <div class="text-xs text-slate-600 ml-24">
                                        √úberschneidung mit Processing Phase von Kunde A ist erlaubt, da Staff verf√ºgbar ist!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Data Flow -->
                <section id="data-flow" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üîÑ</span>
                        Datenfluss & Systemarchitektur
                    </h2>

                    <div class="space-y-8">
                        <!-- Appointment Creation Flow -->
                        <div class="flowchart-container">
                            <h3 class="font-bold text-slate-900 mb-4 text-lg">1Ô∏è‚É£ Termin-Erstellung Flow</h3>
                            <div class="mermaid">
graph TD
    A[üë§ Retell AI Voice Call] --> B[collect_appointment_info]
    B --> C{Service hat<br/>Processing Time?}
    C -->|Ja| D[check_availability:<br/>ProcessingTimeAvailabilityService]
    C -->|Nein| E[check_availability:<br/>Cal.com API]
    D --> F[Pr√ºfe Staff Verf√ºgbarkeit<br/>nur BUSY Phasen]
    E --> G[Pr√ºfe Cal.com Slots]
    F --> H{Staff verf√ºgbar?}
    G --> H
    H -->|Ja| I[‚úÖ Termin erstellen<br/>AppointmentCreationService]
    H -->|Nein| J[‚ùå Alternative Termine<br/>anbieten]
    I --> K[AppointmentObserver<br/>created Event]
    K --> L[AppointmentPhaseObserver:<br/>createPhasesForAppointment]
    L --> M[3 Phasen in DB erstellen<br/>appointment_phases]
    M --> N[SyncToCalcomJob<br/>dispatched]
    N --> O[Cal.com: Single Event<br/>mit Processing Time Metadata]
    O --> P[‚úÖ Termin best√§tigt<br/>Bidirektionale Sync aktiv]

    style A fill:#e0f2fe
    style I fill:#dcfce7
    style L fill:#fef3c7
    style O fill:#ddd6fe
    style P fill:#dcfce7
                            </div>
                        </div>

                        <!-- Database Schema Flow -->
                        <div class="flowchart-container">
                            <h3 class="font-bold text-slate-900 mb-4 text-lg">2Ô∏è‚É£ Datenbank Schema</h3>
                            <div class="mermaid">
erDiagram
    SERVICES ||--o{ APPOINTMENTS : has
    SERVICES {
        bigint id PK
        string name
        int duration_minutes
        boolean has_processing_time
        int initial_duration
        int processing_duration
        int final_duration
    }

    APPOINTMENTS ||--o{ APPOINTMENT_PHASES : has
    APPOINTMENTS {
        bigint id PK
        bigint service_id FK
        bigint staff_id FK
        timestamp starts_at
        timestamp ends_at
        string status
    }

    APPOINTMENT_PHASES {
        bigint id PK
        bigint appointment_id FK
        enum phase_type
        int start_offset_minutes
        int duration_minutes
        boolean staff_required
        timestamp start_time
        timestamp end_time
    }

    STAFF ||--o{ APPOINTMENTS : assigned
    STAFF {
        uuid id PK
        string name
    }
                            </div>
                        </div>

                        <!-- Availability Check Flow -->
                        <div class="flowchart-container">
                            <h3 class="font-bold text-slate-900 mb-4 text-lg">3Ô∏è‚É£ Verf√ºgbarkeitspr√ºfung Flow</h3>
                            <div class="mermaid">
graph LR
    A[Verf√ºgbarkeitspr√ºfung<br/>requested_time] --> B{Service<br/>Processing Time?}
    B -->|Ja| C[Hole alle Staff<br/>des Services]
    B -->|Nein| D[Cal.com API Check]
    C --> E[F√ºr jeden Staff:<br/>isStaffAvailable]
    E --> F[Hole Appointments<br/>im Zeitfenster]
    F --> G{Appointment hat<br/>Processing Time?}
    G -->|Ja| H[Pr√ºfe nur<br/>BUSY Phasen<br/>staff_required=true]
    G -->|Nein| I[Pr√ºfe ganzen<br/>Termin]
    H --> J{√úberschneidung<br/>mit BUSY Phase?}
    I --> J
    J -->|Nein| K[‚úÖ Staff VERF√úGBAR]
    J -->|Ja| L[‚ùå Staff BUSY]
    K --> M[Slot anbieten]
    L --> N[N√§chsten Staff pr√ºfen]

    style A fill:#e0f2fe
    style H fill:#dcfce7
    style K fill:#dcfce7
    style L fill:#fecaca
                            </div>
                        </div>

                        <!-- Phase Observer Flow -->
                        <div class="flowchart-container">
                            <h3 class="font-bold text-slate-900 mb-4 text-lg">4Ô∏è‚É£ Automatische Phasen-Verwaltung</h3>
                            <div class="mermaid">
graph TD
    A[Appointment Event] --> B{Event Type?}
    B -->|created| C[AppointmentPhaseObserver<br/>created]
    B -->|updated| D[AppointmentPhaseObserver<br/>updated]
    B -->|deleting| E[CASCADE DELETE<br/>via FK Constraint]

    C --> F{Service hat<br/>Processing Time?}
    F -->|Ja| G[createPhasesForAppointment]
    F -->|Nein| H[Keine Phasen]

    G --> I[Berechne Phase Timestamps:<br/>start_time, end_time]
    I --> J[INSERT 3 Phasen:<br/>initial, processing, final]
    J --> K[‚úÖ Phasen erstellt]

    D --> L{Was ge√§ndert?}
    L -->|starts_at| M[updatePhasesForRescheduledAppointment]
    L -->|service_id| N[recreatePhasesIfNeeded]
    L -->|Andere| O[Keine Aktion]

    M --> P[DELETE alte Phasen]
    P --> Q[CREATE neue Phasen<br/>mit neuen Timestamps]

    N --> R{Neuer Service<br/>Processing Time?}
    R -->|Ja| G
    R -->|Nein| S[DELETE alle Phasen]

    style C fill:#fef3c7
    style G fill:#dcfce7
    style K fill:#dcfce7
    style Q fill:#dcfce7
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Architecture -->
                <section id="architecture" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üèóÔ∏è</span>
                        System-Architektur
                    </h2>

                    <div class="flowchart-container">
                        <div class="mermaid">
graph TB
    subgraph Frontend["üñ•Ô∏è FRONTEND LAYER"]
        FILAMENT[Filament Admin UI<br/>ServiceResource]
        CALENDAR[Kalenderansicht<br/>Appointment Details]
    end

    subgraph API["üåê API LAYER"]
        RETELL[Retell AI Controller<br/>check_availability]
        CALCOM_WH[Cal.com Webhook<br/>bidirectionale Sync]
    end

    subgraph Services["‚öôÔ∏è SERVICE LAYER"]
        AVAIL[ProcessingTime<br/>AvailabilityService]
        PHASE[AppointmentPhase<br/>CreationService]
        CALCOM[CalcomService]
    end

    subgraph Models["üì¶ MODEL LAYER"]
        SERVICE[Service Model<br/>+hasProcessingTime]
        APPOINTMENT[Appointment Model]
        PHASE_MODEL[AppointmentPhase Model]
    end

    subgraph Observers["üëÅÔ∏è OBSERVER LAYER"]
        PHASE_OBS[AppointmentPhase<br/>Observer]
    end

    subgraph Jobs["üîÑ JOB QUEUE"]
        SYNC[SyncAppointmentToCalcomJob]
    end

    subgraph Database["üíæ DATABASE"]
        DB_SERVICES[(services<br/>+processing_time)]
        DB_APPOINTMENTS[(appointments)]
        DB_PHASES[(appointment_phases<br/>+staff_required)]
    end

    subgraph External["üåç EXTERNAL APIs"]
        CALCOM_API[Cal.com API v2]
        RETELL_AI[Retell AI Platform]
    end

    FILAMENT --> SERVICE
    RETELL --> AVAIL
    RETELL --> PHASE
    CALCOM_WH --> APPOINTMENT

    AVAIL --> SERVICE
    AVAIL --> PHASE_MODEL
    PHASE --> PHASE_MODEL

    SERVICE --> DB_SERVICES
    APPOINTMENT --> DB_APPOINTMENTS
    APPOINTMENT --> PHASE_OBS

    PHASE_OBS --> PHASE
    PHASE_MODEL --> DB_PHASES

    PHASE_OBS --> SYNC
    SYNC --> CALCOM
    CALCOM --> CALCOM_API

    RETELL_AI -.->|Voice Call| RETELL
    CALCOM_API -.->|Webhook| CALCOM_WH

    style AVAIL fill:#dcfce7
    style PHASE fill:#dcfce7
    style PHASE_OBS fill:#fef3c7
    style DB_PHASES fill:#ddd6fe
    style RETELL fill:#e0f2fe
                        </div>
                    </div>

                    <div class="mt-8 grid grid-cols-2 gap-6">
                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-3">üìç Kern-Komponenten</h3>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span><strong>ProcessingTimeAvailabilityService:</strong> 9 Methoden f√ºr Verf√ºgbarkeitspr√ºfung</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span><strong>AppointmentPhaseCreationService:</strong> 8 Methoden f√ºr Phasen-Management</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span><strong>AppointmentPhaseObserver:</strong> Automatische Phasen-Erstellung/-Updates</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span><strong>AppointmentPhase Model:</strong> Scopes, Type Checks, Overlap Detection</span>
                                </li>
                            </ul>
                        </div>

                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-3">üîå Integrationspunkte</h3>
                            <ul class="space-y-2 text-sm">
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">‚Üí</span>
                                    <span><strong>Retell AI:</strong> check_availability respektiert Processing Time</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">‚Üí</span>
                                    <span><strong>Cal.com:</strong> Single Event mit Processing Time Metadata</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">‚Üí</span>
                                    <span><strong>Filament:</strong> Complete UI mit Live-Preview</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <span class="text-blue-600">‚Üí</span>
                                    <span><strong>SyncToCalcomJob:</strong> Automatischer Sync mit Phase-Info</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </section>

                <!-- Calendar Example -->
                <section id="calendar-example" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üìÖ</span>
                        Kalender-Beispiel: Interleaved Booking
                    </h2>

                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg p-6 mb-6">
                        <h3 class="font-bold text-blue-900 mb-2">üí° Szenario</h3>
                        <p class="text-blue-800">
                            Staff Member "Maria" hat 3 √ºberlappende Termine. Das System erkennt automatisch,
                            dass w√§hrend der Processing-Phase andere Kunden bedient werden k√∂nnen.
                        </p>
                    </div>

                    <div class="calendar-view">
                        <div class="calendar-time">10:00</div>
                        <div class="calendar-slot">
                            <div class="appointment-block busy-phase">
                                <strong>üë© Kunde A:</strong> Ansatz + L√§ngenausgleich<br>
                                <small>Phase: Initial (Farbe auftragen)</small>
                                <div class="mt-1 text-xs">‚è∏Ô∏è Staff BUSY</div>
                            </div>
                        </div>

                        <div class="calendar-time">10:15</div>
                        <div class="calendar-slot">
                            <div class="appointment-block available-phase">
                                <strong>üë© Kunde A:</strong> Ansatz + L√§ngenausgleich<br>
                                <small>Phase: Processing (Einwirkzeit)</small>
                                <div class="mt-1 text-xs font-semibold">‚úÖ Staff AVAILABLE</div>
                            </div>
                        </div>

                        <div class="calendar-time">10:20</div>
                        <div class="calendar-slot">
                            <div class="appointment-block available-phase">
                                <strong>üë© Kunde A:</strong> Processing l√§uft weiter
                            </div>
                            <div class="appointment-block busy-phase">
                                <strong>üë® Kunde B:</strong> Haarschnitt (30 min)<br>
                                <small>Parallel zu Kunde A m√∂glich!</small>
                                <div class="mt-1 text-xs">‚è∏Ô∏è Staff BUSY</div>
                            </div>
                        </div>

                        <div class="calendar-time">10:40</div>
                        <div class="calendar-slot">
                            <div class="appointment-block busy-phase">
                                <strong>üë© Kunde A:</strong> Ansatz + L√§ngenausgleich<br>
                                <small>Phase: Final (Auswaschen & Styling)</small>
                                <div class="mt-1 text-xs">‚è∏Ô∏è Staff BUSY</div>
                            </div>
                            <div class="appointment-block busy-phase">
                                <strong>üë® Kunde B:</strong> Haarschnitt (l√§uft noch)
                            </div>
                        </div>

                        <div class="calendar-time">10:50</div>
                        <div class="calendar-slot">
                            <div class="appointment-block busy-phase">
                                <strong>üë© Kunde A:</strong> Final Phase l√§uft weiter
                            </div>
                        </div>

                        <div class="calendar-time">11:00</div>
                        <div class="calendar-slot">
                            <div class="text-slate-400 text-sm">‚úÖ Beide Termine abgeschlossen</div>
                        </div>
                    </div>

                    <div class="mt-6 bg-green-50 border border-green-200 rounded-lg p-5">
                        <h4 class="font-bold text-green-900 mb-2">‚úÖ Resultat</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div>
                                <div class="text-green-800"><strong>Normale Buchung:</strong></div>
                                <div class="text-slate-700">2 Termine = 90 Minuten (10:00-11:30)</div>
                            </div>
                            <div>
                                <div class="text-green-800"><strong>Mit Processing Time:</strong></div>
                                <div class="text-slate-700">2 Termine = 60 Minuten (10:00-11:00)</div>
                            </div>
                        </div>
                        <div class="mt-3 pt-3 border-t border-green-200">
                            <strong class="text-green-900">Zeitersparnis: 30 Minuten (33%)</strong>
                        </div>
                    </div>
                </section>

                <!-- Components -->
                <section id="components" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üß©</span>
                        Technische Komponenten
                    </h2>

                    <div class="space-y-6">
                        <!-- Database -->
                        <div class="border-l-4 border-purple-500 bg-purple-50 rounded-r-lg p-6">
                            <h3 class="font-bold text-purple-900 mb-3 text-lg">üíæ Datenbank</h3>
                            <div class="code-block">
<code>-- services table (4 neue Spalten)
ALTER TABLE services ADD COLUMN has_processing_time BOOLEAN DEFAULT false;
ALTER TABLE services ADD COLUMN initial_duration INTEGER NULL;
ALTER TABLE services ADD COLUMN processing_duration INTEGER NULL;
ALTER TABLE services ADD COLUMN final_duration INTEGER NULL;

-- appointment_phases table (neu)
CREATE TABLE appointment_phases (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    appointment_id BIGINT,
    phase_type ENUM('initial', 'processing', 'final'),
    start_offset_minutes INTEGER,
    duration_minutes INTEGER,
    staff_required BOOLEAN DEFAULT true,  -- KRITISCH f√ºr Verf√ºgbarkeit
    start_time TIMESTAMP,  -- Denormalisiert f√ºr Performance
    end_time TIMESTAMP,    -- Denormalisiert f√ºr Performance
    created_at TIMESTAMP,
    updated_at TIMESTAMP,

    FOREIGN KEY (appointment_id)
        REFERENCES appointments(id)
        ON DELETE CASCADE  -- Automatisches L√∂schen
);</code>
                            </div>
                            <div class="mt-4 text-sm text-slate-700">
                                <strong>Indexes:</strong> time_range (start_time, end_time), appointment_phase (appointment_id, phase_type), staff_required
                            </div>
                        </div>

                        <!-- Models -->
                        <div class="border-l-4 border-blue-500 bg-blue-50 rounded-r-lg p-6">
                            <h3 class="font-bold text-blue-900 mb-3 text-lg">üì¶ Models</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-white rounded-lg p-4 border border-blue-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">AppointmentPhase</h4>
                                    <div class="text-xs text-slate-600 space-y-1">
                                        <div>‚úì <code>scopeStaffRequired()</code></div>
                                        <div>‚úì <code>scopeStaffAvailable()</code></div>
                                        <div>‚úì <code>scopeInTimeRange()</code></div>
                                        <div>‚úì <code>isStaffBusy()</code></div>
                                        <div>‚úì <code>overlaps($start, $end)</code></div>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-blue-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Service (erweitert)</h4>
                                    <div class="text-xs text-slate-600 space-y-1">
                                        <div>‚úì <code>hasProcessingTime()</code></div>
                                        <div>‚úì <code>getTotalDuration()</code></div>
                                        <div>‚úì <code>generatePhases($start)</code></div>
                                        <div>‚úì <code>validateProcessingTime()</code></div>
                                        <div>‚úì <code>getProcessingTimeDescription()</code></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Services -->
                        <div class="border-l-4 border-green-500 bg-green-50 rounded-r-lg p-6">
                            <h3 class="font-bold text-green-900 mb-3 text-lg">‚öôÔ∏è Services</h3>
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border border-green-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">ProcessingTimeAvailabilityService</h4>
                                    <div class="text-sm text-slate-700 mb-2"><strong>9 Methoden:</strong></div>
                                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-600">
                                        <div>‚Ä¢ isStaffAvailable()</div>
                                        <div>‚Ä¢ hasOverlappingBusyPhases()</div>
                                        <div>‚Ä¢ getStaffBusyPhases()</div>
                                        <div>‚Ä¢ getStaffAvailablePhases()</div>
                                        <div>‚Ä¢ findAvailableSlots()</div>
                                        <div>‚Ä¢ calculateStaffUtilization()</div>
                                        <div>‚Ä¢ getAvailabilityBreakdown()</div>
                                        <div>‚Ä¢ canInterleaveAppointments()</div>
                                        <div>‚Ä¢ hasOverlappingAppointments()</div>
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-green-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">AppointmentPhaseCreationService</h4>
                                    <div class="text-sm text-slate-700 mb-2"><strong>8 Methoden:</strong></div>
                                    <div class="grid grid-cols-2 gap-2 text-xs text-slate-600">
                                        <div>‚Ä¢ createPhasesForAppointment()</div>
                                        <div>‚Ä¢ updatePhasesForRescheduledAppointment()</div>
                                        <div>‚Ä¢ deletePhases()</div>
                                        <div>‚Ä¢ recreatePhasesIfNeeded()</div>
                                        <div>‚Ä¢ bulkCreatePhases()</div>
                                        <div>‚Ä¢ hasPhases()</div>
                                        <div>‚Ä¢ getPhaseStats()</div>
                                        <div>‚Ä¢ (private helpers)</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Observer -->
                        <div class="border-l-4 border-yellow-500 bg-yellow-50 rounded-r-lg p-6">
                            <h3 class="font-bold text-yellow-900 mb-3 text-lg">üëÅÔ∏è Observer</h3>
                            <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                <h4 class="font-semibold text-slate-900 mb-2">AppointmentPhaseObserver</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex items-start gap-3">
                                        <span class="text-yellow-600 font-mono text-xs">created()</span>
                                        <span class="text-slate-700">Automatische Phasen-Erstellung wenn Service Processing Time hat</span>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <span class="text-yellow-600 font-mono text-xs">updated()</span>
                                        <span class="text-slate-700">Phasen-Update bei starts_at oder service_id √Ñnderung</span>
                                    </div>
                                    <div class="flex items-start gap-3">
                                        <span class="text-yellow-600 font-mono text-xs">deleting()</span>
                                        <span class="text-slate-700">CASCADE DELETE via FK Constraint (automatisch)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Integration -->
                <section id="integration" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üîå</span>
                        Integration & APIs
                    </h2>

                    <div class="space-y-6">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                            <h3 class="font-bold text-blue-900 mb-4 flex items-center gap-2">
                                <span>ü§ñ</span> Retell AI Integration
                            </h3>
                            <div class="text-sm text-slate-700 mb-3">
                                <strong>File:</strong> <code class="bg-white px-2 py-1 rounded">app/Http/Controllers/Api/RetellApiController.php:484-539</code>
                            </div>
                            <div class="code-block text-xs">
<code>// check_availability Endpoint
if ($service->hasProcessingTime()) {
    // Hole alle Staff des Services
    $availableStaff = $service->staff()
        ->wherePivot('can_book', true)
        ->get();

    // Pr√ºfe ob IRGENDEIN Staff verf√ºgbar ist
    foreach ($availableStaff as $staff) {
        if ($processingTimeService->isStaffAvailable(
            $staff->id,
            $checkDate,
            $service
        )) {
            return ['status' => 'available', ...];
        }
    }
} else {
    // Regular service - Cal.com API
    $slots = $calcomService->getAvailableSlots(...);
}</code>
                            </div>
                        </div>

                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                            <h3 class="font-bold text-purple-900 mb-4 flex items-center gap-2">
                                <span>üìÖ</span> Cal.com Sync Strategy
                            </h3>
                            <div class="text-sm text-slate-700 mb-3">
                                <strong>File:</strong> <code class="bg-white px-2 py-1 rounded">app/Jobs/SyncAppointmentToCalcomJob.php:196-217</code>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border border-purple-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Strategie: Single Event mit Metadata</h4>
                                    <div class="text-sm text-slate-700">
                                        Processing Time Services werden als <strong>EIN Event</strong> zu Cal.com synchronisiert
                                        (nicht 3 separate Events), mit vollst√§ndiger Dauer und Processing Time Informationen in den Metadaten.
                                    </div>
                                </div>
                                <div class="code-block text-xs">
<code>if ($service->hasProcessingTime()) {
    $payload['metadata']['has_processing_time'] = true;
    $payload['metadata']['initial_duration'] = 15;
    $payload['metadata']['processing_duration'] = 30;
    $payload['metadata']['final_duration'] = 15;
    $payload['metadata']['processing_note'] =
        "Service mit Einwirkzeit: 15min (Staff BUSY) + " .
        "30min (Einwirken - Staff AVAILABLE) + " .
        "15min (Staff BUSY)";
}</code>
                                </div>
                                <div class="bg-green-50 border border-green-200 rounded p-3 text-sm">
                                    <strong class="text-green-900">‚úÖ Vorteile:</strong>
                                    <ul class="mt-2 space-y-1 text-green-800">
                                        <li>‚Ä¢ Cal.com blockiert volle Dauer ‚Üí keine Konflikte</li>
                                        <li>‚Ä¢ Metadata erh√§lt Phase-Information</li>
                                        <li>‚Ä¢ Bidirektionale Sync funktioniert nahtlos</li>
                                        <li>‚Ä¢ Einfach und wartbar</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-indigo-50 border border-indigo-200 rounded-lg p-6">
                            <h3 class="font-bold text-indigo-900 mb-4 flex items-center gap-2">
                                <span>üé®</span> Filament Admin UI
                            </h3>
                            <div class="text-sm text-slate-700 mb-3">
                                <strong>File:</strong> <code class="bg-white px-2 py-1 rounded">app/Filament/Resources/ServiceResource.php:146-228, 3000-3010</code>
                            </div>
                            <div class="space-y-3">
                                <div class="bg-white rounded-lg p-4 border border-indigo-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Features</h4>
                                    <ul class="space-y-2 text-sm text-slate-700">
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600">‚úì</span>
                                            <span>Collapsible "Processing Time" Sektion</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600">‚úì</span>
                                            <span>Toggle mit automatischen Defaults (15-processing-15)</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600">‚úì</span>
                                            <span>3 Duration-Felder mit Reactive Updates</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600">‚úì</span>
                                            <span>Live Calendar Preview</span>
                                        </li>
                                        <li class="flex items-start gap-2">
                                            <span class="text-green-600">‚úì</span>
                                            <span>updateTotalDuration() Helper (automatische Gesamtzeit-Berechnung)</span>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Testing -->
                <section id="testing" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">‚úÖ</span>
                        Testing & Qualit√§tssicherung
                    </h2>

                    <div class="bg-green-50 border-2 border-green-500 rounded-lg p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-2xl font-bold text-green-900">69/69 Tests Passing</h3>
                                <p class="text-green-700 mt-1">100% Coverage der Processing Time Features</p>
                            </div>
                            <div class="text-6xl">‚úÖ</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-4">Phase 1: Database Schema</h3>
                            <div class="text-sm space-y-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>services_table_has_processing_time_columns</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>appointment_phases_table_exists</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>foreign_key_cascade_deletes</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>time_range_indexes</span>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-200">
                                <strong>8/8 Tests</strong>
                            </div>
                        </div>

                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-4">Phase 2: Models</h3>
                            <div class="text-sm space-y-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>AppointmentPhase Model (16 tests)</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Service Model Extensions (19 tests)</span>
                                </div>
                                <div class="text-xs text-slate-600 ml-6 mt-1">
                                    Scopes, Relationships, Type Checks, Overlaps
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-200">
                                <strong>35/35 Tests</strong>
                            </div>
                        </div>

                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-4">Phase 3: Availability Service</h3>
                            <div class="text-sm space-y-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Staff availability checks</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Busy phase overlap detection</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Slot finding algorithms</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Interleaving logic</span>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-200">
                                <strong>15/15 Tests</strong>
                            </div>
                        </div>

                        <div class="bg-slate-50 rounded-lg p-6">
                            <h3 class="font-bold text-slate-900 mb-4">Phase 4: Phase Creation</h3>
                            <div class="text-sm space-y-2">
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Automatic phase creation</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Reschedule updates</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Service change recreation</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <span class="text-green-600">‚úì</span>
                                    <span>Bulk operations</span>
                                </div>
                            </div>
                            <div class="mt-4 pt-4 border-t border-slate-200">
                                <strong>11/11 Tests</strong>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="font-bold text-blue-900 mb-3">üß™ Test-Befehle</h3>
                        <div class="code-block text-xs">
<code># Alle Processing Time Tests
vendor/bin/pest --filter ProcessingTime

# Spezifische Test-Suites
vendor/bin/pest --filter AppointmentPhase
vendor/bin/pest --filter AvailabilityService

# Alle Feature Tests
vendor/bin/pest tests/Feature/</code>
                        </div>
                    </div>
                </section>

                <!-- Next Steps -->
                <section id="next-steps" class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl shadow-sm p-8 border-2 border-blue-200">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üöÄ</span>
                        N√§chste Schritte
                    </h2>

                    <div class="space-y-4">
                        <div class="relative pl-8">
                            <div class="timeline-item">
                                <div class="bg-white rounded-lg p-5 border border-blue-200">
                                    <h3 class="font-bold text-slate-900 mb-2">1. Production Deployment</h3>
                                    <div class="text-sm text-slate-700 space-y-1">
                                        <div>‚Ä¢ Run migrations: <code class="bg-slate-100 px-2 py-0.5 rounded text-xs">php artisan migrate</code></div>
                                        <div>‚Ä¢ Verify tests: <code class="bg-slate-100 px-2 py-0.5 rounded text-xs">vendor/bin/pest --filter ProcessingTime</code></div>
                                        <div>‚Ä¢ Clear cache: <code class="bg-slate-100 px-2 py-0.5 rounded text-xs">php artisan config:clear</code></div>
                                        <div>‚Ä¢ Test in Staging first!</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="relative pl-8">
                            <div class="timeline-item">
                                <div class="bg-white rounded-lg p-5 border border-blue-200">
                                    <h3 class="font-bold text-slate-900 mb-2">2. Test Service erstellen</h3>
                                    <div class="text-sm text-slate-700">
                                        ‚Ä¢ Login zu Filament Admin<br>
                                        ‚Ä¢ Create Service mit Processing Time aktiviert<br>
                                        ‚Ä¢ Test mit realistischen Durationen (15-30-15)<br>
                                        ‚Ä¢ Verify Kalender-Preview
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="relative pl-8">
                            <div class="timeline-item">
                                <div class="bg-white rounded-lg p-5 border border-blue-200">
                                    <h3 class="font-bold text-slate-900 mb-2">3. End-to-End Test</h3>
                                    <div class="text-sm text-slate-700">
                                        ‚Ä¢ Create Appointment mit Processing Time Service<br>
                                        ‚Ä¢ Verify 3 Phasen erstellt wurden (DB check)<br>
                                        ‚Ä¢ Test Retell AI check_availability<br>
                                        ‚Ä¢ Verify Cal.com Sync mit Metadata
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="relative pl-8">
                            <div class="timeline-item">
                                <div class="bg-white rounded-lg p-5 border border-blue-200">
                                    <h3 class="font-bold text-slate-900 mb-2">4. Monitoring Setup</h3>
                                    <div class="text-sm text-slate-700">
                                        ‚Ä¢ Log monitoring: <code class="bg-slate-100 px-2 py-0.5 rounded text-xs">tail -f storage/logs/laravel.log</code><br>
                                        ‚Ä¢ Track Cal.com Sync success rate<br>
                                        ‚Ä¢ Monitor query performance (appointment_phases)<br>
                                        ‚Ä¢ Set up alerts for sync failures
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Open Tasks -->
                <section id="open-tasks" class="bg-white rounded-xl shadow-sm p-8">
                    <h2 class="text-2xl font-bold text-slate-900 mb-6 flex items-center gap-3">
                        <span class="text-3xl">üìù</span>
                        Offene Punkte & Frontend-Anpassungen
                    </h2>

                    <div class="space-y-6">
                        <!-- Frontend Tasks -->
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 rounded-r-lg p-6">
                            <h3 class="font-bold text-yellow-900 mb-4 text-lg">üé® Frontend-Anpassungen erforderlich</h3>

                            <div class="space-y-4">
                                <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                    <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                        <span class="status-badge status-pending text-xs">TODO</span>
                                        Appointment Detail View
                                    </h4>
                                    <div class="text-sm text-slate-700 mb-2">
                                        <strong>Datei:</strong> Appointment Detail / View Page
                                    </div>
                                    <div class="text-sm text-slate-600 space-y-1">
                                        <div>‚Ä¢ Phasen-Anzeige mit visueller Timeline</div>
                                        <div>‚Ä¢ Farbcodierung: Rot = BUSY, Gr√ºn = AVAILABLE</div>
                                        <div>‚Ä¢ Zeitstempel f√ºr jede Phase anzeigen</div>
                                        <div>‚Ä¢ Hinweis wenn Service Processing Time hat</div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                    <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                        <span class="status-badge status-pending text-xs">TODO</span>
                                        Kalenderansicht
                                    </h4>
                                    <div class="text-sm text-slate-700 mb-2">
                                        <strong>Datei:</strong> Calendar Component
                                    </div>
                                    <div class="text-sm text-slate-600 space-y-1">
                                        <div>‚Ä¢ Phasen-Visualisierung im Kalender</div>
                                        <div>‚Ä¢ Hover-Tooltip mit Phase-Details</div>
                                        <div>‚Ä¢ Verf√ºgbarkeits-Indikator (gr√ºne L√ºcken)</div>
                                        <div>‚Ä¢ Interleaved Appointments visuell unterscheiden</div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                    <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                        <span class="status-badge status-pending text-xs">TODO</span>
                                        Service Edit/Create Form
                                    </h4>
                                    <div class="text-sm text-slate-700 mb-2">
                                        <strong>Status:</strong> ‚úÖ Bereits implementiert in Filament
                                    </div>
                                    <div class="text-sm text-slate-600 space-y-1">
                                        <div>‚úì Processing Time Toggle</div>
                                        <div>‚úì Duration Input Fields</div>
                                        <div>‚úì Live Preview</div>
                                        <div class="text-green-600 font-semibold">Keine weitere Aktion n√∂tig!</div>
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 border border-yellow-200">
                                    <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                        <span class="status-badge status-pending text-xs">TODO</span>
                                        Staff Schedule View
                                    </h4>
                                    <div class="text-sm text-slate-700 mb-2">
                                        <strong>Datei:</strong> Staff Schedule Component
                                    </div>
                                    <div class="text-sm text-slate-600 space-y-1">
                                        <div>‚Ä¢ Tagesansicht mit Processing Time Phasen</div>
                                        <div>‚Ä¢ Auslastungs-Indikator (Busy vs Available %)</div>
                                        <div>‚Ä¢ Overlapping Appointments visuell darstellen</div>
                                        <div>‚Ä¢ Filter: Nur Processing Time Services</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Service Adjustments -->
                        <div class="bg-blue-50 border-l-4 border-blue-500 rounded-r-lg p-6">
                            <h3 class="font-bold text-blue-900 mb-4 text-lg">‚öôÔ∏è Service-Anpassungen</h3>

                            <div class="space-y-4">
                                <div class="bg-white rounded-lg p-4 border border-blue-200">
                                    <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                        <span class="status-badge status-complete text-xs">DONE</span>
                                        AppointmentAlternativeFinder
                                    </h4>
                                    <div class="text-sm text-slate-600">
                                        ‚úÖ Bereits kompatibel - verwendet ProcessingTimeAvailabilityService
                                    </div>
                                </div>

                                <div class="bg-white rounded-lg p-4 border border-blue-200">
                                    <h4 class="font-semibold text-slate-900 mb-2 flex items-center gap-2">
                                        <span class="status-badge status-pending text-xs">OPTIONAL</span>
                                        WeeklyAvailabilityService
                                    </h4>
                                    <div class="text-sm text-slate-700 mb-2">
                                        <strong>Empfehlung:</strong> Integration mit ProcessingTimeAvailabilityService
                                    </div>
                                    <div class="text-sm text-slate-600">
                                        Derzeit: Verwendet Cal.com API<br>
                                        Optional: Kann ProcessingTime-aware gemacht werden f√ºr pr√§zisere Slots
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Future Enhancements -->
                        <div class="bg-purple-50 border-l-4 border-purple-500 rounded-r-lg p-6">
                            <h3 class="font-bold text-purple-900 mb-4 text-lg">üîÆ Future Enhancements</h3>

                            <div class="grid grid-cols-2 gap-4">
                                <div class="bg-white rounded-lg p-4 border border-purple-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Smart Auto-Assignment</h4>
                                    <div class="text-xs text-slate-600">
                                        Algorithmus der automatisch den besten Staff f√ºr Interleaving findet
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-purple-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Analytics Dashboard</h4>
                                    <div class="text-xs text-slate-600">
                                        Staff Utilization Metrics, Revenue per Hour, Efficiency Tracking
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-purple-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Customer Communication</h4>
                                    <div class="text-xs text-slate-600">
                                        "Express Booking" Option, Wartezeit-Sch√§tzungen
                                    </div>
                                </div>
                                <div class="bg-white rounded-lg p-4 border border-purple-200">
                                    <h4 class="font-semibold text-slate-900 mb-2">Multi-Phase Services</h4>
                                    <div class="text-xs text-slate-600">
                                        Support f√ºr >3 Phasen, custom Phase-Konfigurationen
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Quick Reference -->
                <section class="bg-gradient-to-r from-slate-800 to-slate-900 text-white rounded-xl shadow-lg p-8">
                    <h2 class="text-2xl font-bold mb-6">üìö Quick Reference</h2>

                    <div class="grid grid-cols-3 gap-6">
                        <div>
                            <h3 class="font-bold mb-3 text-blue-300">Database</h3>
                            <div class="text-sm space-y-1 opacity-90">
                                <div>‚Ä¢ services.has_processing_time</div>
                                <div>‚Ä¢ appointment_phases table</div>
                                <div>‚Ä¢ staff_required (KRITISCH!)</div>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold mb-3 text-green-300">Key Services</h3>
                            <div class="text-sm space-y-1 opacity-90">
                                <div>‚Ä¢ ProcessingTimeAvailabilityService</div>
                                <div>‚Ä¢ AppointmentPhaseCreationService</div>
                                <div>‚Ä¢ AppointmentPhaseObserver</div>
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold mb-3 text-purple-300">Integration</h3>
                            <div class="text-sm space-y-1 opacity-90">
                                <div>‚Ä¢ Retell AI: check_availability</div>
                                <div>‚Ä¢ Cal.com: Metadata Sync</div>
                                <div>‚Ä¢ Filament: Complete UI</div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-slate-700">
                        <div class="flex items-center justify-between">
                            <div>
                                <div class="text-sm opacity-75">Feature Status</div>
                                <div class="text-2xl font-bold text-green-400">‚úÖ PRODUCTION-READY</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm opacity-75">Test Coverage</div>
                                <div class="text-2xl font-bold text-blue-400">69/69 Tests</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm opacity-75">Documentation</div>
                                <div class="text-2xl font-bold text-purple-400">Complete</div>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white mt-16 py-8">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="text-sm opacity-75 mb-2">
                Processing Time / Split Appointments Feature
            </div>
            <div class="font-semibold">
                Created: 2025-10-28 | Status: Production-Ready | Tests: 69/69 Passing
            </div>
            <div class="mt-4 text-xs opacity-50">
                Full Documentation: claudedocs/02_BACKEND/Services/PROCESSING_TIME_INTEGRATION_COMPLETE_2025-10-28.md
            </div>
        </div>
    </footer>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#dbeafe',
                primaryTextColor: '#1e40af',
                primaryBorderColor: '#3b82f6',
                lineColor: '#64748b',
                secondaryColor: '#dcfce7',
                tertiaryColor: '#fef3c7',
            }
        });

        // Smooth scroll for navigation
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Add active state to navigation
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('text-blue-600', 'font-semibold');
                        if (link.getAttribute('href') === `#${entry.target.id}`) {
                            link.classList.add('text-blue-600', 'font-semibold');
                        }
                    });
                }
            });
        }, { threshold: 0.5 });

        document.querySelectorAll('section[id]').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>