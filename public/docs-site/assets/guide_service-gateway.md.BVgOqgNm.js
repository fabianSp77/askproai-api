import{_ as a,c as n,o as i,ag as e}from"./chunks/framework.4sa0nZj2.js";const o=JSON.parse('{"title":"Service Gateway","description":"","frontmatter":{},"headers":[],"relativePath":"guide/service-gateway.md","filePath":"guide/service-gateway.md","lastUpdated":1767636057000}'),l={name:"guide/service-gateway.md"};function p(t,s,r,h,k,d){return i(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="service-gateway" tabindex="-1">Service Gateway <a class="header-anchor" href="#service-gateway" aria-label="Permalink to &quot;Service Gateway&quot;">​</a></h1><p>Das Service Gateway ist ein intelligentes Multi-Tenant Case Management System, das Voice Call Ergebnisse verarbeitet und an verschiedene Output-Kanäle weiterleitet.</p><h2 id="ubersicht" tabindex="-1">Übersicht <a class="header-anchor" href="#ubersicht" aria-label="Permalink to &quot;Übersicht&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Voice Call → Intent Detection → Case Creation → Enrichment → Output Delivery</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Das Service Gateway erweitert den bestehenden Terminbuchungs-Bot um Service-Desk-Funktionen. Kunden können sowohl Termine buchen als auch Support-Anfragen stellen - das System erkennt automatisch die Absicht.</p><h2 id="system-architektur" tabindex="-1">System Architektur <a class="header-anchor" href="#system-architektur" aria-label="Permalink to &quot;System Architektur&quot;">​</a></h2><h3 id="komponenten-ubersicht" tabindex="-1">Komponenten-Übersicht <a class="header-anchor" href="#komponenten-ubersicht" aria-label="Permalink to &quot;Komponenten-Übersicht&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                     INCOMING CALL                               │</span></span>
<span class="line"><span>│                    Retell.ai Voice                              │</span></span>
<span class="line"><span>└─────────────────────┬───────────────────────────────────────────┘</span></span>
<span class="line"><span>                      │</span></span>
<span class="line"><span>                      ▼</span></span>
<span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│              GatewayModeResolver                                │</span></span>
<span class="line"><span>│  ┌─────────────────────────────────────────────────────────┐   │</span></span>
<span class="line"><span>│  │ 1. Feature Flag Check (gateway.mode_enabled)            │   │</span></span>
<span class="line"><span>│  │ 2. Call → Company Resolution                            │   │</span></span>
<span class="line"><span>│  │ 3. PolicyConfiguration Lookup (cached 5min)             │   │</span></span>
<span class="line"><span>│  │ 4. Mode Validation                                       │   │</span></span>
<span class="line"><span>│  │ 5. Hybrid: IntentDetectionService                        │   │</span></span>
<span class="line"><span>│  └─────────────────────────────────────────────────────────┘   │</span></span>
<span class="line"><span>└─────────────────────┬───────────────────────────────────────────┘</span></span>
<span class="line"><span>                      │</span></span>
<span class="line"><span>          ┌───────────┼───────────┐</span></span>
<span class="line"><span>          ▼           ▼           ▼</span></span>
<span class="line"><span>    ┌──────────┐ ┌──────────┐ ┌──────────┐</span></span>
<span class="line"><span>    │appointment│ │service_  │ │  hybrid  │</span></span>
<span class="line"><span>    │   Mode   │ │  desk    │ │   Mode   │</span></span>
<span class="line"><span>    └────┬─────┘ └────┬─────┘ └────┬─────┘</span></span>
<span class="line"><span>         │            │            │</span></span>
<span class="line"><span>         │            ▼            │</span></span>
<span class="line"><span>         │     ┌───────────────┐   │</span></span>
<span class="line"><span>         │     │ ServiceCase   │◄──┘</span></span>
<span class="line"><span>         │     │  Creation     │</span></span>
<span class="line"><span>         │     └───────┬───────┘</span></span>
<span class="line"><span>         │             │</span></span>
<span class="line"><span>         │             ▼</span></span>
<span class="line"><span>         │     ┌───────────────┐</span></span>
<span class="line"><span>         │     │  Enrichment   │ (Queue: enrichment)</span></span>
<span class="line"><span>         │     │  • Customer   │</span></span>
<span class="line"><span>         │     │  • Audio      │</span></span>
<span class="line"><span>         │     │  • Transcript │</span></span>
<span class="line"><span>         │     └───────┬───────┘</span></span>
<span class="line"><span>         │             │</span></span>
<span class="line"><span>         ▼             ▼</span></span>
<span class="line"><span>    ┌──────────┐ ┌───────────────┐</span></span>
<span class="line"><span>    │ Cal.com  │ │Output Delivery│</span></span>
<span class="line"><span>    │ Booking  │ │ • Email       │</span></span>
<span class="line"><span>    └──────────┘ │ • Webhook     │</span></span>
<span class="line"><span>                 │ • Hybrid      │</span></span>
<span class="line"><span>                 └───────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h2 id="gateway-modi" tabindex="-1">Gateway Modi <a class="header-anchor" href="#gateway-modi" aria-label="Permalink to &quot;Gateway Modi&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Modus</th><th>Beschreibung</th><th>Use Case</th></tr></thead><tbody><tr><td><code>appointment</code></td><td>Klassische Terminbuchung</td><td>Friseure, Ärzte, Handwerker</td></tr><tr><td><code>service_desk</code></td><td>Ticket/Case-Erstellung</td><td>IT-Support, Kundenservice</td></tr><tr><td><code>hybrid</code></td><td>Kombinierter Modus mit Intent-Erkennung</td><td>Komplexe Workflows</td></tr></tbody></table><h3 id="appointment-modus" tabindex="-1">Appointment Modus <a class="header-anchor" href="#appointment-modus" aria-label="Permalink to &quot;Appointment Modus&quot;">​</a></h3><p>Der Standard-Modus für Terminbuchungen:</p><ul><li>Verfügbarkeit aus Cal.com prüfen</li><li>Termine direkt buchen</li><li>Bestätigung via SMS/Email</li></ul><h3 id="service-desk-modus" tabindex="-1">Service Desk Modus <a class="header-anchor" href="#service-desk-modus" aria-label="Permalink to &quot;Service Desk Modus&quot;">​</a></h3><p>Für Support-Anfragen und Ticket-Erstellung:</p><ul><li>Problem strukturiert erfassen</li><li>ITIL-basierte Kategorisierung (Incident, Request, Inquiry)</li><li>Automatisches Routing an Zielsysteme</li></ul><h3 id="hybrid-modus" tabindex="-1">Hybrid Modus <a class="header-anchor" href="#hybrid-modus" aria-label="Permalink to &quot;Hybrid Modus&quot;">​</a></h3><p>Intelligente Erkennung des Anliegens:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// IntentDetectionService wertet erste Äußerung aus</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $intentService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">detectIntent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($utterance, $companyId);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Beispiel-Output:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;intent&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;service_desk&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;confidence&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.92</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;detected_keywords&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;problem&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;drucker&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;funktioniert nicht&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;explanation&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Erkannte Keywords: problem, drucker, funktioniert nicht&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>Keyword-basierte Erkennung:</strong></p><table tabindex="0"><thead><tr><th>Kontext</th><th>Keywords (Deutsch)</th></tr></thead><tbody><tr><td>Termin</td><td>termin, buchen, reservieren, haarschnitt, färben, massage</td></tr><tr><td>Service</td><td>problem, fehler, funktioniert nicht, drucker, support, störung</td></tr></tbody></table><h2 id="datenfluss" tabindex="-1">Datenfluss <a class="header-anchor" href="#datenfluss" aria-label="Permalink to &quot;Datenfluss&quot;">​</a></h2><h3 id="_1-call-eingang" tabindex="-1">1. Call-Eingang <a class="header-anchor" href="#_1-call-eingang" aria-label="Permalink to &quot;1. Call-Eingang&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Retell.ai Call</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ▼</span></span>
<span class="line"><span>RetellFunctionCallHandler</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ├── extractCallIdLayered()</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ▼</span></span>
<span class="line"><span>GatewayModeResolver::resolve($callId)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-mode-resolution" tabindex="-1">2. Mode Resolution <a class="header-anchor" href="#_2-mode-resolution" aria-label="Permalink to &quot;2. Mode Resolution&quot;">​</a></h3><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// app/Services/Gateway/GatewayModeResolver.php</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> resolve</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">string</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $callId)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> string</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. Feature Flag Check</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gateway.mode_enabled&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;appointment&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. Call → Company Resolution</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $call </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">where</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;retell_call_id&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, $callId)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">first</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. Company Policy Lookup (cached)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $policy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> PolicyConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCachedPolicy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">company,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        PolicyConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">POLICY_TYPE_GATEWAY_MODE</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    );</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. Mode aus Policy oder Default</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    $mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $policy</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">config[</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;mode&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">??</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;gateway.default_mode&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. Hybrid: Intent Detection</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">===</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;hybrid&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $utterance </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $this</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getInitialUtterance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($callId);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        $mode </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $intentService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">determineMode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">($utterance, $call</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">company_id);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $mode;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_3-case-creation-service-desk" tabindex="-1">3. Case Creation (Service Desk) <a class="header-anchor" href="#_3-case-creation-service-desk" aria-label="Permalink to &quot;3. Case Creation (Service Desk)&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ServiceDeskHandler::create()</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ├── IssueCapturingService::capture()</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ├── TicketCategorizationService::categorize()</span></span>
<span class="line"><span>     │</span></span>
<span class="line"><span>     ▼</span></span>
<span class="line"><span>ServiceCase::create([</span></span>
<span class="line"><span>    &#39;company_id&#39; =&gt; $companyId,</span></span>
<span class="line"><span>    &#39;call_id&#39; =&gt; $callId,</span></span>
<span class="line"><span>    &#39;subject&#39; =&gt; $subject,</span></span>
<span class="line"><span>    &#39;description&#39; =&gt; $description,</span></span>
<span class="line"><span>    &#39;category_id&#39; =&gt; $categoryId,</span></span>
<span class="line"><span>    &#39;priority&#39; =&gt; $priority,</span></span>
<span class="line"><span>    &#39;status&#39; =&gt; &#39;open&#39;,</span></span>
<span class="line"><span>])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_4-2-phase-delivery-pattern" tabindex="-1">4. 2-Phase Delivery Pattern <a class="header-anchor" href="#_4-2-phase-delivery-pattern" aria-label="Permalink to &quot;4. 2-Phase Delivery Pattern&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Phase 1: Enrichment</span></span>
<span class="line"><span>─────────────────────────────────</span></span>
<span class="line"><span>ServiceCase Created</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>EnrichServiceCaseJob (Queue: enrichment)</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ├── Customer Matching</span></span>
<span class="line"><span>        ├── Audio Processing</span></span>
<span class="line"><span>        ├── Transcript Extraction</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>ServiceCase.enrichment_completed_at = now()</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>Phase 2: Output Delivery</span></span>
<span class="line"><span>─────────────────────────────────</span></span>
<span class="line"><span>Enrichment Complete</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>DeliverCaseOutputJob (Queue: default)</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ├── EmailOutputHandler OR</span></span>
<span class="line"><span>        ├── WebhookOutputHandler OR</span></span>
<span class="line"><span>        └── HybridOutputHandler</span></span>
<span class="line"><span>        │</span></span>
<span class="line"><span>        ▼</span></span>
<span class="line"><span>ServiceCase.output_status = &#39;sent&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="output-typen" tabindex="-1">Output-Typen <a class="header-anchor" href="#output-typen" aria-label="Permalink to &quot;Output-Typen&quot;">​</a></h2><h3 id="email-output" tabindex="-1">Email Output <a class="header-anchor" href="#email-output" aria-label="Permalink to &quot;Email Output&quot;">​</a></h3><p>Sendet formatierte E-Mail-Benachrichtigungen:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ServiceOutputConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;company_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $company</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;name&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;IT Support Email&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;output_type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;email&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;email_recipients&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;support@company.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;email_subject_template&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;[Ticket #{case_number}] {subject}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="webhook-output" tabindex="-1">Webhook Output <a class="header-anchor" href="#webhook-output" aria-label="Permalink to &quot;Webhook Output&quot;">​</a></h3><p>Liefert JSON-Payloads an externe Systeme:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ServiceOutputConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;company_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $company</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;name&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Jira Integration&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;output_type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;webhook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;webhook_url&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://jira.company.com/rest/api/2/issue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;webhook_method&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;webhook_preset&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;jira&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="webhook-presets" tabindex="-1">Webhook Presets <a class="header-anchor" href="#webhook-presets" aria-label="Permalink to &quot;Webhook Presets&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Preset</th><th>System</th><th>Features</th></tr></thead><tbody><tr><td><code>jira</code></td><td>Atlassian Jira</td><td>Issue-Erstellung mit Custom Fields</td></tr><tr><td><code>servicenow</code></td><td>ServiceNow</td><td>Incident Management</td></tr><tr><td><code>otrs</code></td><td>OTRS</td><td>Ticket-Erstellung</td></tr><tr><td><code>zendesk</code></td><td>Zendesk</td><td>Support Tickets</td></tr><tr><td><code>slack</code></td><td>Slack</td><td>Channel-Benachrichtigungen</td></tr><tr><td><code>teams</code></td><td>Microsoft Teams</td><td>Webhook Cards</td></tr><tr><td><code>generic</code></td><td>Beliebige REST API</td><td>Konfigurierbares Template</td></tr></tbody></table><h3 id="webhook-payload-template" tabindex="-1">Webhook Payload Template <a class="header-anchor" href="#webhook-payload-template" aria-label="Permalink to &quot;Webhook Payload Template&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;ticket&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;title&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;subject }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;description&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;description }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;priority&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;priority }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;case_type }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;customer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;customer-&gt;name }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;phone&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;customer-&gt;phone }}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        &quot;metadata&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;source&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;voice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;call_id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;call_id }}&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            &quot;created_at&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;{{ $case-&gt;created_at-&gt;toIso8601String() }}&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="sicherheit" tabindex="-1">Sicherheit <a class="header-anchor" href="#sicherheit" aria-label="Permalink to &quot;Sicherheit&quot;">​</a></h2><h3 id="h-001-cache-isolation" tabindex="-1">H-001: Cache Isolation <a class="header-anchor" href="#h-001-cache-isolation" aria-label="Permalink to &quot;H-001: Cache Isolation&quot;">​</a></h3><p>Alle Cache-Keys enthalten <code>company_id</code> für Tenant-Isolation:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>service_desk:{company_id}:{type}:{call_id}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="h-002-authorization-guard" tabindex="-1">H-002: Authorization Guard <a class="header-anchor" href="#h-002-authorization-guard" aria-label="Permalink to &quot;H-002: Authorization Guard&quot;">​</a></h3><p>API-Anfragen werden via <code>validateApiContext()</code> validiert:</p><ul><li>Call Context Verification</li><li>Company Isolation Check</li><li>Status Validation (rejected/cancelled calls werden abgelehnt)</li></ul><h3 id="ssrf-protection" tabindex="-1">SSRF Protection <a class="header-anchor" href="#ssrf-protection" aria-label="Permalink to &quot;SSRF Protection&quot;">​</a></h3><p>10-Layer Defense für Webhook URLs:</p><ol><li>URL-Struktur-Validierung</li><li>Protocol Whitelist (HTTPS only in Production)</li><li>Port Whitelist (80, 443)</li><li>Hostname Blocklist (localhost, metadata endpoints)</li><li>IP-Normalisierung (decimal, octal, hex)</li><li>IPv4-mapped IPv6 Detection</li><li>DNS Resolution Validation</li><li>Redirect Prevention</li></ol><h3 id="rate-limiting" tabindex="-1">Rate Limiting <a class="header-anchor" href="#rate-limiting" aria-label="Permalink to &quot;Rate Limiting&quot;">​</a></h3><ul><li>20 Operationen pro Call pro Minute</li><li>Verhindert Missbrauch während Voice Calls</li></ul><h2 id="sla-tracking" tabindex="-1">SLA Tracking <a class="header-anchor" href="#sla-tracking" aria-label="Permalink to &quot;SLA Tracking&quot;">​</a></h2><p>Kategorien können SLA-Ziele definieren:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ServiceCaseCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;name&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Critical Incident&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;sla_response_hours&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1 Stunde Response</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;sla_resolution_hours&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4 Stunden Resolution</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Dashboard-Widgets zeigen:</p><ul><li>Cases mit drohendem SLA-Breach</li><li>SLA Compliance Rates</li><li>Durchschnittliche Response-Zeiten</li></ul><h2 id="konfiguration" tabindex="-1">Konfiguration <a class="header-anchor" href="#konfiguration" aria-label="Permalink to &quot;Konfiguration&quot;">​</a></h2><h3 id="environment-variables" tabindex="-1">Environment Variables <a class="header-anchor" href="#environment-variables" aria-label="Permalink to &quot;Environment Variables&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Feature Flag</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_MODE_ENABLED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_DEFAULT_MODE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">appointment</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Hybrid Mode</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_HYBRID_FALLBACK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">appointment</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2-Phase Delivery</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_ENRICHMENT_ENABLED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_AUDIO_IN_WEBHOOK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_DELIVERY_INITIAL_DELAY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">90</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_ENRICHMENT_TIMEOUT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">180</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Cache (Sekunden)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_CACHE_WIDGET_STATS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">55</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_CACHE_WIDGET_TRENDS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">300</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_CACHE_RECENT_ACTIVITY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">30</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Admin Alerts</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_ADMIN_EMAIL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">admin@company.com</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_ALERTS_ENABLED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">true</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_SLACK_WEBHOOK</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">https://hooks.slack.com/...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="company-level-settings" tabindex="-1">Company-Level Settings <a class="header-anchor" href="#company-level-settings" aria-label="Permalink to &quot;Company-Level Settings&quot;">​</a></h3><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CompanyGatewayConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;company_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $company</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;gateway_mode&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;service_desk&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;default_category_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $category</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;auto_assign_enabled&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;sla_tracking_enabled&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="filament-admin" tabindex="-1">Filament Admin <a class="header-anchor" href="#filament-admin" aria-label="Permalink to &quot;Filament Admin&quot;">​</a></h2><h3 id="service-cases-resource" tabindex="-1">Service Cases Resource <a class="header-anchor" href="#service-cases-resource" aria-label="Permalink to &quot;Service Cases Resource&quot;">​</a></h3><p>Verwalte alle Service Cases im Admin Panel:</p><ul><li>Filter nach Status, Priorität, Kategorie</li><li>Inline-Bearbeitung</li><li>Bulk-Aktionen</li><li>SLA-Countdown-Anzeige</li></ul><h3 id="dashboard-widget" tabindex="-1">Dashboard Widget <a class="header-anchor" href="#dashboard-widget" aria-label="Permalink to &quot;Dashboard Widget&quot;">​</a></h3><p>Das Service Gateway Dashboard zeigt:</p><ul><li>Offene Cases nach Priorität</li><li>SLA-Status-Übersicht</li><li>Trend-Diagramme</li><li>Letzte Aktivitäten</li></ul><h2 id="api-endpoints" tabindex="-1">API Endpoints <a class="header-anchor" href="#api-endpoints" aria-label="Permalink to &quot;API Endpoints&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Method</th><th>Endpoint</th><th>Beschreibung</th></tr></thead><tbody><tr><td>POST</td><td><code>/api/service-gateway/cases</code></td><td>Case erstellen</td></tr><tr><td>GET</td><td><code>/api/service-gateway/cases/{id}</code></td><td>Case abrufen</td></tr><tr><td>PATCH</td><td><code>/api/service-gateway/cases/{id}</code></td><td>Case aktualisieren</td></tr><tr><td>POST</td><td><code>/api/service-gateway/finalize</code></td><td>Ticket finalisieren</td></tr></tbody></table><p>Siehe <a href="/docs-site/docs/api.html">Interactive API Docs</a> für die vollständige Spezifikation.</p><h2 id="rollback-strategie" tabindex="-1">Rollback-Strategie <a class="header-anchor" href="#rollback-strategie" aria-label="Permalink to &quot;Rollback-Strategie&quot;">​</a></h2><p>Das Service Gateway wurde mit minimaler Invasivität implementiert:</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sofortige Deaktivierung ohne Deploy</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">GATEWAY_MODE_ENABLED</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">false</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Bei Problemen:</p><ol><li>Feature Flag deaktivieren</li><li>System fällt auf <code>appointment</code> Modus zurück</li><li>Bestehende Terminbuchung funktioniert weiter</li></ol><h2 id="weitere-ressourcen" tabindex="-1">Weitere Ressourcen <a class="header-anchor" href="#weitere-ressourcen" aria-label="Permalink to &quot;Weitere Ressourcen&quot;">​</a></h2><ul><li><a href="/docs-site/api/service-gateway.html">Service Gateway API</a></li><li><a href="/docs-site/guide/webhooks.html">Webhooks Konfiguration</a></li><li><a href="/docs-site/guide/retell.html">Retell.ai Integration</a></li></ul>`,80)])])}const u=a(l,[["render",p]]);export{o as __pageData,u as default};
