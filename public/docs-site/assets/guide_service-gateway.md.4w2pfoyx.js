import{_ as a,c as i,o as e,ag as n}from"./chunks/framework.4sa0nZj2.js";const k=JSON.parse('{"title":"Service Gateway","description":"","frontmatter":{},"headers":[],"relativePath":"guide/service-gateway.md","filePath":"guide/service-gateway.md","lastUpdated":1767636057000}'),t={name:"guide/service-gateway.md"};function l(p,s,r,h,d,o){return e(),i("div",null,[...s[0]||(s[0]=[n(`<h1 id="service-gateway" tabindex="-1">Service Gateway <a class="header-anchor" href="#service-gateway" aria-label="Permalink to &quot;Service Gateway&quot;">​</a></h1><p>The Service Gateway is a multi-tenant case management system that processes voice call outcomes and delivers them to various output channels.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Voice Call → Intent Detection → Case Creation → Enrichment → Output Delivery</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="gateway-modes" tabindex="-1">Gateway Modes <a class="header-anchor" href="#gateway-modes" aria-label="Permalink to &quot;Gateway Modes&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Mode</th><th>Description</th><th>Use Case</th></tr></thead><tbody><tr><td><code>appointment</code></td><td>Traditional appointment booking</td><td>Scheduling services</td></tr><tr><td><code>service_desk</code></td><td>Pure ticket/case creation</td><td>IT Support, Customer Service</td></tr><tr><td><code>hybrid</code></td><td>Combined mode</td><td>Complex workflows</td></tr></tbody></table><h2 id="output-types" tabindex="-1">Output Types <a class="header-anchor" href="#output-types" aria-label="Permalink to &quot;Output Types&quot;">​</a></h2><h3 id="email-output" tabindex="-1">Email Output <a class="header-anchor" href="#email-output" aria-label="Permalink to &quot;Email Output&quot;">​</a></h3><p>Sends formatted email notifications with case details.</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Configuration</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;output_type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;email&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;email_recipients&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;support@company.com&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;email_subject_template&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;[Ticket #{case_number}] {subject}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="webhook-output" tabindex="-1">Webhook Output <a class="header-anchor" href="#webhook-output" aria-label="Permalink to &quot;Webhook Output&quot;">​</a></h3><p>Delivers JSON payloads to external systems (Jira, ServiceNow, OTRS, etc.).</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Configuration</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;output_type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;webhook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;webhook_url&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://jira.company.com/rest/api/2/issue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;webhook_method&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;POST&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;webhook_preset&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;jira&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="hybrid-output" tabindex="-1">Hybrid Output <a class="header-anchor" href="#hybrid-output" aria-label="Permalink to &quot;Hybrid Output&quot;">​</a></h3><p>Combines both email and webhook for redundant delivery.</p><h2 id="_2-phase-delivery-pattern" tabindex="-1">2-Phase Delivery Pattern <a class="header-anchor" href="#_2-phase-delivery-pattern" aria-label="Permalink to &quot;2-Phase Delivery Pattern&quot;">​</a></h2><p>The Service Gateway uses a sophisticated delivery pattern:</p><h3 id="phase-1-enrichment" tabindex="-1">Phase 1: Enrichment <a class="header-anchor" href="#phase-1-enrichment" aria-label="Permalink to &quot;Phase 1: Enrichment&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>ServiceCase Created</span></span>
<span class="line"><span>       ↓</span></span>
<span class="line"><span>EnrichServiceCaseJob (Queue: enrichment)</span></span>
<span class="line"><span>       ↓</span></span>
<span class="line"><span>- Customer matching</span></span>
<span class="line"><span>- Audio processing</span></span>
<span class="line"><span>- Transcript extraction</span></span>
<span class="line"><span>       ↓</span></span>
<span class="line"><span>ServiceCase.enrichment_completed_at = now()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="phase-2-output-delivery" tabindex="-1">Phase 2: Output Delivery <a class="header-anchor" href="#phase-2-output-delivery" aria-label="Permalink to &quot;Phase 2: Output Delivery&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Enrichment Complete</span></span>
<span class="line"><span>       ↓</span></span>
<span class="line"><span>DeliverCaseOutputJob (Queue: default)</span></span>
<span class="line"><span>       ↓</span></span>
<span class="line"><span>- EmailOutputHandler OR</span></span>
<span class="line"><span>- WebhookOutputHandler OR</span></span>
<span class="line"><span>- HybridOutputHandler</span></span>
<span class="line"><span>       ↓</span></span>
<span class="line"><span>ServiceCase.output_status = &#39;sent&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="webhook-presets" tabindex="-1">Webhook Presets <a class="header-anchor" href="#webhook-presets" aria-label="Permalink to &quot;Webhook Presets&quot;">​</a></h2><p>Built-in presets for popular ticketing systems:</p><table tabindex="0"><thead><tr><th>Preset</th><th>System</th><th>Features</th></tr></thead><tbody><tr><td><code>jira</code></td><td>Atlassian Jira</td><td>Issue creation with custom fields</td></tr><tr><td><code>servicenow</code></td><td>ServiceNow</td><td>Incident management</td></tr><tr><td><code>otrs</code></td><td>OTRS</td><td>Ticket creation</td></tr><tr><td><code>zendesk</code></td><td>Zendesk</td><td>Support tickets</td></tr><tr><td><code>slack</code></td><td>Slack</td><td>Channel notifications</td></tr><tr><td><code>teams</code></td><td>Microsoft Teams</td><td>Webhook cards</td></tr><tr><td><code>generic</code></td><td>Any REST API</td><td>Customizable template</td></tr></tbody></table><h2 id="security-features" tabindex="-1">Security Features <a class="header-anchor" href="#security-features" aria-label="Permalink to &quot;Security Features&quot;">​</a></h2><h3 id="h-001-cache-isolation" tabindex="-1">H-001: Cache Isolation <a class="header-anchor" href="#h-001-cache-isolation" aria-label="Permalink to &quot;H-001: Cache Isolation&quot;">​</a></h3><p>All cache keys include <code>company_id</code> for tenant isolation:</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>service_desk:{company_id}:{type}:{call_id}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="h-002-authorization-guard" tabindex="-1">H-002: Authorization Guard <a class="header-anchor" href="#h-002-authorization-guard" aria-label="Permalink to &quot;H-002: Authorization Guard&quot;">​</a></h3><p>API requests validated via <code>validateApiContext()</code>:</p><ul><li>Call context verification</li><li>Company isolation check</li><li>Status validation (rejects cancelled/rejected)</li></ul><h3 id="ssrf-protection" tabindex="-1">SSRF Protection <a class="header-anchor" href="#ssrf-protection" aria-label="Permalink to &quot;SSRF Protection&quot;">​</a></h3><p>10-layer defense for webhook URLs:</p><ol><li>URL structure validation</li><li>Protocol whitelist (HTTPS only in production)</li><li>Port whitelist (80, 443)</li><li>Hostname blocklist (localhost, metadata endpoints)</li><li>IP normalization (decimal, octal, hex)</li><li>IPv4-mapped IPv6 detection</li><li>DNS resolution validation</li><li>Redirect prevention</li></ol><h3 id="rate-limiting" tabindex="-1">Rate Limiting <a class="header-anchor" href="#rate-limiting" aria-label="Permalink to &quot;Rate Limiting&quot;">​</a></h3><ul><li>20 operations per call per minute</li><li>Prevents abuse during voice calls</li></ul><h2 id="sla-tracking" tabindex="-1">SLA Tracking <a class="header-anchor" href="#sla-tracking" aria-label="Permalink to &quot;SLA Tracking&quot;">​</a></h2><p>Categories can define SLA targets:</p><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ServiceCaseCategory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;name&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;Critical Incident&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;sla_response_hours&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1 hour response</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;sla_resolution_hours&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4 hour resolution</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>Dashboard widgets show:</p><ul><li>Cases approaching SLA breach</li><li>SLA compliance rates</li><li>Average response times</li></ul><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to &quot;Configuration&quot;">​</a></h2><h3 id="company-level-settings" tabindex="-1">Company-Level Settings <a class="header-anchor" href="#company-level-settings" aria-label="Permalink to &quot;Company-Level Settings&quot;">​</a></h3><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">CompanyGatewayConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;company_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $company</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;gateway_mode&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;service_desk&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;default_category_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $category</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;auto_assign_enabled&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;sla_tracking_enabled&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="output-configuration" tabindex="-1">Output Configuration <a class="header-anchor" href="#output-configuration" aria-label="Permalink to &quot;Output Configuration&quot;">​</a></h3><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ServiceOutputConfiguration</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">::</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">create</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;company_id&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $company</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">id,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;name&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;IT Support Webhook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;output_type&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;webhook&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;is_active&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;webhook_url&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;https://...&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;webhook_preset&#39;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;servicenow&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="api-endpoints" tabindex="-1">API Endpoints <a class="header-anchor" href="#api-endpoints" aria-label="Permalink to &quot;API Endpoints&quot;">​</a></h2><table tabindex="0"><thead><tr><th>Method</th><th>Endpoint</th><th>Description</th></tr></thead><tbody><tr><td>POST</td><td><code>/api/service-gateway/cases</code></td><td>Create case</td></tr><tr><td>GET</td><td><code>/api/service-gateway/cases/{id}</code></td><td>Get case</td></tr><tr><td>PATCH</td><td><code>/api/service-gateway/cases/{id}</code></td><td>Update case</td></tr><tr><td>POST</td><td><code>/api/service-gateway/finalize</code></td><td>Finalize ticket</td></tr></tbody></table><p>See <a href="/docs-site/docs/api.html">Interactive API Docs</a> for full specification.</p>`,49)])])}const u=a(t,[["render",l]]);export{k as __pageData,u as default};
