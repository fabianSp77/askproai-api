import{_ as a,c as n,o as e,ag as i}from"./chunks/framework.4sa0nZj2.js";const u=JSON.parse('{"title":"Architecture Overview","description":"","frontmatter":{},"headers":[],"relativePath":"guide/architecture.md","filePath":"guide/architecture.md","lastUpdated":1767648053000}'),t={name:"guide/architecture.md"};function l(p,s,r,c,h,o){return e(),n("div",null,[...s[0]||(s[0]=[i(`<h1 id="architecture-overview" tabindex="-1">Architecture Overview <a class="header-anchor" href="#architecture-overview" aria-label="Permalink to &quot;Architecture Overview&quot;">​</a></h1><p>AskPro API Gateway is a multi-tenant SaaS platform for AI-powered appointment management and service desk operations.</p><h2 id="system-architecture" tabindex="-1">System Architecture <a class="header-anchor" href="#system-architecture" aria-label="Permalink to &quot;System Architecture&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                        Frontend Layer                           │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│  Filament Admin    │  Customer Portal   │   API Clients        │</span></span>
<span class="line"><span>│  (Laravel/Livewire)│  (Blade/Alpine.js) │   (REST/Webhooks)    │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>                              │</span></span>
<span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                      Application Layer                          │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│  Controllers  │  Services  │  Jobs  │  Events  │  Policies     │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>                              │</span></span>
<span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                        Data Layer                               │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│     MySQL (Primary)    │    Redis (Cache/Queue)                 │</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────┘</span></span>
<span class="line"><span>                              │</span></span>
<span class="line"><span>┌─────────────────────────────────────────────────────────────────┐</span></span>
<span class="line"><span>│                    External Integrations                        │</span></span>
<span class="line"><span>├─────────────────────────────────────────────────────────────────┤</span></span>
<span class="line"><span>│   Retell.ai     │   Cal.com      │   Email (SMTP)   │  Webhooks│</span></span>
<span class="line"><span>│   (Voice AI)    │   (Scheduling) │   (Notifications)│  (Output)│</span></span>
<span class="line"><span>└─────────────────────────────────────────────────────────────────┘</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="core-components" tabindex="-1">Core Components <a class="header-anchor" href="#core-components" aria-label="Permalink to &quot;Core Components&quot;">​</a></h2><h3 id="multi-tenant-architecture" tabindex="-1">Multi-Tenant Architecture <a class="header-anchor" href="#multi-tenant-architecture" aria-label="Permalink to &quot;Multi-Tenant Architecture&quot;">​</a></h3><p>Every tenant (Company) has isolated data:</p><ul><li><strong>CompanyScope</strong>: Automatic query scoping via Laravel Global Scope</li><li><strong>Row-Level Security</strong>: Database-enforced isolation</li><li><strong>Tenant Context</strong>: Set via middleware on each request</li></ul><h3 id="service-layer-pattern" tabindex="-1">Service Layer Pattern <a class="header-anchor" href="#service-layer-pattern" aria-label="Permalink to &quot;Service Layer Pattern&quot;">​</a></h3><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">app</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">Services</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">├──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Retell</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                 # Voice AI integration</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">│</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   ├──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> RetellService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">│</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   └──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> DateTimeParser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">├──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> CalcomService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # Scheduling integration</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">├──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> Gateway</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # Service Gateway logic</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">│</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   ├──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> GatewayModeResolver</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">│</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   ├──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> IntentDetectionService</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">php</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">│</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   └──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> OutputHandlers</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">└──</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ServiceDesk</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            # Ticket management</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="job-queue-architecture" tabindex="-1">Job Queue Architecture <a class="header-anchor" href="#job-queue-architecture" aria-label="Permalink to &quot;Job Queue Architecture&quot;">​</a></h3><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Queue Workers</span></span>
<span class="line"><span>├── default         # General jobs</span></span>
<span class="line"><span>├── notifications   # Email/SMS delivery</span></span>
<span class="line"><span>├── sync           # Cal.com synchronization</span></span>
<span class="line"><span>└── gateway        # Service case processing</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="event-driven-design" tabindex="-1">Event-Driven Design <a class="header-anchor" href="#event-driven-design" aria-label="Permalink to &quot;Event-Driven Design&quot;">​</a></h3><div class="language-php vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">php</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Events trigger listeners for decoupled processing</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ServiceCaseCreated</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> →</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> EnrichServiceCaseJob</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                   →</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> SendNotificationJob</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                   →</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> LogActivityJob</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="database-schema" tabindex="-1">Database Schema <a class="header-anchor" href="#database-schema" aria-label="Permalink to &quot;Database Schema&quot;">​</a></h2><h3 id="core-tables" tabindex="-1">Core Tables <a class="header-anchor" href="#core-tables" aria-label="Permalink to &quot;Core Tables&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Table</th><th>Purpose</th></tr></thead><tbody><tr><td>companies</td><td>Tenant configuration</td></tr><tr><td>users</td><td>Admin/Staff accounts</td></tr><tr><td>customers</td><td>End-user data</td></tr><tr><td>calls</td><td>Voice call records</td></tr><tr><td>appointments</td><td>Booking data</td></tr><tr><td>service_cases</td><td>Support tickets</td></tr><tr><td>service_case_categories</td><td>Ticket categories with SLA</td></tr></tbody></table><h3 id="multi-tenancy-keys" tabindex="-1">Multi-Tenancy Keys <a class="header-anchor" href="#multi-tenancy-keys" aria-label="Permalink to &quot;Multi-Tenancy Keys&quot;">​</a></h3><p>All tenant-scoped tables include:</p><ul><li><code>company_id</code> - Foreign key to companies</li><li>Composite indexes for query performance</li></ul><h2 id="security-architecture" tabindex="-1">Security Architecture <a class="header-anchor" href="#security-architecture" aria-label="Permalink to &quot;Security Architecture&quot;">​</a></h2><ul><li><strong>Authentication</strong>: Laravel Sanctum (API) + Session (Web)</li><li><strong>Authorization</strong>: Spatie Permissions + Policies</li><li><strong>CSRF</strong>: Token validation on all forms</li><li><strong>XSS</strong>: Blade auto-escaping</li><li><strong>SQL Injection</strong>: Eloquent parameterized queries</li></ul><h2 id="caching-strategy" tabindex="-1">Caching Strategy <a class="header-anchor" href="#caching-strategy" aria-label="Permalink to &quot;Caching Strategy&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Redis Keys:</span></span>
<span class="line"><span>├── company:{id}:config     # Company settings (1hr TTL)</span></span>
<span class="line"><span>├── availability:{staff}    # Cal.com slots (5min TTL)</span></span>
<span class="line"><span>├── categories:{company}    # Service categories (30min TTL)</span></span>
<span class="line"><span>└── session:*              # User sessions</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="deployment-architecture" tabindex="-1">Deployment Architecture <a class="header-anchor" href="#deployment-architecture" aria-label="Permalink to &quot;Deployment Architecture&quot;">​</a></h2><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Production Environment</span></span>
<span class="line"><span>├── Nginx (Reverse Proxy + SSL)</span></span>
<span class="line"><span>├── PHP-FPM 8.3 (Application)</span></span>
<span class="line"><span>├── MySQL 8.0 (Database)</span></span>
<span class="line"><span>├── Redis (Cache + Queue)</span></span>
<span class="line"><span>└── Supervisor (Queue Workers)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,26)])])}const b=a(t,[["render",l]]);export{u as __pageData,b as default};
