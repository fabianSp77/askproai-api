{
    "global_prompt": "# AskPro AI Terminbuchungs-Agent\n\n## Identität\nDu bist der virtuelle Assistent von Ask Pro AI. Du bist KEIN echter Mensch. Du bist freundlich, professionell und effizient.\n\n## Kernregeln\n- NIEMALS Datum, Uhrzeit oder Verfügbarkeit erfinden\n- IMMER Funktionsergebnisse verwenden\n- Bei Unsicherheit nachfragen\n- Nur Vornamen verwenden (kein Herr/Frau ohne explizites Geschlecht)\n- Wichtige Details vor der Buchung bestätigen\n- Höflich, professionell und effizient bleiben\n\n## Datumsregeln\n- \"15.1\" bedeutet 15. des AKTUELLEN Monats, NICHT Januar\n- Verwende current_time_berlin() als Referenz\n- Relative Daten parsen: \"morgen\" = tomorrow, \"übermorgen\" = day after tomorrow\n\n## Intent Recognition (KRITISCH!)\nBei unklaren Äußerungen IMMER nachfragen:\n\"Möchten Sie einen NEUEN Termin vereinbaren oder einen BESTEHENDEN Termin ändern?\"\n\nOptionen:\n1. Neuen Termin buchen\n2. Bestehenden Termin verschieben\n3. Bestehenden Termin absagen\n4. Termin-Information abfragen\n\n## V85 Race Condition Schutz (Nur bei NEUEN Buchungen!)\n- SCHRITT 1: collect_appointment_data mit bestaetigung=false (nur prüfen)\n- SCHRITT 2: Explizite Benutzerbestätigung einholen\n- SCHRITT 3: collect_appointment_data mit bestaetigung=true (buchen)\n- Bei Race Condition: Sofort Alternativen anbieten\n\n## Policy Violations (Empathisch!)\nBei Frist-Überschreitungen:\n\"Ich verstehe Ihre Situation. Leider können wir kurzfristige Änderungen nur bis [FRIST] vornehmen.\nSie haben folgende Möglichkeiten: [Optionen nennen]. Was möchten Sie tun?\"\n\n## Unerwartete Reaktionen\n- Kunde bricht ab → Höflich verabschieden\n- Kunde unsicher → Zeit geben, Optionen wiederholen\n- Intent wechselt → Flexibel zurück zu Intent Recognition\n- Kunde kennt Datum nicht → Termine auflisten\n\n## Anti-Silence Regel\n- Innerhalb von 2 Sekunden nach Nutzeräußerung sprechen\n- Während Verarbeitung: \"Einen Moment bitte...\"\n- Niemals Stille über 3 Sekunden",
    "start_node_id": "node_01_greeting",
    "start_speaker": "agent",
    "model_choice": {
        "type": "cascading",
        "model": "gpt-4o-mini"
    },
    "model_temperature": 0.3,
    "tools": [
        {
            "tool_id": "tool-check-customer",
            "name": "check_customer",
            "type": "custom",
            "description": "Überprüft ob Kunde anhand Telefonnummer in der Datenbank existiert. Gibt customer_status zurück: found (bekannter Kunde), new_customer (neue Nummer, bekannter Name), oder anonymous (unbekannt).",
            "url": "https://api.askproai.de/api/retell/check-customer",
            "timeout_ms": 4000,
            "parameters": {
                "type": "object",
                "properties": {
                    "phone_number": {
                        "type": "string",
                        "description": "Telefonnummer des Anrufers"
                    }
                }
            }
        },
        {
            "tool_id": "tool-current-time-berlin",
            "name": "current_time_berlin",
            "type": "custom",
            "description": "Holt aktuelles Datum und Uhrzeit in Berlin Zeitzone. Essentiell für Datumsberechnung bei relativen Angaben wie morgen oder 15.1.",
            "url": "https://api.askproai.de/api/retell/current-time-berlin",
            "timeout_ms": 4000
        },
        {
            "tool_id": "tool-collect-appointment-data",
            "name": "collect_appointment_data",
            "type": "custom",
            "description": "Prüft Verfügbarkeit oder bucht Termin. Parameter bestaetigung: false=nur prüfen, true=tatsächlich buchen. Gibt Verfügbarkeit und ggf. Alternativen zurück.",
            "url": "https://api.askproai.de/api/retell/collect-appointment-data",
            "timeout_ms": 8000,
            "parameters": {
                "type": "object",
                "properties": {
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden"
                    },
                    "customer_phone": {
                        "type": "string",
                        "description": "Telefonnummer des Kunden"
                    },
                    "service": {
                        "type": "string",
                        "description": "Dienstleistung (z.B. Beratung)"
                    },
                    "preferred_date": {
                        "type": "string",
                        "description": "Gewünschtes Datum im Format YYYY-MM-DD"
                    },
                    "preferred_time": {
                        "type": "string",
                        "description": "Gewünschte Uhrzeit im Format HH:MM"
                    },
                    "bestaetigung": {
                        "type": "boolean",
                        "description": "false = nur Verfügbarkeit prüfen, true = tatsächlich buchen"
                    }
                },
                "required": [
                    "bestaetigung"
                ]
            }
        },
        {
            "tool_id": "tool-get-customer-appointments",
            "name": "get_customer_appointments",
            "type": "custom",
            "description": "Ruft alle bevorstehenden Termine eines Kunden ab. Gibt Liste mit Datum, Zeit, Service zurück.",
            "url": "https://api.askproai.de/api/retell/get-customer-appointments",
            "timeout_ms": 6000,
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Retell Call ID"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden (optional)"
                    }
                },
                "required": [
                    "call_id"
                ]
            }
        },
        {
            "tool_id": "tool-cancel-appointment",
            "name": "cancel_appointment",
            "type": "custom",
            "description": "Storniert einen Termin. Prüft automatisch Policy (Fristen, Gebühren). Gibt Erfolg oder Policy-Violation zurück.",
            "url": "https://api.askproai.de/api/retell/cancel-appointment",
            "timeout_ms": 8000,
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Retell Call ID"
                    },
                    "appointment_date": {
                        "type": "string",
                        "description": "Termin-Datum im Format YYYY-MM-DD"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden"
                    },
                    "reason": {
                        "type": "string",
                        "description": "Grund der Stornierung"
                    }
                },
                "required": [
                    "call_id",
                    "appointment_date"
                ]
            }
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "name": "reschedule_appointment",
            "type": "custom",
            "description": "Verschiebt einen Termin auf neues Datum/Zeit. Prüft automatisch Policy (Fristen, Gebühren). Gibt Erfolg oder Policy-Violation zurück.",
            "url": "https://api.askproai.de/api/retell/reschedule-appointment",
            "timeout_ms": 10000,
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Retell Call ID"
                    },
                    "old_date": {
                        "type": "string",
                        "description": "Aktuelles Termin-Datum YYYY-MM-DD"
                    },
                    "new_date": {
                        "type": "string",
                        "description": "Neues Termin-Datum YYYY-MM-DD"
                    },
                    "new_time": {
                        "type": "string",
                        "description": "Neue Uhrzeit HH:MM"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden"
                    },
                    "reason": {
                        "type": "string",
                        "description": "Grund der Verschiebung"
                    }
                },
                "required": [
                    "call_id",
                    "old_date",
                    "new_date",
                    "new_time"
                ]
            }
        }
    ],
    "nodes": [
        {
            "id": "node_01_greeting",
            "name": "Begrüßung",
            "type": "conversation",
            "display_position": {
                "x": 100,
                "y": 1200
            },
            "start_speaker": "agent",
            "instruction": {
                "type": "static_text",
                "text": "Willkommen bei Ask Pro AI. Guten Tag!"
            },
            "edges": [
                {
                    "id": "edge_greeting_time",
                    "condition": "Greeting completed",
                    "destination_node_id": "func_01_current_time",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Greeting completed"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "func_01_current_time",
            "name": "Zeit abrufen",
            "type": "function",
            "display_position": {
                "x": 500,
                "y": 1200
            },
            "tool_id": "tool-current-time-berlin",
            "tool_type": "local",
            "speak_during_execution": false,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": ""
            },
            "edges": [
                {
                    "id": "edge_time_customer",
                    "condition": "Time retrieved",
                    "destination_node_id": "func_01_check_customer",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Time retrieved"
                    }
                }
            ]
        },
        {
            "id": "func_01_check_customer",
            "name": "Kunde prüfen",
            "type": "function",
            "display_position": {
                "x": 900,
                "y": 1200
            },
            "tool_id": "tool-check-customer",
            "tool_type": "local",
            "speak_during_execution": false,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": ""
            },
            "edges": [
                {
                    "id": "edge_customer_routing",
                    "condition": "Customer checked",
                    "destination_node_id": "node_02_customer_routing",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Customer checked"
                    }
                }
            ]
        },
        {
            "id": "node_02_customer_routing",
            "name": "Kunden-Routing",
            "type": "conversation",
            "display_position": {
                "x": 1300,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Route customer based on status from check_customer. Do NOT speak - just route silently."
            },
            "edges": [
                {
                    "id": "edge_routing_known",
                    "condition": "Bekannter Kunde",
                    "destination_node_id": "node_03a_known_customer",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "customer_status",
                                "operator": "==",
                                "right": "found"
                            }
                        ],
                        "operator": "&&"
                    }
                },
                {
                    "id": "edge_routing_new",
                    "condition": "Neuer Kunde",
                    "destination_node_id": "node_03b_new_customer",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "customer_status",
                                "operator": "==",
                                "right": "new_customer"
                            }
                        ],
                        "operator": "&&"
                    }
                },
                {
                    "id": "edge_routing_anonymous",
                    "condition": "Anonymer Kunde",
                    "destination_node_id": "node_03c_anonymous_customer",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "customer_status",
                                "operator": "==",
                                "right": "anonymous"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_03a_known_customer",
            "name": "Bekannter Kunde Begrüßung",
            "type": "conversation",
            "display_position": {
                "x": 1700,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Greet by first name warmly. Example: \"Schön Sie wiederzuhören, {{customer_name}}!\""
            },
            "edges": [
                {
                    "id": "edge_known_intent",
                    "condition": "Greeting done",
                    "destination_node_id": "node_04_intent_enhanced",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Greeting done"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_03b_new_customer",
            "name": "Neuer Kunde Begrüßung",
            "type": "conversation",
            "display_position": {
                "x": 2100,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Greet warmly and introduce yourself. Example: \"Herzlich willkommen bei Ask Pro AI!\""
            },
            "edges": [
                {
                    "id": "edge_new_intent",
                    "condition": "Greeting done",
                    "destination_node_id": "node_04_intent_enhanced",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Greeting done"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_03c_anonymous_customer",
            "name": "Anonymer Kunde Begrüßung",
            "type": "conversation",
            "display_position": {
                "x": 2500,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Greet professionally: \"Guten Tag! Wie kann ich Ihnen helfen?\""
            },
            "edges": [
                {
                    "id": "edge_anon_name",
                    "condition": "Need name",
                    "destination_node_id": "node_05_name_collection",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Need name"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_05_name_collection",
            "name": "Namen erfragen",
            "type": "conversation",
            "display_position": {
                "x": 2900,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Ask politely: \"Darf ich zunächst Ihren Namen erfragen?\""
            },
            "edges": [
                {
                    "id": "edge_name_intent",
                    "condition": "Name collected",
                    "destination_node_id": "node_04_intent_enhanced",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Name collected"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_04_intent_enhanced",
            "name": "Intent-Erkennung",
            "type": "conversation",
            "display_position": {
                "x": 3300,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Erkenne die Absicht des Kunden. Frage bei Unklarheit IMMER nach:\n\n\"Möchten Sie einen NEUEN Termin vereinbaren oder einen BESTEHENDEN Termin ändern?\"\n\nIntents:\n1. Neuer Termin → node_06_service_selection\n2. Termin verschieben → func_get_appointments (dann reschedule flow)\n3. Termin stornieren → func_get_appointments (dann cancel flow)\n4. Termin abfragen → func_get_appointments\n\nAchte auf Schlüsselwörter:\n- \"buchen\", \"vereinbaren\", \"neu\" → NEUER Termin\n- \"verschieben\", \"umbuchen\", \"ändern\" → VERSCHIEBUNG\n- \"absagen\", \"stornieren\", \"cancel\" → STORNIERUNG\n- \"wann\", \"welcher\", \"habe ich\" → ABFRAGE"
            },
            "edges": [
                {
                    "id": "edge_intent_new",
                    "condition": "Neuer Termin",
                    "destination_node_id": "node_06_service_selection",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Neuer Termin"
                    }
                },
                {
                    "id": "edge_intent_modify",
                    "condition": "Termin ändern/abfragen",
                    "destination_node_id": "func_get_appointments",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Termin ändern/abfragen"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "func_get_appointments",
            "name": "Termine abrufen",
            "type": "function",
            "display_position": {
                "x": 3700,
                "y": 1200
            },
            "tool_id": "tool-get-customer-appointments",
            "tool_type": "local",
            "speak_during_execution": true,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich schaue nach Ihren Terminen..."
            },
            "edges": [
                {
                    "id": "edge_appointments_display",
                    "condition": "Appointments retrieved",
                    "destination_node_id": "node_appointments_display",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Appointments retrieved"
                    }
                }
            ]
        },
        {
            "id": "node_appointments_display",
            "name": "Termine anzeigen",
            "type": "conversation",
            "display_position": {
                "x": 4100,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Liste alle Termine auf (wenn vorhanden):\n\nFalls KEINE Termine:\n\"Sie haben aktuell keine bevorstehenden Termine. Möchten Sie einen neuen Termin vereinbaren?\"\n→ Zu node_06_service_selection\n\nFalls Termine vorhanden:\n\"Ich habe folgende Termine für Sie:\n1. [Datum], [Uhrzeit] - [Service]\n2. ...\n\nWas möchten Sie mit diesen Terminen tun?\"\n\nOptionen anbieten:\n- Einen Termin verschieben\n- Einen Termin absagen\n- Neuen Termin buchen"
            },
            "edges": [
                {
                    "id": "edge_display_reschedule",
                    "condition": "Verschieben",
                    "destination_node_id": "node_reschedule_identify",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Verschieben"
                    }
                },
                {
                    "id": "edge_display_cancel",
                    "condition": "Stornieren",
                    "destination_node_id": "node_cancel_identify",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Stornieren"
                    }
                },
                {
                    "id": "edge_display_new",
                    "condition": "Neu buchen",
                    "destination_node_id": "node_06_service_selection",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Neu buchen"
                    }
                },
                {
                    "id": "edge_display_polite",
                    "condition": "Abbruch",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Abbruch"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_06_service_selection",
            "name": "Dienstleistung auswählen",
            "type": "conversation",
            "display_position": {
                "x": 4500,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "Ask: \"Für welche Dienstleistung möchten Sie einen Termin? Wir bieten Beratung, Behandlung und Check-ups an.\""
            },
            "edges": [
                {
                    "id": "edge_service_datetime",
                    "condition": "Service selected",
                    "destination_node_id": "node_07_datetime_collection",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Service selected"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_07_datetime_collection",
            "name": "Datum & Zeit erfragen",
            "type": "conversation",
            "display_position": {
                "x": 4900,
                "y": 1200
            },
            "instruction": {
                "type": "prompt",
                "text": "CRITICAL: NEVER invent date/time! Ask: \"Für welchen Tag und welche Uhrzeit?\" Parse relative dates using current_time_berlin data. ALWAYS confirm: \"Das wäre {{weekday}}, der {{date}} um {{time}} Uhr. Richtig?\""
            },
            "edges": [
                {
                    "id": "edge_datetime_valid",
                    "condition": "Datum und Zeit erfasst",
                    "destination_node_id": "func_08_availability_check",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Datum und Zeit erfasst"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "func_08_availability_check",
            "name": "Verfügbarkeit prüfen",
            "type": "function",
            "display_position": {
                "x": 100,
                "y": 1600
            },
            "tool_id": "tool-collect-appointment-data",
            "tool_type": "local",
            "speak_during_execution": true,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich prüfe die Verfügbarkeit."
            },
            "edges": [
                {
                    "id": "edge_avail_available",
                    "condition": "Slot verfügbar",
                    "destination_node_id": "node_09a_booking_confirmation",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Slot verfügbar"
                    }
                },
                {
                    "id": "edge_avail_notavailable",
                    "condition": "Nicht verfügbar",
                    "destination_node_id": "node_09b_alternative_offering",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Nicht verfügbar"
                    }
                }
            ]
        },
        {
            "id": "node_09a_booking_confirmation",
            "name": "Buchungsbestätigung",
            "type": "conversation",
            "display_position": {
                "x": 500,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Confirm booking: \"Der Termin am {{date}} um {{time}} Uhr ist verfügbar. Soll ich diesen verbindlich für Sie buchen?\""
            },
            "edges": [
                {
                    "id": "edge_confirm_yes",
                    "condition": "Ja buchen",
                    "destination_node_id": "func_09c_final_booking",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Ja buchen"
                    }
                },
                {
                    "id": "edge_confirm_no",
                    "condition": "Nein abbrechen",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Nein abbrechen"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_09b_alternative_offering",
            "name": "Alternativen anbieten",
            "type": "conversation",
            "display_position": {
                "x": 900,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Use alternatives from function result. \"Dieser Termin ist leider nicht verfügbar. Ich kann Ihnen folgende Alternativen anbieten: [Liste]. Passt einer davon?\""
            },
            "edges": [
                {
                    "id": "edge_alt_yes",
                    "condition": "Alternative gewählt",
                    "destination_node_id": "func_08_availability_check",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternative gewählt"
                    }
                },
                {
                    "id": "edge_alt_no",
                    "condition": "Keine passt",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Keine passt"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "func_09c_final_booking",
            "name": "Termin buchen",
            "type": "function",
            "display_position": {
                "x": 1300,
                "y": 1600
            },
            "tool_id": "tool-collect-appointment-data",
            "tool_type": "local",
            "speak_during_execution": true,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": "Ich buche den Termin für Sie..."
            },
            "edges": [
                {
                    "id": "edge_booking_success",
                    "condition": "Erfolg",
                    "destination_node_id": "node_14_success_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Erfolg"
                    }
                },
                {
                    "id": "edge_booking_race",
                    "condition": "Race Condition",
                    "destination_node_id": "node_15_race_condition_handler",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Race Condition"
                    }
                }
            ]
        },
        {
            "id": "node_14_success_goodbye",
            "name": "Erfolgsbestätigung",
            "type": "conversation",
            "display_position": {
                "x": 1700,
                "y": 1600
            },
            "skip_response_edge": {
                "id": "edge_success_end",
                "condition": "End call",
                "destination_node_id": "end_node_success",
                "transition_condition": {
                    "type": "prompt",
                    "prompt": "Skip response"
                }
            },
            "instruction": {
                "type": "prompt",
                "text": "Confirm success warmly: \"Perfekt! Ihr Termin am {{date}} um {{time}} Uhr ist gebucht. Sie erhalten eine Bestätigung per E-Mail. Vielen Dank und bis bald!\""
            },
            "knowledge_base_ids": []
        },
        {
            "id": "node_15_race_condition_handler",
            "name": "Race Condition Handler",
            "type": "conversation",
            "display_position": {
                "x": 2100,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Explain race condition empathetically: \"Entschuldigung, dieser Termin wurde gerade eben von jemand anderem gebucht. Darf ich Ihnen einen der Alternativtermine anbieten?\""
            },
            "edges": [
                {
                    "id": "edge_race_alternatives",
                    "condition": "Alternativen anbieten",
                    "destination_node_id": "node_09b_alternative_offering",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternativen anbieten"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_reschedule_identify",
            "name": "Termin für Verschiebung identifizieren",
            "type": "conversation",
            "display_position": {
                "x": 2500,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Ask: \"Welchen Termin möchten Sie verschieben? Bitte nennen Sie mir das Datum.\" If customer doesn't know: Reference the appointments just listed."
            },
            "edges": [
                {
                    "id": "edge_reschedule_datetime",
                    "condition": "Termin identifiziert",
                    "destination_node_id": "node_reschedule_datetime",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Termin identifiziert"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_reschedule_datetime",
            "name": "Neues Datum/Zeit für Verschiebung",
            "type": "conversation",
            "display_position": {
                "x": 2900,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Ask: \"Auf welches Datum und welche Uhrzeit möchten Sie den Termin verschieben?\""
            },
            "edges": [
                {
                    "id": "edge_reschedule_execute",
                    "condition": "Neues Datum erfasst",
                    "destination_node_id": "func_reschedule_execute",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Neues Datum erfasst"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "func_reschedule_execute",
            "name": "Verschiebung durchführen",
            "type": "function",
            "display_position": {
                "x": 3300,
                "y": 1600
            },
            "tool_id": "tool-reschedule-appointment",
            "tool_type": "local",
            "speak_during_execution": true,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich verschiebe Ihren Termin..."
            },
            "edges": [
                {
                    "id": "edge_reschedule_success",
                    "condition": "Erfolg",
                    "destination_node_id": "node_reschedule_success",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Erfolg"
                    }
                },
                {
                    "id": "edge_reschedule_policy",
                    "condition": "Policy Violation",
                    "destination_node_id": "node_policy_violation_handler",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Policy Violation"
                    }
                },
                {
                    "id": "edge_reschedule_error",
                    "condition": "Fehler",
                    "destination_node_id": "node_99_error_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Fehler"
                    }
                }
            ]
        },
        {
            "id": "node_reschedule_success",
            "name": "Verschiebung erfolgreich",
            "type": "conversation",
            "display_position": {
                "x": 3700,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Confirm: \"Perfekt! Ihr Termin wurde erfolgreich auf {{new_date}} um {{new_time}} Uhr verschoben. Sie erhalten eine Bestätigung per E-Mail. Gibt es noch etwas?\""
            },
            "edges": [
                {
                    "id": "edge_reschedule_done",
                    "condition": "Fertig",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Fertig"
                    }
                },
                {
                    "id": "edge_reschedule_more",
                    "condition": "Weiterer Service",
                    "destination_node_id": "node_04_intent_enhanced",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Weiterer Service"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_cancel_identify",
            "name": "Termin für Stornierung identifizieren",
            "type": "conversation",
            "display_position": {
                "x": 4100,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Ask: \"Welchen Termin möchten Sie absagen? Bitte nennen Sie mir das Datum.\" If customer doesn't know: Reference the appointments just listed."
            },
            "edges": [
                {
                    "id": "edge_cancel_confirm",
                    "condition": "Termin identifiziert",
                    "destination_node_id": "node_cancel_confirmation",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Termin identifiziert"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_cancel_confirmation",
            "name": "Stornierung bestätigen",
            "type": "conversation",
            "display_position": {
                "x": 4500,
                "y": 1600
            },
            "instruction": {
                "type": "prompt",
                "text": "Ask for confirmation: \"Möchten Sie den Termin am {{date}} um {{time}} Uhr wirklich absagen?\""
            },
            "edges": [
                {
                    "id": "edge_cancel_yes",
                    "condition": "Ja absagen",
                    "destination_node_id": "func_cancel_execute",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Ja absagen"
                    }
                },
                {
                    "id": "edge_cancel_no",
                    "condition": "Nein behalten",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Nein behalten"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "func_cancel_execute",
            "name": "Stornierung durchführen",
            "type": "function",
            "display_position": {
                "x": 4900,
                "y": 1600
            },
            "tool_id": "tool-cancel-appointment",
            "tool_type": "local",
            "speak_during_execution": true,
            "wait_for_result": true,
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich storniere den Termin..."
            },
            "edges": [
                {
                    "id": "edge_cancel_success",
                    "condition": "Erfolg",
                    "destination_node_id": "node_cancel_success",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Erfolg"
                    }
                },
                {
                    "id": "edge_cancel_policy",
                    "condition": "Policy Violation",
                    "destination_node_id": "node_policy_violation_handler",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Policy Violation"
                    }
                },
                {
                    "id": "edge_cancel_error",
                    "condition": "Fehler",
                    "destination_node_id": "node_99_error_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Fehler"
                    }
                }
            ]
        },
        {
            "id": "node_cancel_success",
            "name": "Stornierung erfolgreich",
            "type": "conversation",
            "display_position": {
                "x": 100,
                "y": 2000
            },
            "instruction": {
                "type": "prompt",
                "text": "Confirm empathetically: \"Ihr Termin am {{date}} um {{time}} Uhr wurde storniert. Sie erhalten eine Bestätigungs-E-Mail. Möchten Sie einen neuen Termin vereinbaren?\""
            },
            "edges": [
                {
                    "id": "edge_cancel_newbooking",
                    "condition": "Neuer Termin",
                    "destination_node_id": "node_06_service_selection",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Neuer Termin"
                    }
                },
                {
                    "id": "edge_cancel_done",
                    "condition": "Nein danke",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Nein danke"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_policy_violation_handler",
            "name": "Policy Verletzung",
            "type": "conversation",
            "display_position": {
                "x": 500,
                "y": 2000
            },
            "instruction": {
                "type": "prompt",
                "text": "Handle policy violations empathetically. Use the error message from the function.\n\nExample:\n\"Ich verstehe Ihre Situation. Leider können wir kurzfristige {{action}} nur bis {{deadline}} vornehmen.\n\nSie haben folgende Möglichkeiten:\n1. {{option_1}}\n2. {{option_2}}\n\nWas möchten Sie tun?\"\n\nAlways offer alternatives, never just say \"nicht möglich\"."
            },
            "edges": [
                {
                    "id": "edge_policy_alt1",
                    "condition": "Alternative 1",
                    "destination_node_id": "node_06_service_selection",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternative 1"
                    }
                },
                {
                    "id": "edge_policy_abort",
                    "condition": "Abbrechen",
                    "destination_node_id": "node_98_polite_goodbye",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Abbrechen"
                    }
                }
            ],
            "knowledge_base_ids": []
        },
        {
            "id": "node_98_polite_goodbye",
            "name": "Höfliche Verabschiedung",
            "type": "conversation",
            "display_position": {
                "x": 900,
                "y": 2000
            },
            "skip_response_edge": {
                "id": "edge_polite_end",
                "condition": "End call",
                "destination_node_id": "end_node_polite",
                "transition_condition": {
                    "type": "prompt",
                    "prompt": "Skip response"
                }
            },
            "instruction": {
                "type": "prompt",
                "text": "Say: \"Kein Problem! Rufen Sie gerne jederzeit wieder an wenn Sie einen Termin benötigen. Ich wünsche Ihnen noch einen schönen Tag. Auf Wiederhören!\""
            },
            "knowledge_base_ids": []
        },
        {
            "id": "node_99_error_goodbye",
            "name": "Fehlerbehandlung",
            "type": "conversation",
            "display_position": {
                "x": 1300,
                "y": 2000
            },
            "skip_response_edge": {
                "id": "edge_error_end",
                "condition": "End call",
                "destination_node_id": "end_node_error",
                "transition_condition": {
                    "type": "prompt",
                    "prompt": "Skip response"
                }
            },
            "instruction": {
                "type": "prompt",
                "text": "Apologize professionally: \"Entschuldigung, es gab einen technischen Fehler. Bitte rufen Sie uns direkt an unter {{phone_number}} oder versuchen Sie es später nochmal. Vielen Dank für Ihr Verständnis.\""
            },
            "knowledge_base_ids": []
        },
        {
            "id": "end_node_success",
            "name": "Anruf beenden (Erfolg)",
            "type": "end",
            "display_position": {
                "x": 1700,
                "y": 2000
            },
            "instruction": {
                "type": "prompt",
                "text": "Politely end the call"
            }
        },
        {
            "id": "end_node_polite",
            "name": "Anruf beenden (Höflich)",
            "type": "end",
            "display_position": {
                "x": 2100,
                "y": 2000
            },
            "instruction": {
                "type": "prompt",
                "text": "Politely end the call"
            }
        },
        {
            "id": "end_node_error",
            "name": "Anruf beenden (Fehler)",
            "type": "end",
            "display_position": {
                "x": 2500,
                "y": 2000
            },
            "instruction": {
                "type": "prompt",
                "text": "Politely end the call"
            }
        }
    ]
}