window.EnhancedChartManager={charts:{},colors:{primary:["#3b82f6","#60a5fa","#93c5fd","#dbeafe"],success:["#10b981","#34d399","#6ee7b7","#a7f3d0"],warning:["#f59e0b","#fbbf24","#fcd34d","#fde68a"],danger:["#ef4444","#f87171","#fca5a5","#fecaca"],purple:["#8b5cf6","#a78bfa","#c4b5fd","#e9d5ff"],gradient:{blue:"linear-gradient(180deg, rgba(59, 130, 246, 0.8) 0%, rgba(59, 130, 246, 0.2) 100%)",green:"linear-gradient(180deg, rgba(16, 185, 129, 0.8) 0%, rgba(16, 185, 129, 0.2) 100%)",purple:"linear-gradient(180deg, rgba(139, 92, 246, 0.8) 0%, rgba(139, 92, 246, 0.2) 100%)"}},destroy(e){if(this.charts[e])try{this.charts[e].destroy(),delete this.charts[e]}catch(t){}},destroyAll(){Object.keys(this.charts).forEach(e=>this.destroy(e))},createAppointmentsChart(e,t){if(!e||!t.labels||!t.appointments)return;const o=e.getContext("2d").createLinearGradient(0,0,0,300);o.addColorStop(0,"rgba(59, 130, 246, 0.8)"),o.addColorStop(1,"rgba(59, 130, 246, 0.1)"),this.charts.appointments=new Chart(e,{type:"bar",data:{labels:t.labels,datasets:[{label:"Termine",data:t.appointments,backgroundColor:o,borderColor:"#3b82f6",borderWidth:2,borderRadius:8,borderSkipped:!1,barThickness:"flex",maxBarThickness:50}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},animation:{duration:1e3,easing:"easeInOutQuart"},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(17, 24, 39, 0.9)",titleColor:"#f3f4f6",bodyColor:"#d1d5db",borderColor:"#374151",borderWidth:1,padding:12,cornerRadius:8,displayColors:!1,callbacks:{title:e=>e[0].label,label:e=>`Termine: ${e.formattedValue}`,afterLabel:e=>{const o=t.appointments.reduce((e,t)=>e+t,0);return`${(e.raw/o*100).toFixed(1)}% vom Total`}}},datalabels:{display:!0,color:"#374151",anchor:"end",align:"top",font:{weight:"bold",size:11},formatter:e=>e>0?e:""}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:11}}},y:{beginAtZero:!0,grid:{color:"rgba(229, 231, 235, 0.5)",drawBorder:!1},ticks:{color:"#6b7280",font:{size:11},padding:8,callback:function(e){return Number.isInteger(e)?e:""}}}}}})},createRevenueChart(e,t){if(!e||!t.labels||!t.revenue)return;const o=e.getContext("2d").createLinearGradient(0,0,0,300);o.addColorStop(0,"rgba(16, 185, 129, 0.8)"),o.addColorStop(1,"rgba(16, 185, 129, 0.01)"),this.charts.revenue=new Chart(e,{type:"line",data:{labels:t.labels,datasets:[{label:"Umsatz",data:t.revenue,borderColor:"#10b981",backgroundColor:o,borderWidth:3,tension:.4,fill:!0,pointRadius:0,pointHoverRadius:6,pointBackgroundColor:"#10b981",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#10b981",pointHoverBorderColor:"#fff",pointHoverBorderWidth:3}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},animation:{duration:1500,easing:"easeInOutQuart"},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(17, 24, 39, 0.9)",titleColor:"#f3f4f6",bodyColor:"#d1d5db",borderColor:"#374151",borderWidth:1,padding:12,cornerRadius:8,displayColors:!1,callbacks:{title:e=>e[0].label,label:e=>`Umsatz: ${e.formattedValue.toLocaleString("de-DE")} €`,afterLabel:e=>{const o=Math.max(...t.revenue);return`${(e.raw/o*100).toFixed(1)}% vom Maximum`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:11}}},y:{beginAtZero:!0,grid:{color:"rgba(229, 231, 235, 0.5)",drawBorder:!1},ticks:{color:"#6b7280",font:{size:11},padding:8,callback:function(e){return e.toLocaleString("de-DE")+" €"}}}}}})},createCallDistributionChart(e,t){if(!e||!t.inbound)return;const o=t.inbound.total_calls||0,a=t.outbound&&t.outbound.total_calls||0;0!==o||0!==a?this.charts.callDist=new Chart(e,{type:"doughnut",data:{labels:["Eingehend","Ausgehend"],datasets:[{data:[o,a],backgroundColor:["#10b981","#3b82f6"],borderColor:"#fff",borderWidth:3,hoverOffset:8}]},options:{responsive:!0,maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeInOutQuart"},cutout:"70%",plugins:{legend:{position:"bottom",labels:{padding:20,color:"#6b7280",font:{size:12,weight:500},usePointStyle:!0,pointStyle:"circle"}},tooltip:{backgroundColor:"rgba(17, 24, 39, 0.9)",titleColor:"#f3f4f6",bodyColor:"#d1d5db",borderColor:"#374151",borderWidth:1,padding:12,cornerRadius:8,callbacks:{label:function(e){const t=e.label||"",o=e.parsed;return[`${t}: ${o} Anrufe`,`${(o/e.dataset.data.reduce((e,t)=>e+t,0)*100).toFixed(1)}% vom Total`]}}},centerText:{display:!0,text:`${o+a}`,label:"Gesamt"}}},plugins:[{id:"centerText",beforeDraw:function(e,t,o){if(o.display){const{ctx:t,chartArea:{width:a,height:r}}=e;t.save(),t.font="bold 24px sans-serif",t.fillStyle="#1f2937",t.textAlign="center",t.textBaseline="middle";const n=a/2,i=r/2-10;t.fillText(o.text,n,i),t.font="12px sans-serif",t.fillStyle="#6b7280",t.fillText(o.label,n,i+20),t.restore()}}}]}):this.showNoData(e.parentElement)},createCallsTimelineChart(e,t){if(!e||!t.labels||!t.calls)return;const o=e.getContext("2d").createLinearGradient(0,0,0,300);o.addColorStop(0,"rgba(139, 92, 246, 0.8)"),o.addColorStop(1,"rgba(139, 92, 246, 0.01)"),this.charts.callsTimeline=new Chart(e,{type:"line",data:{labels:t.labels,datasets:[{label:"Anrufe",data:t.calls,borderColor:"#8b5cf6",backgroundColor:o,borderWidth:3,tension:.4,fill:!0,pointRadius:4,pointHoverRadius:7,pointBackgroundColor:"#8b5cf6",pointBorderColor:"#fff",pointBorderWidth:2,pointHoverBackgroundColor:"#8b5cf6",pointHoverBorderColor:"#fff",pointHoverBorderWidth:3}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{intersect:!1,mode:"index"},animation:{duration:1500,easing:"easeInOutQuart"},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(17, 24, 39, 0.9)",titleColor:"#f3f4f6",bodyColor:"#d1d5db",borderColor:"#374151",borderWidth:1,padding:12,cornerRadius:8,displayColors:!1,callbacks:{title:e=>e[0].label,label:e=>`Anrufe: ${e.formattedValue}`}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:11}}},y:{beginAtZero:!0,grid:{color:"rgba(229, 231, 235, 0.5)",drawBorder:!1},ticks:{color:"#6b7280",font:{size:11},padding:8,callback:function(e){return Number.isInteger(e)?e:""}}}}}})},createHeatmap(e,t){e&&t&&0!==t.length&&(this.charts.heatmap=new ApexCharts(e,{series:t,chart:{height:350,type:"heatmap",toolbar:{show:!0,tools:{download:!0,selection:!1,zoom:!1,zoomin:!1,zoomout:!1,pan:!1,reset:!1}},animations:{enabled:!0,speed:800,animateGradually:{enabled:!0,delay:150}}},plotOptions:{heatmap:{shadeIntensity:.5,radius:4,useFillColorAsStroke:!1,colorScale:{ranges:[{from:0,to:0,name:"Keine",color:"#f3f4f6"},{from:1,to:3,name:"Wenig",color:"#bfdbfe"},{from:4,to:7,name:"Mittel",color:"#60a5fa"},{from:8,to:12,name:"Viel",color:"#3b82f6"},{from:13,to:999,name:"Sehr viel",color:"#1e40af"}]}}},dataLabels:{enabled:!0,style:{colors:["#1f2937"],fontSize:"11px",fontWeight:600}},stroke:{width:1,colors:["#fff"]},xaxis:{type:"category",categories:["8:00","9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00"],labels:{style:{colors:"#6b7280",fontSize:"11px"}}},yaxis:{labels:{style:{colors:"#6b7280",fontSize:"11px"}}},tooltip:{y:{formatter:function(e){return e+" Termine"}},style:{fontSize:"12px"}},legend:{show:!0,position:"bottom",horizontalAlign:"center",fontSize:"12px",labels:{colors:"#6b7280"}}}),this.charts.heatmap.render())},showNoData(e){e.innerHTML='\n            <div class="no-data-state">\n                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" \n                          d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z">\n                    </path>\n                </svg>\n                <p>Keine Daten verfügbar</p>\n            </div>\n        '},create(){this.destroyAll();const e=window.analyticsChartData||{},t=window.analyticsHeatmapData||[],o=window.analyticsCallMetrics||{};if(!e||0===Object.keys(e).length)return;const a=document.getElementById("appointmentsChart");a&&this.createAppointmentsChart(a,e);const r=document.getElementById("revenueChart");r&&this.createRevenueChart(r,e);const n=document.getElementById("callDistributionChart");n&&this.createCallDistributionChart(n,o);const i=document.getElementById("callsTimelineChart");i&&this.createCallsTimelineChart(i,e);const l=document.getElementById("heatmap");l&&this.createHeatmap(l,t)}},window.createEnhancedCharts=function(){window.EnhancedChartManager.create()};
