import"../js/chunks/bootstrap-BQPa8_R7.js";import{m as e,a as t,b as n,c as o}from"../js/vendor/vendor-alpine-BA52dRyX.js";import"../js/chunks/alpine-sidebar-store-DqbT0PbK.js";import"../js/chunks/mobile-interactions-DuwNssOf.js";import"../js/chunks/sidebar-toggle-fix-DKfcCgpc.js";import"../js/chunks/mobile-sidebar-text-fix-C78EM9r9.js";import{h as s}from"../js/vendor/vendor-misc-BtoTmB29.js";import"../js/vendor/vendor-network-ztdpVPaQ.js";class i{constructor(){this.consentKey="askproai_cookie_consent",this.consent=this.loadConsent(),this.initializeThirdPartyScripts()}loadConsent(){try{const e=localStorage.getItem(this.consentKey);if(e)return JSON.parse(e)}catch(e){}return null}saveConsent(e){this.consent={...e,timestamp:(new Date).toISOString()};try{localStorage.setItem(this.consentKey,JSON.stringify(this.consent))}catch(t){}}hasConsent(e){if(!this.consent)return!1;switch(e){case"necessary":return!0;case"functional":return this.consent.functional_cookies||!1;case"analytics":return this.consent.analytics_cookies||!1;case"marketing":return this.consent.marketing_cookies||!1;default:return!1}}initializeThirdPartyScripts(){this.hasConsent("analytics")&&window.GA_TRACKING_ID&&this.loadGoogleAnalytics(),this.hasConsent("marketing")&&window.FB_PIXEL_ID&&this.loadFacebookPixel(),this.initializeConsentedScripts()}loadGoogleAnalytics(){if(window.gtag)return;const e=document.createElement("script");e.async=!0,e.src=`https://www.googletagmanager.com/gtag/js?id=${window.GA_TRACKING_ID}`,document.head.appendChild(e),window.dataLayer=window.dataLayer||[],window.gtag=function(){dataLayer.push(arguments)},window.gtag("js",new Date),window.gtag("config",window.GA_TRACKING_ID,{anonymize_ip:!0,cookie_flags:"SameSite=None;Secure"})}loadFacebookPixel(){var e,t,n,o,s,i;window.fbq||(e=window,t=document,n="script",e.fbq||(o=e.fbq=function(){o.callMethod?o.callMethod.apply(o,arguments):o.queue.push(arguments)},e._fbq||(e._fbq=o),o.push=o,o.loaded=!0,o.version="2.0",o.queue=[],(s=t.createElement(n)).async=!0,s.src="https://connect.facebook.net/en_US/fbevents.js",(i=t.getElementsByTagName(n)[0]).parentNode.insertBefore(s,i)),window.fbq("init",window.FB_PIXEL_ID),window.fbq("track","PageView"))}initializeConsentedScripts(){this.hasConsent("functional")&&this.enableEnhancedFeatures(),this.hasConsent("marketing")&&this.loadMarketingTools()}enableEnhancedFeatures(){window.saveUserPreference=(e,t)=>{this.hasConsent("functional")&&localStorage.setItem(`user_pref_${e}`,t)},window.loadUserPreference=(e,t=null)=>this.hasConsent("functional")&&localStorage.getItem(`user_pref_${e}`)||t}loadMarketingTools(){}deleteNonEssentialCookies(){const e=document.cookie.split(";"),t=["askproai_session","XSRF-TOKEN",this.consentKey];e.forEach(e=>{const n=e.indexOf("="),o=n>-1?e.substr(0,n).trim():e.trim();t.includes(o)||(document.cookie=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/`,document.cookie=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=${window.location.hostname}`,document.cookie=`${o}=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/; domain=.${window.location.hostname}`)})}updateConsent(e){const t={...this.consent};this.saveConsent(e),t&&(t.analytics_cookies&&!e.analytics_cookies||t.marketing_cookies&&!e.marketing_cookies)?(this.deleteNonEssentialCookies(),window.location.reload()):this.initializeThirdPartyScripts()}}let a;"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.cookieConsentManager=new i}):window.cookieConsentManager=new i,window.addEventListener("cookie-consent-updated",e=>{window.cookieConsentManager&&window.cookieConsentManager.updateConsent(e.detail)}),document.addEventListener("DOMContentLoaded",function(){if(!document.querySelector(".fi-company-integration-portal"))return;document.querySelectorAll('button[wire\\:click*="selectCompany"]').forEach((e,t)=>{e.setAttribute("tabindex","0"),e.addEventListener("keydown",function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.click())})}),window.Livewire&&(Livewire.on("company-selected",e=>{}),Livewire.on("test-completed",e=>{})),window.addEventListener("test-result",function(e){const{service:t,success:n,message:o}=e.detail;window.FilamentNotifications&&window.FilamentNotifications.notify(n?"success":"danger",o)}),document.addEventListener("click",function(e){e.target.closest(".fi-modal")});document.querySelectorAll(".fi-section").forEach(e=>{const t=e.querySelector(".fi-section-heading");if(t&&!t.id){const n="section-"+Math.random().toString(36).substr(2,9);t.id=n,e.setAttribute("aria-labelledby",n)}})}),window.CompanyIntegrationPortal={initialized:!0,version:"2.0.0"},document.addEventListener("DOMContentLoaded",function(){function e(){document.querySelectorAll(".fi-ta-table").forEach(e=>{const t=e.querySelectorAll("thead th"),n=e.querySelectorAll("tbody tr"),o=Array.from(t).map(e=>(e.querySelector(".fi-ta-header-cell-label span")||e.querySelector("span")||e).textContent.trim());n.forEach(e=>{e.querySelectorAll("td").forEach((e,t)=>{o[t]&&""!==o[t]&&e.setAttribute("data-label",o[t])})})})}e(),window.Livewire&&Livewire.hook("message.processed",(t,n)=>{setTimeout(e,100)});const t=new MutationObserver(function(t){t.forEach(function(t){"childList"===t.type&&t.target.classList.contains("fi-ta-table")&&e()})});document.querySelectorAll(".fi-ta-content").forEach(e=>{t.observe(e,{childList:!0,subtree:!0})})}),window.addEventListener("resize",function(){clearTimeout(a),a=setTimeout(function(){document.querySelectorAll(".fi-ta-table-wrapper").forEach(e=>{e.style.display="none",e.offsetHeight,e.style.display=""})},250)}),document.addEventListener("alpine:init",()=>{Alpine.data("retellConfigCenter",()=>({activeTab:"dashboard",showAgentModal:!1,showWebhookModal:!1,selectedAgent:null,testInProgress:!1,metricsInterval:null,webhooksInterval:null,init(){this.startLiveUpdates(),Livewire.on("agentUpdated",()=>{this.showSuccessToast("Agent updated successfully")}),Livewire.on("testCompleted",e=>{this.showTestResults(e)})},startLiveUpdates(){this.metricsInterval=setInterval(()=>{"dashboard"===this.activeTab&&Livewire.emit("refreshMetrics")},3e4),this.webhooksInterval=setInterval(()=>{"webhooks"===this.activeTab&&Livewire.emit("refreshWebhooks")},1e4)},stopLiveUpdates(){this.metricsInterval&&clearInterval(this.metricsInterval),this.webhooksInterval&&clearInterval(this.webhooksInterval)},switchTab(e){this.activeTab=e,localStorage.setItem("retell_active_tab",e),"webhooks"===e&&Livewire.emit("loadWebhooks")},editAgent(e){this.selectedAgent=e,this.showAgentModal=!0,Livewire.emit("loadAgent",e.id)},deleteAgent(e){confirm("Are you sure you want to delete this agent?")&&Livewire.emit("deleteAgent",e)},async testWebhook(){this.testInProgress=!0;try{const e=await fetch("/api/retell/test-webhook",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:JSON.stringify({test:!0})}),t=await e.json();this.showTestResults(t)}catch(e){this.showErrorToast("Test failed: "+e.message)}finally{this.testInProgress=!1}},async testAgent(e){try{const t=await fetch(`/api/retell/agents/${e}/test`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content}}),n=await t.json();n.success?this.showSuccessToast("Agent test successful"):this.showErrorToast("Agent test failed: "+n.message)}catch(t){this.showErrorToast("Test failed: "+t.message)}},async testCustomFunction(e){this.$refs.functionTestModal,this.showFunctionTestModal(e)},showFunctionTestModal(e){Livewire.emit("showFunctionTest",e)},showTestResults(e){const t=document.createElement("div");t.className="fixed inset-0 z-50 overflow-y-auto",t.innerHTML=`\n                <div class="flex items-center justify-center min-h-screen px-4">\n                    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity"></div>\n                    <div class="relative bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full p-6">\n                        <h3 class="text-lg font-medium mb-4">Test Results</h3>\n                        <pre class="bg-gray-100 dark:bg-gray-900 p-4 rounded overflow-x-auto">${JSON.stringify(e,null,2)}</pre>\n                        <button onclick="this.closest('.fixed').remove()" class="mt-4 px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">\n                            Close\n                        </button>\n                    </div>\n                </div>\n            `,document.body.appendChild(t)},showSuccessToast(e){window.FilamentNotifications.new().title(e).success().send()},showErrorToast(e){window.FilamentNotifications.new().title(e).danger().send()},copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{this.showSuccessToast("Copied to clipboard")}).catch(()=>{this.showErrorToast("Failed to copy")})},formatTimestamp:e=>new Date(e).toLocaleString(),formatDuration:e=>`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`,destroy(){this.stopLiveUpdates()}}))});window.webhookViewer=new class{constructor(){this.syntaxHighlight=this.syntaxHighlight.bind(this)}syntaxHighlight(e){return(e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(e){let t="text-gray-600";return t=/^"/.test(e)?/:$/.test(e)?"text-blue-600 font-semibold":"text-green-600":/true|false/.test(e)?"text-purple-600":/null/.test(e)?"text-red-600":"text-orange-600",'<span class="'+t+'">'+e+"</span>"})}display(e,t){const n=JSON.stringify(e,null,2),o=this.syntaxHighlight(n);t.innerHTML=`<pre class="text-sm">${o}</pre>`}},window.Echo&&window.Echo.private(`company.${window.companyId}`).listen("RetellWebhookReceived",e=>{Livewire.emit("webhookReceived",e.webhook),window.FilamentNotifications.new().title("New webhook received").body(`Event: ${e.webhook.event_type}`).success().send()}).listen("RetellCallStarted",e=>{Livewire.emit("callStarted",e.call)}).listen("RetellCallEnded",e=>{Livewire.emit("callEnded",e.call)}),window.Alpine=e,e.plugin(t),e.plugin(n),e.plugin(o),e.start(),window.hotkeys=s,s("cmd+k, ctrl+k",function(e){e.preventDefault(),window.dispatchEvent(new CustomEvent("open-command-palette"))});
