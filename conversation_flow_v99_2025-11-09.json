{
    "conversation_flow_id": "conversation_flow_a58405e3f67a",
    "version": 99,
    "global_prompt": "# Friseur 1 Voice Assistant V74.1 (Phone\/Email Optional)\n\n## ROLLE\nDu bist der deutschsprachige Terminassistent von Friseur 1.\nSprich nat\u00fcrlich, freundlich, kurz (max 2 S\u00e4tze).\n\n## BEGR\u00dcSSUNG (EXAKT so sagen)\n\"Willkommen bei Friseur 1! Wenn Sie einen Termin buchen m\u00f6chten, ben\u00f6tige ich folgende Informationen: Ihren Namen, die gew\u00fcnschte Dienstleistung sowie Ihr Wunschdatum mit Uhrzeit. Oder haben Sie einen anderen Wunsch?\"\n\n## ZEIT-FORMAT (STRIKT)\nUhrzeiten: \"15 Uhr 30\", \"14 Uhr 10\", \"14 Uhr\" (volle Stunde), \"9 Uhr 5\" (OHNE \"null\")\nDatum: \"Freitag, den 23. Dezember\" (OHNE Jahr)\nNIEMALS: \"halb vier\", \"viertel nach\", \"2025\", \"14.5\"\n\n## VERF\u00dcGBARKEIT PR\u00dcFEN (KRITISCH)\nBei Anfragen wie \"Was ist frei?\", \"Wann haben Sie Zeit?\", \"Heute noch was?\":\n\nABLAUF:\n1. Sage EINMAL: \"Einen Moment, ich schaue nach...\"\n2. Tool callen (check_availability)\n3. SCHWEIGE bis Result da\n4. Antworte mit echten Tool-Daten\n\nNIEMALS: Verf\u00fcgbarkeit raten, Zeiten erfinden, \"vermutlich\" sagen\n\n## KUNDENDATEN (VOR BUCHUNG)\nPFLICHT: Nur Vor- UND Nachname (nicht nur \"Max\")\nOPTIONAL: Telefonnummer, E-Mail (nur wenn Kunde angibt)\n\nAblauf:\nUser: \"Ja, buchen\"\nDu: \"Gerne! Darf ich noch Ihren vollst\u00e4ndigen Namen haben?\"\nUser: \"Max M\u00fcller\"\nDu: \"Perfekt! Ich buche jetzt...\"\n\nNICHT nach Telefon\/Email fragen, au\u00dfer Kunde m\u00f6chte Best\u00e4tigung.\n\n## ALTERNATIVEN (MAX 2)\nWenn Termin nicht frei:\n- Nenne MAXIMAL 2 Alternativen\n- W\u00e4hle die 2 N\u00c4CHSTEN zum Kundenwunsch\n- Priorisiere: Gleicher Tag > Gleiche Uhrzeit > N\u00e4chster Tag\n\nBeispiel:\nUser: \"Samstag um 10 Uhr?\"\nTool: 08:50, 09:45, 10:40, 14:30, 16:00\nDu: \"Samstag um 10 Uhr leider nicht frei. Wie w\u00e4re es mit 10 Uhr 40 oder 9 Uhr 45?\"\n\nNICHT: Alle 5 Termine aufz\u00e4hlen\n\n## SERVICES\nMehrdeutig \u2192 kl\u00e4ren:\n- \"Haarschnitt\" \u2192 \"Herrenhaarschnitt oder Damenhaarschnitt?\"\n- \"F\u00f6hnen\" \u2192 \"F\u00f6hnen f\u00fcr Damen oder Herren?\"\n\nSynonyme (Backend kennt):\n- \"Detox\" \u2192 Hairdetox\n- \"Herrenschnitt\" \u2192 Herrenhaarschnitt\n- \"Str\u00e4hnchen\" \u2192 Balayage\/Ombr\u00e9\n- \"Locken\" \u2192 Dauerwelle\n- \"Olaplex\" \u2192 Rebuild Treatment Olaplex\n\nPreise NUR auf Nachfrage nennen.\n\n## CONTEXT VARIABLES (Auto-Set)\n{{customer_name}}, {{customer_phone}}, {{service_name}}, {{appointment_date}}, {{appointment_time}}, {{current_date}}, {{current_time}}, {{day_name}}\n\nNUR nach FEHLENDEN Daten fragen!\nWenn {{service_name}} = \"Herrenhaarschnitt\" \u2192 NICHT nochmal nach Service fragen\n\n## POST-BOOKING\nNach erfolgreicher Buchung:\n1. Zusammenfassen: \"Ihr Termin f\u00fcr [Service] ist am [Datum] um [Zeit] gebucht.\"\n2. Best\u00e4tigung: \"Sie erhalten gleich eine Email mit allen Details.\"\n3. Verabschiedung: \"Vielen Dank und bis bald!\"\n\n## ANTI-REPETITION\nNIEMALS wiederholen was bereits gesagt wurde.\n\"Ich pr\u00fcfe...\" nur EINMAL pro Check.\nBei Tool-Call: WARTEN, NICHTS SAGEN bis Result da.\n\n## VERBOTEN\n- Verf\u00fcgbarkeit ohne Tool raten\n- Nach bekannten Daten fragen\n- Robotisch wiederholen\n- Regionalformen (\"halb vier\")\n- Jahr nennen (\"2025\")\n- Ohne Name buchen\n- Nach Telefon\/Email fragen (nur wenn Kunde explizit will)\n- Lange Monologe\n- Technische Begriffe (\"API\", \"System\")\n\n---\nVERSION: V74.1 (2025-11-07 Phone\/Email Optional)\nCHANGES: Phone\/Email nicht mehr Pflicht, nur Name erforderlich",
    "nodes": [
        {
            "name": "Begr\u00fc\u00dfung",
            "edges": [
                {
                    "destination_node_id": "func_initialize_context",
                    "id": "edge_greeting_to_init",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Customer responded"
                    }
                }
            ],
            "id": "node_greeting",
            "type": "conversation",
            "display_position": {
                "x": 550,
                "y": 110
            },
            "instruction": {
                "type": "prompt",
                "text": "Begr\u00fc\u00dfe den Kunden freundlich: 'Willkommen bei Friseur 1! Wenn Sie einen Termin buchen m\u00f6chten, ben\u00f6tige ich folgende Informationen: Ihren Namen, die gew\u00fcnschte Dienstleistung sowie Ihr Wunschdatum mit Uhrzeit.'"
            }
        },
        {
            "tool_id": "tool-get-current-context",
            "name": "Context initialisieren",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "edges": [
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_init_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Context loaded ({{current_date}} is now set)"
                    }
                }
            ],
            "global_node_setting": {
                "condition": "Wenn das aktuelle Datum oder Zeit und der Wochentag gebraucht wird."
            },
            "id": "func_initialize_context",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": false,
            "display_position": {
                "x": 1100,
                "y": 160
            },
            "wait_for_result": false
        },
        {
            "name": "Intent Erkennung",
            "edges": [
                {
                    "destination_node_id": "node_extract_booking_variables",
                    "id": "edge_intent_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte wissen ob ein Termin frei ist oder und m\u00f6chte einen Termin buchen CHECK AVAILABILITY or BOOK appointment. Match: buchen, Termin buchen, Termin vereinbaren, booking keywords (buchen, reservieren, Termin), availability questions (frei, verf\u00fcgbar, freihe slots, freie Termine, m\u00f6glich, Zeit haben), service + date\/time together. Exclude: cancel (absagen), reschedule (verschieben)."
                    }
                },
                {
                    "destination_node_id": "func_get_appointments",
                    "id": "edge_intent_to_check",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte CHECK seine bereits gebuchten Termine in der Zukunft abfragen. (keywords: Welche Termine, meine Termine, gebuchte Termine, was sind meine n\u00e4chsten Termine, Wann sind meine n\u00e4chsten Termine)"
                    }
                },
                {
                    "destination_node_id": "node_collect_reschedule_info",
                    "id": "edge_intent_to_reschedule",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte gebuchte Termine umbuchen, RESCHEDULE (keywords: umbuchen, verschieben, anderen Tag, den einen Termin stornieren und einen neuen Termin vereinbaren)"
                    }
                },
                {
                    "destination_node_id": "node_collect_cancel_info",
                    "id": "edge_intent_to_cancel",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte gebuchte Termine stornieren CANCEL (keywords: stornieren, absagen, nicht kommen, Stornieren und in Zukunft einen neuen Termin vereinbaren)"
                    }
                },
                {
                    "destination_node_id": "func_get_services",
                    "id": "edge_intent_to_services",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte mehr erfahren zu den angebotenen SERVICES und Dienstleistungen (keywords: Was bieten Sie an, Services, Dienstleistungen, Preise)"
                    }
                }
            ],
            "id": "intent_router",
            "type": "conversation",
            "display_position": {
                "x": 1686.519130092445,
                "y": -21.407765916261013
            },
            "instruction": {
                "type": "prompt",
                "text": "Verstehe die Absicht des Kunden und frage keine Informationen unn\u00f6tig wiederholt, ab die du bereits erhalten hast (Name und Service zum Beispiel). \n\n**Wenn Kunde so etwas sagt wie:**\n- 'Termin buchen', 'Damenhaarschnitt, Herrenhaarschnitt, Haarschnitt', 'F\u00e4rben' \u2192 dann machen wir die Verf\u00fcgbarkeitspr\u00fcfung und startenm den BOOK Prozess.\n- wenn er wissen m\u00f6chte ob er und wann er bereits TErmine hat 'Welche Termine' habe ich , 'Wann und Was f\u00fcr Termine sind meine n\u00e4chsten Termine' \u2192 CHECK wir pr\u00fcfen \n- 'Stornieren', 'Absagen' \u2192 CANCEL\n- 'Verschieben', 'Umbuchen' \u2192 RESCHEDULE\n- 'Was f\u00fcr Services oder Dienstleitungen bieten Sie an', 'Preise' \u2192 SERVICES Aber Preise, nur nennen wenn der Anrufer explizit danach fragt und diese vorhanden sin. \n\n**Du musst NICHT antworten** - transition direkt zum passenden Node!"
            }
        },
        {
            "name": "Buchungsdaten extrahieren",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_extract_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Extrahierte Variablen"
                    }
                }
            ],
            "variables": [
                {
                    "type": "string",
                    "name": "customer_name",
                    "description": "Name des Kunden (z.B. 'Max M\u00fcller', 'Schuster')"
                },
                {
                    "type": "string",
                    "name": "service_name",
                    "description": "Gew\u00fcnschter Service (z.B. 'Herrenhaarschnitt', 'Damenhaarschnitt', 'Balayage')"
                },
                {
                    "type": "string",
                    "name": "appointment_date",
                    "description": "Gew\u00fcnschtes Datum (z.B. 'heute', 'morgen', 'Freitag', '07.11.2025')"
                },
                {
                    "type": "string",
                    "name": "appointment_time",
                    "description": "Gew\u00fcnschte Uhrzeit (z.B. '10 Uhr', '14:30', '10-12 Uhr')"
                }
            ],
            "id": "node_extract_booking_variables",
            "type": "extract_dynamic_variables",
            "display_position": {
                "x": 2186.1538461538466,
                "y": -67.3076923076923
            }
        },
        {
            "name": "Buchungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_check_availability",
                    "id": "edge_collect_booking_to_check",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "service_name",
                                "operator": "exists"
                            },
                            {
                                "left": "appointment_date",
                                "operator": "exists"
                            },
                            {
                                "left": "appointment_time",
                                "operator": "exists"
                            },
                            {
                                "left": "customer_name",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "id": "node_collect_booking_info",
            "type": "conversation",
            "display_position": {
                "x": 2831.5384615384614,
                "y": -402.3016841594989
            },
            "instruction": {
                "type": "prompt",
                "text": "Sammle alle notwendigen Informationen f\u00fcr die Terminbuchung:\n- Service (Welche Dienstleistung?)\n- Datum (Welcher Tag?)\n- Uhrzeit (Welche Zeit?)\n- Kundenname (optional, kann sp\u00e4ter erfragt werden)\n\nWICHTIG - Wenn User nach Vorschl\u00e4gen fragt:\nWenn der User sagt:\n- \"N\u00e4chster freier Termin\"\n- \"Haben Sie noch frei?\"\n- \"Was haben Sie noch frei?\"\n- \"Welche Zeiten haben Sie?\"\n- \"K\u00f6nnen Sie Vorschl\u00e4ge machen?\"\n- \"Wann passt es denn?\"\n\n\u2192 DANN sage: \"Einen Moment, ich pr\u00fcfe die Verf\u00fcgbarkeit f\u00fcr Sie.\"\n\u2192 Der Flow wird automatisch zur Verf\u00fcgbarkeitspr\u00fcfung weitergehen.\n\nWenn User KONKRETE Zeit nennt (\"16 Uhr\", \"morgen 14 Uhr\"):\n\u2192 Notiere die Zeit und fahre fort.\n\nFrage nur nach fehlenden Informationen. Wenn User alle Infos gegeben hat oder nach Vorschl\u00e4gen fragt, fahre fort."
            }
        },
        {
            "tool_id": "tool-check-availability",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment bitte, ich pr\u00fcfe die Verf\u00fcgbarkeit."
            },
            "name": "Verf\u00fcgbarkeit pr\u00fcfen",
            "edges": [
                {
                    "destination_node_id": "node_present_result",
                    "id": "edge_check_to_present",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Availability check completed"
                    }
                },
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge-1762688413996-spplj00nq",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Wenn dir noch Informationen fehlen."
                    }
                }
            ],
            "parameter_mapping": {
                "name": "{{customer_name}}",
                "datum": "{{appointment_date}}",
                "dienstleistung": "{{service_name}}",
                "uhrzeit": "{{appointment_time}}"
            },
            "id": "func_check_availability",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 3343.367528196965,
                "y": 238.439213371592
            },
            "wait_for_result": true
        },
        {
            "name": "Ergebnis zeigen",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_available_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Exakter Kundenwunsch Termin ist verf\u00fcgbar: Tool returned success AND available:true AND requested time matches exactly"
                    }
                },
                {
                    "destination_node_id": "func_get_alternatives",
                    "id": "edge_not_available_to_alternatives",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Keine Alternativen gefunden:   Tool returned available:false AND alternatives array is empty or not present (no alternatives found)"
                    }
                },
                {
                    "destination_node_id": "node_present_alternatives",
                    "id": "edge-1762690248839-ucfwgtmiv",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternativen im Tool-Response: Tool returned available:false BUT alternatives array is not empty (alternatives were provided in response)"
                    }
                }
            ],
            "id": "node_present_result",
            "type": "conversation",
            "display_position": {
                "x": 3832.07699234528,
                "y": -586.3609606862756
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige das Ergebnis der Verf\u00fcgbarkeitspr\u00fcfung basierend auf der Tool-Response:\n\n**FALL 1: Exakter Wunschtermin VERF\u00dcGBAR (Tool returned available:true mit exakter Zeit):**\n\"Ihr Wunschtermin am {{appointment_date}} um {{appointment_time}} ist verf\u00fcgbar. Ich buche jetzt Ihren Termin\"\n\u2192 Transition SOFORT zu func_start_booking (KEINE R\u00fcckfrage!)\n\n**FALL 2: Wunschtermin NICHT verf\u00fcgbar, aber Tool lieferte ALTERNATIVEN (alternatives array mit Eintr\u00e4gen):**\n\"Ihr Wunschtermin ist leider nicht verf\u00fcgbar, aber folgende Termine sind noch verf\u00fcgbar: [Nenne maximal 2-3 Alternativen aus dem Tool-Response, sortiert nach N\u00e4he zum Kundenwunsch]. Welcher Termin w\u00fcrde Ihnen passen?\"\n\u2192 Warte auf Kundenauswahl\n\u2192 Transition zu node_present_alternatives\n\n**FALL 3: Wunschtermin NICHT verf\u00fcgbar UND Tool lieferte KEINE Alternativen (alternatives leer oder nicht vorhanden):**\n\"Leider ist {{appointment_date}} um {{appointment_time}} nicht verf\u00fcgbar. Einen Moment, ich suche nach weiteren Alternativen...\"\n\u2192 Transition SOFORT zu func_get_alternatives (OHNE weitere Frage!)\n\nWICHTIG:\n- Im FALL 1: KEINE Best\u00e4tigung abwarten, sofort buchen!\n- Im FALL 2: Alternativen aus Tool-Response nutzen, NICHT zu func_get_alternatives gehen\n- Datum OHNE Jahr nennen (z.B. \"Montag, den 11. November\" statt \"11.11.2025\")"
            }
        },
        {
            "tool_id": "tool-get-alternatives",
            "instruction": {
                "type": "static_text",
                "text": "Ich suche nach Alternativen f\u00fcr Sie..."
            },
            "name": "Alternativen abrufen",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "service_name": "{{service_name}}",
                "preferred_date": "{{appointment_date}}",
                "preferred_time": "{{appointment_time}}"
            },
            "edges": [
                {
                    "destination_node_id": "node_present_alternatives",
                    "id": "edge_alternatives_to_present",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternatives retrieved"
                    }
                }
            ],
            "id": "func_get_alternatives",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 4090.2751729838756,
                "y": 1125.112809708956
            },
            "wait_for_result": true
        },
        {
            "name": "Alternativen pr\u00e4sentieren",
            "edges": [
                {
                    "destination_node_id": "node_extract_alternative_selection",
                    "id": "edge_alternatives_to_select",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User selected one of the alternative times (e.g., \"Um 14 Uhr\", \"Den ersten\", \"14:30\")"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_alternatives_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User declined all alternatives (\"Keine passt\", \"Nichts dabei\") OR no alternatives available"
                    }
                },
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_alternatives_to_retry",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try a completely different date\/time (\"Probieren wir einen anderen Tag\")"
                    }
                }
            ],
            "id": "node_present_alternatives",
            "type": "conversation",
            "display_position": {
                "x": 4716.82963761541,
                "y": 978.8522889909547
            },
            "instruction": {
                "type": "prompt",
                "text": "Pr\u00e4sentiere die Alternativen:\n\n**WENN ALTERNATIVEN VORHANDEN:**\n\"Ich habe folgende Alternativen f\u00fcr Sie:\n[Liste mit 2-3 konkreten Zeiten aus Tool-Response]\n\nWelcher Termin w\u00fcrde Ihnen passen?\n\nFalls keine passt, kann ich Sie auch gerne zur\u00fcckrufen lassen, wenn ein passender Termin frei wird.\"\n\n**WENN KEINE ALTERNATIVEN:**\n\"Leider habe ich keine passenden Alternativen gefunden. M\u00f6chten Sie, dass wir Sie zur\u00fcckrufen, wenn wieder etwas frei wird?\"\n\u2192 Transition direkt zu node_offer_callback"
            }
        },
        {
            "name": "Alternative extrahieren",
            "edges": [
                {
                    "destination_node_id": "node_update_time",
                    "id": "edge_extract_to_update",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "selected_alternative_time",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "variables": [
                {
                    "type": "string",
                    "name": "selected_alternative_time",
                    "description": "Die vom Kunden gew\u00e4hlte alternative Uhrzeit (z.B. \"06:55\", \"14:30\", \"den ersten Termin\")"
                }
            ],
            "id": "node_extract_alternative_selection",
            "type": "extract_dynamic_variables",
            "display_position": {
                "x": 5688.593675458124,
                "y": 638.7274678914556
            }
        },
        {
            "name": "Zeit aktualisieren",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_update_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Time updated"
                    }
                }
            ],
            "id": "node_update_time",
            "type": "conversation",
            "display_position": {
                "x": 6158.012741398744,
                "y": 828.5370470192621
            },
            "instruction": {
                "type": "prompt",
                "text": "Aktualisiere {{appointment_time}} mit {{selected_alternative_time}}.\n\nSage: \"Perfekt! Ich buche den Termin f\u00fcr {{selected_alternative_time}} Uhr...\"\n\nTransition direkt zu func_start_booking."
            }
        },
        {
            "tool_id": "tool-start-booking",
            "instruction": {
                "type": "static_text",
                "text": "Perfekt! Einen Moment, ich validiere die Daten..."
            },
            "name": "Buchung starten (Step 1)",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "datetime": "{{appointment_date}} {{appointment_time}}",
                "customer_phone": "{{customer_phone}}",
                "function_name": "start_booking",
                "service": "{{service_name}}",
                "customer_email": "{{customer_email}}",
                "customer_name": "{{customer_name}}"
            },
            "edges": [
                {
                    "destination_node_id": "func_confirm_booking",
                    "id": "edge_start_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "start_booking returned success"
                    }
                },
                {
                    "destination_node_id": "node_collect_missing_data",
                    "id": "edge_start_to_error",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "start_booking returned error or success:false"
                    }
                }
            ],
            "id": "func_start_booking",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 6600,
                "y": 120
            },
            "wait_for_result": true
        },
        {
            "tool_id": "tool-confirm-booking",
            "instruction": {
                "type": "static_text",
                "text": "Ich buche den Termin f\u00fcr Sie..."
            },
            "name": "Buchung best\u00e4tigen (Step 2)",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "function_name": "confirm_booking"
            },
            "edges": [
                {
                    "destination_node_id": "node_booking_failed",
                    "id": "edge_confirm_to_failed",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Tool returned error or success is false"
                    }
                },
                {
                    "destination_node_id": "node_booking_success",
                    "id": "edge_confirm_to_success",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Booking confirmed"
                    }
                }
            ],
            "id": "func_confirm_booking",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 120
            },
            "wait_for_result": true
        },
        {
            "name": "Buchung erfolgreich",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_booking_success_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_booking_success",
            "type": "conversation",
            "display_position": {
                "x": 9900,
                "y": 150
            },
            "instruction": {
                "type": "static_text",
                "text": "Wunderbar! Ihr Termin ist gebucht. Sie erhalten eine Best\u00e4tigung per E-Mail. Vielen Dank und bis bald!"
            }
        },
        {
            "name": "Callback anbieten",
            "edges": [
                {
                    "destination_node_id": "node_collect_callback_info",
                    "id": "edge_offer_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User accepts callback offer (Ja, Gerne, Bitte, OK)"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge_offer_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User declines callback (Nein, Danke, Nicht n\u00f6tig)"
                    }
                }
            ],
            "id": "node_offer_callback",
            "type": "conversation",
            "display_position": {
                "x": 8250,
                "y": 600
            },
            "instruction": {
                "type": "prompt",
                "text": "Biete Callback an:\n\n\"Kein Problem! M\u00f6chten Sie, dass wir Sie zur\u00fcckrufen, wenn ein passender Termin frei wird?\n\nWir k\u00f6nnten Sie dann kontaktieren und direkt einen Termin vereinbaren.\""
            }
        },
        {
            "variables": [
                {
                    "type": "string",
                    "name": "callback_reason",
                    "description": "Grund f\u00fcr R\u00fcckruf (z.B. 'Termin f\u00fcr Balayage buchen')"
                },
                {
                    "type": "string",
                    "name": "callback_preferred_time",
                    "description": "Bevorzugte R\u00fcckrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag')"
                }
            ],
            "instruction": {
                "type": "prompt",
                "text": "Sammle Callback-Informationen:\n\n**Bereits bekannt:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n\n**Pr\u00fcfe und frage nur wenn fehlt:**\n1. Telefonnummer: \"Unter welcher Nummer k\u00f6nnen wir Sie am besten erreichen?\"\n   \u2192 Setze {{customer_phone}}\n\n2. (Optional) Bevorzugte Zeit: \"Gibt es eine bevorzugte Zeit f\u00fcr den R\u00fcckruf?\"\n   \u2192 Setze {{callback_preferred_time}} (z.B. \"Vormittag\", \"heute Nachmittag\")\n\n**Setze callback_reason automatisch:**\n\u2192 \"Termin f\u00fcr {{service_name}} buchen\"\n\n**Transition:**\nSobald Name + Phone vorhanden \u2192 func_request_callback"
            },
            "name": "Callback-Daten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_request_callback",
                    "id": "edge_collect_callback_to_func",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "All callback data collected: {{customer_name}} AND {{customer_phone}} AND {{callback_reason}}"
                    }
                }
            ],
            "id": "node_collect_callback_info",
            "type": "conversation",
            "display_position": {
                "x": 8800,
                "y": 500
            }
        },
        {
            "tool_id": "tool-request-callback",
            "instruction": {
                "type": "static_text",
                "text": "Perfekt! Ich erstelle Ihre R\u00fcckruf-Anfrage..."
            },
            "name": "Callback-Request erstellen",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "reason": "{{callback_reason}}",
                "phone_number": "{{customer_phone}}",
                "preferred_time": "{{callback_preferred_time}}",
                "customer_name": "{{customer_name}}"
            },
            "edges": [
                {
                    "destination_node_id": "node_callback_confirmation",
                    "id": "edge_callback_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Callback created successfully"
                    }
                }
            ],
            "id": "func_request_callback",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 9350,
                "y": 640
            },
            "wait_for_result": true
        },
        {
            "name": "Callback best\u00e4tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_callback_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_callback_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 9900,
                "y": 610
            },
            "instruction": {
                "type": "prompt",
                "text": "Best\u00e4tige Callback:\n\n\"Wunderbar! Ihre R\u00fcckruf-Anfrage wurde erstellt und automatisch an unser Team zugewiesen.\n\nWir melden uns zeitnah bei Ihnen unter {{customer_phone}} um einen passenden Termin zu vereinbaren.\n\nVielen Dank und einen sch\u00f6nen Tag!\""
            }
        },
        {
            "tool_id": "tool-get-appointments",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich schaue nach Ihren Terminen..."
            },
            "name": "Termine abrufen",
            "edges": [
                {
                    "destination_node_id": "node_show_appointments",
                    "id": "edge_get_to_show",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Appointments retrieved"
                    }
                },
                {
                    "destination_node_id": "node-1762686288875",
                    "id": "edge-1762686241736-xhu3yi3my",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Keine Termine vorhanden"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "id": "func_get_appointments",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 2270.5196994888597,
                "y": 1193.2581415551863
            },
            "wait_for_result": true
        },
        {
            "name": "Termine anzeigen",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_show_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                },
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_show_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to modify a shown appointment"
                    }
                }
            ],
            "id": "node_show_appointments",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 1960
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige maximal zwei Termine dem Kunden und starte mit dem n\u00e4chsten Termin:\n\n**WENN TERMINE VORHANDEN:**\n\"Sie haben folgende Termine: [LISTE MIT DATUM, UHRZEIT, SERVICE]. M\u00f6chten Sie einen davon verschieben oder stornieren?\"\n\n**WENN KEINE TERMINE:**\n\"Sie haben derzeit keine bevorstehenden Termine. M\u00f6chten Sie einen Termin buchen?\""
            }
        },
        {
            "name": "Stornierungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_cancel_appointment",
                    "id": "edge_collect_cancel_to_func",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "ALL variables filled: {{cancel_datum}} AND {{cancel_uhrzeit}}"
                    }
                }
            ],
            "id": "node_collect_cancel_info",
            "type": "conversation",
            "display_position": {
                "x": 8800,
                "y": 2260
            },
            "instruction": {
                "type": "prompt",
                "text": "## WICHTIG: Pr\u00fcfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Datum f\u00fcr Stornierung: {{cancel_datum}}\n- Uhrzeit f\u00fcr Stornierung: {{cancel_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin m\u00f6chte der Kunde stornieren?\n2. **PR\u00dcFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{cancel_datum}} leer \u2192 Frage: \"F\u00fcr welchen Tag m\u00f6chten Sie stornieren?\" (heute\/morgen\/DD.MM.YYYY)\n- Wenn {{cancel_uhrzeit}} leer \u2192 Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n\n**WENN Variable bereits gef\u00fcllt:**\n- \u2705 \u00dcBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich m\u00f6chte meinen Termin morgen um 14 Uhr stornieren\"\n\u2192 cancel_datum = \"morgen\"\n\u2192 cancel_uhrzeit = \"14:00\"\n\u2192 Antworte: \"Verstanden. Einen Moment, ich storniere Ihren Termin...\"\n\u2192 Transition zu func_cancel_appointment\n\n**Transition:**\n- Sobald BEIDE Variablen gef\u00fcllt ({{cancel_datum}} AND {{cancel_uhrzeit}}) \u2192 func_cancel_appointment"
            }
        },
        {
            "tool_id": "tool-cancel-appointment",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich storniere den Termin..."
            },
            "name": "Termin stornieren",
            "edges": [
                {
                    "destination_node_id": "node_cancel_confirmation",
                    "id": "edge_cancel_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Cancellation completed"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "datum": "{{cancel_datum}}",
                "uhrzeit": "{{cancel_uhrzeit}}"
            },
            "id": "func_cancel_appointment",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 9350,
                "y": 2460
            },
            "wait_for_result": true
        },
        {
            "name": "Stornierung best\u00e4tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_cancel_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_cancel_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 9900,
                "y": 2450
            },
            "instruction": {
                "type": "prompt",
                "text": "Best\u00e4tige die Stornierung: 'Ihr Termin wurde storniert. Sie erhalten eine Best\u00e4tigung per E-Mail. Vielen Dank!'"
            }
        },
        {
            "name": "Verschiebungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_reschedule_appointment",
                    "id": "edge_collect_reschedule_to_func",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "ALL variables filled: {{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}"
                    }
                }
            ],
            "id": "node_collect_reschedule_info",
            "type": "conversation",
            "display_position": {
                "x": 8800,
                "y": 1260
            },
            "instruction": {
                "type": "prompt",
                "text": "## WICHTIG: Pr\u00fcfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Alter Termin Datum: {{old_datum}}\n- Alter Termin Uhrzeit: {{old_uhrzeit}}\n- Neuer Termin Datum: {{new_datum}}\n- Neuer Termin Uhrzeit: {{new_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin m\u00f6chte der Kunde verschieben und auf wann?\n2. **PR\u00dcFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{old_datum}} leer \u2192 Frage: \"Welcher Termin soll verschoben werden? An welchem Tag?\" (heute\/morgen\/DD.MM.YYYY)\n- Wenn {{old_uhrzeit}} leer \u2192 Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n- Wenn {{new_datum}} leer \u2192 Frage: \"Auf welchen Tag m\u00f6chten Sie verschieben?\" (heute\/morgen\/DD.MM.YYYY)\n- Wenn {{new_uhrzeit}} leer \u2192 Frage: \"Um welche Uhrzeit?\" (HH:MM)\n\n**WENN Variable bereits gef\u00fcllt:**\n- \u2705 \u00dcBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich m\u00f6chte meinen Termin morgen 14 Uhr auf Donnerstag 16 Uhr verschieben\"\n\u2192 old_datum = \"morgen\"\n\u2192 old_uhrzeit = \"14:00\"\n\u2192 new_datum = \"Donnerstag\"\n\u2192 new_uhrzeit = \"16:00\"\n\u2192 Antworte: \"Perfekt! Einen Moment, ich verschiebe den Termin...\"\n\u2192 Transition zu func_reschedule_appointment\n\n**Transition:**\n- Sobald ALLE 4 Variablen gef\u00fcllt ({{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}) \u2192 func_reschedule_appointment"
            }
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich verschiebe Ihren Termin..."
            },
            "name": "Termin verschieben",
            "edges": [
                {
                    "destination_node_id": "node_reschedule_confirmation",
                    "id": "edge_reschedule_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Rescheduling completed"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "old_uhrzeit": "{{old_uhrzeit}}",
                "old_datum": "{{old_datum}}",
                "new_datum": "{{new_datum}}",
                "new_uhrzeit": "{{new_uhrzeit}}"
            },
            "id": "func_reschedule_appointment",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 9350,
                "y": 1530
            },
            "wait_for_result": true
        },
        {
            "name": "Verschiebung best\u00e4tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_reschedule_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_reschedule_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 9900,
                "y": 1520
            },
            "instruction": {
                "type": "prompt",
                "text": "Best\u00e4tige die Verschiebung: 'Perfekt! Ihr Termin wurde erfolgreich verschoben auf {{new_datum}} um {{new_uhrzeit}} Uhr. Best\u00e4tigung folgt per E-Mail.'"
            }
        },
        {
            "tool_id": "tool-get-services",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich hole die Service-Liste..."
            },
            "name": "Services abrufen",
            "edges": [
                {
                    "destination_node_id": "node_show_services",
                    "id": "edge_get_services_to_show",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Services retrieved"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "global_node_setting": {
                "condition": "Describe the condition to jump to this node"
            },
            "id": "func_get_services",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 2200,
                "y": 2690
            },
            "wait_for_result": true
        },
        {
            "name": "Services anzeigen",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_show_services_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                },
                {
                    "destination_node_id": "node_extract_booking_variables",
                    "id": "edge_show_services_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte einen Termin buchen, nachdem er Informationen zu den Services erhalten hat."
                    }
                }
            ],
            "id": "node_show_services",
            "type": "conversation",
            "display_position": {
                "x": 2764.8064625263055,
                "y": 3491.4355438946804
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige die Services:\n\n\"Wir bieten folgende Services an: [LISTE MIT NAMEN]. M\u00f6chten Sie einen Termin buchen?\""
            }
        },
        {
            "name": "Ende",
            "edges": [],
            "id": "node_end",
            "type": "end",
            "display_position": {
                "x": 10450,
                "y": 1575
            },
            "instruction": {
                "type": "static_text",
                "text": ""
            }
        },
        {
            "name": "Buchung fehlgeschlagen",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_failed_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try again with different time"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_failed_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants callback"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge_failed_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to end call"
                    }
                }
            ],
            "id": "node_booking_failed",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 580
            },
            "instruction": {
                "type": "static_text",
                "text": "Entschuldigung, der Termin konnte leider nicht gebucht werden. M\u00f6chten Sie es mit einem anderen Zeitpunkt versuchen oder soll ich Sie zur\u00fcckrufen lassen?"
            }
        },
        {
            "name": "Fehlenden Namen abfragen",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_retry_booking",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Customer provided the requested information"
                    }
                }
            ],
            "id": "node_collect_missing_data",
            "type": "conversation",
            "display_position": {
                "x": 7150,
                "y": 1160
            },
            "instruction": {
                "type": "prompt",
                "text": "Der vorherige Buchungsversuch ist fehlgeschlagen, weil der Kundenname fehlt. Frage den Kunden nach seinem vollst\u00e4ndigen Namen (Vor- UND Nachname). Beispiel: \"Ihren vollst\u00e4ndigen Namen bitte?\" oder \"Wie ist Ihr Name?\" NICHT nach Telefonnummer oder E-Mail fragen - diese sind optional."
            }
        },
        {
            "name": "Begr\u00fc\u00dfung",
            "edges": [
                {
                    "destination_node_id": "node_extract_booking_variables",
                    "id": "edge-1762686288875-0-j563n3yv5",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Anrufer m\u00f6chte einen Termin buchen"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge-1762686481261-b9gvfur2b",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                }
            ],
            "id": "node-1762686288875",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 2910
            },
            "instruction": {
                "type": "prompt",
                "text": "Erkl\u00e4re den Kunden, dass du keine Termine Die aktuell gebucht zu empfinden kannst. Und frage ihn, ob er einen Termin buchen m\u00f6chte? "
            }
        }
    ],
    "start_node_id": "node_greeting",
    "start_speaker": "agent",
    "begin_after_user_silence_ms": 800,
    "tools": [
        {
            "tool_id": "tool-check-availability",
            "timeout_ms": 15000,
            "name": "check_availability_v17",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "description": "Pr\u00fcft Verf\u00fcgbarkeit f\u00fcr einen Termin",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string",
                        "description": "Kundenname"
                    },
                    "datum": {
                        "type": "string",
                        "description": "Datum: heute, morgen, Montag, oder DD.MM.YYYY"
                    },
                    "dienstleistung": {
                        "type": "string",
                        "description": "Service (z.B. Herrenhaarschnitt)"
                    },
                    "uhrzeit": {
                        "type": "string",
                        "description": "Uhrzeit im Format HH:MM"
                    }
                },
                "required": [
                    "name",
                    "datum",
                    "uhrzeit",
                    "dienstleistung"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-alternatives",
            "timeout_ms": 10000,
            "name": "get_alternatives",
            "description": "Schl\u00e4gt alternative Zeitslots vor wenn Wunschtermin nicht verf\u00fcgbar. Sucht intelligente Alternativen basierend auf Datum, Zeit und Service.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "preferred_time": {
                        "type": "string",
                        "description": "Gew\u00fcnschte Uhrzeit (HH:MM) oder Zeitfenster (Vormittag, Nachmittag)"
                    },
                    "service_name": {
                        "type": "string",
                        "description": "Service f\u00fcr den Alternativen gesucht werden (z.B. Herrenhaarschnitt, Balayage)"
                    },
                    "preferred_date": {
                        "type": "string",
                        "description": "Gew\u00fcnschtes Datum (heute, morgen, Montag, oder DD.MM.YYYY)"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system for context"
                    }
                },
                "required": [
                    "call_id",
                    "service_name",
                    "preferred_date"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-request-callback",
            "timeout_ms": 10000,
            "name": "request_callback",
            "description": "Erstellt Callback-Request mit automatischer Staff-Zuweisung. 100% Success Rate (Fixed 2025-11-06). Fallback-Option wenn kein Termin verf\u00fcgbar.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "reason": {
                        "type": "string",
                        "description": "Grund f\u00fcr R\u00fcckruf (z.B. 'Termin f\u00fcr Balayage buchen', 'Beratung')"
                    },
                    "preferred_time": {
                        "type": "string",
                        "description": "Bevorzugte R\u00fcckrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag', '14-16 Uhr')"
                    },
                    "phone_number": {
                        "type": "string",
                        "description": "Telefonnummer (Format: +49... oder 0...)"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id",
                    "customer_name",
                    "phone_number",
                    "reason"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-appointments",
            "timeout_ms": 15000,
            "name": "get_customer_appointments",
            "description": "Ruft bestehende Termine des Kunden ab",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Optional: Kundenname zur Filterung"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-cancel-appointment",
            "timeout_ms": 15000,
            "name": "cancel_appointment",
            "description": "Storniert einen bestehenden Termin",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "datum": {
                        "type": "string",
                        "description": "Optional: Datum (heute, morgen, oder DD.MM.YYYY)"
                    },
                    "appointment_id": {
                        "type": "string",
                        "description": "Optional: Appointment ID"
                    },
                    "uhrzeit": {
                        "type": "string",
                        "description": "Optional: Uhrzeit HH:MM"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "timeout_ms": 15000,
            "name": "reschedule_appointment",
            "description": "Verschiebt einen Termin auf neues Datum\/Uhrzeit",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "new_uhrzeit": {
                        "type": "string",
                        "description": "Required: Neue Uhrzeit HH:MM"
                    },
                    "appointment_id": {
                        "type": "string",
                        "description": "Optional: Appointment ID"
                    },
                    "old_datum": {
                        "type": "string",
                        "description": "Optional: Altes Datum DD.MM.YYYY"
                    },
                    "old_uhrzeit": {
                        "type": "string",
                        "description": "Optional: Alte Uhrzeit HH:MM"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    },
                    "new_datum": {
                        "type": "string",
                        "description": "Required: Neues Datum (heute, morgen, oder DD.MM.YYYY)"
                    }
                },
                "required": [
                    "call_id",
                    "new_datum",
                    "new_uhrzeit"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-services",
            "timeout_ms": 15000,
            "name": "get_available_services",
            "description": "Listet alle verf\u00fcgbaren Services auf",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-start-booking",
            "timeout_ms": 5000,
            "name": "start_booking",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "description": "Step 1 of 2-step booking: Validates all booking data and returns immediate status (<500ms). Use this BEFORE confirm_booking to provide instant feedback to user. Returns validation status and caches data.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "datetime": {
                        "type": "string",
                        "description": "Appointment date and time in format: DD.MM.YYYY HH:MM (e.g., 06.11.2025 14:00). IMPORTANT: Always use year 2025."
                    },
                    "service": {
                        "type": "string",
                        "description": "Service name (e.g., Herrenhaarschnitt, Damenhaarschnitt, Beratung)"
                    },
                    "function_name": {
                        "type": "string",
                        "description": "Function name: start_booking"
                    },
                    "customer_email": {
                        "type": "string",
                        "description": "Customer email address (optional)"
                    },
                    "customer_phone": {
                        "type": "string",
                        "description": "Customer phone number (format: +49... or 0...)"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Customer full name"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Unique Retell call identifier for session tracking"
                    }
                },
                "required": [
                    "function_name",
                    "call_id",
                    "datetime",
                    "service",
                    "customer_name",
                    "customer_phone"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-confirm-booking",
            "timeout_ms": 30000,
            "name": "confirm_booking",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "description": "Step 2 of 2-step booking: Executes the actual Cal.com booking and database save. Call this IMMEDIATELY AFTER start_booking returns success. Takes 4-5s but user already heard status message.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "function_name": {
                        "type": "string",
                        "description": "Function name: confirm_booking"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Same call_id used in start_booking to retrieve cached booking data"
                    }
                },
                "required": [
                    "function_name",
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-current-context",
            "timeout_ms": 5000,
            "name": "get_current_context",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "description": "Ruft aktuelles Datum, Uhrzeit und Kontext-Informationen ab. Wird automatisch beim Call-Start gecallt um {{current_date}}, {{current_time}}, {{day_name}} zu setzen.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Die Call ID des aktuellen Anrufs"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/current-context"
        }
    ],
    "model_choice": {
        "type": "cascading",
        "model": "gpt-4.1-mini",
        "high_priority": true
    },
    "model_temperature": 0.3,
    "tool_call_strict_mode": false,
    "knowledge_base_ids": [],
    "kb_config": {
        "top_k": 3,
        "filter_score": 0.6
    },
    "begin_tag_display_position": {
        "x": 0,
        "y": 185
    },
    "is_published": false
}