<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/TESTING_STRATEGY/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>AskProAI Testing Strategy - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "AskProAI Testing Strategy";
        var mkdocs_page_input_path = "TESTING_STRATEGY.md";
        var mkdocs_page_url = "/mkdocs/TESTING_STRATEGY/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>AskProAI Testing Strategy</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="askproai-testing-strategy">AskProAI Testing Strategy</h1>
<h2 id="overview">Overview</h2>
<p>This document outlines the comprehensive testing strategy for the AskProAI platform, covering unit tests, integration tests, E2E tests, and performance testing.</p>
<h2 id="test-levels">Test Levels</h2>
<h3 id="1-unit-tests">1. Unit Tests</h3>
<p>Focus on testing individual components in isolation.</p>
<p><strong>Coverage Areas:</strong>
- Services (CalcomV2Service, RetellV2Service, etc.)
- Models and their relationships
- Utilities and helpers
- Validators and formatters</p>
<p><strong>Key Test Files:</strong>
- <code>tests/Unit/CalcomV2ServiceTest.php</code>
- <code>tests/Unit/PhoneNumberValidatorTest.php</code>
- <code>tests/Unit/MockRetellServiceTest.php</code>
- <code>tests/Unit/CriticalFixesUnitTest.php</code></p>
<p><strong>Running Unit Tests:</strong></p>
<pre><code class="language-bash">php artisan test --testsuite=Unit
php artisan test --testsuite=Unit --parallel
</code></pre>
<h3 id="2-integration-tests">2. Integration Tests</h3>
<p>Test interaction between multiple components.</p>
<p><strong>Coverage Areas:</strong>
- Service interactions
- Database transactions
- External API mocking
- Queue job processing</p>
<p><strong>Key Test Files:</strong>
- <code>tests/Integration/BookingServiceIntegrationTest.php</code>
- <code>tests/Integration/WebhookProcessingTest.php</code>
- <code>tests/Integration/CalcomIntegrationTest.php</code></p>
<p><strong>Running Integration Tests:</strong></p>
<pre><code class="language-bash">php artisan test --testsuite=Integration
</code></pre>
<h3 id="3-end-to-end-e2e-tests">3. End-to-End (E2E) Tests</h3>
<p>Test complete user workflows from start to finish.</p>
<p><strong>Coverage Areas:</strong>
- Complete booking flow (phone → appointment)
- Webhook processing chains
- Multi-step processes
- Error scenarios</p>
<p><strong>Key Test Files:</strong>
- <code>tests/E2E/BookingFlowCalcomV2E2ETest.php</code>
- <code>tests/E2E/PhoneToAppointmentFlowTest.php</code>
- <code>tests/E2E/ConcurrentBookingStressTest.php</code></p>
<p><strong>Running E2E Tests:</strong></p>
<pre><code class="language-bash">php artisan test --testsuite=E2E
</code></pre>
<h3 id="4-performance-tests">4. Performance Tests</h3>
<p>Ensure system meets performance requirements.</p>
<p><strong>Coverage Areas:</strong>
- Concurrent request handling
- Database query performance
- API response times
- Memory usage</p>
<p><strong>Key Test Files:</strong>
- <code>tests/E2E/ConcurrentBookingStressTest.php</code>
- Performance assertions in E2E tests</p>
<p><strong>Running Performance Tests:</strong></p>
<pre><code class="language-bash">php artisan test --filter=performance
</code></pre>
<h2 id="test-data-strategy">Test Data Strategy</h2>
<h3 id="1-factories">1. Factories</h3>
<p>Use Laravel factories for consistent test data generation.</p>
<pre><code class="language-php">// Create test company with branches
$company = Company::factory()
    -&gt;has(Branch::factory()-&gt;count(3))
    -&gt;has(Staff::factory()-&gt;count(5))
    -&gt;create();
</code></pre>
<h3 id="2-seeders">2. Seeders</h3>
<p>Special seeders for test environments:
- <code>TestDataSeeder</code> - Basic test data
- <code>PerformanceTestSeeder</code> - Large datasets
- <code>E2ETestSeeder</code> - Complete scenarios</p>
<h3 id="3-mock-services">3. Mock Services</h3>
<p>Replace external services with mocks:
- <code>MockCalcomV2Client</code> - Cal.com API mock
- <code>MockRetellService</code> - Retell.ai API mock
- <code>Mail::fake()</code> - Email testing
- <code>Queue::fake()</code> - Queue testing</p>
<h2 id="test-environment-configuration">Test Environment Configuration</h2>
<h3 id="phpunit-configuration">PHPUnit Configuration</h3>
<pre><code class="language-xml">&lt;phpunit&gt;
    &lt;testsuites&gt;
        &lt;testsuite name=&quot;Unit&quot;&gt;
            &lt;directory&gt;tests/Unit&lt;/directory&gt;
        &lt;/testsuite&gt;
        &lt;testsuite name=&quot;Integration&quot;&gt;
            &lt;directory&gt;tests/Integration&lt;/directory&gt;
        &lt;/testsuite&gt;
        &lt;testsuite name=&quot;Feature&quot;&gt;
            &lt;directory&gt;tests/Feature&lt;/directory&gt;
        &lt;/testsuite&gt;
        &lt;testsuite name=&quot;E2E&quot;&gt;
            &lt;directory&gt;tests/E2E&lt;/directory&gt;
        &lt;/testsuite&gt;
    &lt;/testsuites&gt;
    &lt;php&gt;
        &lt;env name=&quot;APP_ENV&quot; value=&quot;testing&quot;/&gt;
        &lt;env name=&quot;DB_CONNECTION&quot; value=&quot;sqlite&quot;/&gt;
        &lt;env name=&quot;DB_DATABASE&quot; value=&quot;:memory:&quot;/&gt;
        &lt;env name=&quot;QUEUE_CONNECTION&quot; value=&quot;sync&quot;/&gt;
        &lt;env name=&quot;CACHE_DRIVER&quot; value=&quot;array&quot;/&gt;
    &lt;/php&gt;
&lt;/phpunit&gt;
</code></pre>
<h3 id="test-database">Test Database</h3>
<ul>
<li>SQLite in-memory for speed</li>
<li>Migrations run before each test</li>
<li>Transaction rollback after each test</li>
</ul>
<h2 id="mock-strategy">Mock Strategy</h2>
<h3 id="external-apis">External APIs</h3>
<p>All external APIs should be mocked in tests:</p>
<pre><code class="language-php">// Mock Cal.com API
$this-&gt;app-&gt;bind(CalcomV2Client::class, function () {
    return new MockCalcomV2Client();
});

// Mock Retell API
$this-&gt;app-&gt;bind(RetellV2Service::class, function () {
    return new MockRetellService();
});
</code></pre>
<h3 id="time-based-testing">Time-based Testing</h3>
<p>Use Carbon's test helpers:</p>
<pre><code class="language-php">// Freeze time
Carbon::setTestNow('2024-01-15 10:00:00');

// Travel to future
$this-&gt;travel(5)-&gt;minutes();
</code></pre>
<h2 id="continuous-integration">Continuous Integration</h2>
<h3 id="github-actions-workflow">GitHub Actions Workflow</h3>
<pre><code class="language-yaml">name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
      - name: Install Dependencies
        run: composer install
      - name: Run Tests
        run: php artisan test --parallel
      - name: Upload Coverage
        uses: codecov/codecov-action@v1
</code></pre>
<h3 id="pre-commit-hooks">Pre-commit Hooks</h3>
<pre><code class="language-bash">#!/bin/sh
# .git/hooks/pre-commit

# Run tests before commit
php artisan test --testsuite=Unit --stop-on-failure

# Check code style
./vendor/bin/pint --test
</code></pre>
<h2 id="test-scenarios">Test Scenarios</h2>
<h3 id="critical-business-flows">Critical Business Flows</h3>
<h4 id="1-appointment-booking-flow">1. Appointment Booking Flow</h4>
<pre><code>1. Receive Retell webhook (call ended)
2. Extract customer information
3. Check availability via Cal.com
4. Create appointment
5. Send confirmation email
</code></pre>
<h4 id="2-webhook-deduplication">2. Webhook Deduplication</h4>
<pre><code>1. Receive duplicate webhook
2. Check Redis for existing key
3. Return cached response
4. Verify no duplicate processing
</code></pre>
<h4 id="3-multi-tenancy-isolation">3. Multi-Tenancy Isolation</h4>
<pre><code>1. Create data for Company A
2. Create data for Company B
3. Verify Company A cannot access Company B data
4. Test with different user contexts
</code></pre>
<h3 id="error-scenarios">Error Scenarios</h3>
<h4 id="1-external-api-failures">1. External API Failures</h4>
<ul>
<li>Cal.com timeout</li>
<li>Retell.ai rate limit</li>
<li>Network errors</li>
<li>Invalid responses</li>
</ul>
<h4 id="2-data-integrity">2. Data Integrity</h4>
<ul>
<li>Concurrent bookings</li>
<li>Race conditions</li>
<li>Transaction rollbacks</li>
<li>Lock timeouts</li>
</ul>
<h4 id="3-security">3. Security</h4>
<ul>
<li>Invalid signatures</li>
<li>Unauthorized access</li>
<li>SQL injection attempts</li>
<li>XSS prevention</li>
</ul>
<h2 id="performance-benchmarks">Performance Benchmarks</h2>
<h3 id="response-time-targets">Response Time Targets</h3>
<ul>
<li>API endpoints: &lt; 200ms (p95)</li>
<li>Webhook processing: &lt; 100ms</li>
<li>Database queries: &lt; 50ms</li>
<li>External API calls: &lt; 2s with timeout</li>
</ul>
<h3 id="load-testing">Load Testing</h3>
<pre><code class="language-bash"># Using Apache Bench
ab -n 1000 -c 10 https://api.askproai.de/api/health

# Using Locust
locust -f tests/LoadTests/booking_flow.py --host=https://api.askproai.de
</code></pre>
<h2 id="test-maintenance">Test Maintenance</h2>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Keep tests fast</strong>: Use mocks, avoid sleep()</li>
<li><strong>Keep tests isolated</strong>: No dependencies between tests</li>
<li><strong>Keep tests readable</strong>: Clear names, arrange-act-assert</li>
<li><strong>Keep tests maintainable</strong>: Use factories, avoid hardcoded values</li>
</ol>
<h3 id="regular-tasks">Regular Tasks</h3>
<ul>
<li>Weekly: Review failing tests</li>
<li>Monthly: Update test data</li>
<li>Quarterly: Performance baseline update</li>
<li>Yearly: Test strategy review</li>
</ul>
<h2 id="debugging-failed-tests">Debugging Failed Tests</h2>
<h3 id="local-debugging">Local Debugging</h3>
<pre><code class="language-bash"># Run specific test with details
php artisan test --filter=test_can_book_appointment -vvv

# Stop on first failure
php artisan test --stop-on-failure

# With Xdebug
XDEBUG_MODE=debug php artisan test
</code></pre>
<h3 id="ci-debugging">CI Debugging</h3>
<ul>
<li>Check GitHub Actions logs</li>
<li>Download artifacts</li>
<li>Re-run with SSH access</li>
<li>Use <code>ray()</code> for debugging</li>
</ul>
<h2 id="coverage-requirements">Coverage Requirements</h2>
<h3 id="minimum-coverage">Minimum Coverage</h3>
<ul>
<li>Overall: 80%</li>
<li>Critical paths: 95%</li>
<li>New code: 90%</li>
</ul>
<h3 id="coverage-reports">Coverage Reports</h3>
<pre><code class="language-bash"># Generate HTML report
php artisan test --coverage-html coverage

# Generate Clover report
php artisan test --coverage-clover coverage.xml
</code></pre>
<h2 id="testing-checklist">Testing Checklist</h2>
<h3 id="before-deployment">Before Deployment</h3>
<ul>
<li>[ ] All tests passing</li>
<li>[ ] Coverage meets requirements</li>
<li>[ ] Performance tests pass</li>
<li>[ ] Security tests pass</li>
<li>[ ] E2E tests pass</li>
<li>[ ] No console.log or dd() statements</li>
<li>[ ] Mocks disabled for production</li>
</ul>
<h3 id="after-deployment">After Deployment</h3>
<ul>
<li>[ ] Smoke tests pass</li>
<li>[ ] Health checks green</li>
<li>[ ] No error spike in logs</li>
<li>[ ] Performance metrics normal</li>
</ul>
<hr />
<p><em>Last Updated: 2025-06-17</em></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
