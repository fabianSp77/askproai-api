<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/CALCOM_V2_API_DOCUMENTATION/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Cal.com V2 API Integration Documentation - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Cal.com V2 API Integration Documentation";
        var mkdocs_page_input_path = "CALCOM_V2_API_DOCUMENTATION.md";
        var mkdocs_page_url = "/mkdocs/CALCOM_V2_API_DOCUMENTATION/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Cal.com V2 API Integration Documentation</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="calcom-v2-api-integration-documentation">Cal.com V2 API Integration Documentation</h1>
<h2 id="overview">Overview</h2>
<p>This document describes the production-ready Cal.com V2 API integration for AskProAI. The integration provides a robust, scalable, and fault-tolerant solution for managing calendar bookings through Cal.com's latest API version.</p>
<h2 id="key-features">Key Features</h2>
<ul>
<li>✅ <strong>Full V2 API Support</strong>: All major endpoints implemented</li>
<li>✅ <strong>Circuit Breaker Pattern</strong>: Automatic fault tolerance</li>
<li>✅ <strong>Retry Logic</strong>: Exponential backoff for transient failures</li>
<li>✅ <strong>Response Caching</strong>: Redis-based caching for performance</li>
<li>✅ <strong>Type Safety</strong>: DTOs for all API responses</li>
<li>✅ <strong>Structured Logging</strong>: Comprehensive request/response logging</li>
<li>✅ <strong>Error Handling</strong>: Custom exceptions for different error types</li>
<li>✅ <strong>Health Monitoring</strong>: Built-in health check endpoint</li>
<li>✅ <strong>Metrics Collection</strong>: Performance and reliability metrics</li>
</ul>
<h2 id="architecture">Architecture</h2>
<h3 id="core-components">Core Components</h3>
<ol>
<li><strong>CalcomV2Client</strong>: Low-level API client with all HTTP operations</li>
<li><strong>CalcomV2Service</strong>: High-level service integrating with domain models</li>
<li><strong>DTOs</strong>: Type-safe data transfer objects</li>
<li><strong>Exceptions</strong>: Specific exception classes for error handling</li>
<li><strong>Controllers</strong>: HTTP endpoints for health checks</li>
</ol>
<h3 id="class-structure">Class Structure</h3>
<pre><code>app/Services/Calcom/
├── CalcomV2Client.php          # Core API client
├── CalcomV2Service.php         # Business logic service
├── DTOs/
│   ├── BaseDTO.php            # Base DTO class
│   ├── EventTypeDTO.php       # Event type data
│   ├── SlotDTO.php            # Available slot data
│   ├── BookingDTO.php         # Booking data
│   ├── AttendeeDTO.php        # Attendee data
│   └── ScheduleDTO.php        # Schedule data
└── Exceptions/
    ├── CalcomApiException.php          # Base exception
    ├── CalcomAuthenticationException.php
    ├── CalcomRateLimitException.php
    └── CalcomValidationException.php
</code></pre>
<h2 id="api-endpoints">API Endpoints</h2>
<h3 id="event-types">Event Types</h3>
<pre><code class="language-php">// Get all event types
$client-&gt;getEventTypes(array $filters = []): array

// Filters:
// - userId: Filter by user ID
// - teamId: Filter by team ID
// - active: Filter active/inactive
</code></pre>
<h3 id="schedules">Schedules</h3>
<pre><code class="language-php">// Get all schedules
$client-&gt;getSchedules(array $filters = []): array
</code></pre>
<h3 id="available-slots">Available Slots</h3>
<pre><code class="language-php">// Get available time slots
$client-&gt;getAvailableSlots(array $params): array

// Required params:
// - startTime: ISO 8601 datetime
// - endTime: ISO 8601 datetime
// - eventTypeId OR eventTypeSlug
// 
// Optional params:
// - timeZone: Timezone for slots (default: UTC)
// - duration: Override event type duration
</code></pre>
<h3 id="bookings">Bookings</h3>
<pre><code class="language-php">// Create a new booking
$client-&gt;createBooking(array $data): BookingDTO

// Required data:
// - start: ISO 8601 datetime
// - eventTypeId: Event type ID
// - responses: Array with name and email
// - metadata: Additional metadata
//
// Optional data:
// - timeZone: Attendee timezone
// - language: Preferred language
// - location: Meeting location

// Get all bookings
$client-&gt;getBookings(array $filters = []): array

// Get single booking
$client-&gt;getBooking(string $uid): BookingDTO

// Reschedule booking
$client-&gt;rescheduleBooking(string $uid, array $data): BookingDTO

// Cancel booking
$client-&gt;cancelBooking(string $uid, array $data = []): array
</code></pre>
<h2 id="usage-examples">Usage Examples</h2>
<h3 id="basic-usage">Basic Usage</h3>
<pre><code class="language-php">use App\Services\Calcom\CalcomV2Client;

// Initialize client
$client = new CalcomV2Client('your-api-key');

// Get event types
$eventTypes = $client-&gt;getEventTypes();

// Get available slots
$slots = $client-&gt;getAvailableSlots([
    'startTime' =&gt; '2024-01-15T00:00:00Z',
    'endTime' =&gt; '2024-01-16T00:00:00Z',
    'eventTypeId' =&gt; 123
]);

// Create booking
$booking = $client-&gt;createBooking([
    'start' =&gt; '2024-01-15T10:00:00Z',
    'eventTypeId' =&gt; 123,
    'responses' =&gt; [
        'name' =&gt; 'John Doe',
        'email' =&gt; 'john@example.com',
        'phone' =&gt; '+1234567890'
    ],
    'metadata' =&gt; [
        'source' =&gt; 'askproai'
    ]
]);
</code></pre>
<h3 id="service-layer-usage">Service Layer Usage</h3>
<pre><code class="language-php">use App\Services\Calcom\CalcomV2Service;
use App\Models\Company;

// Initialize service with company
$company = Company::find(1);
$service = new CalcomV2Service($company);

// Get event types as DTOs
$eventTypes = $service-&gt;getEventTypes();

// Check availability
$isAvailable = $service-&gt;checkAvailability(
    eventTypeId: 123,
    requestedTime: now()-&gt;addDay()-&gt;setTime(10, 0),
    staffId: 456
);

// Create booking from appointment
$booking = $service-&gt;createBookingFromAppointment($appointment);

// Sync bookings from Cal.com
$syncedCount = $service-&gt;syncBookings(
    from: now()-&gt;subDays(7),
    to: now()-&gt;addDays(30)
);
</code></pre>
<h2 id="error-handling">Error Handling</h2>
<h3 id="exception-types">Exception Types</h3>
<ol>
<li><strong>CalcomApiException</strong>: Base exception for all API errors</li>
<li><strong>CalcomAuthenticationException</strong>: 401 authentication failures</li>
<li><strong>CalcomRateLimitException</strong>: 429 rate limit errors</li>
<li><strong>CalcomValidationException</strong>: 422 validation errors</li>
</ol>
<h3 id="error-handling-example">Error Handling Example</h3>
<pre><code class="language-php">try {
    $booking = $client-&gt;createBooking($data);
} catch (CalcomAuthenticationException $e) {
    // Handle authentication error
    Log::error('Cal.com authentication failed: ' . $e-&gt;getMessage());
} catch (CalcomValidationException $e) {
    // Handle validation errors
    $errors = $e-&gt;getErrorMessages();
    Log::error('Validation failed: ' . implode(', ', $errors));
} catch (CalcomRateLimitException $e) {
    // Handle rate limiting
    $retryAfter = $e-&gt;getRetryAfter();
    Log::warning(&quot;Rate limited. Retry after {$retryAfter} seconds&quot;);
} catch (CalcomApiException $e) {
    // Handle other API errors
    Log::error('Cal.com API error: ' . $e-&gt;getMessage());
}
</code></pre>
<h2 id="caching">Caching</h2>
<h3 id="cache-configuration">Cache Configuration</h3>
<ul>
<li><strong>Event Types</strong>: 5 minutes TTL</li>
<li><strong>Schedules</strong>: 5 minutes TTL</li>
<li><strong>Available Slots</strong>: 1 minute TTL</li>
<li><strong>Bookings</strong>: No caching (always fresh)</li>
</ul>
<h3 id="cache-management">Cache Management</h3>
<pre><code class="language-php">// Cache is automatically managed by the client
// Manual cache clearing:
Cache::tags(['calcom_slots'])-&gt;flush();

// Cache warmup command:
php artisan calcom:cache-warmup
</code></pre>
<h2 id="circuit-breaker">Circuit Breaker</h2>
<p>The circuit breaker protects against cascading failures:</p>
<ul>
<li><strong>Closed State</strong>: Normal operation</li>
<li><strong>Open State</strong>: Fails fast after threshold exceeded</li>
<li><strong>Half-Open State</strong>: Limited requests to test recovery</li>
</ul>
<h3 id="configuration">Configuration</h3>
<pre><code class="language-php">// Default thresholds
const FAILURE_THRESHOLD = 5;     // Failures before opening
const SUCCESS_THRESHOLD = 2;     // Successes to close
const TIMEOUT = 60;              // Seconds before half-open
</code></pre>
<h2 id="health-monitoring">Health Monitoring</h2>
<h3 id="health-check-endpoint">Health Check Endpoint</h3>
<pre><code class="language-bash">GET /api/health/calcom
</code></pre>
<p>Response:</p>
<pre><code class="language-json">{
    &quot;service&quot;: &quot;cal.com&quot;,
    &quot;status&quot;: &quot;healthy&quot;,
    &quot;timestamp&quot;: &quot;2024-01-15T10:00:00Z&quot;,
    &quot;details&quot;: {
        &quot;response_time_ms&quot;: 245,
        &quot;circuit_breaker&quot;: {
            &quot;state&quot;: &quot;closed&quot;,
            &quot;failure_count&quot;: 0,
            &quot;success_count&quot;: 150
        },
        &quot;api_version&quot;: &quot;2024-08-13&quot;,
        &quot;cache_ttls&quot;: {
            &quot;event_types_ttl&quot;: 300,
            &quot;schedules_ttl&quot;: 300,
            &quot;slots_ttl&quot;: 60
        }
    }
}
</code></pre>
<h3 id="metrics">Metrics</h3>
<pre><code class="language-php">// Get client metrics
$metrics = $client-&gt;getMetrics();

// Returns:
[
    'circuit_breaker' =&gt; [
        'state' =&gt; 'closed',
        'failure_count' =&gt; 0,
        'success_count' =&gt; 1000,
        'last_failure_time' =&gt; null
    ],
    'cache' =&gt; [
        'event_types_ttl' =&gt; 300,
        'schedules_ttl' =&gt; 300,
        'slots_ttl' =&gt; 60
    ],
    'api_version' =&gt; '2024-08-13'
]
</code></pre>
<h2 id="testing">Testing</h2>
<h3 id="unit-tests">Unit Tests</h3>
<pre><code class="language-bash"># Run Cal.com V2 client tests
php artisan test --filter CalcomV2ClientTest
</code></pre>
<h3 id="integration-tests">Integration Tests</h3>
<pre><code class="language-bash"># Run integration tests
php artisan test --filter CalcomV2ClientIntegrationTest --group integration
</code></pre>
<h3 id="test-coverage">Test Coverage</h3>
<ul>
<li>✅ All API endpoints</li>
<li>✅ Error handling scenarios</li>
<li>✅ Circuit breaker behavior</li>
<li>✅ Caching functionality</li>
<li>✅ Concurrent booking handling</li>
<li>✅ Timezone conversions</li>
<li>✅ Pagination support</li>
</ul>
<h2 id="migration-from-v1">Migration from V1</h2>
<h3 id="key-differences">Key Differences</h3>
<ol>
<li><strong>API Version</strong>: Uses V2 endpoints exclusively</li>
<li><strong>Response Format</strong>: Responses wrapped in <code>data</code> key</li>
<li><strong>Booking Creation</strong>: Different parameter structure</li>
<li><strong>Error Responses</strong>: Standardized error format</li>
</ol>
<h3 id="migration-steps">Migration Steps</h3>
<ol>
<li>Update service initialization:</li>
</ol>
<pre><code class="language-php">// Old
$service = new CalcomService();

// New
$service = new CalcomV2Service();
</code></pre>
<ol>
<li>Update booking creation:</li>
</ol>
<pre><code class="language-php">// Old
$service-&gt;createBooking($eventTypeId, $start, $end, $attendee);

// New
$service-&gt;createBookingFromAppointment($appointment);
</code></pre>
<ol>
<li>Update error handling to use new exception types</li>
</ol>
<h2 id="performance-optimization">Performance Optimization</h2>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Use Caching</strong>: Leverage built-in caching for repeated queries</li>
<li><strong>Batch Operations</strong>: Group related API calls</li>
<li><strong>Async Processing</strong>: Use queues for non-critical operations</li>
<li><strong>Monitor Metrics</strong>: Track circuit breaker state and response times</li>
</ol>
<h3 id="cache-warmup">Cache Warmup</h3>
<pre><code class="language-bash"># Warm up caches for all companies
php artisan calcom:cache-warmup

# Warm up specific company
php artisan calcom:cache-warmup --company=1
</code></pre>
<h2 id="security">Security</h2>
<h3 id="api-key-management">API Key Management</h3>
<ul>
<li>Store API keys encrypted in database</li>
<li>Use environment variables for defaults</li>
<li>Rotate keys regularly</li>
<li>Monitor for authentication failures</li>
</ul>
<h3 id="request-sanitization">Request Sanitization</h3>
<p>Sensitive data is automatically redacted in logs:
- Email addresses
- Phone numbers
- Personal notes</p>
<h2 id="troubleshooting">Troubleshooting</h2>
<h3 id="common-issues">Common Issues</h3>
<ol>
<li><strong>Authentication Failures</strong></li>
<li>Check API key validity</li>
<li>Verify Cal.com account status</li>
<li>
<p>Check rate limits</p>
</li>
<li>
<p><strong>Booking Failures</strong></p>
</li>
<li>Validate required fields</li>
<li>Check slot availability</li>
<li>
<p>Verify event type configuration</p>
</li>
<li>
<p><strong>Circuit Breaker Open</strong></p>
</li>
<li>Check Cal.com API status</li>
<li>Review error logs</li>
<li>Wait for timeout period</li>
</ol>
<h3 id="debug-mode">Debug Mode</h3>
<p>Enable detailed logging:</p>
<pre><code class="language-php">// In CalcomV2Client
$this-&gt;logger-&gt;setLevel('debug');
</code></pre>
<h2 id="support">Support</h2>
<p>For issues or questions:
1. Check error logs in <code>storage/logs/laravel.log</code>
2. Review health check endpoint
3. Monitor metrics dashboard
4. Contact system administrator</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
