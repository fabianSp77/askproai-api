<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/integrations/whatsapp/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>WhatsApp Integration - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "WhatsApp Integration";
        var mkdocs_page_input_path = "docs/integrations/whatsapp.md";
        var mkdocs_page_url = "/mkdocs/docs/integrations/whatsapp/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>WhatsApp Integration</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="whatsapp-integration">WhatsApp Integration</h1>
<h2 id="overview">Overview</h2>
<p>WhatsApp integration allows AskProAI to send appointment confirmations, reminders, and enable two-way communication with customers via WhatsApp Business API.</p>
<h2 id="status">Status</h2>
<p>⚠️ <strong>Note</strong>: WhatsApp integration is planned but not yet implemented. This documentation outlines the planned implementation.</p>
<h2 id="planned-features">Planned Features</h2>
<h3 id="messaging-capabilities">Messaging Capabilities</h3>
<ul>
<li>Appointment confirmations</li>
<li>Reminder notifications (24h, 1h before)</li>
<li>Rescheduling requests</li>
<li>Two-way chat support</li>
<li>Rich media messages (location maps, documents)</li>
</ul>
<h3 id="whatsapp-business-api-setup">WhatsApp Business API Setup</h3>
<h4 id="prerequisites">Prerequisites</h4>
<pre><code class="language-yaml">requirements:
  - WhatsApp Business Account
  - Facebook Business Manager
  - Verified Business
  - Approved Message Templates
  - Phone Number (not used for WhatsApp before)
</code></pre>
<h4 id="configuration">Configuration</h4>
<pre><code class="language-bash"># Environment Variables
WHATSAPP_API_URL=https://graph.facebook.com/v17.0
WHATSAPP_PHONE_NUMBER_ID=1234567890
WHATSAPP_BUSINESS_ACCOUNT_ID=987654321
WHATSAPP_ACCESS_TOKEN=EAAxxxxxxxxxxxxx
WHATSAPP_WEBHOOK_VERIFY_TOKEN=your-verify-token
</code></pre>
<h2 id="message-templates">Message Templates</h2>
<h3 id="appointment-confirmation-template">Appointment Confirmation Template</h3>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;appointment_confirmation_de&quot;,
  &quot;language&quot;: &quot;de&quot;,
  &quot;category&quot;: &quot;TRANSACTIONAL&quot;,
  &quot;components&quot;: [
    {
      &quot;type&quot;: &quot;HEADER&quot;,
      &quot;format&quot;: &quot;TEXT&quot;,
      &quot;text&quot;: &quot;Terminbestätigung&quot;
    },
    {
      &quot;type&quot;: &quot;BODY&quot;,
      &quot;text&quot;: &quot;Hallo {{1}}, Ihr Termin bei {{2}} wurde bestätigt:\n\n📅 Datum: {{3}}\n⏰ Zeit: {{4}}\n📍 Ort: {{5}}\n\nBitte antworten Sie mit 'JA' zur Bestätigung oder 'NEIN' zum Stornieren.&quot;
    },
    {
      &quot;type&quot;: &quot;FOOTER&quot;,
      &quot;text&quot;: &quot;AskProAI - Ihr digitaler Assistent&quot;
    }
  ]
}
</code></pre>
<h3 id="reminder-template">Reminder Template</h3>
<pre><code class="language-json">{
  &quot;name&quot;: &quot;appointment_reminder_de&quot;,
  &quot;language&quot;: &quot;de&quot;,
  &quot;category&quot;: &quot;TRANSACTIONAL&quot;,
  &quot;components&quot;: [
    {
      &quot;type&quot;: &quot;BODY&quot;,
      &quot;text&quot;: &quot;Erinnerung: Sie haben morgen um {{1}} einen Termin bei {{2}}. Adresse: {{3}}&quot;
    }
  ]
}
</code></pre>
<h2 id="implementation-architecture">Implementation Architecture</h2>
<h3 id="service-layer">Service Layer</h3>
<pre><code class="language-php">namespace App\Services;

class WhatsAppService
{
    private $client;
    private $phoneNumberId;

    public function __construct()
    {
        $this-&gt;client = new \GuzzleHttp\Client([
            'base_uri' =&gt; config('services.whatsapp.api_url'),
            'headers' =&gt; [
                'Authorization' =&gt; 'Bearer ' . config('services.whatsapp.access_token'),
                'Content-Type' =&gt; 'application/json'
            ]
        ]);

        $this-&gt;phoneNumberId = config('services.whatsapp.phone_number_id');
    }

    public function sendTemplate(string $to, string $template, array $parameters)
    {
        $response = $this-&gt;client-&gt;post(&quot;/{$this-&gt;phoneNumberId}/messages&quot;, [
            'json' =&gt; [
                'messaging_product' =&gt; 'whatsapp',
                'to' =&gt; $this-&gt;formatPhoneNumber($to),
                'type' =&gt; 'template',
                'template' =&gt; [
                    'name' =&gt; $template,
                    'language' =&gt; ['code' =&gt; 'de'],
                    'components' =&gt; $this-&gt;buildComponents($parameters)
                ]
            ]
        ]);

        return json_decode($response-&gt;getBody(), true);
    }

    public function sendMessage(string $to, string $message)
    {
        $response = $this-&gt;client-&gt;post(&quot;/{$this-&gt;phoneNumberId}/messages&quot;, [
            'json' =&gt; [
                'messaging_product' =&gt; 'whatsapp',
                'to' =&gt; $this-&gt;formatPhoneNumber($to),
                'type' =&gt; 'text',
                'text' =&gt; ['body' =&gt; $message]
            ]
        ]);

        return json_decode($response-&gt;getBody(), true);
    }
}
</code></pre>
<h3 id="webhook-handler">Webhook Handler</h3>
<pre><code class="language-php">class WhatsAppWebhookController extends Controller
{
    public function verify(Request $request)
    {
        $verifyToken = config('services.whatsapp.webhook_verify_token');

        if ($request-&gt;get('hub_verify_token') === $verifyToken) {
            return response($request-&gt;get('hub_challenge'));
        }

        abort(403);
    }

    public function handle(Request $request)
    {
        $data = $request-&gt;all();

        foreach ($data['entry'] as $entry) {
            foreach ($entry['changes'] as $change) {
                if ($change['field'] === 'messages') {
                    $this-&gt;processMessage($change['value']);
                }
            }
        }

        return response('EVENT_RECEIVED');
    }

    private function processMessage($value)
    {
        if (!isset($value['messages'])) {
            return;
        }

        foreach ($value['messages'] as $message) {
            ProcessWhatsAppMessage::dispatch($message);
        }
    }
}
</code></pre>
<h2 id="message-processing">Message Processing</h2>
<h3 id="appointment-confirmation-flow">Appointment Confirmation Flow</h3>
<pre><code class="language-php">class SendWhatsAppConfirmation extends Job
{
    public function handle()
    {
        $whatsapp = app(WhatsAppService::class);

        $parameters = [
            $this-&gt;appointment-&gt;customer-&gt;name,
            $this-&gt;appointment-&gt;branch-&gt;name,
            $this-&gt;appointment-&gt;date-&gt;format('d.m.Y'),
            $this-&gt;appointment-&gt;time-&gt;format('H:i'),
            $this-&gt;appointment-&gt;branch-&gt;full_address
        ];

        $whatsapp-&gt;sendTemplate(
            $this-&gt;appointment-&gt;customer-&gt;phone,
            'appointment_confirmation_de',
            $parameters
        );

        // Log message
        WhatsAppMessage::create([
            'appointment_id' =&gt; $this-&gt;appointment-&gt;id,
            'customer_id' =&gt; $this-&gt;appointment-&gt;customer_id,
            'type' =&gt; 'template',
            'template' =&gt; 'appointment_confirmation_de',
            'status' =&gt; 'sent',
            'sent_at' =&gt; now()
        ]);
    }
}
</code></pre>
<h3 id="interactive-messages">Interactive Messages</h3>
<pre><code class="language-php">// Send interactive button message
$whatsapp-&gt;sendInteractive($to, [
    'type' =&gt; 'button',
    'body' =&gt; [
        'text' =&gt; 'Möchten Sie Ihren Termin bestätigen?'
    ],
    'action' =&gt; [
        'buttons' =&gt; [
            ['type' =&gt; 'reply', 'reply' =&gt; ['id' =&gt; 'confirm', 'title' =&gt; 'Bestätigen']],
            ['type' =&gt; 'reply', 'reply' =&gt; ['id' =&gt; 'cancel', 'title' =&gt; 'Stornieren']],
            ['type' =&gt; 'reply', 'reply' =&gt; ['id' =&gt; 'reschedule', 'title' =&gt; 'Verschieben']]
        ]
    ]
]);
</code></pre>
<h2 id="opt-in-management">Opt-in Management</h2>
<h3 id="customer-preferences">Customer Preferences</h3>
<pre><code class="language-php">Schema::table('customers', function (Blueprint $table) {
    $table-&gt;boolean('whatsapp_opted_in')-&gt;default(false);
    $table-&gt;timestamp('whatsapp_opted_in_at')-&gt;nullable();
    $table-&gt;string('whatsapp_number')-&gt;nullable();
});
</code></pre>
<h3 id="opt-in-flow">Opt-in Flow</h3>
<pre><code class="language-php">class WhatsAppOptInService
{
    public function requestOptIn(Customer $customer)
    {
        // Send opt-in request via SMS or email
        $message = &quot;Möchten Sie Terminerinnerungen per WhatsApp erhalten? 
                   Antworten Sie mit JA auf diese Nachricht.&quot;;

        app(SMSService::class)-&gt;send($customer-&gt;phone, $message);
    }

    public function processOptIn(string $phone, bool $accepted)
    {
        $customer = Customer::where('phone', $phone)-&gt;first();

        if ($customer &amp;&amp; $accepted) {
            $customer-&gt;update([
                'whatsapp_opted_in' =&gt; true,
                'whatsapp_opted_in_at' =&gt; now(),
                'whatsapp_number' =&gt; $phone
            ]);

            // Send welcome message
            app(WhatsAppService::class)-&gt;sendTemplate(
                $phone,
                'welcome_whatsapp',
                [$customer-&gt;name]
            );
        }
    }
}
</code></pre>
<h2 id="conversation-management">Conversation Management</h2>
<h3 id="two-way-communication">Two-Way Communication</h3>
<pre><code class="language-php">class WhatsAppConversation extends Model
{
    protected $fillable = [
        'customer_id',
        'appointment_id',
        'status', // open, closed
        'last_message_at',
        'assigned_to' // staff member handling conversation
    ];

    public function messages()
    {
        return $this-&gt;hasMany(WhatsAppMessage::class);
    }
}
</code></pre>
<h3 id="auto-response-system">Auto-Response System</h3>
<pre><code class="language-php">class WhatsAppAutoResponder
{
    private $patterns = [
        '/termin|appointment/i' =&gt; 'appointment_query',
        '/stornieren|cancel/i' =&gt; 'cancellation_request',
        '/verschieben|reschedule/i' =&gt; 'reschedule_request',
        '/öffnungszeiten|hours/i' =&gt; 'business_hours',
        '/adresse|location/i' =&gt; 'location_info'
    ];

    public function processMessage($message)
    {
        foreach ($this-&gt;patterns as $pattern =&gt; $intent) {
            if (preg_match($pattern, $message['text']['body'])) {
                return $this-&gt;handleIntent($intent, $message);
            }
        }

        return $this-&gt;defaultResponse($message);
    }
}
</code></pre>
<h2 id="media-handling">Media Handling</h2>
<h3 id="location-sharing">Location Sharing</h3>
<pre><code class="language-php">// Send location for appointment
$whatsapp-&gt;sendLocation($to, [
    'latitude' =&gt; $branch-&gt;latitude,
    'longitude' =&gt; $branch-&gt;longitude,
    'name' =&gt; $branch-&gt;name,
    'address' =&gt; $branch-&gt;full_address
]);
</code></pre>
<h3 id="document-sending">Document Sending</h3>
<pre><code class="language-php">// Send appointment confirmation PDF
$whatsapp-&gt;sendDocument($to, [
    'link' =&gt; $appointment-&gt;confirmation_pdf_url,
    'caption' =&gt; 'Ihre Terminbestätigung'
]);
</code></pre>
<h2 id="analytics-monitoring">Analytics &amp; Monitoring</h2>
<h3 id="message-tracking">Message Tracking</h3>
<pre><code class="language-php">class WhatsAppAnalytics
{
    public function getMetrics($companyId, $period = 'month')
    {
        return [
            'messages_sent' =&gt; WhatsAppMessage::sent()-&gt;period($period)-&gt;count(),
            'templates_used' =&gt; WhatsAppMessage::templates()-&gt;period($period)-&gt;count(),
            'conversations' =&gt; WhatsAppConversation::period($period)-&gt;count(),
            'response_rate' =&gt; $this-&gt;calculateResponseRate($companyId, $period),
            'opt_in_rate' =&gt; $this-&gt;calculateOptInRate($companyId, $period)
        ];
    }
}
</code></pre>
<h2 id="cost-management">Cost Management</h2>
<h3 id="message-pricing">Message Pricing</h3>
<pre><code class="language-php">class WhatsAppCostCalculator
{
    private $pricing = [
        'DE' =&gt; [
            'template' =&gt; 0.0551, // EUR per message
            'session' =&gt; 0.0367   // EUR per conversation session
        ]
    ];

    public function calculateMonthlyCost(Company $company)
    {
        $templateMessages = $company-&gt;whatsapp_messages()
            -&gt;whereType('template')
            -&gt;whereMonth('created_at', now()-&gt;month)
            -&gt;count();

        $sessions = $company-&gt;whatsapp_conversations()
            -&gt;whereMonth('created_at', now()-&gt;month)
            -&gt;count();

        return [
            'template_cost' =&gt; $templateMessages * $this-&gt;pricing['DE']['template'],
            'session_cost' =&gt; $sessions * $this-&gt;pricing['DE']['session'],
            'total' =&gt; $total
        ];
    }
}
</code></pre>
<h2 id="testing">Testing</h2>
<h3 id="sandbox-testing">Sandbox Testing</h3>
<pre><code class="language-bash"># WhatsApp test configuration
WHATSAPP_SANDBOX_NUMBER=+1-415-238-0000
WHATSAPP_TEST_TOKEN=test_token_xxxxx
</code></pre>
<h3 id="test-commands">Test Commands</h3>
<pre><code class="language-bash"># Send test message
php artisan whatsapp:test-message +49xxxxxxxxx

# Test webhook
php artisan whatsapp:test-webhook message_received
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../sms/">SMS Integration</a></li>
<li><a href="../features/notifications.md">Notification System</a></li>
<li><a href="../../features/customer-portal/">Customer Portal</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
