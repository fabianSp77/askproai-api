<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/migration/calcom-v2/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Cal.com v1 to v2 Migration Guide - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Cal.com v1 to v2 Migration Guide";
        var mkdocs_page_input_path = "docs/migration/calcom-v2.md";
        var mkdocs_page_url = "/mkdocs/docs/migration/calcom-v2/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Cal.com v1 to v2 Migration Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="calcom-v1-to-v2-migration-guide">Cal.com v1 to v2 Migration Guide</h1>
<h2 id="overview">Overview</h2>
<p>This guide covers the migration from Cal.com API v1 to v2, including breaking changes, new features, and step-by-step migration instructions for the AskProAI integration.</p>
<h2 id="key-differences">Key Differences</h2>
<h3 id="api-structure-changes">API Structure Changes</h3>
<h4 id="base-urls">Base URLs</h4>
<pre><code class="language-yaml">v1: https://api.cal.com/v1
v2: https://api.cal.com/v2

Authentication:
  v1: API key in query parameter (?apiKey=xxx)
  v2: Bearer token in header (Authorization: Bearer xxx)
</code></pre>
<h4 id="response-format">Response Format</h4>
<pre><code class="language-json">// v1 Response
{
  &quot;booking&quot;: {
    &quot;id&quot;: 123,
    &quot;uid&quot;: &quot;abc-123&quot;,
    &quot;title&quot;: &quot;Meeting&quot;
  }
}

// v2 Response
{
  &quot;status&quot;: &quot;success&quot;,
  &quot;data&quot;: {
    &quot;id&quot;: &quot;abc-123&quot;,
    &quot;type&quot;: &quot;booking&quot;,
    &quot;attributes&quot;: {
      &quot;title&quot;: &quot;Meeting&quot;,
      &quot;startTime&quot;: &quot;2025-07-01T14:00:00Z&quot;,
      &quot;endTime&quot;: &quot;2025-07-01T15:00:00Z&quot;
    }
  }
}
</code></pre>
<h3 id="breaking-changes">Breaking Changes</h3>
<ol>
<li><strong>Authentication Method</strong></li>
<li>v1: Query parameter</li>
<li>
<p>v2: Bearer token header</p>
</li>
<li>
<p><strong>Endpoint Changes</strong>
   ```yaml
   Event Types:
     v1: GET /event-types
     v2: GET /event-types?include=locations,hosts</p>
</li>
</ol>
<p>Bookings:
     v1: POST /bookings
     v2: POST /bookings with structured payload</p>
<p>Availability:
     v1: GET /availability/{userId}
     v2: GET /slots/available
   ```</p>
<ol>
<li><strong>Data Structure</strong></li>
<li>v2 uses JSON:API specification</li>
<li>Nested resources require explicit includes</li>
<li>Pagination format changed</li>
</ol>
<h2 id="migration-implementation">Migration Implementation</h2>
<h3 id="step-1-update-service-configuration">Step 1: Update Service Configuration</h3>
<pre><code class="language-php">// config/services.php
return [
    'calcom' =&gt; [
        'api_version' =&gt; env('CALCOM_API_VERSION', 'v2'),
        'api_url' =&gt; env('CALCOM_API_URL', 'https://api.cal.com'),
        'api_key' =&gt; env('CALCOM_API_KEY'),
        'team_id' =&gt; env('CALCOM_TEAM_ID'),

        // v2 specific settings
        'v2' =&gt; [
            'timeout' =&gt; 30,
            'retry_times' =&gt; 3,
            'retry_delay' =&gt; 100,
            'include_relationships' =&gt; true,
        ],

        // Fallback v1 settings (during migration)
        'v1' =&gt; [
            'enabled' =&gt; env('CALCOM_V1_FALLBACK', true),
            'api_key' =&gt; env('CALCOM_V1_API_KEY'),
        ],
    ],
];
</code></pre>
<h3 id="step-2-create-v2-service-implementation">Step 2: Create v2 Service Implementation</h3>
<pre><code class="language-php">// app/Services/CalcomV2Service.php
namespace App\Services;

use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;
use App\Exceptions\CalcomException;

class CalcomV2Service
{
    private string $baseUrl;
    private string $apiKey;
    private array $defaultHeaders;

    public function __construct()
    {
        $this-&gt;baseUrl = config('services.calcom.api_url') . '/v2';
        $this-&gt;apiKey = config('services.calcom.api_key');
        $this-&gt;defaultHeaders = [
            'Authorization' =&gt; 'Bearer ' . $this-&gt;apiKey,
            'Content-Type' =&gt; 'application/json',
            'Accept' =&gt; 'application/vnd.api+json',
        ];
    }

    /**
     * Get event types with v2 API
     */
    public function getEventTypes(): array
    {
        $response = Http::withHeaders($this-&gt;defaultHeaders)
            -&gt;get(&quot;{$this-&gt;baseUrl}/event-types&quot;, [
                'include' =&gt; 'locations,schedule,hosts',
                'filter[active]' =&gt; true,
            ]);

        if (!$response-&gt;successful()) {
            throw new CalcomException(
                &quot;Failed to fetch event types: &quot; . $response-&gt;body()
            );
        }

        return $this-&gt;transformEventTypes($response-&gt;json('data', []));
    }

    /**
     * Check availability with v2 API
     */
    public function checkAvailability(
        int $eventTypeId,
        string $startDate,
        string $endDate
    ): array {
        $response = Http::withHeaders($this-&gt;defaultHeaders)
            -&gt;get(&quot;{$this-&gt;baseUrl}/slots/available&quot;, [
                'eventTypeId' =&gt; $eventTypeId,
                'startTime' =&gt; $startDate,
                'endTime' =&gt; $endDate,
                'timeZone' =&gt; config('app.timezone'),
            ]);

        if (!$response-&gt;successful()) {
            Log::error('Cal.com availability check failed', [
                'status' =&gt; $response-&gt;status(),
                'body' =&gt; $response-&gt;body(),
            ]);

            // Fallback to v1 if enabled
            if (config('services.calcom.v1.enabled')) {
                return $this-&gt;fallbackToV1Availability($eventTypeId, $startDate, $endDate);
            }

            throw new CalcomException(&quot;Availability check failed&quot;);
        }

        return $this-&gt;transformAvailabilitySlots($response-&gt;json('data', []));
    }

    /**
     * Create booking with v2 API
     */
    public function createBooking(array $data): array
    {
        $payload = [
            'data' =&gt; [
                'type' =&gt; 'bookings',
                'attributes' =&gt; [
                    'eventTypeId' =&gt; $data['eventTypeId'],
                    'start' =&gt; $data['start'],
                    'responses' =&gt; [
                        'name' =&gt; $data['name'],
                        'email' =&gt; $data['email'],
                        'phone' =&gt; $data['phone'] ?? null,
                        'notes' =&gt; $data['notes'] ?? null,
                    ],
                    'timeZone' =&gt; $data['timeZone'] ?? config('app.timezone'),
                    'language' =&gt; $data['language'] ?? 'de',
                    'metadata' =&gt; [
                        'source' =&gt; 'askproai',
                        'companyId' =&gt; $data['companyId'] ?? null,
                        'branchId' =&gt; $data['branchId'] ?? null,
                    ],
                ],
            ],
        ];

        $response = Http::withHeaders($this-&gt;defaultHeaders)
            -&gt;post(&quot;{$this-&gt;baseUrl}/bookings&quot;, $payload);

        if (!$response-&gt;successful()) {
            Log::error('Cal.com booking creation failed', [
                'status' =&gt; $response-&gt;status(),
                'body' =&gt; $response-&gt;body(),
                'payload' =&gt; $payload,
            ]);

            throw new CalcomException(
                &quot;Booking creation failed: &quot; . $response-&gt;json('errors.0.detail', 'Unknown error')
            );
        }

        return $this-&gt;transformBooking($response-&gt;json('data'));
    }

    /**
     * Transform v2 event types to internal format
     */
    private function transformEventTypes(array $eventTypes): array
    {
        return collect($eventTypes)-&gt;map(function ($eventType) {
            $attributes = $eventType['attributes'] ?? [];

            return [
                'id' =&gt; $eventType['id'],
                'slug' =&gt; $attributes['slug'] ?? null,
                'title' =&gt; $attributes['title'] ?? 'Unnamed Event',
                'description' =&gt; $attributes['description'] ?? null,
                'length' =&gt; $attributes['length'] ?? 30,
                'locations' =&gt; $this-&gt;extractLocations($eventType),
                'price' =&gt; $attributes['price'] ?? 0,
                'currency' =&gt; $attributes['currency'] ?? 'EUR',
                'requiresConfirmation' =&gt; $attributes['requiresConfirmation'] ?? false,
                'disableGuests' =&gt; $attributes['disableGuests'] ?? false,
                // Map v2 fields to v1 compatible structure
                'users' =&gt; $this-&gt;extractHosts($eventType),
                'schedule' =&gt; $this-&gt;extractSchedule($eventType),
            ];
        })-&gt;toArray();
    }

    /**
     * Transform v2 availability slots
     */
    private function transformAvailabilitySlots(array $slots): array
    {
        return collect($slots)-&gt;map(function ($slot) {
            return [
                'time' =&gt; $slot['attributes']['startTime'] ?? $slot['attributes']['start'],
                'available' =&gt; true,
                'duration' =&gt; $slot['attributes']['duration'] ?? null,
            ];
        })-&gt;toArray();
    }

    /**
     * Fallback to v1 API for availability
     */
    private function fallbackToV1Availability(
        int $eventTypeId,
        string $startDate,
        string $endDate
    ): array {
        Log::warning('Falling back to Cal.com v1 API for availability check');

        return app(CalcomService::class)-&gt;checkAvailability(
            $eventTypeId,
            $startDate,
            $endDate
        );
    }
}
</code></pre>
<h3 id="step-3-migration-adapter-pattern">Step 3: Migration Adapter Pattern</h3>
<pre><code class="language-php">// app/Services/CalcomAdapter.php
namespace App\Services;

use App\Contracts\CalendarServiceInterface;

class CalcomAdapter implements CalendarServiceInterface
{
    private $v1Service;
    private $v2Service;
    private bool $useV2;

    public function __construct(
        CalcomService $v1Service,
        CalcomV2Service $v2Service
    ) {
        $this-&gt;v1Service = $v1Service;
        $this-&gt;v2Service = $v2Service;
        $this-&gt;useV2 = config('services.calcom.api_version') === 'v2';
    }

    public function createBooking(array $data): array
    {
        try {
            if ($this-&gt;useV2) {
                return $this-&gt;v2Service-&gt;createBooking($data);
            }
        } catch (\Exception $e) {
            Log::error('v2 API failed, falling back to v1', [
                'error' =&gt; $e-&gt;getMessage()
            ]);
        }

        return $this-&gt;v1Service-&gt;createBooking($this-&gt;transformToV1($data));
    }

    private function transformToV1(array $v2Data): array
    {
        return [
            'eventTypeId' =&gt; $v2Data['eventTypeId'],
            'start' =&gt; $v2Data['start'],
            'end' =&gt; $v2Data['end'] ?? null,
            'name' =&gt; $v2Data['responses']['name'] ?? $v2Data['name'],
            'email' =&gt; $v2Data['responses']['email'] ?? $v2Data['email'],
            'guests' =&gt; $v2Data['responses']['guests'] ?? [],
            'notes' =&gt; $v2Data['responses']['notes'] ?? null,
            'timeZone' =&gt; $v2Data['timeZone'],
            'rescheduleUid' =&gt; $v2Data['rescheduleUid'] ?? null,
        ];
    }
}
</code></pre>
<h3 id="step-4-update-models-and-database">Step 4: Update Models and Database</h3>
<pre><code class="language-php">// database/migrations/2025_update_calcom_event_types_for_v2.php
use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

class UpdateCalcomEventTypesForV2 extends Migration
{
    public function up()
    {
        Schema::table('calcom_event_types', function (Blueprint $table) {
            // Add v2 specific fields
            $table-&gt;string('api_version')-&gt;default('v1')-&gt;after('event_type_id');
            $table-&gt;json('v2_attributes')-&gt;nullable()-&gt;after('metadata');
            $table-&gt;json('included_relationships')-&gt;nullable();
            $table-&gt;boolean('requires_confirmation')-&gt;default(false);
            $table-&gt;boolean('disable_guests')-&gt;default(false);
            $table-&gt;string('booking_limits')-&gt;nullable();

            // Add indexes for better performance
            $table-&gt;index('api_version');
            $table-&gt;index(['company_id', 'api_version']);
        });

        // Migrate existing data
        DB::statement(&quot;
            UPDATE calcom_event_types 
            SET api_version = 'v1' 
            WHERE api_version IS NULL
        &quot;);
    }

    public function down()
    {
        Schema::table('calcom_event_types', function (Blueprint $table) {
            $table-&gt;dropColumn([
                'api_version',
                'v2_attributes',
                'included_relationships',
                'requires_confirmation',
                'disable_guests',
                'booking_limits',
            ]);
        });
    }
}
</code></pre>
<h3 id="step-5-update-webhook-handlers">Step 5: Update Webhook Handlers</h3>
<pre><code class="language-php">// app/Http/Controllers/CalcomWebhookController.php
namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Jobs\ProcessCalcomWebhook;

class CalcomWebhookController extends Controller
{
    public function handleV2Webhook(Request $request)
    {
        // Verify webhook signature for v2
        if (!$this-&gt;verifyV2Signature($request)) {
            return response()-&gt;json(['error' =&gt; 'Invalid signature'], 401);
        }

        $payload = $request-&gt;json();

        // v2 webhook structure
        $event = [
            'id' =&gt; $payload['id'],
            'type' =&gt; $payload['type'], // booking.created, booking.cancelled, etc.
            'data' =&gt; $payload['data'],
            'occurred_at' =&gt; $payload['occurred_at'],
        ];

        ProcessCalcomWebhook::dispatch($event, 'v2');

        return response()-&gt;json(['status' =&gt; 'accepted'], 202);
    }

    private function verifyV2Signature(Request $request): bool
    {
        $signature = $request-&gt;header('X-Cal-Signature-256');

        if (!$signature) {
            return false;
        }

        $secret = config('services.calcom.webhook_secret');
        $payload = $request-&gt;getContent();
        $expected = hash_hmac('sha256', $payload, $secret);

        return hash_equals($expected, $signature);
    }
}
</code></pre>
<h3 id="step-6-testing-migration">Step 6: Testing Migration</h3>
<pre><code class="language-php">// tests/Integration/CalcomV2MigrationTest.php
namespace Tests\Integration;

use Tests\TestCase;
use App\Services\CalcomService;
use App\Services\CalcomV2Service;
use Illuminate\Support\Facades\Http;

class CalcomV2MigrationTest extends TestCase
{
    /** @test */
    public function v2_service_returns_compatible_event_types()
    {
        Http::fake([
            '*/v2/event-types*' =&gt; Http::response([
                'data' =&gt; [
                    [
                        'id' =&gt; '123',
                        'type' =&gt; 'event-types',
                        'attributes' =&gt; [
                            'title' =&gt; 'Consultation',
                            'slug' =&gt; 'consultation',
                            'length' =&gt; 30,
                        ],
                    ],
                ],
            ]),
        ]);

        $v2Service = new CalcomV2Service();
        $eventTypes = $v2Service-&gt;getEventTypes();

        $this-&gt;assertArrayHasKey('id', $eventTypes[0]);
        $this-&gt;assertArrayHasKey('title', $eventTypes[0]);
        $this-&gt;assertArrayHasKey('length', $eventTypes[0]);
    }

    /** @test */
    public function adapter_falls_back_to_v1_on_v2_failure()
    {
        // Mock v2 to fail
        Http::fake([
            '*/v2/bookings*' =&gt; Http::response(null, 500),
            '*/v1/bookings*' =&gt; Http::response(['uid' =&gt; 'booking-123']),
        ]);

        $adapter = app(CalcomAdapter::class);
        $booking = $adapter-&gt;createBooking([
            'eventTypeId' =&gt; 1,
            'start' =&gt; '2025-07-01T14:00:00Z',
            'responses' =&gt; [
                'name' =&gt; 'John Doe',
                'email' =&gt; 'john@example.com',
            ],
        ]);

        $this-&gt;assertNotNull($booking);
    }
}
</code></pre>
<h2 id="migration-timeline">Migration Timeline</h2>
<h3 id="phase-1-preparation-week-1">Phase 1: Preparation (Week 1)</h3>
<ul>
<li>Set up v2 API credentials</li>
<li>Deploy v2 service alongside v1</li>
<li>Enable logging and monitoring</li>
</ul>
<h3 id="phase-2-testing-week-2">Phase 2: Testing (Week 2)</h3>
<ul>
<li>Run parallel tests</li>
<li>Compare v1 and v2 responses</li>
<li>Fix compatibility issues</li>
</ul>
<h3 id="phase-3-gradual-migration-weeks-3-4">Phase 3: Gradual Migration (Weeks 3-4)</h3>
<ul>
<li>Enable v2 for read operations</li>
<li>Monitor error rates</li>
<li>Enable v2 for write operations</li>
<li>Keep v1 as fallback</li>
</ul>
<h3 id="phase-4-completion-week-5">Phase 4: Completion (Week 5)</h3>
<ul>
<li>Disable v1 fallback</li>
<li>Remove v1 code</li>
<li>Update documentation</li>
</ul>
<h2 id="rollback-plan">Rollback Plan</h2>
<h3 id="quick-rollback">Quick Rollback</h3>
<pre><code class="language-bash"># Switch back to v1
php artisan config:set services.calcom.api_version v1
php artisan config:cache
</code></pre>
<h3 id="full-rollback">Full Rollback</h3>
<pre><code class="language-php">// config/services.php
'calcom' =&gt; [
    'api_version' =&gt; 'v1', // Force v1
    'force_v1' =&gt; true,    // Disable v2 completely
]
</code></pre>
<h2 id="monitoring-dashboard">Monitoring Dashboard</h2>
<pre><code class="language-php">// app/Http/Controllers/CalcomMigrationDashboard.php
class CalcomMigrationDashboard extends Controller
{
    public function index()
    {
        $metrics = [
            'v1_calls' =&gt; Cache::get('calcom.v1.calls', 0),
            'v2_calls' =&gt; Cache::get('calcom.v2.calls', 0),
            'v1_errors' =&gt; Cache::get('calcom.v1.errors', 0),
            'v2_errors' =&gt; Cache::get('calcom.v2.errors', 0),
            'fallback_count' =&gt; Cache::get('calcom.fallbacks', 0),
            'migration_progress' =&gt; $this-&gt;calculateProgress(),
        ];

        return view('admin.calcom-migration', compact('metrics'));
    }

    private function calculateProgress(): float
    {
        $v1Calls = Cache::get('calcom.v1.calls', 0);
        $v2Calls = Cache::get('calcom.v2.calls', 0);
        $total = $v1Calls + $v2Calls;

        return $total &gt; 0 ? ($v2Calls / $total) * 100 : 0;
    }
}
</code></pre>
<h2 id="common-issues-and-solutions">Common Issues and Solutions</h2>
<h3 id="issue-authentication-failures">Issue: Authentication Failures</h3>
<pre><code class="language-php">// Solution: Update headers
$headers = [
    'Authorization' =&gt; 'Bearer ' . $apiKey, // v2
    // Not: 'apiKey' =&gt; $apiKey (v1)
];
</code></pre>
<h3 id="issue-missing-data-in-responses">Issue: Missing Data in Responses</h3>
<pre><code class="language-php">// Solution: Use includes parameter
$response = Http::get('/v2/event-types', [
    'include' =&gt; 'locations,schedule,hosts', // Explicit includes required
]);
</code></pre>
<h3 id="issue-webhook-signature-mismatch">Issue: Webhook Signature Mismatch</h3>
<pre><code class="language-bash"># Debug webhook signatures
php artisan calcom:debug-webhook --payload='{&quot;test&quot;:true}'
</code></pre>
<h2 id="performance-comparison">Performance Comparison</h2>
<pre><code class="language-yaml">API Performance:
  v1:
    Average Response Time: 450ms
    P95 Response Time: 1200ms
    Error Rate: 0.05%

  v2:
    Average Response Time: 280ms (-38%)
    P95 Response Time: 650ms (-46%)
    Error Rate: 0.02% (-60%)

Features:
  v1:
    - Basic CRUD operations
    - Limited filtering
    - No field selection

  v2:
    - Advanced filtering
    - Field selection
    - Relationship includes
    - Better error messages
    - Webhook reliability
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../../integrations/calcom/">Cal.com Integration Guide</a></li>
<li><a href="../../configuration/services/">Service Configuration</a></li>
<li><a href="../api/webhooks.md">Webhook Setup</a></li>
<li><a href="../../development/testing/">Testing Guide</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
