<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/development/debugging/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Debugging Guide - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Debugging Guide";
        var mkdocs_page_input_path = "docs/development/debugging.md";
        var mkdocs_page_url = "/mkdocs/docs/development/debugging/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Debugging Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="debugging-guide">Debugging Guide</h1>
<h2 id="overview">Overview</h2>
<p>This guide provides comprehensive debugging techniques and tools for troubleshooting issues in the AskProAI application. It covers various debugging scenarios, tools, and best practices.</p>
<h2 id="development-environment-debugging">Development Environment Debugging</h2>
<h3 id="laravel-telescope">Laravel Telescope</h3>
<p>Telescope provides insight into requests, exceptions, database queries, queued jobs, mail, notifications, cache operations, scheduled tasks, variable dumps and more.</p>
<pre><code class="language-php">// Access Telescope
http://localhost:8000/telescope

// Programmatically enable/disable
app('telescope')-&gt;startRecording();
app('telescope')-&gt;stopRecording();

// Tag entries for filtering
Telescope::tag(function (IncomingEntry $entry) {
    if ($entry-&gt;type === 'request') {
        return ['status:' . $entry-&gt;content['response_status']];
    }
    return [];
});
</code></pre>
<h3 id="laravel-debugbar">Laravel Debugbar</h3>
<pre><code class="language-php">// Enable/disable debugbar
config(['debugbar.enabled' =&gt; true]);

// Add custom messages
\Debugbar::info('Info message');
\Debugbar::error('Error message');
\Debugbar::warning('Warning message');

// Add custom timeline events
\Debugbar::startMeasure('api-call', 'External API Call');
// ... your code
\Debugbar::stopMeasure('api-call');

// Add data to debugbar
\Debugbar::addCollector(new \DebugBar\DataCollector\MessagesCollector('custom'));
</code></pre>
<h3 id="debug-helpers">Debug Helpers</h3>
<pre><code class="language-php">// Dump and die
dd($variable);

// Dump and continue
dump($variable);

// Dump to log
logger('Debug message', ['context' =&gt; $data]);

// Conditional debugging
dump_if($condition, $variable);
dd_unless($condition, $variable);

// Ray debugging (if installed)
ray($data)-&gt;green();
ray()-&gt;showQueries();
ray()-&gt;pause();
</code></pre>
<h2 id="logging-and-monitoring">Logging and Monitoring</h2>
<h3 id="structured-logging">Structured Logging</h3>
<pre><code class="language-php">// app/Logging/StructuredLogger.php
namespace App\Logging;

use Illuminate\Support\Facades\Log;
use Illuminate\Support\Str;

class StructuredLogger
{
    private string $correlationId;
    private array $context = [];

    public function __construct()
    {
        $this-&gt;correlationId = request()-&gt;header('X-Correlation-ID', Str::uuid());
    }

    public function withContext(array $context): self
    {
        $this-&gt;context = array_merge($this-&gt;context, $context);
        return $this;
    }

    public function info(string $message, array $data = []): void
    {
        $this-&gt;log('info', $message, $data);
    }

    public function error(string $message, array $data = []): void
    {
        $this-&gt;log('error', $message, $data);
    }

    private function log(string $level, string $message, array $data): void
    {
        Log::$level($message, array_merge([
            'correlation_id' =&gt; $this-&gt;correlationId,
            'user_id' =&gt; auth()-&gt;id(),
            'company_id' =&gt; auth()-&gt;user()?-&gt;company_id,
            'request_id' =&gt; request()-&gt;id(),
            'timestamp' =&gt; now()-&gt;toIso8601String(),
        ], $this-&gt;context, $data));
    }
}

// Usage
app(StructuredLogger::class)
    -&gt;withContext(['service' =&gt; 'appointment'])
    -&gt;info('Appointment created', ['appointment_id' =&gt; $appointment-&gt;id]);
</code></pre>
<h3 id="query-debugging">Query Debugging</h3>
<pre><code class="language-php">// Enable query log
DB::enableQueryLog();

// Your queries here
$users = User::where('active', true)-&gt;get();

// Get executed queries
$queries = DB::getQueryLog();
dd($queries);

// Log all queries
DB::listen(function ($query) {
    Log::debug('Query', [
        'sql' =&gt; $query-&gt;sql,
        'bindings' =&gt; $query-&gt;bindings,
        'time' =&gt; $query-&gt;time,
    ]);
});

// Using Laravel Debugbar
\Debugbar::startMeasure('complex-query', 'Complex Query Execution');
$results = DB::select('SELECT * FROM large_table WHERE complex_conditions');
\Debugbar::stopMeasure('complex-query');
</code></pre>
<h3 id="performance-debugging">Performance Debugging</h3>
<pre><code class="language-php">// app/Http/Middleware/PerformanceMonitoring.php
namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\Log;

class PerformanceMonitoring
{
    public function handle($request, Closure $next)
    {
        $start = microtime(true);

        $response = $next($request);

        $duration = microtime(true) - $start;

        if ($duration &gt; 1) { // Log slow requests (&gt; 1 second)
            Log::warning('Slow request detected', [
                'url' =&gt; $request-&gt;fullUrl(),
                'method' =&gt; $request-&gt;method(),
                'duration' =&gt; round($duration, 3),
                'memory' =&gt; round(memory_get_peak_usage() / 1024 / 1024, 2) . 'MB',
            ]);
        }

        $response-&gt;headers-&gt;set('X-Response-Time', round($duration * 1000) . 'ms');

        return $response;
    }
}
</code></pre>
<h2 id="debugging-external-services">Debugging External Services</h2>
<h3 id="retellai-debugging">Retell.ai Debugging</h3>
<pre><code class="language-php">// app/Services/Debug/RetellDebugger.php
namespace App\Services\Debug;

use Illuminate\Support\Facades\Http;
use Illuminate\Support\Facades\Log;

class RetellDebugger
{
    public function debugWebhook(array $payload): void
    {
        Log::channel('retell')-&gt;debug('Webhook received', [
            'event_type' =&gt; $payload['event_type'],
            'call_id' =&gt; $payload['call_id'] ?? null,
            'raw_payload' =&gt; $payload,
        ]);
    }

    public function testConnection(): array
    {
        try {
            $response = Http::withToken(config('services.retell.api_key'))
                -&gt;get('https://api.retellai.com/v1/agents');

            return [
                'status' =&gt; 'connected',
                'agents' =&gt; $response-&gt;json(),
                'response_time' =&gt; $response-&gt;handlerStats()['total_time'] ?? null,
            ];
        } catch (\Exception $e) {
            return [
                'status' =&gt; 'error',
                'message' =&gt; $e-&gt;getMessage(),
                'trace' =&gt; $e-&gt;getTraceAsString(),
            ];
        }
    }

    public function simulateWebhook(string $eventType, array $data = []): void
    {
        $payload = array_merge([
            'event_type' =&gt; $eventType,
            'call_id' =&gt; 'debug_' . Str::random(10),
            'timestamp' =&gt; now()-&gt;toIso8601String(),
        ], $data);

        $response = Http::withHeaders([
            'x-retell-signature' =&gt; $this-&gt;generateSignature($payload),
        ])-&gt;post(route('retell.webhook'), $payload);

        Log::channel('retell')-&gt;debug('Simulated webhook', [
            'payload' =&gt; $payload,
            'response' =&gt; $response-&gt;json(),
            'status' =&gt; $response-&gt;status(),
        ]);
    }
}
</code></pre>
<h3 id="calcom-debugging">Cal.com Debugging</h3>
<pre><code class="language-php">// app/Console/Commands/DebugCalcom.php
namespace App\Console\Commands;

use App\Services\CalcomV2Service;
use Illuminate\Console\Command;

class DebugCalcom extends Command
{
    protected $signature = 'debug:calcom {action}';

    public function handle(CalcomV2Service $calcom)
    {
        switch ($this-&gt;argument('action')) {
            case 'test':
                $this-&gt;testConnection($calcom);
                break;

            case 'availability':
                $this-&gt;checkAvailability($calcom);
                break;

            case 'event-types':
                $this-&gt;listEventTypes($calcom);
                break;
        }
    }

    private function testConnection(CalcomV2Service $calcom): void
    {
        $this-&gt;info('Testing Cal.com connection...');

        try {
            $response = $calcom-&gt;testConnection();
            $this-&gt;info('✓ Connection successful');
            $this-&gt;table(['Key', 'Value'], collect($response)-&gt;map(fn($v, $k) =&gt; [$k, $v]));
        } catch (\Exception $e) {
            $this-&gt;error('✗ Connection failed: ' . $e-&gt;getMessage());
            $this-&gt;line($e-&gt;getTraceAsString());
        }
    }
}
</code></pre>
<h2 id="error-debugging">Error Debugging</h2>
<h3 id="exception-handler-enhancement">Exception Handler Enhancement</h3>
<pre><code class="language-php">// app/Exceptions/Handler.php
namespace App\Exceptions;

use Illuminate\Foundation\Exceptions\Handler as ExceptionHandler;
use Throwable;

class Handler extends ExceptionHandler
{
    public function report(Throwable $exception)
    {
        // Add context to all exceptions
        if (app()-&gt;bound('sentry')) {
            \Sentry\configureScope(function (\Sentry\State\Scope $scope) {
                $scope-&gt;setContext('request', [
                    'url' =&gt; request()-&gt;fullUrl(),
                    'method' =&gt; request()-&gt;method(),
                    'ip' =&gt; request()-&gt;ip(),
                ]);

                if ($user = auth()-&gt;user()) {
                    $scope-&gt;setContext('user', [
                        'id' =&gt; $user-&gt;id,
                        'email' =&gt; $user-&gt;email,
                        'company_id' =&gt; $user-&gt;company_id,
                    ]);
                }
            });
        }

        // Log additional context for debugging
        if ($this-&gt;shouldReport($exception)) {
            Log::error('Exception occurred', [
                'exception' =&gt; get_class($exception),
                'message' =&gt; $exception-&gt;getMessage(),
                'file' =&gt; $exception-&gt;getFile(),
                'line' =&gt; $exception-&gt;getLine(),
                'trace' =&gt; collect($exception-&gt;getTrace())-&gt;take(5)-&gt;toArray(),
                'request' =&gt; [
                    'url' =&gt; request()-&gt;fullUrl(),
                    'method' =&gt; request()-&gt;method(),
                    'data' =&gt; request()-&gt;except(['password', 'password_confirmation']),
                ],
            ]);
        }

        parent::report($exception);
    }
}
</code></pre>
<h3 id="custom-exception-with-debug-info">Custom Exception with Debug Info</h3>
<pre><code class="language-php">// app/Exceptions/BookingException.php
namespace App\Exceptions;

use Exception;

class BookingException extends Exception
{
    protected array $context = [];

    public static function slotNotAvailable(array $context = []): self
    {
        $exception = new self('The requested time slot is not available');
        $exception-&gt;context = $context;
        return $exception;
    }

    public function context(): array
    {
        return $this-&gt;context;
    }

    public function report()
    {
        Log::error('Booking exception', [
            'message' =&gt; $this-&gt;getMessage(),
            'context' =&gt; $this-&gt;context,
            'trace' =&gt; $this-&gt;getTraceAsString(),
        ]);
    }

    public function render($request)
    {
        if ($request-&gt;expectsJson()) {
            return response()-&gt;json([
                'message' =&gt; $this-&gt;getMessage(),
                'debug' =&gt; config('app.debug') ? $this-&gt;context : null,
            ], 422);
        }

        return parent::render($request);
    }
}
</code></pre>
<h2 id="queue-debugging">Queue Debugging</h2>
<h3 id="queue-monitoring">Queue Monitoring</h3>
<pre><code class="language-php">// app/Console/Commands/MonitorQueues.php
namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Queue;
use Illuminate\Support\Facades\Redis;

class MonitorQueues extends Command
{
    protected $signature = 'queue:monitor';

    public function handle()
    {
        $queues = ['default', 'high', 'low', 'webhooks', 'emails'];

        $this-&gt;table(
            ['Queue', 'Size', 'Processing', 'Failed', 'Status'],
            collect($queues)-&gt;map(fn($queue) =&gt; [
                $queue,
                $this-&gt;getQueueSize($queue),
                $this-&gt;getProcessingCount($queue),
                $this-&gt;getFailedCount($queue),
                $this-&gt;getQueueStatus($queue),
            ])
        );

        // Monitor specific job
        $this-&gt;monitorJob('App\Jobs\ProcessRetellWebhook');
    }

    private function getQueueSize(string $queue): int
    {
        return Redis::llen(&quot;queues:{$queue}&quot;);
    }

    private function monitorJob(string $jobClass): void
    {
        $jobs = Redis::lrange('queues:default', 0, -1);

        $count = collect($jobs)
            -&gt;map(fn($job) =&gt; json_decode($job, true))
            -&gt;filter(fn($job) =&gt; ($job['displayName'] ?? '') === $jobClass)
            -&gt;count();

        $this-&gt;info(&quot;Found {$count} {$jobClass} jobs in queue&quot;);
    }
}
</code></pre>
<h3 id="failed-job-debugging">Failed Job Debugging</h3>
<pre><code class="language-php">// app/Console/Commands/DebugFailedJob.php
namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;

class DebugFailedJob extends Command
{
    protected $signature = 'queue:debug-failed {id}';

    public function handle()
    {
        $job = DB::table('failed_jobs')-&gt;find($this-&gt;argument('id'));

        if (!$job) {
            $this-&gt;error('Failed job not found');
            return;
        }

        $payload = json_decode($job-&gt;payload, true);
        $exception = $job-&gt;exception;

        $this-&gt;info('Failed Job Details:');
        $this-&gt;table(
            ['Property', 'Value'],
            [
                ['ID', $job-&gt;id],
                ['Queue', $job-&gt;queue],
                ['Failed At', $job-&gt;failed_at],
                ['Job Class', $payload['displayName'] ?? 'Unknown'],
                ['Attempts', $payload['attempts'] ?? 0],
            ]
        );

        $this-&gt;info(&quot;\nJob Data:&quot;);
        $this-&gt;line(json_encode($payload['data'] ?? [], JSON_PRETTY_PRINT));

        $this-&gt;error(&quot;\nException:&quot;);
        $this-&gt;line($exception);

        if ($this-&gt;confirm('Retry this job?')) {
            $this-&gt;call('queue:retry', ['id' =&gt; [$job-&gt;id]]);
        }
    }
}
</code></pre>
<h2 id="database-debugging">Database Debugging</h2>
<h3 id="query-analysis">Query Analysis</h3>
<pre><code class="language-php">// app/Console/Commands/AnalyzeQueries.php
namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;

class AnalyzeQueries extends Command
{
    protected $signature = 'db:analyze-queries';

    public function handle()
    {
        DB::enableQueryLog();

        // Run your application logic here
        $this-&gt;call('appointment:sync');

        $queries = collect(DB::getQueryLog());

        $this-&gt;info(&quot;Total queries: &quot; . $queries-&gt;count());

        // Find slow queries
        $slowQueries = $queries-&gt;filter(fn($q) =&gt; $q['time'] &gt; 100);

        if ($slowQueries-&gt;isNotEmpty()) {
            $this-&gt;warn(&quot;\nSlow queries detected:&quot;);
            $slowQueries-&gt;each(function ($query) {
                $this-&gt;line(&quot;Time: {$query['time']}ms&quot;);
                $this-&gt;line(&quot;SQL: {$query['query']}&quot;);
                $this-&gt;line(&quot;Bindings: &quot; . json_encode($query['bindings']));
                $this-&gt;line(&quot;&quot;);
            });
        }

        // Find N+1 queries
        $this-&gt;detectNPlusOne($queries);
    }

    private function detectNPlusOne($queries)
    {
        $patterns = $queries-&gt;map(fn($q) =&gt; preg_replace('/\d+/', 'N', $q['query']))
            -&gt;countBy()
            -&gt;filter(fn($count) =&gt; $count &gt; 1);

        if ($patterns-&gt;isNotEmpty()) {
            $this-&gt;warn(&quot;\nPotential N+1 queries detected:&quot;);
            $patterns-&gt;each(function ($count, $pattern) {
                $this-&gt;line(&quot;Pattern repeated {$count} times: {$pattern}&quot;);
            });
        }
    }
}
</code></pre>
<h3 id="migration-debugging">Migration Debugging</h3>
<pre><code class="language-php">// app/Console/Commands/DebugMigration.php
namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Schema;

class DebugMigration extends Command
{
    protected $signature = 'migrate:debug {migration}';

    public function handle()
    {
        $migrationClass = $this-&gt;argument('migration');
        $migration = new $migrationClass;

        // Test migration in transaction
        DB::beginTransaction();

        try {
            $this-&gt;info('Running migration...');
            $migration-&gt;up();

            // Check schema changes
            $this-&gt;info('Schema changes applied successfully');

            // You can inspect the changes here
            $this-&gt;call('db:show', ['table' =&gt; 'your_table']);

            if ($this-&gt;confirm('Keep changes?')) {
                DB::commit();
                $this-&gt;info('Changes committed');
            } else {
                DB::rollback();
                $this-&gt;info('Changes rolled back');
            }
        } catch (\Exception $e) {
            DB::rollback();
            $this-&gt;error('Migration failed: ' . $e-&gt;getMessage());
            $this-&gt;line($e-&gt;getTraceAsString());
        }
    }
}
</code></pre>
<h2 id="api-debugging">API Debugging</h2>
<h3 id="requestresponse-logging-middleware">Request/Response Logging Middleware</h3>
<pre><code class="language-php">// app/Http/Middleware/LogApiRequests.php
namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Str;

class LogApiRequests
{
    public function handle($request, Closure $next)
    {
        $requestId = Str::uuid();

        // Log request
        Log::channel('api')-&gt;info('API Request', [
            'request_id' =&gt; $requestId,
            'method' =&gt; $request-&gt;method(),
            'url' =&gt; $request-&gt;fullUrl(),
            'headers' =&gt; $request-&gt;headers-&gt;all(),
            'body' =&gt; $request-&gt;except(['password', 'password_confirmation']),
            'ip' =&gt; $request-&gt;ip(),
        ]);

        $response = $next($request);

        // Log response
        Log::channel('api')-&gt;info('API Response', [
            'request_id' =&gt; $requestId,
            'status' =&gt; $response-&gt;status(),
            'headers' =&gt; $response-&gt;headers-&gt;all(),
            'body' =&gt; $response-&gt;getContent(),
        ]);

        return $response;
    }
}
</code></pre>
<h3 id="api-testing-tool">API Testing Tool</h3>
<pre><code class="language-php">// app/Console/Commands/TestApi.php
namespace App\Console\Commands;

use Illuminate\Console\Command;
use Illuminate\Support\Facades\Http;

class TestApi extends Command
{
    protected $signature = 'api:test {endpoint} {--method=GET} {--data=}';

    public function handle()
    {
        $endpoint = $this-&gt;argument('endpoint');
        $method = $this-&gt;option('method');
        $data = json_decode($this-&gt;option('data') ?? '{}', true);

        $url = url($endpoint);

        $this-&gt;info(&quot;Testing API: {$method} {$url}&quot;);

        $response = Http::withHeaders([
            'Accept' =&gt; 'application/json',
            'Authorization' =&gt; 'Bearer ' . $this-&gt;getTestToken(),
        ])-&gt;$method($url, $data);

        $this-&gt;table(
            ['Property', 'Value'],
            [
                ['Status', $response-&gt;status()],
                ['Time', $response-&gt;handlerStats()['total_time'] . 's'],
                ['Size', strlen($response-&gt;body()) . ' bytes'],
            ]
        );

        $this-&gt;info(&quot;\nResponse Headers:&quot;);
        foreach ($response-&gt;headers() as $key =&gt; $values) {
            $this-&gt;line(&quot;{$key}: &quot; . implode(', ', $values));
        }

        $this-&gt;info(&quot;\nResponse Body:&quot;);
        $this-&gt;line($response-&gt;body());
    }
}
</code></pre>
<h2 id="production-debugging">Production Debugging</h2>
<h3 id="safe-production-debugging">Safe Production Debugging</h3>
<pre><code class="language-php">// app/Http/Controllers/DebugController.php
namespace App\Http\Controllers;

use Illuminate\Http\Request;

class DebugController extends Controller
{
    public function __construct()
    {
        $this-&gt;middleware('can:debug');
    }

    public function systemInfo()
    {
        return [
            'app' =&gt; [
                'version' =&gt; config('app.version'),
                'environment' =&gt; app()-&gt;environment(),
                'debug' =&gt; config('app.debug'),
                'url' =&gt; config('app.url'),
            ],
            'php' =&gt; [
                'version' =&gt; PHP_VERSION,
                'memory_limit' =&gt; ini_get('memory_limit'),
                'max_execution_time' =&gt; ini_get('max_execution_time'),
                'loaded_extensions' =&gt; get_loaded_extensions(),
            ],
            'laravel' =&gt; [
                'version' =&gt; app()-&gt;version(),
                'cache_driver' =&gt; config('cache.default'),
                'queue_driver' =&gt; config('queue.default'),
                'session_driver' =&gt; config('session.driver'),
            ],
            'server' =&gt; [
                'software' =&gt; $_SERVER['SERVER_SOFTWARE'] ?? 'Unknown',
                'os' =&gt; php_uname(),
                'load_average' =&gt; sys_getloadavg(),
            ],
        ];
    }

    public function healthCheck()
    {
        $checks = [
            'database' =&gt; $this-&gt;checkDatabase(),
            'redis' =&gt; $this-&gt;checkRedis(),
            'storage' =&gt; $this-&gt;checkStorage(),
            'external_services' =&gt; $this-&gt;checkExternalServices(),
        ];

        return response()-&gt;json($checks);
    }
}
</code></pre>
<h3 id="feature-flags-for-debugging">Feature Flags for Debugging</h3>
<pre><code class="language-php">// config/debug.php
return [
    'features' =&gt; [
        'verbose_logging' =&gt; env('DEBUG_VERBOSE_LOGGING', false),
        'query_logging' =&gt; env('DEBUG_QUERY_LOGGING', false),
        'api_logging' =&gt; env('DEBUG_API_LOGGING', false),
        'performance_tracking' =&gt; env('DEBUG_PERFORMANCE', false),
    ],
];

// Usage
if (config('debug.features.verbose_logging')) {
    Log::debug('Verbose debug information', $context);
}
</code></pre>
<h2 id="debugging-tools">Debugging Tools</h2>
<h3 id="artisan-commands">Artisan Commands</h3>
<pre><code class="language-bash"># Clear all caches
php artisan optimize:clear

# View application routes
php artisan route:list --path=api

# View scheduled tasks
php artisan schedule:list

# Test specific command
php artisan tinker
&gt;&gt;&gt; app(RetellService::class)-&gt;testConnection()

# View configuration
php artisan config:show database

# Debug queue workers
php artisan queue:listen --tries=1 --timeout=0

# Debug specific job
php artisan queue:work --queue=webhooks --stop-when-empty
</code></pre>
<h3 id="tinker-sessions">Tinker Sessions</h3>
<pre><code class="language-php">// Useful tinker commands
php artisan tinker

// Test database connection
&gt;&gt;&gt; DB::connection()-&gt;getPdo();

// Test Redis connection
&gt;&gt;&gt; Redis::ping();

// Debug specific model
&gt;&gt;&gt; $appointment = Appointment::with(['customer', 'service'])-&gt;find(1);
&gt;&gt;&gt; $appointment-&gt;toArray();

// Test service
&gt;&gt;&gt; $service = app(AppointmentService::class);
&gt;&gt;&gt; $service-&gt;checkAvailability('2025-07-01', '14:00');

// Clear specific cache
&gt;&gt;&gt; Cache::forget('key');

// Debug configuration
&gt;&gt;&gt; config('services.retell');

// Test email
&gt;&gt;&gt; Mail::raw('Test email', fn($message) =&gt; $message-&gt;to('test@example.com'));
</code></pre>
<h2 id="debugging-best-practices">Debugging Best Practices</h2>
<ol>
<li><strong>Use Correlation IDs</strong>: Track requests across services</li>
<li><strong>Structured Logging</strong>: Use consistent log formats</li>
<li><strong>Don't Debug in Production</strong>: Use feature flags and staging environment</li>
<li><strong>Clean Up Debug Code</strong>: Remove or disable debug statements before merging</li>
<li><strong>Document Debug Findings</strong>: Keep a debug journal for recurring issues</li>
<li><strong>Use Version Control</strong>: Tag releases for easy rollback and comparison</li>
<li><strong>Monitor Performance Impact</strong>: Ensure debugging doesn't affect performance</li>
</ol>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../testing/">Testing Guide</a></li>
<li><a href="../../deployment/monitoring/">Monitoring Setup</a></li>
<li><a href="../api/error-handling.md">Error Handling</a></li>
<li><a href="../operations/performance.md">Performance Optimization</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
