<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/deployment/monitoring/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Monitoring Setup Guide - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Monitoring Setup Guide";
        var mkdocs_page_input_path = "docs/deployment/monitoring.md";
        var mkdocs_page_url = "/mkdocs/docs/deployment/monitoring/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Monitoring Setup Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="monitoring-setup-guide">Monitoring Setup Guide</h1>
<h2 id="overview">Overview</h2>
<p>This guide covers the complete monitoring setup for AskProAI, including application monitoring, infrastructure monitoring, alerting, and visualization dashboards.</p>
<h2 id="monitoring-stack">Monitoring Stack</h2>
<h3 id="components-overview">Components Overview</h3>
<pre><code class="language-yaml">Application Monitoring:
  - Laravel Telescope (Development)
  - Sentry (Error tracking)
  - New Relic APM (Performance)

Infrastructure Monitoring:
  - Prometheus (Metrics collection)
  - Grafana (Visualization)
  - Node Exporter (System metrics)
  - MySQL Exporter (Database metrics)

Log Management:
  - ELK Stack (Elasticsearch, Logstash, Kibana)
  - Fluentd (Log forwarding)

Alerting:
  - Alertmanager (Prometheus alerts)
  - PagerDuty (On-call management)
  - Slack (Team notifications)
</code></pre>
<h2 id="application-monitoring">Application Monitoring</h2>
<h3 id="laravel-telescope-setup">Laravel Telescope Setup</h3>
<pre><code class="language-bash"># Install Telescope (development only)
composer require laravel/telescope --dev

# Publish assets
php artisan telescope:install

# Run migrations
php artisan migrate

# Configure access in TelescopeServiceProvider
public function gate()
{
    Gate::define('viewTelescope', function ($user) {
        return in_array($user-&gt;email, [
            'admin@askproai.de',
        ]);
    });
}
</code></pre>
<h3 id="sentry-integration">Sentry Integration</h3>
<pre><code class="language-php">// config/sentry.php
return [
    'dsn' =&gt; env('SENTRY_LARAVEL_DSN'),

    'release' =&gt; trim(exec('git describe --tags --abbrev=0 2&gt;/dev/null')) ?: 'unknown',

    'environment' =&gt; env('APP_ENV'),

    'breadcrumbs' =&gt; [
        'logs' =&gt; true,
        'sql_queries' =&gt; true,
        'sql_bindings' =&gt; true,
        'queue_info' =&gt; true,
        'command_info' =&gt; true,
    ],

    'tracing' =&gt; [
        'transaction_sample_rate' =&gt; env('SENTRY_TRACES_SAMPLE_RATE', 0.1),
        'trace_propagation_targets' =&gt; [
            'api.askproai.de',
            'api.retellai.com',
            'api.cal.com',
        ],
    ],

    'send_default_pii' =&gt; false,

    'before_send' =&gt; function (\Sentry\Event $event, ?\Sentry\EventHint $hint): ?\Sentry\Event {
        // Filter out sensitive data
        if ($exception = $hint-&gt;getException()) {
            if ($exception instanceof \Illuminate\Database\QueryException) {
                // Remove SQL with potential sensitive data
                $event-&gt;setExceptions([]);
            }
        }

        return $event;
    },
];
</code></pre>
<h3 id="custom-metrics-collection">Custom Metrics Collection</h3>
<pre><code class="language-php">// app/Services/Monitoring/MetricsCollector.php
class MetricsCollector
{
    private $prometheus;

    public function __construct()
    {
        $this-&gt;prometheus = app('prometheus');
    }

    public function recordApiRequest(string $endpoint, float $duration, int $statusCode)
    {
        // Record request duration
        $this-&gt;prometheus-&gt;histogram(
            'api_request_duration_seconds',
            'API request duration',
            ['endpoint', 'method', 'status'],
            [0.01, 0.05, 0.1, 0.5, 1, 2.5, 5, 10]
        )-&gt;observe($duration, [$endpoint, request()-&gt;method(), $statusCode]);

        // Increment request counter
        $this-&gt;prometheus-&gt;counter(
            'api_requests_total',
            'Total API requests',
            ['endpoint', 'method', 'status']
        )-&gt;inc([$endpoint, request()-&gt;method(), $statusCode]);
    }

    public function recordBusinessMetric(string $metric, float $value, array $labels = [])
    {
        $this-&gt;prometheus-&gt;gauge(
            &quot;business_{$metric}&quot;,
            &quot;Business metric: {$metric}&quot;,
            array_keys($labels)
        )-&gt;set($value, array_values($labels));
    }
}
</code></pre>
<h2 id="infrastructure-monitoring">Infrastructure Monitoring</h2>
<h3 id="prometheus-setup">Prometheus Setup</h3>
<pre><code class="language-yaml"># docker-compose.monitoring.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    volumes:
      - ./prometheus/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
      - '--web.console.libraries=/usr/share/prometheus/console_libraries'
      - '--web.console.templates=/usr/share/prometheus/consoles'
      - '--web.enable-lifecycle'
    ports:
      - &quot;9090:9090&quot;
    restart: unless-stopped

  node_exporter:
    image: prom/node-exporter:latest
    container_name: node_exporter
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--path.rootfs=/rootfs'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    ports:
      - &quot;9100:9100&quot;
    restart: unless-stopped

  mysql_exporter:
    image: prom/mysqld-exporter:latest
    container_name: mysql_exporter
    environment:
      DATA_SOURCE_NAME: &quot;exporter:password@(mysql:3306)/&quot;
    ports:
      - &quot;9104:9104&quot;
    restart: unless-stopped

volumes:
  prometheus_data:
</code></pre>
<h3 id="prometheus-configuration">Prometheus Configuration</h3>
<pre><code class="language-yaml"># prometheus/prometheus.yml
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    environment: 'production'
    region: 'eu-central-1'

# Alerting
alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

# Rule files
rule_files:
  - &quot;alerts/*.yml&quot;

# Scrape configurations
scrape_configs:
  # Application metrics
  - job_name: 'askproai-app'
    static_configs:
      - targets: ['app:9091']
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        replacement: 'askproai-web'

  # Node metrics
  - job_name: 'node'
    static_configs:
      - targets: ['node_exporter:9100']

  # MySQL metrics
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql_exporter:9104']

  # Redis metrics
  - job_name: 'redis'
    static_configs:
      - targets: ['redis_exporter:9121']

  # Nginx metrics
  - job_name: 'nginx'
    static_configs:
      - targets: ['nginx_exporter:9113']
</code></pre>
<h3 id="grafana-dashboards">Grafana Dashboards</h3>
<pre><code class="language-json">// grafana/dashboards/askproai-overview.json
{
  &quot;dashboard&quot;: {
    &quot;title&quot;: &quot;AskProAI Overview&quot;,
    &quot;panels&quot;: [
      {
        &quot;title&quot;: &quot;Request Rate&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;rate(api_requests_total[5m])&quot;,
            &quot;legendFormat&quot;: &quot;{{method}} {{endpoint}}&quot;
          }
        ],
        &quot;type&quot;: &quot;graph&quot;
      },
      {
        &quot;title&quot;: &quot;Response Time (95th percentile)&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;histogram_quantile(0.95, rate(api_request_duration_seconds_bucket[5m]))&quot;,
            &quot;legendFormat&quot;: &quot;{{endpoint}}&quot;
          }
        ],
        &quot;type&quot;: &quot;graph&quot;
      },
      {
        &quot;title&quot;: &quot;Active Calls&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;business_active_calls&quot;,
            &quot;legendFormat&quot;: &quot;Active Calls&quot;
          }
        ],
        &quot;type&quot;: &quot;stat&quot;
      },
      {
        &quot;title&quot;: &quot;Appointments Today&quot;,
        &quot;targets&quot;: [
          {
            &quot;expr&quot;: &quot;business_appointments_today&quot;,
            &quot;legendFormat&quot;: &quot;Appointments&quot;
          }
        ],
        &quot;type&quot;: &quot;stat&quot;
      }
    ]
  }
}
</code></pre>
<h2 id="log-management">Log Management</h2>
<h3 id="elk-stack-setup">ELK Stack Setup</h3>
<pre><code class="language-yaml"># docker-compose.elk.yml
version: '3.8'

services:
  elasticsearch:
    image: docker.elastic.co/elasticsearch/elasticsearch:8.8.0
    container_name: elasticsearch
    environment:
      - discovery.type=single-node
      - &quot;ES_JAVA_OPTS=-Xms2g -Xmx2g&quot;
      - xpack.security.enabled=false
    volumes:
      - elasticsearch_data:/usr/share/elasticsearch/data
    ports:
      - &quot;9200:9200&quot;

  logstash:
    image: docker.elastic.co/logstash/logstash:8.8.0
    container_name: logstash
    volumes:
      - ./logstash/pipeline:/usr/share/logstash/pipeline
    ports:
      - &quot;5000:5000&quot;
      - &quot;9600:9600&quot;
    depends_on:
      - elasticsearch

  kibana:
    image: docker.elastic.co/kibana/kibana:8.8.0
    container_name: kibana
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    ports:
      - &quot;5601:5601&quot;
    depends_on:
      - elasticsearch

volumes:
  elasticsearch_data:
</code></pre>
<h3 id="logstash-configuration">Logstash Configuration</h3>
<pre><code class="language-ruby"># logstash/pipeline/logstash.conf
input {
  tcp {
    port =&gt; 5000
    codec =&gt; json
  }

  file {
    path =&gt; &quot;/var/log/askproai/*.log&quot;
    start_position =&gt; &quot;beginning&quot;
    codec =&gt; &quot;json&quot;
  }
}

filter {
  # Parse Laravel logs
  if [type] == &quot;laravel&quot; {
    grok {
      match =&gt; {
        &quot;message&quot; =&gt; &quot;\[%{TIMESTAMP_ISO8601:timestamp}\] %{DATA:env}\.%{LOGLEVEL:level}: %{GREEDYDATA:log_message}&quot;
      }
    }

    date {
      match =&gt; [ &quot;timestamp&quot;, &quot;ISO8601&quot; ]
    }
  }

  # Parse nginx access logs
  if [type] == &quot;nginx-access&quot; {
    grok {
      match =&gt; {
        &quot;message&quot; =&gt; '%{IPORHOST:remote_addr} - %{DATA:remote_user} \[%{HTTPDATE:time_local}\] &quot;%{WORD:method} %{URIPATHPARAM:request} HTTP/%{NUMBER:http_version}&quot; %{NUMBER:status} %{NUMBER:body_bytes_sent} &quot;%{DATA:http_referer}&quot; &quot;%{DATA:http_user_agent}&quot;'
      }
    }
  }

  # Add GeoIP information
  if [remote_addr] {
    geoip {
      source =&gt; &quot;remote_addr&quot;
      target =&gt; &quot;geoip&quot;
    }
  }
}

output {
  elasticsearch {
    hosts =&gt; [&quot;elasticsearch:9200&quot;]
    index =&gt; &quot;askproai-%{type}-%{+YYYY.MM.dd}&quot;
  }

  # Send critical errors to monitoring
  if [level] == &quot;ERROR&quot; or [level] == &quot;CRITICAL&quot; {
    http {
      url =&gt; &quot;http://monitoring-webhook/alert&quot;
      http_method =&gt; &quot;post&quot;
      format =&gt; &quot;json&quot;
    }
  }
}
</code></pre>
<h2 id="alerting-rules">Alerting Rules</h2>
<h3 id="prometheus-alert-rules">Prometheus Alert Rules</h3>
<pre><code class="language-yaml"># prometheus/alerts/application.yml
groups:
  - name: application
    interval: 30s
    rules:
      - alert: HighErrorRate
        expr: rate(api_requests_total{status=~&quot;5..&quot;}[5m]) &gt; 0.05
        for: 5m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: &quot;High error rate detected&quot;
          description: &quot;Error rate is {{ $value | humanizePercentage }} for {{ $labels.endpoint }}&quot;

      - alert: SlowResponseTime
        expr: histogram_quantile(0.95, rate(api_request_duration_seconds_bucket[5m])) &gt; 1
        for: 10m
        labels:
          severity: warning
          team: backend
        annotations:
          summary: &quot;Slow API response time&quot;
          description: &quot;95th percentile response time is {{ $value }}s for {{ $labels.endpoint }}&quot;

      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes &gt; 0.9
        for: 5m
        labels:
          severity: warning
          team: ops
        annotations:
          summary: &quot;High memory usage&quot;
          description: &quot;Memory usage is {{ $value | humanizePercentage }}&quot;

  - name: business
    interval: 60s
    rules:
      - alert: NoCallsProcessed
        expr: increase(business_calls_processed[1h]) == 0
        for: 1h
        labels:
          severity: warning
          team: business
        annotations:
          summary: &quot;No calls processed in the last hour&quot;
          description: &quot;Check Retell.ai integration&quot;

      - alert: HighBookingFailureRate
        expr: rate(business_booking_failures[5m]) / rate(business_booking_attempts[5m]) &gt; 0.1
        for: 15m
        labels:
          severity: critical
          team: backend
        annotations:
          summary: &quot;High booking failure rate&quot;
          description: &quot;Booking failure rate is {{ $value | humanizePercentage }}&quot;
</code></pre>
<h3 id="alertmanager-configuration">Alertmanager Configuration</h3>
<pre><code class="language-yaml"># alertmanager/alertmanager.yml
global:
  resolve_timeout: 5m
  slack_api_url: 'YOUR_SLACK_WEBHOOK_URL'

route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 12h
  receiver: 'default'

  routes:
    - match:
        severity: critical
      receiver: 'pagerduty-critical'
      continue: true

    - match:
        team: backend
      receiver: 'backend-team'

    - match:
        team: ops
      receiver: 'ops-team'

receivers:
  - name: 'default'
    slack_configs:
      - channel: '#alerts'
        title: 'AskProAI Alert'
        text: '{{ range .Alerts }}{{ .Annotations.summary }}{{ end }}'

  - name: 'pagerduty-critical'
    pagerduty_configs:
      - service_key: 'YOUR_PAGERDUTY_SERVICE_KEY'
        description: '{{ .GroupLabels.alertname }}'

  - name: 'backend-team'
    slack_configs:
      - channel: '#backend-alerts'
        send_resolved: true

  - name: 'ops-team'
    slack_configs:
      - channel: '#ops-alerts'
        send_resolved: true
</code></pre>
<h2 id="custom-monitoring-dashboards">Custom Monitoring Dashboards</h2>
<h3 id="business-metrics-dashboard">Business Metrics Dashboard</h3>
<pre><code class="language-php">// app/Http/Controllers/Admin/MonitoringController.php
class MonitoringController extends Controller
{
    public function dashboard()
    {
        $metrics = [
            'real_time' =&gt; $this-&gt;getRealTimeMetrics(),
            'hourly' =&gt; $this-&gt;getHourlyMetrics(),
            'daily' =&gt; $this-&gt;getDailyMetrics(),
            'alerts' =&gt; $this-&gt;getActiveAlerts(),
        ];

        return view('admin.monitoring.dashboard', compact('metrics'));
    }

    private function getRealTimeMetrics()
    {
        return Cache::remember('metrics:realtime', 10, function () {
            return [
                'active_calls' =&gt; Call::where('status', 'in_progress')-&gt;count(),
                'queue_size' =&gt; Redis::llen('queues:default'),
                'response_time' =&gt; $this-&gt;getAverageResponseTime(),
                'error_rate' =&gt; $this-&gt;getCurrentErrorRate(),
                'active_users' =&gt; Redis::scard('active_users'),
            ];
        });
    }

    private function getHourlyMetrics()
    {
        return Cache::remember('metrics:hourly', 300, function () {
            $hour = now()-&gt;subHour();

            return [
                'calls_received' =&gt; Call::where('created_at', '&gt;=', $hour)-&gt;count(),
                'appointments_booked' =&gt; Appointment::where('created_at', '&gt;=', $hour)-&gt;count(),
                'conversion_rate' =&gt; $this-&gt;getConversionRate($hour),
                'revenue' =&gt; $this-&gt;getRevenue($hour),
            ];
        });
    }
}
</code></pre>
<h3 id="real-time-monitoring-view">Real-time Monitoring View</h3>
<pre><code class="language-blade">{{-- resources/views/admin/monitoring/dashboard.blade.php --}}
@extends('layouts.admin')

@section('content')
&lt;div class=&quot;monitoring-dashboard&quot; x-data=&quot;monitoringDashboard()&quot;&gt;
    &lt;!-- Real-time Metrics --&gt;
    &lt;div class=&quot;grid grid-cols-1 md:grid-cols-5 gap-4 mb-6&quot;&gt;
        &lt;div class=&quot;metric-card&quot;&gt;
            &lt;h3&gt;Active Calls&lt;/h3&gt;
            &lt;div class=&quot;metric-value&quot; x-text=&quot;metrics.active_calls&quot;&gt;-&lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;metric-card&quot;&gt;
            &lt;h3&gt;Queue Size&lt;/h3&gt;
            &lt;div class=&quot;metric-value&quot; x-text=&quot;metrics.queue_size&quot;&gt;-&lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;metric-card&quot;&gt;
            &lt;h3&gt;Response Time&lt;/h3&gt;
            &lt;div class=&quot;metric-value&quot;&gt;
                &lt;span x-text=&quot;metrics.response_time&quot;&gt;&lt;/span&gt;ms
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;metric-card&quot;&gt;
            &lt;h3&gt;Error Rate&lt;/h3&gt;
            &lt;div class=&quot;metric-value&quot; 
                 :class=&quot;{'text-red-600': metrics.error_rate &gt; 5}&quot;&gt;
                &lt;span x-text=&quot;metrics.error_rate&quot;&gt;&lt;/span&gt;%
            &lt;/div&gt;
        &lt;/div&gt;

        &lt;div class=&quot;metric-card&quot;&gt;
            &lt;h3&gt;Active Users&lt;/h3&gt;
            &lt;div class=&quot;metric-value&quot; x-text=&quot;metrics.active_users&quot;&gt;-&lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- Charts --&gt;
    &lt;div class=&quot;grid grid-cols-1 md:grid-cols-2 gap-6&quot;&gt;
        &lt;div class=&quot;chart-container&quot;&gt;
            &lt;h3&gt;Request Rate (Last Hour)&lt;/h3&gt;
            &lt;canvas id=&quot;requestRateChart&quot;&gt;&lt;/canvas&gt;
        &lt;/div&gt;

        &lt;div class=&quot;chart-container&quot;&gt;
            &lt;h3&gt;Response Times (Last Hour)&lt;/h3&gt;
            &lt;canvas id=&quot;responseTimeChart&quot;&gt;&lt;/canvas&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;!-- Active Alerts --&gt;
    &lt;div class=&quot;alerts-section mt-6&quot;&gt;
        &lt;h3&gt;Active Alerts&lt;/h3&gt;
        &lt;div class=&quot;alerts-list&quot;&gt;
            &lt;template x-for=&quot;alert in alerts&quot; :key=&quot;alert.id&quot;&gt;
                &lt;div class=&quot;alert-item&quot; 
                     :class=&quot;'alert-' + alert.severity&quot;&gt;
                    &lt;span class=&quot;alert-time&quot; x-text=&quot;alert.time&quot;&gt;&lt;/span&gt;
                    &lt;span class=&quot;alert-message&quot; x-text=&quot;alert.message&quot;&gt;&lt;/span&gt;
                &lt;/div&gt;
            &lt;/template&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;

&lt;script&gt;
function monitoringDashboard() {
    return {
        metrics: @json($metrics['real_time']),
        alerts: @json($metrics['alerts']),

        init() {
            // Update metrics every 10 seconds
            setInterval(() =&gt; this.updateMetrics(), 10000);

            // Initialize charts
            this.initCharts();
        },

        async updateMetrics() {
            try {
                const response = await fetch('/admin/monitoring/metrics');
                const data = await response.json();
                this.metrics = data.real_time;
                this.alerts = data.alerts;
            } catch (error) {
                console.error('Failed to update metrics:', error);
            }
        },

        initCharts() {
            // Request rate chart
            new Chart(document.getElementById('requestRateChart'), {
                type: 'line',
                data: {
                    labels: @json($metrics['hourly']['labels']),
                    datasets: [{
                        label: 'Requests/min',
                        data: @json($metrics['hourly']['request_rate']),
                        borderColor: 'rgb(59, 130, 246)',
                        tension: 0.1
                    }]
                }
            });

            // Response time chart
            new Chart(document.getElementById('responseTimeChart'), {
                type: 'line',
                data: {
                    labels: @json($metrics['hourly']['labels']),
                    datasets: [{
                        label: 'p50',
                        data: @json($metrics['hourly']['p50']),
                        borderColor: 'rgb(34, 197, 94)'
                    }, {
                        label: 'p95',
                        data: @json($metrics['hourly']['p95']),
                        borderColor: 'rgb(251, 191, 36)'
                    }, {
                        label: 'p99',
                        data: @json($metrics['hourly']['p99']),
                        borderColor: 'rgb(239, 68, 68)'
                    }]
                }
            });
        }
    };
}
&lt;/script&gt;
@endsection
</code></pre>
<h2 id="health-checks">Health Checks</h2>
<h3 id="application-health-endpoint">Application Health Endpoint</h3>
<pre><code class="language-php">// app/Http/Controllers/HealthController.php
class HealthController extends Controller
{
    public function check()
    {
        $checks = [
            'database' =&gt; $this-&gt;checkDatabase(),
            'redis' =&gt; $this-&gt;checkRedis(),
            'filesystem' =&gt; $this-&gt;checkFilesystem(),
            'services' =&gt; $this-&gt;checkExternalServices(),
            'queue' =&gt; $this-&gt;checkQueue(),
        ];

        $status = collect($checks)-&gt;every(fn($check) =&gt; $check['status'] === 'healthy') 
            ? 'healthy' 
            : 'unhealthy';

        return response()-&gt;json([
            'status' =&gt; $status,
            'timestamp' =&gt; now()-&gt;toIso8601String(),
            'version' =&gt; config('app.version'),
            'checks' =&gt; $checks,
        ], $status === 'healthy' ? 200 : 503);
    }

    private function checkDatabase(): array
    {
        try {
            $start = microtime(true);
            DB::select('SELECT 1');
            $duration = (microtime(true) - $start) * 1000;

            return [
                'status' =&gt; 'healthy',
                'response_time_ms' =&gt; round($duration, 2),
            ];
        } catch (\Exception $e) {
            return [
                'status' =&gt; 'unhealthy',
                'error' =&gt; $e-&gt;getMessage(),
            ];
        }
    }

    private function checkExternalServices(): array
    {
        $services = [
            'retell' =&gt; $this-&gt;checkRetell(),
            'calcom' =&gt; $this-&gt;checkCalcom(),
            'stripe' =&gt; $this-&gt;checkStripe(),
        ];

        $healthyCount = collect($services)-&gt;filter(fn($s) =&gt; $s['status'] === 'healthy')-&gt;count();

        return [
            'status' =&gt; $healthyCount === count($services) ? 'healthy' : 'degraded',
            'services' =&gt; $services,
        ];
    }
}
</code></pre>
<h3 id="automated-health-monitoring">Automated Health Monitoring</h3>
<pre><code class="language-php">// app/Console/Commands/MonitorHealth.php
class MonitorHealth extends Command
{
    protected $signature = 'monitor:health';

    public function handle()
    {
        $response = Http::timeout(5)-&gt;get(config('app.url') . '/health');

        if ($response-&gt;failed() || $response-&gt;json('status') !== 'healthy') {
            // Send alert
            Notification::route('slack', config('monitoring.slack_webhook'))
                -&gt;notify(new HealthCheckFailed($response-&gt;json()));

            // Log to monitoring system
            Log::channel('monitoring')-&gt;error('Health check failed', [
                'response' =&gt; $response-&gt;json(),
                'status_code' =&gt; $response-&gt;status(),
            ]);

            return 1;
        }

        // Record successful health check
        Cache::put('last_health_check', now(), 300);

        return 0;
    }
}
</code></pre>
<h2 id="performance-monitoring">Performance Monitoring</h2>
<h3 id="apm-integration">APM Integration</h3>
<pre><code class="language-php">// app/Providers/MonitoringServiceProvider.php
class MonitoringServiceProvider extends ServiceProvider
{
    public function boot()
    {
        // Track database queries
        if (config('monitoring.track_queries')) {
            DB::listen(function ($query) {
                if ($query-&gt;time &gt; 100) { // Log slow queries
                    Log::channel('slow-queries')-&gt;warning('Slow query detected', [
                        'sql' =&gt; $query-&gt;sql,
                        'bindings' =&gt; $query-&gt;bindings,
                        'time' =&gt; $query-&gt;time,
                        'connection' =&gt; $query-&gt;connectionName,
                    ]);
                }

                // Send to APM
                if (app()-&gt;bound('newrelic')) {
                    app('newrelic')-&gt;recordDatastoreSegment(
                        'MySQL',
                        $query-&gt;sql,
                        $query-&gt;time
                    );
                }
            });
        }

        // Track HTTP requests
        Event::listen(RequestHandled::class, function ($event) {
            $duration = microtime(true) - LARAVEL_START;

            app(MetricsCollector::class)-&gt;recordApiRequest(
                $event-&gt;request-&gt;route()-&gt;uri ?? 'unknown',
                $duration,
                $event-&gt;response-&gt;getStatusCode()
            );
        });
    }
}
</code></pre>
<h2 id="monitoring-best-practices">Monitoring Best Practices</h2>
<h3 id="1-alert-fatigue-prevention">1. <strong>Alert Fatigue Prevention</strong></h3>
<ul>
<li>Set appropriate thresholds</li>
<li>Use alert grouping and deduplication</li>
<li>Implement escalation policies</li>
<li>Regular alert review and tuning</li>
</ul>
<h3 id="2-data-retention">2. <strong>Data Retention</strong></h3>
<pre><code class="language-yaml">Metrics retention:
  - Real-time: 24 hours
  - 5-minute aggregates: 7 days
  - Hourly aggregates: 30 days
  - Daily aggregates: 1 year

Log retention:
  - Application logs: 30 days
  - Access logs: 90 days
  - Audit logs: 2 years
  - Debug logs: 7 days
</code></pre>
<h3 id="3-dashboard-design">3. <strong>Dashboard Design</strong></h3>
<ul>
<li>Focus on actionable metrics</li>
<li>Use consistent color coding</li>
<li>Implement drill-down capabilities</li>
<li>Mobile-responsive design</li>
</ul>
<h3 id="4-incident-response">4. <strong>Incident Response</strong></h3>
<pre><code class="language-markdown">## Incident Response Playbook

1. **Detection**
   - Automated alert received
   - Verify issue is real (not false positive)
   - Assess severity and impact

2. **Response**
   - Acknowledge alert in PagerDuty
   - Join incident channel in Slack
   - Begin investigation using dashboards

3. **Mitigation**
   - Apply immediate fixes if possible
   - Scale resources if needed
   - Communicate with stakeholders

4. **Resolution**
   - Verify issue is resolved
   - Monitor for recurrence
   - Document root cause

5. **Post-mortem**
   - Schedule blameless post-mortem
   - Identify action items
   - Update monitoring/alerts
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../operations/performance.md">Performance Optimization</a></li>
<li><a href="../operations/alerting.md">Alerting Configuration</a></li>
<li><a href="../operations/logging.md">Logging Strategy</a></li>
<li><a href="../operations/incident-response.md">Incident Response</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
