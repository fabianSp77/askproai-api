<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/deployment/scaling/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Scaling Guide - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Scaling Guide";
        var mkdocs_page_input_path = "docs/deployment/scaling.md";
        var mkdocs_page_url = "/mkdocs/docs/deployment/scaling/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Scaling Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="scaling-guide">Scaling Guide</h1>
<h2 id="overview">Overview</h2>
<p>This guide covers strategies for scaling AskProAI to handle increased load, from vertical scaling of a single server to horizontal scaling across multiple servers and regions.</p>
<h2 id="scaling-strategies">Scaling Strategies</h2>
<h3 id="current-load-metrics">Current Load Metrics</h3>
<p>Before scaling, understand your current load:</p>
<pre><code class="language-php">// app/Console/Commands/AnalyzeLoad.php
class AnalyzeLoad extends Command
{
    protected $signature = 'analyze:load';

    public function handle()
    {
        $metrics = [
            'requests_per_minute' =&gt; $this-&gt;getRequestRate(),
            'concurrent_users' =&gt; $this-&gt;getConcurrentUsers(),
            'database_queries_per_second' =&gt; $this-&gt;getDatabaseLoad(),
            'queue_jobs_per_minute' =&gt; $this-&gt;getQueueThroughput(),
            'average_response_time' =&gt; $this-&gt;getAverageResponseTime(),
            'peak_memory_usage' =&gt; $this-&gt;getPeakMemoryUsage(),
        ];

        $this-&gt;table(['Metric', 'Value', 'Threshold', 'Status'], 
            collect($metrics)-&gt;map(function ($value, $metric) {
                $threshold = config(&quot;scaling.thresholds.{$metric}&quot;);
                $status = $value &gt; $threshold * 0.8 ? '⚠️ Warning' : '✅ OK';
                return [$metric, $value, $threshold, $status];
            })-&gt;toArray()
        );
    }
}
</code></pre>
<h2 id="vertical-scaling">Vertical Scaling</h2>
<h3 id="server-upgrade-path">Server Upgrade Path</h3>
<pre><code class="language-yaml"># Scaling tiers
Small (Current):
  CPU: 4 cores
  RAM: 8 GB
  Storage: 100 GB SSD
  Users: Up to 100 concurrent

Medium:
  CPU: 8 cores
  RAM: 16 GB
  Storage: 250 GB SSD
  Users: Up to 500 concurrent

Large:
  CPU: 16 cores
  RAM: 32 GB
  Storage: 500 GB SSD
  Users: Up to 1000 concurrent

Extra Large:
  CPU: 32 cores
  RAM: 64 GB
  Storage: 1 TB NVMe
  Users: Up to 2500 concurrent
</code></pre>
<h3 id="optimization-before-scaling">Optimization Before Scaling</h3>
<pre><code class="language-bash"># PHP-FPM tuning for more cores
# /etc/php/8.2/fpm/pool.d/www.conf

pm = dynamic
pm.max_children = 100  # Was 50
pm.start_servers = 20  # Was 10
pm.min_spare_servers = 10  # Was 5
pm.max_spare_servers = 30  # Was 15
pm.max_requests = 1000

# MySQL tuning for more RAM
# /etc/mysql/mysql.conf.d/mysqld.cnf
innodb_buffer_pool_size = 16G  # 70% of RAM
innodb_buffer_pool_instances = 8
innodb_log_file_size = 2G
thread_cache_size = 100
</code></pre>
<h2 id="horizontal-scaling">Horizontal Scaling</h2>
<h3 id="architecture-overview">Architecture Overview</h3>
<pre><code>                    ┌─────────────────┐
                    │  Load Balancer  │
                    │   (HAProxy)     │
                    └────────┬────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
   ┌────▼─────┐        ┌────▼─────┐        ┌────▼─────┐
   │  Web 1   │        │  Web 2   │        │  Web 3   │
   │  Nginx   │        │  Nginx   │        │  Nginx   │
   │  PHP-FPM │        │  PHP-FPM │        │  PHP-FPM │
   └──────────┘        └──────────┘        └──────────┘
        │                    │                    │
        └────────────────────┼────────────────────┘
                             │
                    ┌────────▼────────┐
                    │   Shared Redis  │
                    │  Session Store  │
                    └─────────────────┘
                             │
                    ┌────────▼────────┐
                    │    MySQL       │
                    │  Primary/Replica│
                    └─────────────────┘
</code></pre>
<h3 id="load-balancer-configuration">Load Balancer Configuration</h3>
<pre><code class="language-nginx"># /etc/haproxy/haproxy.cfg
global
    maxconn 4096
    log /dev/log local0
    chroot /var/lib/haproxy
    stats socket /run/haproxy/admin.sock mode 660 level admin
    stats timeout 30s

defaults
    mode http
    log global
    option httplog
    option dontlognull
    timeout connect 5000
    timeout client 50000
    timeout server 50000

frontend web_frontend
    bind *:80
    bind *:443 ssl crt /etc/ssl/certs/askproai.pem
    redirect scheme https if !{ ssl_fc }

    # Rate limiting
    stick-table type ip size 100k expire 30s store http_req_rate(10s)
    http-request track-sc0 src
    http-request deny if { sc_http_req_rate(0) gt 100 }

    default_backend web_servers

backend web_servers
    balance roundrobin
    option httpchk GET /health

    # Session affinity
    cookie SERVERID insert indirect nocache

    server web1 10.0.1.10:80 check cookie web1
    server web2 10.0.1.11:80 check cookie web2
    server web3 10.0.1.12:80 check cookie web3
</code></pre>
<h3 id="database-scaling">Database Scaling</h3>
<h4 id="read-replica-setup">Read Replica Setup</h4>
<pre><code class="language-sql">-- On primary server
CREATE USER 'replication'@'%' IDENTIFIED BY 'strong_password';
GRANT REPLICATION SLAVE ON *.* TO 'replication'@'%';
FLUSH PRIVILEGES;

-- Get binary log position
SHOW MASTER STATUS;
</code></pre>
<pre><code class="language-sql">-- On replica server
CHANGE MASTER TO
    MASTER_HOST='10.0.1.20',
    MASTER_USER='replication',
    MASTER_PASSWORD='strong_password',
    MASTER_LOG_FILE='mysql-bin.000001',
    MASTER_LOG_POS=154;

START SLAVE;
SHOW SLAVE STATUS\G;
</code></pre>
<h4 id="laravel-configuration-for-read-replicas">Laravel Configuration for Read Replicas</h4>
<pre><code class="language-php">// config/database.php
'mysql' =&gt; [
    'read' =&gt; [
        'host' =&gt; [
            env('DB_READ_HOST_1', '10.0.1.21'),
            env('DB_READ_HOST_2', '10.0.1.22'),
        ],
    ],
    'write' =&gt; [
        'host' =&gt; [
            env('DB_WRITE_HOST', '10.0.1.20'),
        ],
    ],
    'sticky' =&gt; true,
    'driver' =&gt; 'mysql',
    // ... rest of config
],
</code></pre>
<h3 id="redis-cluster">Redis Cluster</h3>
<h4 id="redis-sentinel-setup">Redis Sentinel Setup</h4>
<pre><code class="language-bash"># /etc/redis/sentinel.conf
port 26379
sentinel monitor mymaster 10.0.1.30 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel parallel-syncs mymaster 1
sentinel failover-timeout mymaster 10000
</code></pre>
<h4 id="laravel-redis-cluster-configuration">Laravel Redis Cluster Configuration</h4>
<pre><code class="language-php">// config/database.php
'redis' =&gt; [
    'client' =&gt; env('REDIS_CLIENT', 'phpredis'),

    'clusters' =&gt; [
        'default' =&gt; [
            [
                'host' =&gt; env('REDIS_HOST_1', '10.0.1.30'),
                'password' =&gt; env('REDIS_PASSWORD', null),
                'port' =&gt; env('REDIS_PORT', 6379),
                'database' =&gt; 0,
            ],
            [
                'host' =&gt; env('REDIS_HOST_2', '10.0.1.31'),
                'password' =&gt; env('REDIS_PASSWORD', null),
                'port' =&gt; env('REDIS_PORT', 6379),
                'database' =&gt; 0,
            ],
        ],
    ],

    'options' =&gt; [
        'cluster' =&gt; env('REDIS_CLUSTER', 'redis'),
        'prefix' =&gt; env('REDIS_PREFIX', 'askproai_'),
    ],
],
</code></pre>
<h3 id="queue-scaling">Queue Scaling</h3>
<h4 id="dedicated-queue-workers">Dedicated Queue Workers</h4>
<pre><code class="language-yaml"># docker-compose.queue.yml
version: '3.8'

services:
  queue-high:
    image: askproai:latest
    command: php artisan horizon
    environment:
      - HORIZON_PREFIX=high
      - HORIZON_QUEUE=critical,high
    deploy:
      replicas: 3

  queue-default:
    image: askproai:latest
    command: php artisan horizon
    environment:
      - HORIZON_PREFIX=default
      - HORIZON_QUEUE=default
    deploy:
      replicas: 5

  queue-low:
    image: askproai:latest
    command: php artisan horizon
    environment:
      - HORIZON_PREFIX=low
      - HORIZON_QUEUE=low,reports
    deploy:
      replicas: 2
</code></pre>
<h3 id="file-storage-scaling">File Storage Scaling</h3>
<h4 id="s3-compatible-storage">S3-Compatible Storage</h4>
<pre><code class="language-php">// config/filesystems.php
'disks' =&gt; [
    's3' =&gt; [
        'driver' =&gt; 's3',
        'key' =&gt; env('AWS_ACCESS_KEY_ID'),
        'secret' =&gt; env('AWS_SECRET_ACCESS_KEY'),
        'region' =&gt; env('AWS_DEFAULT_REGION'),
        'bucket' =&gt; env('AWS_BUCKET'),
        'url' =&gt; env('AWS_URL'),
        'endpoint' =&gt; env('AWS_ENDPOINT'),
        'use_path_style_endpoint' =&gt; env('AWS_USE_PATH_STYLE_ENDPOINT', false),
    ],

    'local' =&gt; [
        'driver' =&gt; 'local',
        'root' =&gt; storage_path('app'),
        'throw' =&gt; false,
    ],
],

'default' =&gt; env('FILESYSTEM_DISK', 's3'),
</code></pre>
<h2 id="auto-scaling">Auto-Scaling</h2>
<h3 id="aws-auto-scaling-group">AWS Auto Scaling Group</h3>
<pre><code class="language-yaml"># terraform/autoscaling.tf
resource &quot;aws_autoscaling_group&quot; &quot;web_asg&quot; {
  name                = &quot;askproai-web-asg&quot;
  vpc_zone_identifier = aws_subnet.private.*.id
  target_group_arns   = [aws_lb_target_group.web.arn]
  health_check_type   = &quot;ELB&quot;
  health_check_grace_period = 300

  min_size         = 2
  max_size         = 10
  desired_capacity = 3

  launch_template {
    id      = aws_launch_template.web.id
    version = &quot;$Latest&quot;
  }

  tag {
    key                 = &quot;Name&quot;
    value               = &quot;askproai-web&quot;
    propagate_at_launch = true
  }
}

resource &quot;aws_autoscaling_policy&quot; &quot;scale_up&quot; {
  name                   = &quot;askproai-scale-up&quot;
  scaling_adjustment     = 2
  adjustment_type        = &quot;ChangeInCapacity&quot;
  cooldown              = 300
  autoscaling_group_name = aws_autoscaling_group.web_asg.name
}

resource &quot;aws_cloudwatch_metric_alarm&quot; &quot;high_cpu&quot; {
  alarm_name          = &quot;askproai-high-cpu&quot;
  comparison_operator = &quot;GreaterThanThreshold&quot;
  evaluation_periods  = &quot;2&quot;
  metric_name         = &quot;CPUUtilization&quot;
  namespace           = &quot;AWS/EC2&quot;
  period              = &quot;120&quot;
  statistic           = &quot;Average&quot;
  threshold           = &quot;80&quot;
  alarm_description   = &quot;This metric monitors ec2 cpu utilization&quot;
  alarm_actions       = [aws_autoscaling_policy.scale_up.arn]
}
</code></pre>
<h3 id="kubernetes-horizontal-pod-autoscaler">Kubernetes Horizontal Pod Autoscaler</h3>
<pre><code class="language-yaml"># k8s/hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: askproai-web-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: askproai-web
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  - type: Pods
    pods:
      metric:
        name: http_requests_per_second
      target:
        type: AverageValue
        averageValue: &quot;1000&quot;
</code></pre>
<h2 id="caching-strategy">Caching Strategy</h2>
<h3 id="multi-level-caching">Multi-Level Caching</h3>
<pre><code class="language-php">// app/Services/Cache/MultiLevelCache.php
class MultiLevelCache
{
    private array $levels = [];

    public function __construct()
    {
        $this-&gt;levels = [
            'l1' =&gt; new APCuCache(),      // Local memory cache
            'l2' =&gt; new RedisCache(),      // Shared Redis cache
            'l3' =&gt; new DatabaseCache(),   // Database fallback
        ];
    }

    public function get(string $key)
    {
        foreach ($this-&gt;levels as $level =&gt; $cache) {
            if ($value = $cache-&gt;get($key)) {
                // Populate higher levels
                $this-&gt;populateUpperLevels($level, $key, $value);
                return $value;
            }
        }

        return null;
    }

    public function set(string $key, $value, int $ttl = 3600)
    {
        foreach ($this-&gt;levels as $cache) {
            $cache-&gt;set($key, $value, $ttl);
        }
    }
}
</code></pre>
<h3 id="cdn-integration">CDN Integration</h3>
<pre><code class="language-nginx"># Cloudflare Page Rules
/*
Cache Level: Cache Everything
Edge Cache TTL: 1 month

/api/*
Cache Level: Bypass
Always Use HTTPS: On

/assets/*
Browser Cache TTL: 1 year
Edge Cache TTL: 1 month
</code></pre>
<h2 id="database-optimization">Database Optimization</h2>
<h3 id="query-optimization">Query Optimization</h3>
<pre><code class="language-php">// app/Services/QueryOptimizer.php
class QueryOptimizer
{
    public function optimizeForScale()
    {
        // Use covering indexes
        Schema::table('appointments', function (Blueprint $table) {
            $table-&gt;index(['company_id', 'date', 'status', 'created_at'], 'covering_idx');
        });

        // Partition large tables
        DB::statement('
            ALTER TABLE calls
            PARTITION BY RANGE (YEAR(created_at)) (
                PARTITION p2023 VALUES LESS THAN (2024),
                PARTITION p2024 VALUES LESS THAN (2025),
                PARTITION p2025 VALUES LESS THAN (2026),
                PARTITION p_future VALUES LESS THAN MAXVALUE
            )
        ');

        // Archive old data
        DB::statement('
            CREATE TABLE calls_archive LIKE calls;
            INSERT INTO calls_archive 
            SELECT * FROM calls 
            WHERE created_at &lt; DATE_SUB(NOW(), INTERVAL 1 YEAR);
            DELETE FROM calls 
            WHERE created_at &lt; DATE_SUB(NOW(), INTERVAL 1 YEAR);
        ');
    }
}
</code></pre>
<h3 id="connection-pooling">Connection Pooling</h3>
<pre><code class="language-php">// config/database.php
'mysql' =&gt; [
    'driver' =&gt; 'mysql',
    'host' =&gt; env('DB_HOST'),
    'options' =&gt; [
        PDO::ATTR_PERSISTENT =&gt; true,
        PDO::MYSQL_ATTR_INIT_COMMAND =&gt; &quot;SET SESSION sql_mode='STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'&quot;,
    ],
    'pool' =&gt; [
        'min' =&gt; 5,
        'max' =&gt; 20,
    ],
],
</code></pre>
<h2 id="microservices-architecture">Microservices Architecture</h2>
<h3 id="service-decomposition">Service Decomposition</h3>
<pre><code class="language-yaml"># Services breakdown
api-gateway:
  - Authentication
  - Rate limiting
  - Request routing

appointment-service:
  - Appointment CRUD
  - Availability checking
  - Calendar sync

communication-service:
  - Email sending
  - SMS sending
  - WhatsApp integration

billing-service:
  - Subscription management
  - Payment processing
  - Invoice generation

analytics-service:
  - Metrics collection
  - Report generation
  - Real-time dashboards
</code></pre>
<h3 id="service-communication">Service Communication</h3>
<pre><code class="language-php">// app/Services/Microservices/AppointmentClient.php
class AppointmentClient
{
    private $httpClient;

    public function __construct()
    {
        $this-&gt;httpClient = Http::timeout(5)
            -&gt;retry(3, 100)
            -&gt;baseUrl(config('services.appointment.url'))
            -&gt;withHeaders([
                'X-Service-Token' =&gt; config('services.appointment.token'),
            ]);
    }

    public function createAppointment(array $data): Appointment
    {
        $response = $this-&gt;httpClient-&gt;post('/appointments', $data);

        if ($response-&gt;failed()) {
            throw new ServiceException('Appointment service unavailable');
        }

        return new Appointment($response-&gt;json());
    }
}
</code></pre>
<h2 id="monitoring-at-scale">Monitoring at Scale</h2>
<h3 id="distributed-tracing">Distributed Tracing</h3>
<pre><code class="language-php">// app/Http/Middleware/DistributedTracing.php
class DistributedTracing
{
    public function handle($request, Closure $next)
    {
        $traceId = $request-&gt;header('X-Trace-ID') ?? Str::uuid();
        $spanId = Str::uuid();

        // Add to context
        Log::shareContext([
            'trace_id' =&gt; $traceId,
            'span_id' =&gt; $spanId,
        ]);

        // Add to response
        $response = $next($request);
        $response-&gt;headers-&gt;set('X-Trace-ID', $traceId);

        // Send to tracing service
        dispatch(function () use ($traceId, $spanId, $request, $response) {
            TracingService::record([
                'trace_id' =&gt; $traceId,
                'span_id' =&gt; $spanId,
                'service' =&gt; 'api-gateway',
                'operation' =&gt; $request-&gt;route()-&gt;getName(),
                'duration' =&gt; microtime(true) - LARAVEL_START,
                'status_code' =&gt; $response-&gt;status(),
            ]);
        })-&gt;afterResponse();

        return $response;
    }
}
</code></pre>
<h3 id="metrics-aggregation">Metrics Aggregation</h3>
<pre><code class="language-yaml"># prometheus.yml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'askproai-web'
    static_configs:
      - targets: ['web1:9090', 'web2:9090', 'web3:9090']

  - job_name: 'askproai-queue'
    static_configs:
      - targets: ['queue1:9090', 'queue2:9090']

  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-primary:9104', 'mysql-replica:9104']
</code></pre>
<h2 id="performance-testing">Performance Testing</h2>
<h3 id="load-testing-script">Load Testing Script</h3>
<pre><code class="language-bash">#!/bin/bash
# load-test.sh

# Test configuration
CONCURRENT_USERS=1000
DURATION=300
RAMP_UP=60

# Run load test
k6 run \
  --vus $CONCURRENT_USERS \
  --duration ${DURATION}s \
  --ramp-up ${RAMP_UP}s \
  load-test.js

# Analyze results
k6 cloud --token $K6_CLOUD_TOKEN
</code></pre>
<pre><code class="language-javascript">// load-test.js
import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
  stages: [
    { duration: '1m', target: 100 },
    { duration: '3m', target: 1000 },
    { duration: '1m', target: 0 },
  ],
  thresholds: {
    http_req_duration: ['p(95)&lt;500'],
    http_req_failed: ['rate&lt;0.01'],
  },
};

export default function () {
  // Test appointment booking flow
  let response = http.post('https://api.askproai.de/api/appointments', {
    customer_name: 'Test User',
    service_id: 1,
    date: '2025-07-01',
    time: '14:00',
  });

  check(response, {
    'status is 201': (r) =&gt; r.status === 201,
    'response time &lt; 500ms': (r) =&gt; r.timings.duration &lt; 500,
  });

  sleep(1);
}
</code></pre>
<h2 id="cost-optimization">Cost Optimization</h2>
<h3 id="resource-right-sizing">Resource Right-Sizing</h3>
<pre><code class="language-php">// app/Console/Commands/AnalyzeResourceUsage.php
class AnalyzeResourceUsage extends Command
{
    public function handle()
    {
        $metrics = [
            'cpu_utilization' =&gt; $this-&gt;getCpuUtilization(),
            'memory_utilization' =&gt; $this-&gt;getMemoryUtilization(),
            'storage_utilization' =&gt; $this-&gt;getStorageUtilization(),
            'network_utilization' =&gt; $this-&gt;getNetworkUtilization(),
        ];

        $recommendations = [];

        if ($metrics['cpu_utilization'] &lt; 20) {
            $recommendations[] = 'Consider downsizing CPU resources';
        }

        if ($metrics['memory_utilization'] &lt; 50) {
            $recommendations[] = 'Consider reducing memory allocation';
        }

        $this-&gt;info('Resource Usage Analysis:');
        $this-&gt;table(['Resource', 'Usage', 'Recommendation'], 
            collect($metrics)-&gt;map(function ($usage, $resource) use ($recommendations) {
                return [$resource, &quot;{$usage}%&quot;, $recommendations[$resource] ?? 'Optimal'];
            })-&gt;toArray()
        );
    }
}
</code></pre>
<h3 id="spot-instance-strategy">Spot Instance Strategy</h3>
<pre><code class="language-yaml"># terraform/spot-instances.tf
resource &quot;aws_spot_fleet_request&quot; &quot;workers&quot; {
  iam_fleet_role = aws_iam_role.spot_fleet.arn

  allocation_strategy = &quot;diversified&quot;
  target_capacity     = 10
  valid_until        = &quot;2025-12-31T23:59:59Z&quot;

  launch_specification {
    instance_type     = &quot;c5.large&quot;
    ami              = data.aws_ami.askproai.id
    key_name         = aws_key_pair.deployer.key_name
    availability_zone = &quot;eu-central-1a&quot;

    user_data = base64encode(templatefile(&quot;userdata.sh&quot;, {
      role = &quot;queue-worker&quot;
    }))
  }

  launch_specification {
    instance_type     = &quot;c5.xlarge&quot;
    ami              = data.aws_ami.askproai.id
    key_name         = aws_key_pair.deployer.key_name
    availability_zone = &quot;eu-central-1b&quot;

    user_data = base64encode(templatefile(&quot;userdata.sh&quot;, {
      role = &quot;queue-worker&quot;
    }))
  }
}
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../operations/performance.md">Performance Optimization</a></li>
<li><a href="../../operations/monitoring/">Monitoring</a></li>
<li><a href="../production/">Production Deployment</a></li>
<li><a href="../../configuration/database/">Database Configuration</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
