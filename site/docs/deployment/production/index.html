<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/deployment/production/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Production Deployment Guide - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Production Deployment Guide";
        var mkdocs_page_input_path = "docs/deployment/production.md";
        var mkdocs_page_url = "/mkdocs/docs/deployment/production/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Production Deployment Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="production-deployment-guide">Production Deployment Guide</h1>
<h2 id="overview">Overview</h2>
<p>This guide covers best practices and procedures for deploying AskProAI to production, including deployment strategies, optimization, security hardening, and maintenance procedures.</p>
<h2 id="pre-deployment-checklist">Pre-Deployment Checklist</h2>
<h3 id="code-preparation">Code Preparation</h3>
<pre><code class="language-bash"># Ensure all tests pass
php artisan test
npm run test

# Check code quality
./vendor/bin/phpstan analyse
./vendor/bin/php-cs-fixer fix --dry-run

# Verify no debug code
grep -r &quot;dd(&quot; app/
grep -r &quot;dump(&quot; app/
grep -r &quot;var_dump&quot; app/

# Check for sensitive data
grep -r &quot;password&quot; .env.example
grep -r &quot;secret&quot; config/
</code></pre>
<h3 id="environment-verification">Environment Verification</h3>
<pre><code class="language-bash"># Verify production environment
APP_ENV=production
APP_DEBUG=false
APP_URL=https://api.askproai.de

# Ensure all required services are configured
php artisan config:show services

# Test external connections
php artisan askproai:test-connections
</code></pre>
<h2 id="deployment-strategies">Deployment Strategies</h2>
<h3 id="blue-green-deployment">Blue-Green Deployment</h3>
<pre><code class="language-bash">#!/bin/bash
# deploy-blue-green.sh

BLUE_DIR=&quot;/var/www/api-gateway-blue&quot;
GREEN_DIR=&quot;/var/www/api-gateway-green&quot;
CURRENT_DIR=&quot;/var/www/api-gateway&quot;

# Determine which is current
if [ &quot;$(readlink $CURRENT_DIR)&quot; = &quot;$BLUE_DIR&quot; ]; then
    DEPLOY_TO=$GREEN_DIR
    OLD_DIR=$BLUE_DIR
else
    DEPLOY_TO=$BLUE_DIR
    OLD_DIR=$GREEN_DIR
fi

echo &quot;Deploying to $DEPLOY_TO&quot;

# Deploy new version
cd $DEPLOY_TO
git pull origin main
composer install --optimize-autoloader --no-dev
npm ci &amp;&amp; npm run build

# Copy environment file
cp $OLD_DIR/.env $DEPLOY_TO/.env

# Run migrations
php artisan migrate --force

# Cache everything
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan event:cache

# Warm up cache
php artisan cache:warm

# Run health checks
php artisan health:check

# Switch symlink
ln -sfn $DEPLOY_TO $CURRENT_DIR

# Reload PHP-FPM
sudo systemctl reload php8.2-fpm

echo &quot;Deployment complete&quot;
</code></pre>
<h3 id="rolling-deployment-with-zero-downtime">Rolling Deployment with Zero Downtime</h3>
<pre><code class="language-php">// app/Console/Commands/DeployRolling.php
class DeployRolling extends Command
{
    protected $signature = 'deploy:rolling';

    public function handle()
    {
        $this-&gt;info('Starting rolling deployment...');

        // Put application in maintenance mode with secret
        $secret = Str::random(32);
        $this-&gt;call('down', [
            '--secret' =&gt; $secret,
            '--render' =&gt; 'errors::503',
            '--retry' =&gt; 60,
        ]);

        $this-&gt;info(&quot;Maintenance mode enabled. Secret: {$secret}&quot;);

        // Run deployment tasks
        $this-&gt;runDeploymentTasks();

        // Bring application back online
        $this-&gt;call('up');

        $this-&gt;info('Deployment complete!');
    }

    private function runDeploymentTasks()
    {
        // Update code
        $this-&gt;info('Updating code...');
        exec('git pull origin main');

        // Install dependencies
        $this-&gt;info('Installing dependencies...');
        exec('composer install --optimize-autoloader --no-dev');
        exec('npm ci &amp;&amp; npm run build');

        // Run migrations
        $this-&gt;info('Running migrations...');
        $this-&gt;call('migrate', ['--force' =&gt; true]);

        // Clear and rebuild caches
        $this-&gt;info('Rebuilding caches...');
        $this-&gt;call('optimize:clear');
        $this-&gt;call('optimize');

        // Restart queue workers gracefully
        $this-&gt;info('Restarting queue workers...');
        $this-&gt;call('horizon:terminate');
        sleep(5);
        exec('sudo supervisorctl restart horizon');
    }
}
</code></pre>
<h3 id="container-based-deployment">Container-Based Deployment</h3>
<pre><code class="language-dockerfile"># Dockerfile
FROM php:8.2-fpm

# Install dependencies
RUN apt-get update &amp;&amp; apt-get install -y \
    git \
    curl \
    libpng-dev \
    libonig-dev \
    libxml2-dev \
    zip \
    unzip \
    nginx \
    supervisor

# Install PHP extensions
RUN docker-php-ext-install pdo_mysql mbstring exif pcntl bcmath gd

# Install Composer
COPY --from=composer:latest /usr/bin/composer /usr/bin/composer

# Set working directory
WORKDIR /var/www

# Copy application
COPY . .

# Install dependencies
RUN composer install --optimize-autoloader --no-dev
RUN npm ci &amp;&amp; npm run build

# Copy configuration files
COPY docker/nginx/conf.d/app.conf /etc/nginx/conf.d/
COPY docker/supervisor/conf.d/supervisord.conf /etc/supervisor/conf.d/

# Set permissions
RUN chown -R www-data:www-data /var/www

EXPOSE 80

CMD [&quot;/usr/bin/supervisord&quot;]
</code></pre>
<h2 id="production-optimization">Production Optimization</h2>
<h3 id="php-optimization">PHP Optimization</h3>
<pre><code class="language-ini">; /etc/php/8.2/fpm/conf.d/99-production.ini

; OPcache settings
opcache.enable=1
opcache.memory_consumption=512
opcache.interned_strings_buffer=64
opcache.max_accelerated_files=32531
opcache.revalidate_freq=0
opcache.save_comments=1
opcache.fast_shutdown=1
opcache.enable_file_override=1
opcache.validate_timestamps=0

; Performance settings
realpath_cache_size=4096K
realpath_cache_ttl=600
max_execution_time=30
max_input_time=60
memory_limit=512M

; Security
expose_php=Off
</code></pre>
<h3 id="laravel-optimization">Laravel Optimization</h3>
<pre><code class="language-bash"># Optimize autoloader
composer dump-autoload --optimize --no-dev

# Cache all configurations
php artisan optimize

# Compile assets
npm run production

# Enable route caching
php artisan route:cache

# Enable view caching
php artisan view:cache

# Enable event caching
php artisan event:cache

# Optimize database
php artisan db:optimize
</code></pre>
<h3 id="database-optimization">Database Optimization</h3>
<pre><code class="language-sql">-- Optimize tables
OPTIMIZE TABLE appointments;
OPTIMIZE TABLE calls;
OPTIMIZE TABLE customers;

-- Update statistics
ANALYZE TABLE appointments;
ANALYZE TABLE calls;
ANALYZE TABLE customers;

-- Add missing indexes
ALTER TABLE appointments ADD INDEX idx_date_status (date, status);
ALTER TABLE calls ADD INDEX idx_created_company (created_at, company_id);
</code></pre>
<h3 id="redis-optimization">Redis Optimization</h3>
<pre><code class="language-bash"># redis.conf optimizations
maxmemory 4gb
maxmemory-policy allkeys-lru
save &quot;&quot;  # Disable RDB snapshots if using AOF
appendonly yes
appendfsync everysec
no-appendfsync-on-rewrite yes
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb
</code></pre>
<h2 id="security-hardening">Security Hardening</h2>
<h3 id="server-security">Server Security</h3>
<pre><code class="language-bash"># Disable unnecessary services
sudo systemctl disable bluetooth
sudo systemctl disable cups

# Configure sysctl for security
sudo nano /etc/sysctl.d/99-security.conf

# Add these settings:
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_max_syn_backlog = 2048
net.ipv4.tcp_synack_retries = 2
net.ipv4.ip_forward = 0
net.ipv4.conf.all.send_redirects = 0
net.ipv4.conf.all.accept_redirects = 0
net.ipv4.conf.all.accept_source_route = 0
net.ipv4.conf.all.log_martians = 1

# Apply settings
sudo sysctl -p /etc/sysctl.d/99-security.conf
</code></pre>
<h3 id="application-security">Application Security</h3>
<pre><code class="language-php">// app/Http/Kernel.php
protected $middlewareGroups = [
    'web' =&gt; [
        \App\Http\Middleware\EncryptCookies::class,
        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,
        \Illuminate\Session\Middleware\StartSession::class,
        \App\Http\Middleware\SecurityHeaders::class,
        \App\Http\Middleware\PreventClickjacking::class,
        \App\Http\Middleware\ValidatePostSize::class,
        \App\Http\Middleware\ThrottleRequests::class,
    ],
];

// app/Http/Middleware/SecurityHeaders.php
public function handle($request, Closure $next)
{
    $response = $next($request);

    $response-&gt;headers-&gt;set('X-Content-Type-Options', 'nosniff');
    $response-&gt;headers-&gt;set('X-Frame-Options', 'DENY');
    $response-&gt;headers-&gt;set('X-XSS-Protection', '1; mode=block');
    $response-&gt;headers-&gt;set('Referrer-Policy', 'strict-origin-when-cross-origin');
    $response-&gt;headers-&gt;set('Content-Security-Policy', &quot;default-src 'self'&quot;);
    $response-&gt;headers-&gt;set('Permissions-Policy', 'geolocation=(), microphone=(), camera=()');

    if ($request-&gt;secure()) {
        $response-&gt;headers-&gt;set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload');
    }

    return $response;
}
</code></pre>
<h3 id="ssltls-configuration">SSL/TLS Configuration</h3>
<pre><code class="language-nginx"># /etc/nginx/sites-available/askproai-ssl

server {
    listen 443 ssl http2;
    server_name api.askproai.de;

    # SSL Configuration
    ssl_certificate /etc/letsencrypt/live/api.askproai.de/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/api.askproai.de/privkey.pem;

    # SSL Security
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # SSL Optimization
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    ssl_stapling on;
    ssl_stapling_verify on;

    # Security Headers
    add_header Strict-Transport-Security &quot;max-age=63072000; includeSubDomains; preload&quot; always;
    add_header X-Content-Type-Options &quot;nosniff&quot; always;
    add_header X-Frame-Options &quot;DENY&quot; always;
    add_header X-XSS-Protection &quot;1; mode=block&quot; always;
    add_header Referrer-Policy &quot;strict-origin-when-cross-origin&quot; always;
}
</code></pre>
<h2 id="monitoring-setup">Monitoring Setup</h2>
<h3 id="application-monitoring">Application Monitoring</h3>
<pre><code class="language-php">// config/monitoring.php
return [
    'alerts' =&gt; [
        'high_error_rate' =&gt; [
            'threshold' =&gt; 100, // errors per minute
            'duration' =&gt; 5, // minutes
            'channels' =&gt; ['slack', 'email'],
        ],
        'slow_response' =&gt; [
            'threshold' =&gt; 1000, // milliseconds
            'percentile' =&gt; 95,
            'channels' =&gt; ['slack'],
        ],
        'queue_size' =&gt; [
            'threshold' =&gt; 1000,
            'queues' =&gt; ['default', 'webhooks'],
            'channels' =&gt; ['slack', 'sms'],
        ],
        'failed_jobs' =&gt; [
            'threshold' =&gt; 10,
            'window' =&gt; 60, // minutes
            'channels' =&gt; ['email', 'slack'],
        ],
    ],
];
</code></pre>
<h3 id="health-checks">Health Checks</h3>
<pre><code class="language-php">// app/Http/Controllers/HealthController.php
class HealthController extends Controller
{
    public function check()
    {
        $checks = [
            'database' =&gt; $this-&gt;checkDatabase(),
            'redis' =&gt; $this-&gt;checkRedis(),
            'queue' =&gt; $this-&gt;checkQueue(),
            'storage' =&gt; $this-&gt;checkStorage(),
            'services' =&gt; $this-&gt;checkExternalServices(),
        ];

        $healthy = collect($checks)-&gt;every(fn($check) =&gt; $check['status'] === 'healthy');

        return response()-&gt;json([
            'status' =&gt; $healthy ? 'healthy' : 'unhealthy',
            'timestamp' =&gt; now()-&gt;toIso8601String(),
            'checks' =&gt; $checks,
        ], $healthy ? 200 : 503);
    }

    private function checkDatabase(): array
    {
        try {
            DB::select('SELECT 1');
            return ['status' =&gt; 'healthy', 'response_time' =&gt; DB::getQueryLog()[0]['time'] ?? 0];
        } catch (\Exception $e) {
            return ['status' =&gt; 'unhealthy', 'error' =&gt; $e-&gt;getMessage()];
        }
    }
}
</code></pre>
<h2 id="backup-procedures">Backup Procedures</h2>
<h3 id="automated-backup-script">Automated Backup Script</h3>
<pre><code class="language-bash">#!/bin/bash
# /usr/local/bin/askproai-backup.sh

# Configuration
BACKUP_DIR=&quot;/var/backups/askproai&quot;
S3_BUCKET=&quot;s3://askproai-backups&quot;
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

# Create backup directory
mkdir -p $BACKUP_DIR

# Database backup
echo &quot;Backing up database...&quot;
mysqldump \
    --single-transaction \
    --routines \
    --triggers \
    --add-drop-table \
    -h localhost \
    -u askproai_user \
    -p'password' \
    askproai_db | gzip &gt; $BACKUP_DIR/db_$DATE.sql.gz

# Application files backup
echo &quot;Backing up application files...&quot;
tar -czf $BACKUP_DIR/files_$DATE.tar.gz \
    -C /var/www/api-gateway \
    storage/app \
    .env \
    --exclude=storage/app/public/cache

# Upload to S3
echo &quot;Uploading to S3...&quot;
aws s3 cp $BACKUP_DIR/db_$DATE.sql.gz $S3_BUCKET/daily/
aws s3 cp $BACKUP_DIR/files_$DATE.tar.gz $S3_BUCKET/daily/

# Cleanup old backups
echo &quot;Cleaning up old backups...&quot;
find $BACKUP_DIR -type f -mtime +7 -delete
aws s3 ls $S3_BUCKET/daily/ | while read -r line; do
    createDate=$(echo $line | awk '{print $1&quot; &quot;$2}')
    createDate=$(date -d &quot;$createDate&quot; +%s)
    olderThan=$(date -d &quot;$RETENTION_DAYS days ago&quot; +%s)
    if [[ $createDate -lt $olderThan ]]; then
        fileName=$(echo $line | awk '{print $4}')
        aws s3 rm $S3_BUCKET/daily/$fileName
    fi
done

echo &quot;Backup completed&quot;
</code></pre>
<h3 id="backup-verification">Backup Verification</h3>
<pre><code class="language-bash">#!/bin/bash
# /usr/local/bin/verify-backup.sh

LATEST_BACKUP=$(ls -t /var/backups/askproai/db_*.sql.gz | head -1)
TEMP_DB=&quot;askproai_verify&quot;

echo &quot;Verifying backup: $LATEST_BACKUP&quot;

# Create temporary database
mysql -u root -p -e &quot;CREATE DATABASE IF NOT EXISTS $TEMP_DB&quot;

# Restore backup
gunzip &lt; $LATEST_BACKUP | mysql -u root -p $TEMP_DB

# Run verification queries
TABLES=$(mysql -u root -p $TEMP_DB -e &quot;SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='$TEMP_DB'&quot; -s -N)
APPOINTMENTS=$(mysql -u root -p $TEMP_DB -e &quot;SELECT COUNT(*) FROM appointments&quot; -s -N)

echo &quot;Tables: $TABLES&quot;
echo &quot;Appointments: $APPOINTMENTS&quot;

# Cleanup
mysql -u root -p -e &quot;DROP DATABASE $TEMP_DB&quot;

if [ $TABLES -gt 50 ] &amp;&amp; [ $APPOINTMENTS -gt 0 ]; then
    echo &quot;Backup verification: PASSED&quot;
    exit 0
else
    echo &quot;Backup verification: FAILED&quot;
    exit 1
fi
</code></pre>
<h2 id="maintenance-mode">Maintenance Mode</h2>
<h3 id="scheduled-maintenance">Scheduled Maintenance</h3>
<pre><code class="language-php">// app/Console/Commands/ScheduledMaintenance.php
class ScheduledMaintenance extends Command
{
    protected $signature = 'maintenance:scheduled {--duration=30}';

    public function handle()
    {
        $duration = $this-&gt;option('duration');

        // Notify users in advance
        Notification::send(
            User::whereHas('roles', fn($q) =&gt; $q-&gt;where('name', 'admin'))-&gt;get(),
            new MaintenanceScheduled($duration)
        );

        // Schedule maintenance mode
        $this-&gt;info(&quot;Scheduling maintenance in 5 minutes for {$duration} minutes&quot;);

        sleep(300); // Wait 5 minutes

        // Enable maintenance mode
        $this-&gt;call('down', [
            '--message' =&gt; 'Scheduled maintenance in progress',
            '--retry' =&gt; $duration * 60,
            '--refresh' =&gt; 15,
        ]);

        // Perform maintenance tasks
        $this-&gt;performMaintenance();

        // Disable maintenance mode
        $this-&gt;call('up');

        $this-&gt;info('Maintenance completed');
    }
}
</code></pre>
<h3 id="emergency-maintenance">Emergency Maintenance</h3>
<pre><code class="language-bash"># Enable maintenance mode immediately
php artisan down --message=&quot;Emergency maintenance&quot; --retry=60

# Allow specific IPs during maintenance
php artisan down --allow=192.168.1.1 --allow=10.0.0.1

# Create custom maintenance page
php artisan down --render=&quot;errors::maintenance&quot;
</code></pre>
<h2 id="rollback-procedures">Rollback Procedures</h2>
<h3 id="database-rollback">Database Rollback</h3>
<pre><code class="language-bash">#!/bin/bash
# rollback-database.sh

BACKUP_FILE=$1
TEMP_DB=&quot;askproai_rollback&quot;

echo &quot;Rolling back database to: $BACKUP_FILE&quot;

# Create backup of current state
mysqldump -u askproai_user -p askproai_db | gzip &gt; rollback_before_$(date +%Y%m%d_%H%M%S).sql.gz

# Restore from backup
gunzip &lt; $BACKUP_FILE | mysql -u askproai_user -p askproai_db

echo &quot;Database rolled back successfully&quot;
</code></pre>
<h3 id="code-rollback">Code Rollback</h3>
<pre><code class="language-bash">#!/bin/bash
# rollback-code.sh

PREVIOUS_RELEASE=$1

cd /var/www/api-gateway

# Create backup tag
git tag -a &quot;rollback-$(date +%Y%m%d_%H%M%S)&quot; -m &quot;Rollback point&quot;

# Rollback to previous release
git checkout $PREVIOUS_RELEASE

# Install dependencies for that release
composer install --optimize-autoloader --no-dev
npm ci &amp;&amp; npm run build

# Clear caches
php artisan optimize:clear
php artisan optimize

# Restart services
sudo systemctl reload php8.2-fpm
sudo supervisorctl restart horizon

echo &quot;Code rolled back to $PREVIOUS_RELEASE&quot;
</code></pre>
<h2 id="performance-tuning">Performance Tuning</h2>
<h3 id="database-tuning">Database Tuning</h3>
<pre><code class="language-sql">-- Monitor slow queries
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 1;
SET GLOBAL slow_query_log_file = '/var/log/mysql/slow-query.log';

-- Analyze query performance
EXPLAIN ANALYZE 
SELECT * FROM appointments 
WHERE company_id = 1 
  AND date &gt;= CURDATE() 
  AND status = 'scheduled'
ORDER BY date, time;
</code></pre>
<h3 id="redis-tuning">Redis Tuning</h3>
<pre><code class="language-bash"># Monitor Redis performance
redis-cli --latency
redis-cli --latency-history
redis-cli --latency-dist

# Check memory usage
redis-cli INFO memory

# Enable Redis slow log
redis-cli CONFIG SET slowlog-log-slower-than 10000
redis-cli SLOWLOG GET 10
</code></pre>
<h2 id="post-deployment-verification">Post-Deployment Verification</h2>
<h3 id="automated-tests">Automated Tests</h3>
<pre><code class="language-bash">#!/bin/bash
# post-deploy-test.sh

echo &quot;Running post-deployment tests...&quot;

# API endpoint tests
curl -f https://api.askproai.de/api/health || exit 1
curl -f https://api.askproai.de/api/version || exit 1

# Database connectivity
php artisan tinker --execute=&quot;DB::select('SELECT 1')&quot; || exit 1

# Redis connectivity
php artisan tinker --execute=&quot;Redis::ping()&quot; || exit 1

# Queue processing
php artisan queue:work --stop-when-empty || exit 1

# External service connectivity
php artisan askproai:test-connections || exit 1

echo &quot;All tests passed!&quot;
</code></pre>
<h3 id="monitoring-alerts">Monitoring Alerts</h3>
<pre><code class="language-php">// app/Console/Commands/PostDeploymentCheck.php
class PostDeploymentCheck extends Command
{
    protected $signature = 'deploy:verify';

    public function handle()
    {
        $checks = [
            'Application Version' =&gt; config('app.version'),
            'Database Migrations' =&gt; $this-&gt;checkMigrations(),
            'Cache Status' =&gt; $this-&gt;checkCache(),
            'Queue Workers' =&gt; $this-&gt;checkQueues(),
            'External Services' =&gt; $this-&gt;checkServices(),
            'Error Rate' =&gt; $this-&gt;checkErrorRate(),
        ];

        $this-&gt;table(['Check', 'Status'], 
            collect($checks)-&gt;map(fn($status, $check) =&gt; [$check, $status])-&gt;toArray()
        );

        if (collect($checks)-&gt;contains('Failed')) {
            $this-&gt;error('Post-deployment verification failed!');
            return 1;
        }

        $this-&gt;info('Post-deployment verification passed!');
        return 0;
    }
}
</code></pre>
<h2 id="disaster-recovery">Disaster Recovery</h2>
<h3 id="recovery-plan">Recovery Plan</h3>
<pre><code class="language-yaml"># disaster-recovery-plan.yml
recovery_objectives:
  rto: 4 hours  # Recovery Time Objective
  rpo: 1 hour   # Recovery Point Objective

backup_locations:
  - type: local
    path: /var/backups/askproai
    retention: 7 days
  - type: s3
    bucket: askproai-backups
    retention: 30 days
  - type: glacier
    bucket: askproai-archive
    retention: 1 year

recovery_procedures:
  1_assess:
    - Identify scope of disaster
    - Activate incident response team
    - Communicate with stakeholders

  2_restore:
    - Provision new infrastructure if needed
    - Restore latest database backup
    - Restore application code
    - Restore configuration files

  3_verify:
    - Run system health checks
    - Verify data integrity
    - Test critical functionality

  4_resume:
    - Update DNS if needed
    - Enable application
    - Monitor closely for 24 hours
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../installation/">Installation Guide</a></li>
<li><a href="../../operations/monitoring/">Monitoring Setup</a></li>
<li><a href="../backup/">Backup Strategies</a></li>
<li><a href="../operations/performance.md">Performance Optimization</a></li>
<li><a href="../../configuration/security/">Security Best Practices</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
