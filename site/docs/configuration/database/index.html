<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/configuration/database/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Database Configuration - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Database Configuration";
        var mkdocs_page_input_path = "docs/configuration/database.md";
        var mkdocs_page_url = "/mkdocs/docs/configuration/database/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Database Configuration</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="database-configuration">Database Configuration</h1>
<h2 id="overview">Overview</h2>
<p>AskProAI uses MySQL/MariaDB as the primary database with support for read replicas, connection pooling, and performance optimization. This guide covers database configuration, optimization, and best practices.</p>
<h2 id="database-connection">Database Connection</h2>
<h3 id="primary-configuration">Primary Configuration</h3>
<pre><code class="language-php">// config/database.php
return [
    'default' =&gt; env('DB_CONNECTION', 'mysql'),

    'connections' =&gt; [
        'mysql' =&gt; [
            'driver' =&gt; 'mysql',
            'url' =&gt; env('DATABASE_URL'),
            'host' =&gt; env('DB_HOST', '127.0.0.1'),
            'port' =&gt; env('DB_PORT', '3306'),
            'database' =&gt; env('DB_DATABASE', 'askproai_db'),
            'username' =&gt; env('DB_USERNAME', 'askproai_user'),
            'password' =&gt; env('DB_PASSWORD', ''),
            'unix_socket' =&gt; env('DB_SOCKET', ''),
            'charset' =&gt; 'utf8mb4',
            'collation' =&gt; 'utf8mb4_unicode_ci',
            'prefix' =&gt; '',
            'prefix_indexes' =&gt; true,
            'strict' =&gt; true,
            'engine' =&gt; 'InnoDB',
            'options' =&gt; extension_loaded('pdo_mysql') ? array_filter([
                PDO::MYSQL_ATTR_SSL_CA =&gt; env('MYSQL_ATTR_SSL_CA'),
                PDO::MYSQL_ATTR_SSL_CERT =&gt; env('MYSQL_ATTR_SSL_CERT'),
                PDO::MYSQL_ATTR_SSL_KEY =&gt; env('MYSQL_ATTR_SSL_KEY'),
                PDO::MYSQL_ATTR_SSL_VERIFY_SERVER_CERT =&gt; false,
                PDO::ATTR_PERSISTENT =&gt; env('DB_PERSISTENT', false),
                PDO::ATTR_EMULATE_PREPARES =&gt; false,
                PDO::MYSQL_ATTR_USE_BUFFERED_QUERY =&gt; false,
            ]) : [],
        ],
    ],
];
</code></pre>
<h3 id="readwrite-splitting">Read/Write Splitting</h3>
<pre><code class="language-php">// config/database.php
'mysql' =&gt; [
    'read' =&gt; [
        'host' =&gt; [
            env('DB_READ_HOST_1', '127.0.0.1'),
            env('DB_READ_HOST_2', '127.0.0.1'),
        ],
        'port' =&gt; env('DB_READ_PORT', 3306),
        'username' =&gt; env('DB_READ_USERNAME', 'askproai_readonly'),
        'password' =&gt; env('DB_READ_PASSWORD'),
    ],
    'write' =&gt; [
        'host' =&gt; [
            env('DB_WRITE_HOST', '127.0.0.1'),
        ],
        'port' =&gt; env('DB_WRITE_PORT', 3306),
        'username' =&gt; env('DB_WRITE_USERNAME', 'askproai_user'),
        'password' =&gt; env('DB_WRITE_PASSWORD'),
    ],
    'sticky' =&gt; env('DB_STICKY', true), // Keep reading from write after writes
    'driver' =&gt; 'mysql',
    'database' =&gt; env('DB_DATABASE', 'askproai_db'),
    // ... other settings
],
</code></pre>
<h2 id="connection-pooling">Connection Pooling</h2>
<h3 id="database-connection-pool">Database Connection Pool</h3>
<pre><code class="language-php">// app/Services/Database/ConnectionPool.php
class ConnectionPool
{
    private array $connections = [];
    private int $maxConnections;
    private int $minConnections;

    public function __construct()
    {
        $this-&gt;maxConnections = config('database.pool.max', 20);
        $this-&gt;minConnections = config('database.pool.min', 5);

        $this-&gt;initializePool();
    }

    private function initializePool(): void
    {
        for ($i = 0; $i &lt; $this-&gt;minConnections; $i++) {
            $this-&gt;connections[] = $this-&gt;createConnection();
        }
    }

    public function getConnection(): PDO
    {
        if (empty($this-&gt;connections) &amp;&amp; count($this-&gt;activeConnections) &lt; $this-&gt;maxConnections) {
            return $this-&gt;createConnection();
        }

        return array_pop($this-&gt;connections) ?? $this-&gt;waitForConnection();
    }

    public function releaseConnection(PDO $connection): void
    {
        if ($this-&gt;isHealthy($connection)) {
            $this-&gt;connections[] = $connection;
        }
    }

    private function isHealthy(PDO $connection): bool
    {
        try {
            $connection-&gt;query('SELECT 1');
            return true;
        } catch (\Exception $e) {
            return false;
        }
    }
}
</code></pre>
<h3 id="connection-management">Connection Management</h3>
<pre><code class="language-php">// config/database.php
'pool' =&gt; [
    'min' =&gt; env('DB_POOL_MIN', 2),
    'max' =&gt; env('DB_POOL_MAX', 10),
    'idle_timeout' =&gt; env('DB_POOL_IDLE_TIMEOUT', 60),
    'max_lifetime' =&gt; env('DB_POOL_MAX_LIFETIME', 3600),
    'wait_timeout' =&gt; env('DB_POOL_WAIT_TIMEOUT', 3),
],
</code></pre>
<h2 id="database-optimization">Database Optimization</h2>
<h3 id="index-configuration">Index Configuration</h3>
<pre><code class="language-php">// database/migrations/2025_06_23_add_performance_indexes.php
class AddPerformanceIndexes extends Migration
{
    public function up()
    {
        // Composite indexes for common queries
        Schema::table('appointments', function (Blueprint $table) {
            $table-&gt;index(['company_id', 'date', 'status'], 'idx_company_date_status');
            $table-&gt;index(['branch_id', 'date'], 'idx_branch_date');
            $table-&gt;index(['customer_id', 'created_at'], 'idx_customer_created');
        });

        // Covering indexes for read-heavy queries
        Schema::table('calls', function (Blueprint $table) {
            $table-&gt;index(['company_id', 'created_at', 'status'], 'idx_company_created_status');
            $table-&gt;index(['phone_number', 'created_at'], 'idx_phone_created');
        });

        // Full-text search indexes
        DB::statement('ALTER TABLE customers ADD FULLTEXT idx_fulltext_search (name, email, notes)');

        // Partial indexes for filtered queries
        DB::statement('CREATE INDEX idx_active_appointments ON appointments (date, time) WHERE status = &quot;scheduled&quot;');
    }
}
</code></pre>
<h3 id="query-optimization">Query Optimization</h3>
<pre><code class="language-php">// app/Services/Database/QueryOptimizer.php
class QueryOptimizer
{
    public function analyzeSlowQueries(): array
    {
        $slowQueries = DB::select(&quot;
            SELECT 
                query_time,
                lock_time,
                rows_sent,
                rows_examined,
                sql_text,
                digest
            FROM mysql.slow_log
            WHERE query_time &gt; 1
            ORDER BY query_time DESC
            LIMIT 20
        &quot;);

        return collect($slowQueries)-&gt;map(function ($query) {
            return [
                'query' =&gt; $query-&gt;sql_text,
                'time' =&gt; $query-&gt;query_time,
                'rows_examined' =&gt; $query-&gt;rows_examined,
                'efficiency' =&gt; $query-&gt;rows_sent / max($query-&gt;rows_examined, 1),
                'suggestions' =&gt; $this-&gt;getSuggestions($query),
            ];
        })-&gt;toArray();
    }

    public function explainQuery(string $sql): array
    {
        $explanation = DB::select(&quot;EXPLAIN {$sql}&quot;);

        return collect($explanation)-&gt;map(function ($row) {
            return [
                'table' =&gt; $row-&gt;table,
                'type' =&gt; $row-&gt;type,
                'possible_keys' =&gt; $row-&gt;possible_keys,
                'key' =&gt; $row-&gt;key,
                'rows' =&gt; $row-&gt;rows,
                'extra' =&gt; $row-&gt;Extra,
                'optimization_level' =&gt; $this-&gt;rateOptimization($row),
            ];
        })-&gt;toArray();
    }

    private function rateOptimization($explanation): string
    {
        if ($explanation-&gt;type === 'ALL') {
            return 'poor'; // Full table scan
        }

        if (in_array($explanation-&gt;type, ['const', 'eq_ref'])) {
            return 'excellent';
        }

        if (in_array($explanation-&gt;type, ['ref', 'range'])) {
            return 'good';
        }

        return 'fair';
    }
}
</code></pre>
<h2 id="migration-strategies">Migration Strategies</h2>
<h3 id="zero-downtime-migrations">Zero-Downtime Migrations</h3>
<pre><code class="language-php">// app/Console/Commands/MigrateOnline.php
class MigrateOnline extends Command
{
    protected $signature = 'migrate:online {migration}';

    public function handle()
    {
        $migration = $this-&gt;argument('migration');

        // Use pt-online-schema-change for large tables
        if ($this-&gt;isLargeTable($migration)) {
            $this-&gt;runOnlineSchemaChange($migration);
        } else {
            $this-&gt;runStandardMigration($migration);
        }
    }

    private function runOnlineSchemaChange($migration)
    {
        $alterStatement = $this-&gt;getAlterStatement($migration);
        $table = $this-&gt;getTableName($migration);

        $command = sprintf(
            'pt-online-schema-change --alter=&quot;%s&quot; D=%s,t=%s --execute',
            $alterStatement,
            config('database.connections.mysql.database'),
            $table
        );

        $this-&gt;info(&quot;Running online schema change: {$command}&quot;);
        exec($command, $output, $returnCode);

        if ($returnCode !== 0) {
            $this-&gt;error('Online schema change failed');
            return 1;
        }

        $this-&gt;info('Online schema change completed successfully');
    }
}
</code></pre>
<h3 id="migration-best-practices">Migration Best Practices</h3>
<pre><code class="language-php">// database/migrations/2025_06_23_example_migration.php
class ExampleMigration extends Migration
{
    public function up()
    {
        // Disable foreign key checks for performance
        Schema::disableForeignKeyConstraints();

        // Use raw SQL for better control
        DB::statement('SET SESSION innodb_lock_wait_timeout = 5');

        // Add columns with default values to avoid locking
        Schema::table('large_table', function (Blueprint $table) {
            $table-&gt;boolean('new_column')-&gt;default(false)-&gt;after('existing_column');
        });

        // Create indexes concurrently (MySQL 8.0+)
        DB::statement('CREATE INDEX CONCURRENTLY idx_new ON large_table(new_column)');

        // Re-enable foreign key checks
        Schema::enableForeignKeyConstraints();
    }

    public function down()
    {
        // Always provide rollback capability
        Schema::table('large_table', function (Blueprint $table) {
            $table-&gt;dropColumn('new_column');
        });
    }
}
</code></pre>
<h2 id="database-monitoring">Database Monitoring</h2>
<h3 id="performance-metrics">Performance Metrics</h3>
<pre><code class="language-php">// app/Services/Database/DatabaseMonitor.php
class DatabaseMonitor
{
    public function getMetrics(): array
    {
        return [
            'connections' =&gt; $this-&gt;getConnectionMetrics(),
            'performance' =&gt; $this-&gt;getPerformanceMetrics(),
            'storage' =&gt; $this-&gt;getStorageMetrics(),
            'replication' =&gt; $this-&gt;getReplicationMetrics(),
        ];
    }

    private function getConnectionMetrics(): array
    {
        $result = DB::select(&quot;SHOW STATUS LIKE 'Threads_connected'&quot;)[0];
        $maxConnections = DB::select(&quot;SHOW VARIABLES LIKE 'max_connections'&quot;)[0];

        return [
            'current' =&gt; $result-&gt;Value,
            'max' =&gt; $maxConnections-&gt;Value,
            'usage_percentage' =&gt; round(($result-&gt;Value / $maxConnections-&gt;Value) * 100, 2),
        ];
    }

    private function getPerformanceMetrics(): array
    {
        $status = collect(DB::select(&quot;SHOW GLOBAL STATUS&quot;))
            -&gt;pluck('Value', 'Variable_name');

        return [
            'queries_per_second' =&gt; round($status['Questions'] / $status['Uptime'], 2),
            'slow_queries' =&gt; $status['Slow_queries'],
            'table_locks_waited' =&gt; $status['Table_locks_waited'],
            'innodb_buffer_pool_hit_rate' =&gt; $this-&gt;calculateBufferPoolHitRate($status),
        ];
    }

    private function calculateBufferPoolHitRate($status): float
    {
        $reads = $status['Innodb_buffer_pool_reads'] ?? 0;
        $readRequests = $status['Innodb_buffer_pool_read_requests'] ?? 1;

        return round((1 - ($reads / $readRequests)) * 100, 2);
    }
}
</code></pre>
<h3 id="query-logging">Query Logging</h3>
<pre><code class="language-php">// app/Providers/DatabaseQueryLogProvider.php
class DatabaseQueryLogProvider extends ServiceProvider
{
    public function boot()
    {
        if (config('app.debug') || config('database.log_queries')) {
            DB::listen(function ($query) {
                Log::channel('queries')-&gt;info('Query executed', [
                    'sql' =&gt; $query-&gt;sql,
                    'bindings' =&gt; $query-&gt;bindings,
                    'time' =&gt; $query-&gt;time,
                    'connection' =&gt; $query-&gt;connectionName,
                ]);

                // Alert on slow queries
                if ($query-&gt;time &gt; 1000) { // Over 1 second
                    Log::channel('slow-queries')-&gt;warning('Slow query detected', [
                        'sql' =&gt; $query-&gt;sql,
                        'time' =&gt; $query-&gt;time,
                        'trace' =&gt; debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, 10),
                    ]);
                }
            });
        }
    }
}
</code></pre>
<h2 id="backup-configuration">Backup Configuration</h2>
<h3 id="automated-backups">Automated Backups</h3>
<pre><code class="language-php">// config/backup.php
return [
    'backup' =&gt; [
        'name' =&gt; env('APP_NAME', 'askproai'),
        'source' =&gt; [
            'databases' =&gt; ['mysql'],
        ],
        'database_dump_compressor' =&gt; 'gzip',
        'database_dump_file_extension' =&gt; 'sql.gz',
        'destination' =&gt; [
            'filename_prefix' =&gt; 'backup-',
            'disks' =&gt; ['local', 's3'],
        ],
        'temporary_directory' =&gt; storage_path('app/backup-temp'),
        'password' =&gt; env('BACKUP_ARCHIVE_PASSWORD'),
        'encryption' =&gt; 'default',
    ],

    'notifications' =&gt; [
        'notifications' =&gt; [
            \Spatie\Backup\Notifications\Notifications\BackupHasFailedNotification::class,
            \Spatie\Backup\Notifications\Notifications\UnhealthyBackupWasFoundNotification::class,
            \Spatie\Backup\Notifications\Notifications\CleanupHasFailedNotification::class,
            \Spatie\Backup\Notifications\Notifications\BackupWasSuccessfulNotification::class,
            \Spatie\Backup\Notifications\Notifications\HealthyBackupWasFoundNotification::class,
            \Spatie\Backup\Notifications\Notifications\CleanupWasSuccessfulNotification::class,
        ],
        'notifiable' =&gt; \Spatie\Backup\Notifications\Notifiable::class,
        'mail' =&gt; [
            'to' =&gt; env('BACKUP_NOTIFICATION_EMAIL', 'admin@askproai.de'),
        ],
    ],

    'cleanup' =&gt; [
        'strategy' =&gt; \Spatie\Backup\Tasks\Cleanup\Strategies\DefaultStrategy::class,
        'default_strategy' =&gt; [
            'keep_all_backups_for_days' =&gt; 7,
            'keep_daily_backups_for_days' =&gt; 30,
            'keep_weekly_backups_for_weeks' =&gt; 8,
            'keep_monthly_backups_for_months' =&gt; 12,
            'keep_yearly_backups_for_years' =&gt; 2,
            'delete_oldest_backups_when_using_more_megabytes_than' =&gt; 5000,
        ],
    ],
];
</code></pre>
<h3 id="backup-verification">Backup Verification</h3>
<pre><code class="language-php">// app/Console/Commands/VerifyBackup.php
class VerifyBackup extends Command
{
    protected $signature = 'backup:verify {file}';

    public function handle()
    {
        $file = $this-&gt;argument('file');

        // Extract backup
        $this-&gt;info('Extracting backup...');
        $extractPath = $this-&gt;extractBackup($file);

        // Verify database dump
        $this-&gt;info('Verifying database dump...');
        if (!$this-&gt;verifyDatabaseDump($extractPath)) {
            $this-&gt;error('Database dump verification failed');
            return 1;
        }

        // Test restore to temporary database
        $this-&gt;info('Testing restore...');
        if (!$this-&gt;testRestore($extractPath)) {
            $this-&gt;error('Restore test failed');
            return 1;
        }

        $this-&gt;info('Backup verification successful');
        return 0;
    }
}
</code></pre>
<h2 id="database-security">Database Security</h2>
<h3 id="encryption-at-rest">Encryption at Rest</h3>
<pre><code class="language-php">// config/database.php
'mysql' =&gt; [
    // ... other config
    'options' =&gt; [
        PDO::MYSQL_ATTR_SSL_CA =&gt; env('MYSQL_ATTR_SSL_CA'),
        PDO::MYSQL_ATTR_SSL_CERT =&gt; env('MYSQL_ATTR_SSL_CERT'),
        PDO::MYSQL_ATTR_SSL_KEY =&gt; env('MYSQL_ATTR_SSL_KEY'),
        PDO::MYSQL_ATTR_SSL_VERIFY_SERVER_CERT =&gt; true,
    ],
],

// Enable table encryption
DB::statement(&quot;ALTER TABLE sensitive_data ENCRYPTION='Y'&quot;);
</code></pre>
<h3 id="access-control">Access Control</h3>
<pre><code class="language-sql">-- Create read-only user for reporting
CREATE USER 'askproai_readonly'@'%' IDENTIFIED BY 'secure_password';
GRANT SELECT ON askproai_db.* TO 'askproai_readonly'@'%';

-- Create backup user with minimal privileges
CREATE USER 'askproai_backup'@'localhost' IDENTIFIED BY 'secure_password';
GRANT SELECT, LOCK TABLES, SHOW VIEW, EVENT, TRIGGER ON askproai_db.* TO 'askproai_backup'@'localhost';

-- Application user with specific privileges
CREATE USER 'askproai_app'@'%' IDENTIFIED BY 'secure_password';
GRANT SELECT, INSERT, UPDATE, DELETE, CREATE TEMPORARY TABLES ON askproai_db.* TO 'askproai_app'@'%';
</code></pre>
<h2 id="database-maintenance">Database Maintenance</h2>
<h3 id="optimization-schedule">Optimization Schedule</h3>
<pre><code class="language-php">// app/Console/Kernel.php
protected function schedule(Schedule $schedule)
{
    // Optimize tables weekly
    $schedule-&gt;command('db:optimize')
        -&gt;weeklyOn(0, '03:00')
        -&gt;withoutOverlapping();

    // Analyze tables for query optimizer
    $schedule-&gt;command('db:analyze')
        -&gt;daily()
        -&gt;at('04:00');

    // Clean up old data
    $schedule-&gt;command('db:cleanup')
        -&gt;daily()
        -&gt;at('02:00');

    // Update statistics
    $schedule-&gt;command('db:update-stats')
        -&gt;twiceDaily(6, 18);
}
</code></pre>
<h3 id="maintenance-commands">Maintenance Commands</h3>
<pre><code class="language-php">// app/Console/Commands/OptimizeDatabase.php
class OptimizeDatabase extends Command
{
    protected $signature = 'db:optimize {--table=}';

    public function handle()
    {
        $tables = $this-&gt;option('table') 
            ? [$this-&gt;option('table')] 
            : $this-&gt;getAllTables();

        foreach ($tables as $table) {
            $this-&gt;info(&quot;Optimizing table: {$table}&quot;);

            DB::statement(&quot;ANALYZE TABLE {$table}&quot;);
            DB::statement(&quot;OPTIMIZE TABLE {$table}&quot;);

            // Update index statistics
            DB::statement(&quot;ALTER TABLE {$table} ENGINE=InnoDB&quot;);
        }

        $this-&gt;info('Database optimization completed');
    }
}
</code></pre>
<h2 id="testing-configuration">Testing Configuration</h2>
<h3 id="test-database">Test Database</h3>
<pre><code class="language-php">// config/database.php
'connections' =&gt; [
    'mysql_testing' =&gt; [
        'driver' =&gt; 'mysql',
        'host' =&gt; env('DB_TEST_HOST', '127.0.0.1'),
        'port' =&gt; env('DB_TEST_PORT', '3306'),
        'database' =&gt; env('DB_TEST_DATABASE', 'askproai_test'),
        'username' =&gt; env('DB_TEST_USERNAME', 'root'),
        'password' =&gt; env('DB_TEST_PASSWORD', ''),
        'charset' =&gt; 'utf8mb4',
        'collation' =&gt; 'utf8mb4_unicode_ci',
        'prefix' =&gt; '',
        'strict' =&gt; true,
        'engine' =&gt; 'InnoDB',
    ],

    'sqlite_testing' =&gt; [
        'driver' =&gt; 'sqlite',
        'database' =&gt; ':memory:',
        'prefix' =&gt; '',
        'foreign_key_constraints' =&gt; true,
    ],
],
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../deployment/migration.md">Migration Guide</a></li>
<li><a href="../operations/performance.md">Performance Optimization</a></li>
<li><a href="../../deployment/backup/">Backup Strategies</a></li>
<li><a href="../security/">Security Configuration</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
