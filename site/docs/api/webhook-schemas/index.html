<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/api/webhook-schemas/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Webhook Schemas - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Webhook Schemas";
        var mkdocs_page_input_path = "docs/api/webhook-schemas.md";
        var mkdocs_page_url = "/mkdocs/docs/api/webhook-schemas/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Webhook Schemas</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="webhook-schemas">Webhook Schemas</h1>
<h2 id="overview">Overview</h2>
<p>This document defines the webhook schemas for all external integrations in AskProAI. Each webhook includes signature verification for security.</p>
<h2 id="retellai-webhooks">Retell.ai Webhooks</h2>
<h3 id="webhook-configuration">Webhook Configuration</h3>
<ul>
<li><strong>URL</strong>: <code>https://api.askproai.de/api/retell/webhook</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Authentication</strong>: HMAC-SHA256 signature in <code>x-retell-signature</code> header</li>
</ul>
<h3 id="call_started-event">call_started Event</h3>
<pre><code class="language-json">{
  &quot;event_type&quot;: &quot;call_started&quot;,
  &quot;call_id&quot;: &quot;call_abc123def456&quot;,
  &quot;agent_id&quot;: &quot;agent_789ghi012jkl&quot;,
  &quot;from_number&quot;: &quot;+49301234567&quot;,
  &quot;to_number&quot;: &quot;+49309876543&quot;,
  &quot;direction&quot;: &quot;inbound&quot;,
  &quot;metadata&quot;: {
    &quot;custom_field&quot;: &quot;value&quot;
  },
  &quot;timestamp&quot;: &quot;2025-06-23T10:30:00Z&quot;
}
</code></pre>
<h3 id="call_ended-event">call_ended Event</h3>
<pre><code class="language-json">{
  &quot;event_type&quot;: &quot;call_ended&quot;,
  &quot;call_id&quot;: &quot;call_abc123def456&quot;,
  &quot;agent_id&quot;: &quot;agent_789ghi012jkl&quot;,
  &quot;from_number&quot;: &quot;+49301234567&quot;,
  &quot;to_number&quot;: &quot;+49309876543&quot;,
  &quot;direction&quot;: &quot;inbound&quot;,
  &quot;duration&quot;: 180,
  &quot;end_reason&quot;: &quot;user_hangup&quot;,
  &quot;metadata&quot;: {
    &quot;custom_field&quot;: &quot;value&quot;
  },
  &quot;timestamp&quot;: &quot;2025-06-23T10:33:00Z&quot;
}
</code></pre>
<h3 id="call_analyzed-event">call_analyzed Event</h3>
<pre><code class="language-json">{
  &quot;event_type&quot;: &quot;call_analyzed&quot;,
  &quot;call_id&quot;: &quot;call_abc123def456&quot;,
  &quot;agent_id&quot;: &quot;agent_789ghi012jkl&quot;,
  &quot;transcript&quot;: &quot;Agent: Guten Tag, wie kann ich Ihnen helfen?\nCaller: Ich möchte einen Termin buchen...&quot;,
  &quot;recording_url&quot;: &quot;https://storage.retellai.com/recordings/call_abc123def456.mp3&quot;,
  &quot;call_summary&quot;: &quot;Customer called to book an appointment for next Tuesday at 2 PM&quot;,
  &quot;user_sentiment&quot;: &quot;positive&quot;,
  &quot;detected_language&quot;: &quot;de-DE&quot;,
  &quot;function_calls&quot;: [
    {
      &quot;name&quot;: &quot;book_appointment&quot;,
      &quot;arguments&quot;: {
        &quot;customer_name&quot;: &quot;Max Mustermann&quot;,
        &quot;phone_number&quot;: &quot;+49301234567&quot;,
        &quot;service_type&quot;: &quot;Consultation&quot;,
        &quot;preferred_date&quot;: &quot;2025-06-30&quot;,
        &quot;preferred_time&quot;: &quot;14:00&quot;
      },
      &quot;result&quot;: &quot;success&quot;
    }
  ],
  &quot;custom_analysis&quot;: {
    &quot;intent&quot;: &quot;appointment_booking&quot;,
    &quot;urgency&quot;: &quot;normal&quot;,
    &quot;customer_type&quot;: &quot;new&quot;
  },
  &quot;timestamp&quot;: &quot;2025-06-23T10:35:00Z&quot;
}
</code></pre>
<h3 id="signature-verification">Signature Verification</h3>
<pre><code class="language-php">// PHP Example
$payload = file_get_contents('php://input');
$signature = $_SERVER['HTTP_X_RETELL_SIGNATURE'];
$secret = env('RETELL_WEBHOOK_SECRET');

$expected = hash_hmac('sha256', $payload, $secret);

if (!hash_equals($expected, $signature)) {
    http_response_code(401);
    exit('Invalid signature');
}
</code></pre>
<h2 id="calcom-webhooks">Cal.com Webhooks</h2>
<h3 id="webhook-configuration_1">Webhook Configuration</h3>
<ul>
<li><strong>URL</strong>: <code>https://api.askproai.de/api/webhooks/calcom</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Authentication</strong>: HMAC-SHA256 signature in <code>X-Cal-Signature-256</code> header</li>
</ul>
<h3 id="booking_created-event">BOOKING_CREATED Event</h3>
<pre><code class="language-json">{
  &quot;triggerEvent&quot;: &quot;BOOKING_CREATED&quot;,
  &quot;createdAt&quot;: &quot;2025-06-23T10:00:00Z&quot;,
  &quot;payload&quot;: {
    &quot;id&quot;: 123456,
    &quot;uid&quot;: &quot;abc123def456ghi789&quot;,
    &quot;idempotencyKey&quot;: &quot;unique-key-123&quot;,
    &quot;eventTypeId&quot;: 2026361,
    &quot;title&quot;: &quot;30 Min Consultation&quot;,
    &quot;description&quot;: &quot;Initial consultation appointment&quot;,
    &quot;startTime&quot;: &quot;2025-06-30T14:00:00Z&quot;,
    &quot;endTime&quot;: &quot;2025-06-30T14:30:00Z&quot;,
    &quot;attendees&quot;: [
      {
        &quot;email&quot;: &quot;patient@example.com&quot;,
        &quot;name&quot;: &quot;Max Mustermann&quot;,
        &quot;timeZone&quot;: &quot;Europe/Berlin&quot;,
        &quot;locale&quot;: &quot;de&quot;
      }
    ],
    &quot;organizer&quot;: {
      &quot;id&quot;: 789,
      &quot;name&quot;: &quot;Dr. Schmidt&quot;,
      &quot;email&quot;: &quot;dr.schmidt@clinic.de&quot;,
      &quot;timeZone&quot;: &quot;Europe/Berlin&quot;
    },
    &quot;location&quot;: {
      &quot;type&quot;: &quot;inPerson&quot;,
      &quot;value&quot;: &quot;Beispielstraße 123, 10115 Berlin&quot;
    },
    &quot;responses&quot;: {
      &quot;name&quot;: &quot;Max Mustermann&quot;,
      &quot;email&quot;: &quot;patient@example.com&quot;,
      &quot;phone&quot;: &quot;+49301234567&quot;,
      &quot;notes&quot;: &quot;First time patient, referred by Dr. Mueller&quot;
    },
    &quot;metadata&quot;: {
      &quot;askproai_appointment_id&quot;: &quot;456&quot;,
      &quot;branch_id&quot;: &quot;123&quot;,
      &quot;source&quot;: &quot;phone_booking&quot;
    },
    &quot;status&quot;: &quot;ACCEPTED&quot;,
    &quot;rescheduled&quot;: false,
    &quot;cancellationReason&quot;: null
  }
}
</code></pre>
<h3 id="booking_cancelled-event">BOOKING_CANCELLED Event</h3>
<pre><code class="language-json">{
  &quot;triggerEvent&quot;: &quot;BOOKING_CANCELLED&quot;,
  &quot;createdAt&quot;: &quot;2025-06-23T11:00:00Z&quot;,
  &quot;payload&quot;: {
    &quot;id&quot;: 123456,
    &quot;uid&quot;: &quot;abc123def456ghi789&quot;,
    &quot;title&quot;: &quot;30 Min Consultation&quot;,
    &quot;startTime&quot;: &quot;2025-06-30T14:00:00Z&quot;,
    &quot;endTime&quot;: &quot;2025-06-30T14:30:00Z&quot;,
    &quot;organizer&quot;: {
      &quot;id&quot;: 789,
      &quot;name&quot;: &quot;Dr. Schmidt&quot;,
      &quot;email&quot;: &quot;dr.schmidt@clinic.de&quot;
    },
    &quot;attendees&quot;: [
      {
        &quot;email&quot;: &quot;patient@example.com&quot;,
        &quot;name&quot;: &quot;Max Mustermann&quot;
      }
    ],
    &quot;cancellationReason&quot;: &quot;Patient requested cancellation&quot;,
    &quot;cancelledBy&quot;: &quot;attendee&quot;,
    &quot;metadata&quot;: {
      &quot;askproai_appointment_id&quot;: &quot;456&quot;
    }
  }
}
</code></pre>
<h3 id="booking_rescheduled-event">BOOKING_RESCHEDULED Event</h3>
<pre><code class="language-json">{
  &quot;triggerEvent&quot;: &quot;BOOKING_RESCHEDULED&quot;,
  &quot;createdAt&quot;: &quot;2025-06-23T12:00:00Z&quot;,
  &quot;payload&quot;: {
    &quot;id&quot;: 123457,
    &quot;uid&quot;: &quot;new123def456ghi789&quot;,
    &quot;previousUid&quot;: &quot;abc123def456ghi789&quot;,
    &quot;title&quot;: &quot;30 Min Consultation&quot;,
    &quot;startTime&quot;: &quot;2025-07-01T15:00:00Z&quot;,
    &quot;endTime&quot;: &quot;2025-07-01T15:30:00Z&quot;,
    &quot;previousStartTime&quot;: &quot;2025-06-30T14:00:00Z&quot;,
    &quot;previousEndTime&quot;: &quot;2025-06-30T14:30:00Z&quot;,
    &quot;organizer&quot;: {
      &quot;id&quot;: 789,
      &quot;name&quot;: &quot;Dr. Schmidt&quot;,
      &quot;email&quot;: &quot;dr.schmidt@clinic.de&quot;
    },
    &quot;attendees&quot;: [
      {
        &quot;email&quot;: &quot;patient@example.com&quot;,
        &quot;name&quot;: &quot;Max Mustermann&quot;
      }
    ],
    &quot;rescheduledBy&quot;: &quot;organizer&quot;,
    &quot;rescheduledReason&quot;: &quot;Doctor unavailable at original time&quot;,
    &quot;metadata&quot;: {
      &quot;askproai_appointment_id&quot;: &quot;456&quot;
    }
  }
}
</code></pre>
<h3 id="booking_requested-event">BOOKING_REQUESTED Event</h3>
<pre><code class="language-json">{
  &quot;triggerEvent&quot;: &quot;BOOKING_REQUESTED&quot;,
  &quot;createdAt&quot;: &quot;2025-06-23T13:00:00Z&quot;,
  &quot;payload&quot;: {
    &quot;id&quot;: 123458,
    &quot;eventTypeId&quot;: 2026361,
    &quot;title&quot;: &quot;30 Min Consultation&quot;,
    &quot;startTime&quot;: &quot;2025-06-30T14:00:00Z&quot;,
    &quot;endTime&quot;: &quot;2025-06-30T14:30:00Z&quot;,
    &quot;responses&quot;: {
      &quot;name&quot;: &quot;Max Mustermann&quot;,
      &quot;email&quot;: &quot;patient@example.com&quot;,
      &quot;phone&quot;: &quot;+49301234567&quot;
    },
    &quot;status&quot;: &quot;PENDING&quot;,
    &quot;requiresConfirmation&quot;: true
  }
}
</code></pre>
<h2 id="stripe-webhooks">Stripe Webhooks</h2>
<h3 id="webhook-configuration_2">Webhook Configuration</h3>
<ul>
<li><strong>URL</strong>: <code>https://api.askproai.de/stripe/webhook</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Authentication</strong>: Stripe signature in <code>stripe-signature</code> header</li>
</ul>
<h3 id="customersubscriptioncreated">customer.subscription.created</h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;evt_1234567890&quot;,
  &quot;object&quot;: &quot;event&quot;,
  &quot;api_version&quot;: &quot;2023-10-16&quot;,
  &quot;created&quot;: 1719140400,
  &quot;data&quot;: {
    &quot;object&quot;: {
      &quot;id&quot;: &quot;sub_1234567890&quot;,
      &quot;object&quot;: &quot;subscription&quot;,
      &quot;customer&quot;: &quot;cus_1234567890&quot;,
      &quot;status&quot;: &quot;active&quot;,
      &quot;current_period_start&quot;: 1719140400,
      &quot;current_period_end&quot;: 1721732400,
      &quot;items&quot;: {
        &quot;data&quot;: [
          {
            &quot;id&quot;: &quot;si_1234567890&quot;,
            &quot;price&quot;: {
              &quot;id&quot;: &quot;price_1234567890&quot;,
              &quot;product&quot;: &quot;prod_1234567890&quot;,
              &quot;unit_amount&quot;: 9900,
              &quot;currency&quot;: &quot;eur&quot;
            },
            &quot;quantity&quot;: 1
          }
        ]
      },
      &quot;metadata&quot;: {
        &quot;company_id&quot;: &quot;123&quot;,
        &quot;plan&quot;: &quot;professional&quot;
      }
    }
  },
  &quot;type&quot;: &quot;customer.subscription.created&quot;
}
</code></pre>
<h3 id="invoicepayment_succeeded">invoice.payment_succeeded</h3>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;evt_1234567890&quot;,
  &quot;object&quot;: &quot;event&quot;,
  &quot;api_version&quot;: &quot;2023-10-16&quot;,
  &quot;created&quot;: 1719140400,
  &quot;data&quot;: {
    &quot;object&quot;: {
      &quot;id&quot;: &quot;in_1234567890&quot;,
      &quot;object&quot;: &quot;invoice&quot;,
      &quot;amount_paid&quot;: 9900,
      &quot;currency&quot;: &quot;eur&quot;,
      &quot;customer&quot;: &quot;cus_1234567890&quot;,
      &quot;subscription&quot;: &quot;sub_1234567890&quot;,
      &quot;status&quot;: &quot;paid&quot;,
      &quot;lines&quot;: {
        &quot;data&quot;: [
          {
            &quot;amount&quot;: 9900,
            &quot;description&quot;: &quot;Professional Plan&quot;,
            &quot;period&quot;: {
              &quot;start&quot;: 1719140400,
              &quot;end&quot;: 1721732400
            }
          }
        ]
      },
      &quot;metadata&quot;: {
        &quot;company_id&quot;: &quot;123&quot;
      }
    }
  },
  &quot;type&quot;: &quot;invoice.payment_succeeded&quot;
}
</code></pre>
<h2 id="whatsapp-webhooks-planned">WhatsApp Webhooks (Planned)</h2>
<h3 id="webhook-configuration_3">Webhook Configuration</h3>
<ul>
<li><strong>URL</strong>: <code>https://api.askproai.de/api/webhooks/whatsapp</code></li>
<li><strong>Method</strong>: <code>POST</code></li>
<li><strong>Authentication</strong>: Facebook webhook verification</li>
</ul>
<h3 id="message-received">Message Received</h3>
<pre><code class="language-json">{
  &quot;object&quot;: &quot;whatsapp_business_account&quot;,
  &quot;entry&quot;: [
    {
      &quot;id&quot;: &quot;WHATSAPP_BUSINESS_ACCOUNT_ID&quot;,
      &quot;changes&quot;: [
        {
          &quot;value&quot;: {
            &quot;messaging_product&quot;: &quot;whatsapp&quot;,
            &quot;metadata&quot;: {
              &quot;display_phone_number&quot;: &quot;+49301234567&quot;,
              &quot;phone_number_id&quot;: &quot;PHONE_NUMBER_ID&quot;
            },
            &quot;contacts&quot;: [
              {
                &quot;profile&quot;: {
                  &quot;name&quot;: &quot;Max Mustermann&quot;
                },
                &quot;wa_id&quot;: &quot;491234567890&quot;
              }
            ],
            &quot;messages&quot;: [
              {
                &quot;from&quot;: &quot;491234567890&quot;,
                &quot;id&quot;: &quot;wamid.1234567890&quot;,
                &quot;timestamp&quot;: &quot;1719140400&quot;,
                &quot;text&quot;: {
                  &quot;body&quot;: &quot;Ich möchte meinen Termin verschieben&quot;
                },
                &quot;type&quot;: &quot;text&quot;
              }
            ]
          },
          &quot;field&quot;: &quot;messages&quot;
        }
      ]
    }
  ]
}
</code></pre>
<h2 id="sms-webhooks">SMS Webhooks</h2>
<h3 id="twilio-status-callback">Twilio Status Callback</h3>
<pre><code class="language-json">{
  &quot;MessageSid&quot;: &quot;SM1234567890abcdef&quot;,
  &quot;MessageStatus&quot;: &quot;delivered&quot;,
  &quot;To&quot;: &quot;+49301234567&quot;,
  &quot;From&quot;: &quot;+49309876543&quot;,
  &quot;ApiVersion&quot;: &quot;2010-04-01&quot;,
  &quot;SmsSid&quot;: &quot;SM1234567890abcdef&quot;,
  &quot;SmsStatus&quot;: &quot;delivered&quot;,
  &quot;Body&quot;: &quot;Appointment reminder for tomorrow at 2 PM&quot;,
  &quot;NumSegments&quot;: &quot;1&quot;,
  &quot;Direction&quot;: &quot;outbound-api&quot;,
  &quot;Price&quot;: &quot;-0.075&quot;,
  &quot;PriceUnit&quot;: &quot;EUR&quot;,
  &quot;ErrorCode&quot;: null,
  &quot;ErrorMessage&quot;: null
}
</code></pre>
<h2 id="webhook-security-best-practices">Webhook Security Best Practices</h2>
<h3 id="1-signature-verification">1. Signature Verification</h3>
<p>Always verify webhook signatures before processing:</p>
<pre><code class="language-php">// Generic signature verification
function verifyWebhookSignature($payload, $signature, $secret) {
    $expected = hash_hmac('sha256', $payload, $secret);
    return hash_equals($expected, $signature);
}
</code></pre>
<h3 id="2-idempotency">2. Idempotency</h3>
<p>Handle duplicate webhooks gracefully:</p>
<pre><code class="language-php">// Store processed webhook IDs
$webhookId = $request-&gt;input('id') ?? $request-&gt;input('idempotencyKey');
if (WebhookEvent::where('external_id', $webhookId)-&gt;exists()) {
    return response()-&gt;json(['status' =&gt; 'already_processed']);
}
</code></pre>
<h3 id="3-timeout-handling">3. Timeout Handling</h3>
<p>Respond quickly to avoid timeouts:</p>
<pre><code class="language-php">// Queue processing for long operations
ProcessWebhook::dispatch($webhookData);
return response()-&gt;json(['status' =&gt; 'accepted'], 202);
</code></pre>
<h3 id="4-error-handling">4. Error Handling</h3>
<p>Return appropriate status codes:
- <code>200 OK</code> - Successfully processed
- <code>202 Accepted</code> - Received and queued for processing
- <code>400 Bad Request</code> - Invalid payload
- <code>401 Unauthorized</code> - Invalid signature
- <code>500 Internal Server Error</code> - Processing failed</p>
<h2 id="testing-webhooks">Testing Webhooks</h2>
<h3 id="local-development">Local Development</h3>
<pre><code class="language-bash"># Use ngrok for local webhook testing
ngrok http 8000

# Update webhook URL to ngrok URL
https://abc123.ngrok.io/api/webhooks/retell
</code></pre>
<h3 id="webhook-testing-tools">Webhook Testing Tools</h3>
<pre><code class="language-bash"># Test Retell webhook
curl -X POST https://api.askproai.de/api/retell/webhook \
  -H &quot;Content-Type: application/json&quot; \
  -H &quot;x-retell-signature: $(echo -n '$BODY' | openssl dgst -sha256 -hmac '$SECRET' -binary | base64)&quot; \
  -d '{
    &quot;event_type&quot;: &quot;call_ended&quot;,
    &quot;call_id&quot;: &quot;test_call_123&quot;
  }'
</code></pre>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="webhooks.md">Webhook Processing</a></li>
<li><a href="authentication.md">API Authentication</a></li>
<li><a href="../integrations/">Integration Guides</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
