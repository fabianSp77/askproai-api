<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/docs/operations/monitoring/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Operations Monitoring Guide - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Operations Monitoring Guide";
        var mkdocs_page_input_path = "docs/operations/monitoring.md";
        var mkdocs_page_url = "/mkdocs/docs/operations/monitoring/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../architecture/performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Operations Monitoring Guide</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="operations-monitoring-guide">Operations Monitoring Guide</h1>
<h2 id="overview">Overview</h2>
<p>This guide covers the operational aspects of monitoring AskProAI in production, including system monitoring, application monitoring, alerting strategies, and incident response procedures.</p>
<h2 id="monitoring-architecture">Monitoring Architecture</h2>
<h3 id="components-overview">Components Overview</h3>
<pre><code>┌─────────────────────────────────────────────────────────────┐
│                     Monitoring Stack                          │
├─────────────────┬───────────────┬──────────────┬────────────┤
│   Metrics       │     Logs      │   Traces     │  Alerts    │
├─────────────────┼───────────────┼──────────────┼────────────┤
│  Prometheus     │ Elasticsearch │   Jaeger     │ Alertmanager│
│  Grafana        │   Logstash    │   Zipkin     │ PagerDuty  │
│  StatsD         │    Kibana     │              │   Slack    │
└─────────────────┴───────────────┴──────────────┴────────────┘
</code></pre>
<h2 id="system-monitoring">System Monitoring</h2>
<h3 id="infrastructure-metrics">Infrastructure Metrics</h3>
<h4 id="server-monitoring">Server Monitoring</h4>
<pre><code class="language-yaml"># prometheus/targets/servers.yml
- targets:
    - 'web1.askproai.de:9100'
    - 'web2.askproai.de:9100'
    - 'db1.askproai.de:9100'
  labels:
    env: 'production'
    role: 'web'

- targets:
    - 'db-primary.askproai.de:9100'
    - 'db-replica.askproai.de:9100'
  labels:
    env: 'production'
    role: 'database'
</code></pre>
<h4 id="key-system-metrics">Key System Metrics</h4>
<pre><code class="language-yaml">CPU Usage:
  - Threshold: &lt; 80% sustained
  - Alert: &gt; 90% for 5 minutes

Memory Usage:
  - Threshold: &lt; 85%
  - Alert: &gt; 90% for 5 minutes

Disk Usage:
  - Threshold: &lt; 80%
  - Alert: &gt; 85%

Network:
  - Bandwidth: Monitor for anomalies
  - Packet Loss: Alert &gt; 1%

Load Average:
  - Threshold: &lt; number of CPUs
  - Alert: &gt; 2x CPUs for 5 minutes
</code></pre>
<h3 id="database-monitoring">Database Monitoring</h3>
<h4 id="mysql-metrics">MySQL Metrics</h4>
<pre><code class="language-sql">-- Key performance queries
-- Connection status
SHOW STATUS WHERE Variable_name IN (
    'Threads_connected',
    'Max_used_connections',
    'Aborted_connects',
    'Connection_errors_internal'
);

-- Query performance
SHOW STATUS WHERE Variable_name IN (
    'Questions',
    'Slow_queries',
    'Select_scan',
    'Select_full_join'
);

-- InnoDB metrics
SHOW STATUS WHERE Variable_name LIKE 'Innodb%';
</code></pre>
<h4 id="database-dashboards">Database Dashboards</h4>
<pre><code class="language-json">{
  &quot;dashboard&quot;: &quot;MySQL Performance&quot;,
  &quot;panels&quot;: [
    {
      &quot;title&quot;: &quot;Queries Per Second&quot;,
      &quot;query&quot;: &quot;rate(mysql_global_status_questions[5m])&quot;
    },
    {
      &quot;title&quot;: &quot;Slow Queries&quot;,
      &quot;query&quot;: &quot;rate(mysql_global_status_slow_queries[5m])&quot;
    },
    {
      &quot;title&quot;: &quot;Buffer Pool Hit Rate&quot;,
      &quot;query&quot;: &quot;100 - (rate(mysql_global_status_innodb_buffer_pool_reads[5m]) / rate(mysql_global_status_innodb_buffer_pool_read_requests[5m]) * 100)&quot;
    },
    {
      &quot;title&quot;: &quot;Connections&quot;,
      &quot;query&quot;: &quot;mysql_global_status_threads_connected&quot;
    }
  ]
}
</code></pre>
<h3 id="redis-monitoring">Redis Monitoring</h3>
<h4 id="key-redis-metrics">Key Redis Metrics</h4>
<pre><code class="language-bash"># Monitor Redis performance
redis-cli INFO stats
redis-cli INFO memory
redis-cli INFO replication
redis-cli --latency
redis-cli --latency-history

# Key metrics to track
- Used memory vs max memory
- Hit rate (keyspace_hits / (keyspace_hits + keyspace_misses))
- Connected clients
- Operations per second
- Evicted keys
- Replication lag
</code></pre>
<h2 id="application-monitoring">Application Monitoring</h2>
<h3 id="business-metrics">Business Metrics</h3>
<pre><code class="language-php">// app/Services/Monitoring/BusinessMetrics.php
namespace App\Services\Monitoring;

class BusinessMetrics
{
    public function collectMetrics(): void
    {
        // Appointment metrics
        $this-&gt;gauge('appointments.total', Appointment::count());
        $this-&gt;gauge('appointments.today', Appointment::today()-&gt;count());
        $this-&gt;gauge('appointments.upcoming_week', Appointment::nextWeek()-&gt;count());

        // Call metrics
        $this-&gt;gauge('calls.active', Call::active()-&gt;count());
        $this-&gt;counter('calls.completed', Call::completed()-&gt;today()-&gt;count());
        $this-&gt;histogram('calls.duration', Call::today()-&gt;avg('duration'));

        // Revenue metrics
        $this-&gt;gauge('revenue.today', $this-&gt;getTodayRevenue());
        $this-&gt;gauge('revenue.mtd', $this-&gt;getMonthToDateRevenue());

        // Customer metrics
        $this-&gt;gauge('customers.total', Customer::count());
        $this-&gt;gauge('customers.new_today', Customer::createdToday()-&gt;count());

        // System health
        $this-&gt;gauge('queue.size.default', Redis::llen('queues:default'));
        $this-&gt;gauge('failed_jobs.count', DB::table('failed_jobs')-&gt;count());
    }

    private function gauge(string $metric, $value): void
    {
        app('prometheus')-&gt;gauge(&quot;askproai_{$metric}&quot;, $value);
    }
}
</code></pre>
<h3 id="api-monitoring">API Monitoring</h3>
<pre><code class="language-php">// app/Http/Middleware/ApiMetrics.php
namespace App\Http\Middleware;

class ApiMetrics
{
    public function handle($request, Closure $next)
    {
        $start = microtime(true);

        $response = $next($request);

        $duration = microtime(true) - $start;

        // Record metrics
        $this-&gt;recordMetrics($request, $response, $duration);

        return $response;
    }

    private function recordMetrics($request, $response, $duration): void
    {
        $tags = [
            'method' =&gt; $request-&gt;method(),
            'endpoint' =&gt; $request-&gt;route()?-&gt;uri() ?? 'unknown',
            'status' =&gt; $response-&gt;status(),
        ];

        // Response time histogram
        app('statsd')-&gt;histogram('api.response_time', $duration * 1000, $tags);

        // Request counter
        app('statsd')-&gt;increment('api.requests', 1, $tags);

        // Error rate
        if ($response-&gt;status() &gt;= 400) {
            app('statsd')-&gt;increment('api.errors', 1, $tags);
        }

        // Log slow requests
        if ($duration &gt; 1) {
            Log::warning('Slow API request', [
                'url' =&gt; $request-&gt;fullUrl(),
                'duration' =&gt; $duration,
                'tags' =&gt; $tags,
            ]);
        }
    }
}
</code></pre>
<h3 id="queue-monitoring">Queue Monitoring</h3>
<pre><code class="language-php">// app/Console/Commands/MonitorQueues.php
class MonitorQueues extends Command
{
    protected $signature = 'monitor:queues';

    public function handle()
    {
        $queues = ['default', 'high', 'low', 'webhooks', 'emails'];

        foreach ($queues as $queue) {
            $size = Redis::llen(&quot;queues:{$queue}&quot;);
            $processing = Redis::llen(&quot;queues:{$queue}:processing&quot;);
            $failed = Redis::get(&quot;queues:{$queue}:failed&quot;) ?? 0;

            // Send metrics
            app('prometheus')-&gt;gauge(&quot;queue_size&quot;, $size, ['queue' =&gt; $queue]);
            app('prometheus')-&gt;gauge(&quot;queue_processing&quot;, $processing, ['queue' =&gt; $queue]);
            app('prometheus')-&gt;gauge(&quot;queue_failed&quot;, $failed, ['queue' =&gt; $queue]);

            // Alert on high queue size
            if ($size &gt; 1000) {
                $this-&gt;alert(&quot;Queue {$queue} has {$size} jobs pending&quot;);
            }
        }
    }
}
</code></pre>
<h2 id="log-management">Log Management</h2>
<h3 id="centralized-logging">Centralized Logging</h3>
<pre><code class="language-yaml"># filebeat.yml
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/www/api-gateway/storage/logs/*.log
  multiline.pattern: '^\[[0-9]{4}-[0-9]{2}-[0-9]{2}'
  multiline.negate: true
  multiline.match: after
  fields:
    app: askproai
    env: production

- type: log
  enabled: true
  paths:
    - /var/log/nginx/*.log
  fields:
    app: nginx

output.elasticsearch:
  hosts: [&quot;elasticsearch:9200&quot;]
  index: &quot;askproai-%{[fields.app]}-%{+yyyy.MM.dd}&quot;
</code></pre>
<h3 id="structured-logging">Structured Logging</h3>
<pre><code class="language-php">// config/logging.php
'channels' =&gt; [
    'production' =&gt; [
        'driver' =&gt; 'stack',
        'channels' =&gt; ['daily', 'elasticsearch'],
    ],

    'elasticsearch' =&gt; [
        'driver' =&gt; 'custom',
        'via' =&gt; App\Logging\ElasticsearchLogger::class,
        'hosts' =&gt; [env('ELASTICSEARCH_HOST', 'localhost:9200')],
        'index' =&gt; 'askproai',
    ],

    'daily' =&gt; [
        'driver' =&gt; 'daily',
        'path' =&gt; storage_path('logs/laravel.log'),
        'level' =&gt; 'info',
        'days' =&gt; 14,
        'formatter' =&gt; Monolog\Formatter\JsonFormatter::class,
    ],
];
</code></pre>
<h3 id="log-analysis-queries">Log Analysis Queries</h3>
<pre><code class="language-json">// Kibana saved searches
{
  &quot;error_logs&quot;: {
    &quot;query&quot;: &quot;level:error AND app:askproai&quot;,
    &quot;columns&quot;: [&quot;timestamp&quot;, &quot;message&quot;, &quot;context.user_id&quot;, &quot;context.exception&quot;]
  },

  &quot;slow_queries&quot;: {
    &quot;query&quot;: &quot;message:\&quot;slow query\&quot; AND duration:&gt;1000&quot;,
    &quot;columns&quot;: [&quot;timestamp&quot;, &quot;context.sql&quot;, &quot;context.duration&quot;]
  },

  &quot;failed_webhooks&quot;: {
    &quot;query&quot;: &quot;channel:webhooks AND status:failed&quot;,
    &quot;columns&quot;: [&quot;timestamp&quot;, &quot;context.webhook_type&quot;, &quot;context.error&quot;]
  },

  &quot;api_errors&quot;: {
    &quot;query&quot;: &quot;status:&gt;=400 AND type:api_request&quot;,
    &quot;columns&quot;: [&quot;timestamp&quot;, &quot;context.url&quot;, &quot;context.status&quot;, &quot;context.message&quot;]
  }
}
</code></pre>
<h2 id="alerting-strategy">Alerting Strategy</h2>
<h3 id="alert-levels">Alert Levels</h3>
<pre><code class="language-yaml"># alertmanager/config.yml
global:
  resolve_timeout: 5m

route:
  group_by: ['alertname', 'severity']
  group_wait: 10s
  group_interval: 5m
  repeat_interval: 12h
  receiver: 'default'

  routes:
    - match:
        severity: critical
      receiver: pagerduty
      continue: true

    - match:
        severity: warning
      receiver: slack

    - match:
        severity: info
      receiver: email

receivers:
  - name: 'pagerduty'
    pagerduty_configs:
      - service_key: 'YOUR_PAGERDUTY_KEY'
        severity: 'error'

  - name: 'slack'
    slack_configs:
      - api_url: 'YOUR_SLACK_WEBHOOK'
        channel: '#alerts'
        title: 'AskProAI Alert'

  - name: 'email'
    email_configs:
      - to: 'ops@askproai.de'
        from: 'alerts@askproai.de'
</code></pre>
<h3 id="alert-rules">Alert Rules</h3>
<pre><code class="language-yaml"># prometheus/alerts/application.yml
groups:
  - name: application
    rules:
      - alert: HighErrorRate
        expr: rate(api_errors_total[5m]) &gt; 0.05
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: &quot;High API error rate&quot;
          description: &quot;Error rate is {{ $value | humanizePercentage }}&quot;

      - alert: SlowResponseTime
        expr: histogram_quantile(0.95, api_response_time_bucket) &gt; 1
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: &quot;API response time degraded&quot;

      - alert: QueueBacklog
        expr: queue_size &gt; 1000
        for: 15m
        labels:
          severity: warning
        annotations:
          summary: &quot;Queue {{ $labels.queue }} has high backlog&quot;

      - alert: DatabaseConnectionPool
        expr: mysql_global_status_threads_connected / mysql_global_variables_max_connections &gt; 0.8
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: &quot;Database connection pool near limit&quot;
</code></pre>
<h2 id="incident-response">Incident Response</h2>
<h3 id="incident-levels">Incident Levels</h3>
<pre><code class="language-yaml">Severity 1 (Critical):
  - Complete service outage
  - Data loss or corruption
  - Security breach
  - Response time: Immediate
  - Escalation: Immediate

Severity 2 (High):
  - Partial service outage
  - Significant performance degradation
  - Major feature unavailable
  - Response time: 30 minutes
  - Escalation: 1 hour

Severity 3 (Medium):
  - Minor feature issues
  - Moderate performance impact
  - Non-critical errors
  - Response time: 2 hours
  - Escalation: 4 hours

Severity 4 (Low):
  - Cosmetic issues
  - Minor bugs
  - Documentation updates
  - Response time: Next business day
  - Escalation: 2 days
</code></pre>
<h3 id="incident-response-playbook">Incident Response Playbook</h3>
<pre><code class="language-markdown">## Initial Response (0-15 minutes)
1. **Acknowledge** the alert
2. **Assess** the impact and severity
3. **Communicate** initial status
4. **Create** incident channel/ticket

## Investigation (15-30 minutes)
1. **Gather** information from monitoring
2. **Check** recent deployments
3. **Review** logs and metrics
4. **Identify** root cause

## Mitigation (30+ minutes)
1. **Implement** immediate fix if possible
2. **Scale** resources if needed
3. **Rollback** if necessary
4. **Monitor** for improvement

## Resolution
1. **Verify** issue is resolved
2. **Monitor** for recurrence
3. **Update** status page
4. **Document** findings

## Post-Incident
1. **Schedule** post-mortem (within 48 hours)
2. **Create** incident report
3. **Identify** action items
4. **Update** runbooks
</code></pre>
<h3 id="runbooks">Runbooks</h3>
<h4 id="high-cpu-usage">High CPU Usage</h4>
<pre><code class="language-bash">#!/bin/bash
# runbook/high-cpu.sh

echo &quot;=== High CPU Usage Runbook ===&quot;

# 1. Identify top processes
echo &quot;Top CPU consuming processes:&quot;
top -b -n 1 | head -20

# 2. Check PHP-FPM processes
echo &quot;PHP-FPM process count:&quot;
ps aux | grep php-fpm | wc -l

# 3. Check for runaway queries
echo &quot;Active MySQL queries:&quot;
mysql -e &quot;SHOW PROCESSLIST&quot; | grep -v Sleep

# 4. Check queue workers
echo &quot;Queue worker status:&quot;
supervisorctl status

# Actions:
# - Restart PHP-FPM if needed: sudo systemctl restart php8.2-fpm
# - Kill long-running queries: mysql -e &quot;KILL QUERY &lt;id&gt;&quot;
# - Scale horizontally if sustained high load
</code></pre>
<h4 id="database-issues">Database Issues</h4>
<pre><code class="language-sql">-- runbook/database-issues.sql

-- Check connection count
SHOW STATUS WHERE Variable_name = 'Threads_connected';
SHOW VARIABLES WHERE Variable_name = 'max_connections';

-- Check for locks
SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCKS;
SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITS;

-- Check slow queries
SELECT * FROM mysql.slow_log ORDER BY query_time DESC LIMIT 10;

-- Check table sizes
SELECT 
    table_schema AS 'Database',
    table_name AS 'Table',
    ROUND(((data_length + index_length) / 1024 / 1024), 2) AS 'Size (MB)'
FROM information_schema.TABLES
WHERE table_schema = 'askproai_db'
ORDER BY (data_length + index_length) DESC
LIMIT 10;
</code></pre>
<h2 id="performance-monitoring">Performance Monitoring</h2>
<h3 id="application-performance-monitoring-apm">Application Performance Monitoring (APM)</h3>
<pre><code class="language-php">// app/Services/APM/PerformanceMonitor.php
class PerformanceMonitor
{
    public function measureDatabasePerformance(): array
    {
        $queries = DB::getQueryLog();

        return [
            'total_queries' =&gt; count($queries),
            'total_time' =&gt; collect($queries)-&gt;sum('time'),
            'slow_queries' =&gt; collect($queries)-&gt;filter(fn($q) =&gt; $q['time'] &gt; 100)-&gt;count(),
            'average_time' =&gt; collect($queries)-&gt;avg('time'),
        ];
    }

    public function measureCachePerformance(): array
    {
        $stats = Cache::getStore()-&gt;getRedis()-&gt;info();

        return [
            'hit_rate' =&gt; $this-&gt;calculateHitRate($stats),
            'memory_usage' =&gt; $stats['used_memory_human'],
            'evicted_keys' =&gt; $stats['evicted_keys'],
            'connected_clients' =&gt; $stats['connected_clients'],
        ];
    }

    public function measureApiPerformance(): array
    {
        return [
            'requests_per_minute' =&gt; Cache::get('api.rpm', 0),
            'average_response_time' =&gt; Cache::get('api.avg_response_time', 0),
            'error_rate' =&gt; Cache::get('api.error_rate', 0),
            'active_users' =&gt; Cache::get('active_users', 0),
        ];
    }
}
</code></pre>
<h3 id="performance-dashboards">Performance Dashboards</h3>
<pre><code class="language-json">// grafana/dashboards/performance.json
{
  &quot;dashboard&quot;: {
    &quot;title&quot;: &quot;AskProAI Performance&quot;,
    &quot;panels&quot;: [
      {
        &quot;title&quot;: &quot;Request Rate&quot;,
        &quot;targets&quot;: [{
          &quot;expr&quot;: &quot;rate(api_requests_total[5m])&quot;
        }]
      },
      {
        &quot;title&quot;: &quot;Response Time Percentiles&quot;,
        &quot;targets&quot;: [
          {&quot;expr&quot;: &quot;histogram_quantile(0.50, api_response_time_bucket)&quot;, &quot;legendFormat&quot;: &quot;p50&quot;},
          {&quot;expr&quot;: &quot;histogram_quantile(0.95, api_response_time_bucket)&quot;, &quot;legendFormat&quot;: &quot;p95&quot;},
          {&quot;expr&quot;: &quot;histogram_quantile(0.99, api_response_time_bucket)&quot;, &quot;legendFormat&quot;: &quot;p99&quot;}
        ]
      },
      {
        &quot;title&quot;: &quot;Database Query Time&quot;,
        &quot;targets&quot;: [{
          &quot;expr&quot;: &quot;rate(mysql_query_duration_seconds_sum[5m]) / rate(mysql_query_duration_seconds_count[5m])&quot;
        }]
      }
    ]
  }
}
</code></pre>
<h2 id="monitoring-automation">Monitoring Automation</h2>
<h3 id="health-check-automation">Health Check Automation</h3>
<pre><code class="language-php">// app/Console/Commands/AutomatedHealthCheck.php
class AutomatedHealthCheck extends Command
{
    protected $signature = 'health:check {--alert}';

    public function handle()
    {
        $checks = [
            'database' =&gt; $this-&gt;checkDatabase(),
            'redis' =&gt; $this-&gt;checkRedis(),
            'queue' =&gt; $this-&gt;checkQueue(),
            'disk' =&gt; $this-&gt;checkDiskSpace(),
            'external_services' =&gt; $this-&gt;checkExternalServices(),
        ];

        $failed = collect($checks)-&gt;filter(fn($check) =&gt; !$check['healthy']);

        if ($failed-&gt;isNotEmpty() &amp;&amp; $this-&gt;option('alert')) {
            $this-&gt;sendAlert($failed);
        }

        return $failed-&gt;isEmpty() ? 0 : 1;
    }

    private function checkDatabase(): array
    {
        try {
            $start = microtime(true);
            DB::select('SELECT 1');
            $time = (microtime(true) - $start) * 1000;

            return [
                'healthy' =&gt; $time &lt; 100,
                'response_time' =&gt; $time,
                'message' =&gt; $time &lt; 100 ? 'OK' : 'Slow response',
            ];
        } catch (\Exception $e) {
            return [
                'healthy' =&gt; false,
                'message' =&gt; $e-&gt;getMessage(),
            ];
        }
    }
}
</code></pre>
<h3 id="monitoring-scripts">Monitoring Scripts</h3>
<pre><code class="language-bash">#!/bin/bash
# scripts/monitor-system.sh

# Function to check service
check_service() {
    service=$1
    if systemctl is-active --quiet $service; then
        echo &quot;✓ $service is running&quot;
    else
        echo &quot;✗ $service is down&quot;
        systemctl start $service
    fi
}

# Check critical services
check_service nginx
check_service php8.2-fpm
check_service mysql
check_service redis
check_service supervisor

# Check disk space
df -h | grep -E '^/dev/' | awk '{print $5 &quot; &quot; $6}' | while read usage mount; do
    usage_int=${usage%\%}
    if [ $usage_int -gt 80 ]; then
        echo &quot;⚠️  Disk usage on $mount is $usage&quot;
    fi
done

# Check memory
free_mem=$(free -m | awk 'NR==2{printf &quot;%.2f&quot;, $3*100/$2}')
echo &quot;Memory usage: $free_mem%&quot;

# Check load average
load=$(uptime | awk -F'load average:' '{print $2}')
echo &quot;Load average: $load&quot;
</code></pre>
<h2 id="monitoring-best-practices">Monitoring Best Practices</h2>
<ol>
<li><strong>Set Meaningful Alerts</strong>: Avoid alert fatigue with relevant thresholds</li>
<li><strong>Use SLIs/SLOs</strong>: Define Service Level Indicators and Objectives</li>
<li><strong>Monitor Business Metrics</strong>: Track what matters to the business</li>
<li><strong>Automate Responses</strong>: Create runbooks and automated remediation</li>
<li><strong>Regular Reviews</strong>: Review and tune alerts monthly</li>
<li><strong>Capacity Planning</strong>: Use metrics for proactive scaling</li>
<li><strong>Documentation</strong>: Keep runbooks and procedures updated</li>
</ol>
<h2 id="related-documentation">Related Documentation</h2>
<ul>
<li><a href="../../deployment/monitoring/">Deployment Monitoring</a></li>
<li><a href="performance.md">Performance Optimization</a></li>
<li><a href="../troubleshooting/">Troubleshooting Guide</a></li>
<li><a href="../operations/incident-response.md">Incident Response</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
