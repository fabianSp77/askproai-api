<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/architecture/queue-jobs/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Queue Jobs Architecture - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Queue Jobs Architecture";
        var mkdocs_page_input_path = "architecture/queue-jobs.md";
        var mkdocs_page_url = "/mkdocs/architecture/queue-jobs/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../security/">Security</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Queue Jobs Architecture</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="queue-jobs-architecture">Queue Jobs Architecture</h1>
<h2 id="overview">Overview</h2>
<p>AskProAI uses Laravel's queue system with Redis and Horizon for processing asynchronous tasks. This architecture ensures reliable webhook processing, notifications, and heavy computations without blocking user requests.</p>
<h2 id="queue-architecture">Queue Architecture</h2>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;Job Sources&quot;
        API[API Requests]
        WEBHOOK[Webhooks]
        CRON[Scheduled Tasks]
        EVENTS[Event Listeners]
    end

    subgraph &quot;Queue System&quot;
        DISPATCH[Job Dispatcher]
        REDIS[(Redis Queues)]
        HORIZON[Laravel Horizon]
    end

    subgraph &quot;Queue Types&quot;
        CRITICAL[Critical Queue]
        HIGH[High Priority]
        DEFAULT[Default Queue]
        LOW[Low Priority]
        WEBHOOKS[Webhook Queue]
        NOTIFICATIONS[Notification Queue]
    end

    subgraph &quot;Workers&quot;
        W1[Worker Pool 1]
        W2[Worker Pool 2]
        W3[Worker Pool 3]
        WW[Webhook Workers]
    end

    API --&gt; DISPATCH
    WEBHOOK --&gt; DISPATCH
    CRON --&gt; DISPATCH
    EVENTS --&gt; DISPATCH

    DISPATCH --&gt; REDIS
    REDIS --&gt; CRITICAL
    REDIS --&gt; HIGH
    REDIS --&gt; DEFAULT
    REDIS --&gt; LOW
    REDIS --&gt; WEBHOOKS
    REDIS --&gt; NOTIFICATIONS

    HORIZON --&gt; W1
    HORIZON --&gt; W2
    HORIZON --&gt; W3
    HORIZON --&gt; WW

    CRITICAL --&gt; W1
    HIGH --&gt; W1
    DEFAULT --&gt; W2
    LOW --&gt; W3
    WEBHOOKS --&gt; WW
    NOTIFICATIONS --&gt; W3
</code></pre>
<h2 id="job-categories">Job Categories</h2>
<h3 id="critical-jobs">Critical Jobs</h3>
<p>These jobs affect immediate user experience and must be processed quickly.</p>
<h4 id="processretellcallendedjob">ProcessRetellCallEndedJob</h4>
<pre><code class="language-php">class ProcessRetellCallEndedJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $tries = 3;
    public $timeout = 60;
    public $queue = 'critical';

    public function handle()
    {
        // 1. Parse call data
        $callData = $this-&gt;parseRetellData($this-&gt;payload);

        // 2. Create call record
        $call = Call::create($callData);

        // 3. Extract appointment request
        if ($appointmentRequest = $this-&gt;extractAppointmentRequest()) {
            CreateAppointmentFromCallJob::dispatch($appointmentRequest)
                -&gt;onQueue('high');
        }

        // 4. Update customer record
        UpdateCustomerFromCallJob::dispatch($call)
            -&gt;onQueue('default');
    }

    public function failed(\Throwable $exception)
    {
        Log::critical('Critical job failed', [
            'job' =&gt; self::class,
            'payload' =&gt; $this-&gt;payload,
            'error' =&gt; $exception-&gt;getMessage()
        ]);

        // Alert operations team
        NotifyOpsTeam::dispatch($exception);
    }
}
</code></pre>
<h3 id="high-priority-jobs">High Priority Jobs</h3>
<p>Important but not immediately critical.</p>
<h4 id="createappointmentfromcalljob">CreateAppointmentFromCallJob</h4>
<pre><code class="language-php">class CreateAppointmentFromCallJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $tries = 5;
    public $backoff = [10, 30, 60, 300, 600];
    public $queue = 'high';

    public function handle(
        AppointmentBookingService $bookingService,
        CalcomV2Service $calcomService
    ) {
        DB::transaction(function () use ($bookingService, $calcomService) {
            // Create appointment
            $appointment = $bookingService-&gt;createFromCall($this-&gt;data);

            // Book in Cal.com
            $calcomBooking = $calcomService-&gt;createBooking($appointment);

            // Update with external reference
            $appointment-&gt;update([
                'external_id' =&gt; $calcomBooking-&gt;id
            ]);

            // Send confirmation
            SendAppointmentConfirmationJob::dispatch($appointment)
                -&gt;onQueue('notifications');
        });
    }
}
</code></pre>
<h3 id="default-priority-jobs">Default Priority Jobs</h3>
<p>Regular processing tasks.</p>
<h4 id="synccalcomdatajob">SyncCalcomDataJob</h4>
<pre><code class="language-php">class SyncCalcomDataJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $tries = 3;
    public $timeout = 300;
    public $queue = 'default';

    public function handle(CalcomSyncService $syncService)
    {
        // Sync event types
        $syncService-&gt;syncEventTypes($this-&gt;companyId);

        // Sync availability
        $syncService-&gt;syncAvailability($this-&gt;companyId);

        // Update cache
        Cache::tags(['calcom', &quot;company:{$this-&gt;companyId}&quot;])-&gt;flush();
    }
}
</code></pre>
<h3 id="webhook-jobs">Webhook Jobs</h3>
<p>Special handling for external webhooks.</p>
<h4 id="processcalcomwebhookjob">ProcessCalcomWebhookJob</h4>
<pre><code class="language-php">class ProcessCalcomWebhookJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $tries = 10;
    public $backoff = [5, 10, 30, 60, 120, 300, 600, 1800, 3600, 7200];
    public $queue = 'webhooks';

    public function middleware()
    {
        return [
            new RateLimited('calcom-webhooks'),
            new PreventOverlapping($this-&gt;webhookId),
        ];
    }

    public function handle()
    {
        // Check for duplicate processing
        if ($this-&gt;isDuplicate()) {
            Log::info('Skipping duplicate webhook', ['id' =&gt; $this-&gt;webhookId]);
            return;
        }

        // Process based on event type
        match($this-&gt;eventType) {
            'booking.created' =&gt; $this-&gt;handleBookingCreated(),
            'booking.cancelled' =&gt; $this-&gt;handleBookingCancelled(),
            'booking.rescheduled' =&gt; $this-&gt;handleBookingRescheduled(),
            default =&gt; Log::warning('Unknown webhook event', ['type' =&gt; $this-&gt;eventType])
        };

        // Mark as processed
        WebhookEvent::where('id', $this-&gt;webhookId)
            -&gt;update(['processed_at' =&gt; now()]);
    }
}
</code></pre>
<h3 id="notification-jobs">Notification Jobs</h3>
<p>User communications.</p>
<h4 id="sendsmsnotificationjob">SendSMSNotificationJob</h4>
<pre><code class="language-php">class SendSMSNotificationJob implements ShouldQueue
{
    use Dispatchable, InteractsWithQueue, Queueable, SerializesModels;

    public $tries = 3;
    public $timeout = 30;
    public $queue = 'notifications';

    public function handle(SMSService $smsService)
    {
        try {
            $smsService-&gt;send(
                $this-&gt;phoneNumber,
                $this-&gt;message,
                $this-&gt;metadata
            );

            // Log success
            NotificationLog::create([
                'type' =&gt; 'sms',
                'recipient' =&gt; $this-&gt;phoneNumber,
                'status' =&gt; 'sent',
                'sent_at' =&gt; now()
            ]);
        } catch (\Exception $e) {
            // Log failure but don't throw (avoid retries for invalid numbers)
            NotificationLog::create([
                'type' =&gt; 'sms',
                'recipient' =&gt; $this-&gt;phoneNumber,
                'status' =&gt; 'failed',
                'error' =&gt; $e-&gt;getMessage()
            ]);
        }
    }
}
</code></pre>
<h2 id="queue-configuration">Queue Configuration</h2>
<h3 id="horizon-configuration">Horizon Configuration</h3>
<pre><code class="language-php">// config/horizon.php
return [
    'use' =&gt; 'default',

    'prefix' =&gt; env('HORIZON_PREFIX', 'horizon:'),

    'waits' =&gt; [
        'redis:default' =&gt; 60,
    ],

    'trim' =&gt; [
        'recent' =&gt; 60,
        'pending' =&gt; 60,
        'completed' =&gt; 60,
        'recent_failed' =&gt; 10080,
        'failed' =&gt; 10080,
        'monitored' =&gt; 10080,
    ],

    'metrics' =&gt; [
        'trim_snapshots' =&gt; [
            'job' =&gt; 24,
            'queue' =&gt; 24,
        ],
    ],

    'environments' =&gt; [
        'production' =&gt; [
            'critical' =&gt; [
                'connection' =&gt; 'redis',
                'queue' =&gt; ['critical'],
                'balance' =&gt; 'auto',
                'autoScalingStrategy' =&gt; 'time',
                'maxProcesses' =&gt; 20,
                'minProcesses' =&gt; 5,
                'balanceMaxShift' =&gt; 5,
                'balanceCooldown' =&gt; 3,
                'memory' =&gt; 128,
                'tries' =&gt; 3,
                'nice' =&gt; 0,
                'timeout' =&gt; 60,
            ],
            'high-priority' =&gt; [
                'connection' =&gt; 'redis',
                'queue' =&gt; ['high'],
                'balance' =&gt; 'auto',
                'maxProcesses' =&gt; 15,
                'minProcesses' =&gt; 3,
                'memory' =&gt; 256,
                'tries' =&gt; 5,
                'nice' =&gt; 5,
                'timeout' =&gt; 300,
            ],
            'default' =&gt; [
                'connection' =&gt; 'redis',
                'queue' =&gt; ['default'],
                'balance' =&gt; 'simple',
                'processes' =&gt; 10,
                'memory' =&gt; 512,
                'tries' =&gt; 3,
                'nice' =&gt; 10,
                'timeout' =&gt; 600,
            ],
            'webhooks' =&gt; [
                'connection' =&gt; 'redis',
                'queue' =&gt; ['webhooks'],
                'balance' =&gt; 'auto',
                'maxProcesses' =&gt; 25,
                'minProcesses' =&gt; 5,
                'memory' =&gt; 256,
                'tries' =&gt; 10,
                'nice' =&gt; 5,
                'timeout' =&gt; 30,
            ],
            'notifications' =&gt; [
                'connection' =&gt; 'redis',
                'queue' =&gt; ['notifications', 'low'],
                'balance' =&gt; 'simple',
                'processes' =&gt; 5,
                'memory' =&gt; 128,
                'tries' =&gt; 3,
                'nice' =&gt; 15,
                'timeout' =&gt; 60,
            ],
        ],
    ],
];
</code></pre>
<h2 id="job-lifecycle">Job Lifecycle</h2>
<pre><code class="language-mermaid">stateDiagram-v2
    [*] --&gt; Dispatched: Job::dispatch()
    Dispatched --&gt; Queued: Add to Redis
    Queued --&gt; Processing: Worker picks up
    Processing --&gt; Completed: Success
    Processing --&gt; Failed: Exception
    Processing --&gt; Released: Retry needed
    Released --&gt; Queued: Back to queue
    Failed --&gt; Retrying: Has retries left
    Retrying --&gt; Queued: Retry after delay
    Failed --&gt; Dead: No retries left
    Completed --&gt; [*]
    Dead --&gt; [*]
</code></pre>
<h2 id="job-patterns">Job Patterns</h2>
<h3 id="1-idempotent-jobs">1. Idempotent Jobs</h3>
<pre><code class="language-php">trait MakesJobIdempotent
{
    public function handle()
    {
        $lockKey = $this-&gt;getLockKey();

        $lock = Cache::lock($lockKey, $this-&gt;timeout + 60);

        if (!$lock-&gt;get()) {
            Log::info('Job already processing', ['key' =&gt; $lockKey]);
            return;
        }

        try {
            if ($this-&gt;alreadyProcessed()) {
                Log::info('Job already completed', ['key' =&gt; $lockKey]);
                return;
            }

            $this-&gt;process();
            $this-&gt;markAsProcessed();
        } finally {
            $lock-&gt;release();
        }
    }

    abstract protected function getLockKey(): string;
    abstract protected function alreadyProcessed(): bool;
    abstract protected function process(): void;
    abstract protected function markAsProcessed(): void;
}
</code></pre>
<h3 id="2-batch-processing">2. Batch Processing</h3>
<pre><code class="language-php">class ProcessBatchJob implements ShouldQueue
{
    use Batchable;

    public function handle()
    {
        $items = $this-&gt;getItems();

        $jobs = $items-&gt;map(function ($item) {
            return new ProcessSingleItemJob($item);
        });

        Bus::batch($jobs)
            -&gt;then(function (Batch $batch) {
                Log::info('Batch completed', ['id' =&gt; $batch-&gt;id]);
            })
            -&gt;catch(function (Batch $batch, Throwable $e) {
                Log::error('Batch failed', [
                    'id' =&gt; $batch-&gt;id,
                    'error' =&gt; $e-&gt;getMessage()
                ]);
            })
            -&gt;finally(function (Batch $batch) {
                CleanupBatchJob::dispatch($batch-&gt;id);
            })
            -&gt;dispatch();
    }
}
</code></pre>
<h3 id="3-chain-processing">3. Chain Processing</h3>
<pre><code class="language-php">Bus::chain([
    new ExtractCallDataJob($callId),
    new IdentifyCustomerJob($callId),
    new CreateAppointmentJob($callId),
    new SendConfirmationJob($callId),
    new UpdateAnalyticsJob($callId),
])-&gt;dispatch();
</code></pre>
<h2 id="monitoring-metrics">Monitoring &amp; Metrics</h2>
<h3 id="queue-metrics">Queue Metrics</h3>
<pre><code class="language-php">class QueueMetricsService
{
    public function getMetrics(): array
    {
        return [
            'queue_sizes' =&gt; $this-&gt;getQueueSizes(),
            'processing_time' =&gt; $this-&gt;getProcessingTimes(),
            'failure_rates' =&gt; $this-&gt;getFailureRates(),
            'worker_status' =&gt; $this-&gt;getWorkerStatus(),
            'throughput' =&gt; $this-&gt;getThroughput(),
        ];
    }

    private function getQueueSizes(): array
    {
        return collect(['critical', 'high', 'default', 'webhooks', 'notifications'])
            -&gt;mapWithKeys(function ($queue) {
                return [$queue =&gt; Redis::llen(&quot;queues:{$queue}&quot;)];
            })
            -&gt;toArray();
    }
}
</code></pre>
<h3 id="health-checks">Health Checks</h3>
<pre><code class="language-php">class QueueHealthCheck
{
    public function check(): HealthCheckResult
    {
        $issues = [];

        // Check queue sizes
        foreach ($this-&gt;getQueueSizes() as $queue =&gt; $size) {
            if ($size &gt; $this-&gt;getThreshold($queue)) {
                $issues[] = &quot;Queue {$queue} is backed up ({$size} jobs)&quot;;
            }
        }

        // Check failed jobs
        $failedCount = DB::table('failed_jobs')-&gt;count();
        if ($failedCount &gt; 100) {
            $issues[] = &quot;High number of failed jobs ({$failedCount})&quot;;
        }

        // Check worker health
        if (!$this-&gt;areWorkersHealthy()) {
            $issues[] = &quot;Some workers are not responding&quot;;
        }

        return new HealthCheckResult(
            empty($issues) ? 'healthy' : 'unhealthy',
            $issues
        );
    }
}
</code></pre>
<h2 id="best-practices">Best Practices</h2>
<h3 id="1-job-design">1. Job Design</h3>
<ul>
<li>Keep jobs small and focused</li>
<li>Use database transactions when needed</li>
<li>Implement proper error handling</li>
<li>Make jobs idempotent when possible</li>
<li>Use appropriate timeouts</li>
</ul>
<h3 id="2-queue-selection">2. Queue Selection</h3>
<ul>
<li><code>critical</code>: User-facing, immediate impact</li>
<li><code>high</code>: Important but can wait seconds</li>
<li><code>default</code>: Regular processing</li>
<li><code>webhooks</code>: External service callbacks</li>
<li><code>notifications</code>: User communications</li>
<li><code>low</code>: Reports, cleanup, maintenance</li>
</ul>
<h3 id="3-error-handling">3. Error Handling</h3>
<pre><code class="language-php">public function handle()
{
    try {
        $this-&gt;process();
    } catch (RateLimitException $e) {
        // Retry later with backoff
        $this-&gt;release($e-&gt;retryAfter);
    } catch (ExternalServiceException $e) {
        // Retry with exponential backoff
        $this-&gt;release($this-&gt;attempts() * 60);
    } catch (ValidationException $e) {
        // Don't retry - log and fail
        Log::error('Validation failed', ['error' =&gt; $e-&gt;getMessage()]);
        $this-&gt;fail($e);
    }
}
</code></pre>
<h3 id="4-monitoring">4. Monitoring</h3>
<ul>
<li>Set up alerts for queue depth</li>
<li>Monitor job processing time</li>
<li>Track failure rates</li>
<li>Watch for memory leaks</li>
<li>Review slow job logs</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
