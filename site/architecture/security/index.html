<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://api.askproai.de/mkdocs/architecture/security/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Security - AskProAI Dokumentation</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Security";
        var mkdocs_page_input_path = "architecture/security.md";
        var mkdocs_page_url = "/mkdocs/architecture/security/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> AskProAI Dokumentation
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Start</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Hauptdokumentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE/">Projekt Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE_QUICK_REFERENCE/">Quick Reference</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE_CONTEXT_SUMMARY/">Context Summary</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Power User</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../TOP_10_COMMANDS/">Top 10 Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../CLAUDE_BEFEHLE_FUER_DICH/">Claude Befehle für dich</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../MY_COMMANDS/">Meine Commands</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Best Practices 2025</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../BEST_PRACTICES_IMPLEMENTATION/">Implementation Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../DEVELOPMENT_PROCESS_2025/">Development Process</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../CLAUDE_DOCUMENTATION_GAPS_ANALYSIS.md">Documentation Gaps</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Schnellstart</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../5-MINUTEN_ONBOARDING_PLAYBOOK/">5-Minuten Onboarding</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Architektur</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../overview/">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../services/">Services</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../system-design/">System Design</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mcp-architecture/">MCP Architecture</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../database-schema/">Database Schema</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Security</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security-principles">Security Principles</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#architecture-overview">Architecture Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#authentication-authorization">Authentication &amp; Authorization</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#authentication-methods">Authentication Methods</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#api-token-authentication">API Token Authentication</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#session-based-authentication">Session-Based Authentication</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#authorization-framework">Authorization Framework</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#multi-factor-authentication-mfa">Multi-Factor Authentication (MFA)</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#input-validation-sanitization">Input Validation &amp; Sanitization</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#request-validation">Request Validation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#xss-prevention">XSS Prevention</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#sql-injection-prevention">SQL Injection Prevention</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#webhook-security">Webhook Security</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#signature-verification">Signature Verification</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#webhook-payload-validation">Webhook Payload Validation</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#data-encryption">Data Encryption</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#encryption-at-rest">Encryption at Rest</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#encryption-in-transit">Encryption in Transit</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#multi-tenancy-security">Multi-Tenancy Security</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#tenant-isolation">Tenant Isolation</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#cross-tenant-protection">Cross-Tenant Protection</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#rate-limiting-ddos-protection">Rate Limiting &amp; DDoS Protection</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#application-level-rate-limiting">Application-Level Rate Limiting</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#infrastructure-protection">Infrastructure Protection</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security-monitoring">Security Monitoring</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#real-time-threat-detection">Real-Time Threat Detection</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#audit-logging">Audit Logging</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#gdpr-compliance">GDPR Compliance</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#data-privacy">Data Privacy</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#consent-management">Consent Management</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security-headers">Security Headers</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#incident-response">Incident Response</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#response-plan">Response Plan</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#security-contacts">Security Contacts</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#security-checklist">Security Checklist</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#development">Development</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#deployment">Deployment</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#maintenance">Maintenance</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../performance/">Performance</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../api/overview.md">Übersicht</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/authentication/">Authentication</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../api/endpoints.md">Endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../api/webhooks/">Webhooks</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Features</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/appointment-booking/">Appointment Booking</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../features/call-management.md">Call Management</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../features/customer-portal.md">Customer Portal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../features/multi-tenancy/">Multi-Tenancy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Development</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../development/setup.md">Setup</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../development/testing.md">Testing</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../development/code-standards.md">Code Standards</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../deployment/overview.md">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../deployment/production.md">Production</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../deployment/environment-variables.md">Environment Variables</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Betrieb</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../CUSTOMER_SUCCESS_RUNBOOK/">Customer Success</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../EMERGENCY_RESPONSE_PLAYBOOK/">Emergency Response</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../ERROR_PATTERNS/">Error Patterns</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../TROUBLESHOOTING_DECISION_TREE/">Troubleshooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../DEPLOYMENT_CHECKLIST/">Deployment Checklist</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Monitoring</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../KPI_DASHBOARD_TEMPLATE/">KPI Dashboard</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../INTEGRATION_HEALTH_MONITOR/">Health Monitor</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../PHONE_TO_APPOINTMENT_FLOW/">Phone to Appointment Flow</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">AskProAI Dokumentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Architektur &raquo;</li>
      <li>Security</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="security-architecture">Security Architecture</h1>
<h2 id="overview">Overview</h2>
<p>AskProAI implements defense-in-depth security architecture with multiple layers of protection. This document outlines our security measures, compliance standards, and best practices.</p>
<h2 id="security-principles">Security Principles</h2>
<ol>
<li><strong>Zero Trust</strong>: Never trust, always verify</li>
<li><strong>Least Privilege</strong>: Minimal access rights</li>
<li><strong>Defense in Depth</strong>: Multiple security layers</li>
<li><strong>Fail Secure</strong>: Secure by default on failure</li>
<li><strong>Audit Everything</strong>: Comprehensive logging</li>
</ol>
<h2 id="architecture-overview">Architecture Overview</h2>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;External Layer&quot;
        CF[Cloudflare WAF]
        DDOS[DDoS Protection]
        SSL[SSL/TLS]
    end

    subgraph &quot;Application Layer&quot;
        AUTH[Authentication]
        AUTHZ[Authorization]
        VALID[Input Validation]
        CSRF[CSRF Protection]
    end

    subgraph &quot;Service Layer&quot;
        SIGN[Webhook Signatures]
        RATE[Rate Limiting]
        TENANT[Tenant Isolation]
        AUDIT[Audit Logging]
    end

    subgraph &quot;Data Layer&quot;
        ENCRYPT[Encryption at Rest]
        BACKUP[Encrypted Backups]
        ANON[PII Anonymization]
        MASK[Data Masking]
    end

    CF --&gt; AUTH
    DDOS --&gt; CF
    SSL --&gt; CF

    AUTH --&gt; AUTHZ
    AUTHZ --&gt; VALID
    VALID --&gt; CSRF

    CSRF --&gt; SIGN
    SIGN --&gt; RATE
    RATE --&gt; TENANT
    TENANT --&gt; AUDIT

    AUDIT --&gt; ENCRYPT
    ENCRYPT --&gt; BACKUP
    BACKUP --&gt; ANON
    ANON --&gt; MASK
</code></pre>
<h2 id="authentication-authorization">Authentication &amp; Authorization</h2>
<h3 id="authentication-methods">Authentication Methods</h3>
<h4 id="api-token-authentication">API Token Authentication</h4>
<pre><code class="language-php">// Secure token generation
$token = bin2hex(random_bytes(32));
$hashedToken = hash('sha256', $token);

// Store only the hash
ApiToken::create([
    'token_hash' =&gt; $hashedToken,
    'company_id' =&gt; $company-&gt;id,
    'expires_at' =&gt; now()-&gt;addYear()
]);
</code></pre>
<h4 id="session-based-authentication">Session-Based Authentication</h4>
<ul>
<li>Laravel Sanctum for SPA authentication</li>
<li>Secure session cookies (HttpOnly, Secure, SameSite)</li>
<li>Session rotation on privilege escalation</li>
</ul>
<h3 id="authorization-framework">Authorization Framework</h3>
<pre><code class="language-php">// Policy-based authorization
class AppointmentPolicy
{
    public function view(User $user, Appointment $appointment)
    {
        return $user-&gt;company_id === $appointment-&gt;company_id;
    }

    public function update(User $user, Appointment $appointment)
    {
        return $user-&gt;company_id === $appointment-&gt;company_id
            &amp;&amp; $user-&gt;hasPermission('appointments.update');
    }
}
</code></pre>
<h3 id="multi-factor-authentication-mfa">Multi-Factor Authentication (MFA)</h3>
<pre><code class="language-mermaid">sequenceDiagram
    User-&gt;&gt;Auth: Login with credentials
    Auth-&gt;&gt;User: Request 2FA code
    User-&gt;&gt;Auth: Provide TOTP code
    Auth-&gt;&gt;TOTP: Verify code
    TOTP--&gt;&gt;Auth: Valid
    Auth-&gt;&gt;Session: Create authenticated session
    Auth--&gt;&gt;User: Login successful
</code></pre>
<h2 id="input-validation-sanitization">Input Validation &amp; Sanitization</h2>
<h3 id="request-validation">Request Validation</h3>
<pre><code class="language-php">class CreateAppointmentRequest extends FormRequest
{
    public function rules()
    {
        return [
            'customer_phone' =&gt; [
                'required',
                'string',
                new PhoneNumber(),
                new SQLInjectionProtection()
            ],
            'start_time' =&gt; [
                'required',
                'date',
                'after:now',
                new BusinessHours()
            ],
            'service_id' =&gt; [
                'required',
                'integer',
                'exists:services,id,company_id,' . $this-&gt;company_id
            ]
        ];
    }
}
</code></pre>
<h3 id="xss-prevention">XSS Prevention</h3>
<pre><code class="language-php">// Automatic output escaping
{{ $user-&gt;name }} // Escaped
{!! $user-&gt;bio !!} // Raw (use carefully)

// Content Security Policy
Content-Security-Policy: 
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://cdn.example.com;
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
</code></pre>
<h3 id="sql-injection-prevention">SQL Injection Prevention</h3>
<pre><code class="language-php">// Bad - Never do this
$users = DB::select(&quot;SELECT * FROM users WHERE email = '$email'&quot;);

// Good - Parameterized queries
$users = DB::select(&quot;SELECT * FROM users WHERE email = ?&quot;, [$email]);

// Better - Query builder
$users = User::where('email', $email)-&gt;get();
</code></pre>
<h2 id="webhook-security">Webhook Security</h2>
<h3 id="signature-verification">Signature Verification</h3>
<pre><code class="language-php">class VerifyWebhookSignature
{
    public function handle($request, Closure $next)
    {
        $payload = $request-&gt;getContent();
        $signature = $request-&gt;header('X-Webhook-Signature');

        $expected = 'sha256=' . hash_hmac(
            'sha256',
            $payload,
            config('services.webhook.secret')
        );

        if (!hash_equals($expected, $signature)) {
            throw new UnauthorizedException('Invalid webhook signature');
        }

        return $next($request);
    }
}
</code></pre>
<h3 id="webhook-payload-validation">Webhook Payload Validation</h3>
<pre><code class="language-json">{
  &quot;timestamp&quot;: &quot;2025-06-23T10:00:00Z&quot;,
  &quot;signature&quot;: &quot;sha256=...&quot;,
  &quot;nonce&quot;: &quot;unique-value&quot;,
  &quot;data&quot;: {
    // Actual webhook data
  }
}
</code></pre>
<h2 id="data-encryption">Data Encryption</h2>
<h3 id="encryption-at-rest">Encryption at Rest</h3>
<pre><code class="language-php">// Automatic encryption for sensitive fields
class Customer extends Model
{
    protected $encrypted = [
        'ssn',
        'credit_card',
        'medical_notes'
    ];
}

// Encryption implementation
trait EncryptsAttributes
{
    public function setAttribute($key, $value)
    {
        if (in_array($key, $this-&gt;encrypted)) {
            $value = Crypt::encryptString($value);
        }

        parent::setAttribute($key, $value);
    }
}
</code></pre>
<h3 id="encryption-in-transit">Encryption in Transit</h3>
<ul>
<li>TLS 1.3 minimum</li>
<li>Strong cipher suites only</li>
<li>HSTS enabled</li>
<li>Certificate pinning for mobile apps</li>
</ul>
<h2 id="multi-tenancy-security">Multi-Tenancy Security</h2>
<h3 id="tenant-isolation">Tenant Isolation</h3>
<pre><code class="language-php">// Global scope for automatic tenant filtering
class TenantScope implements Scope
{
    public function apply(Builder $builder, Model $model)
    {
        if (Auth::check()) {
            $builder-&gt;where('company_id', Auth::user()-&gt;company_id);
        }
    }
}

// Applied automatically to models
protected static function booted()
{
    static::addGlobalScope(new TenantScope);
}
</code></pre>
<h3 id="cross-tenant-protection">Cross-Tenant Protection</h3>
<pre><code class="language-php">// Middleware to prevent tenant switching
class EnsureTenantConsistency
{
    public function handle($request, Closure $next)
    {
        $requestTenant = $request-&gt;header('X-Company-ID');
        $userTenant = Auth::user()-&gt;company_id;

        if ($requestTenant &amp;&amp; $requestTenant != $userTenant) {
            abort(403, 'Tenant mismatch');
        }

        return $next($request);
    }
}
</code></pre>
<h2 id="rate-limiting-ddos-protection">Rate Limiting &amp; DDoS Protection</h2>
<h3 id="application-level-rate-limiting">Application-Level Rate Limiting</h3>
<pre><code class="language-php">// Adaptive rate limiting
class AdaptiveRateLimiter
{
    public function getRateLimit($user)
    {
        // Base limits by tier
        $limits = [
            'free' =&gt; 100,
            'pro' =&gt; 1000,
            'enterprise' =&gt; 10000
        ];

        $baseLimit = $limits[$user-&gt;tier] ?? 100;

        // Adjust based on behavior
        if ($this-&gt;isSuspiciousBehavior($user)) {
            return $baseLimit * 0.5; // Reduce limit
        }

        if ($this-&gt;isVerifiedUser($user)) {
            return $baseLimit * 1.2; // Increase limit
        }

        return $baseLimit;
    }
}
</code></pre>
<h3 id="infrastructure-protection">Infrastructure Protection</h3>
<ul>
<li>Cloudflare DDoS protection</li>
<li>Rate limiting at nginx level</li>
<li>Fail2ban for repeated failures</li>
<li>Geographic restrictions when needed</li>
</ul>
<h2 id="security-monitoring">Security Monitoring</h2>
<h3 id="real-time-threat-detection">Real-Time Threat Detection</h3>
<pre><code class="language-php">class ThreatDetectionService
{
    protected $patterns = [
        'sql_injection' =&gt; '/(\bUNION\b|\bSELECT\b.*\bFROM\b|\bDROP\b)/i',
        'xss_attempt' =&gt; '/&lt;script|javascript:|onerror=/i',
        'path_traversal' =&gt; '/\.\.\/|\.\.\\\\/',
        'command_injection' =&gt; '/;|\||`|\$\(/
    ];

    public function analyze($request)
    {
        foreach ($this-&gt;patterns as $threat =&gt; $pattern) {
            if ($this-&gt;detectPattern($request, $pattern)) {
                $this-&gt;handleThreat($threat, $request);
            }
        }
    }
}
</code></pre>
<h3 id="audit-logging">Audit Logging</h3>
<pre><code class="language-php">// Comprehensive audit trail
class AuditLogger
{
    public function log($action, $model, $user)
    {
        AuditLog::create([
            'user_id' =&gt; $user-&gt;id,
            'company_id' =&gt; $user-&gt;company_id,
            'action' =&gt; $action,
            'model_type' =&gt; get_class($model),
            'model_id' =&gt; $model-&gt;id,
            'old_values' =&gt; $model-&gt;getOriginal(),
            'new_values' =&gt; $model-&gt;getAttributes(),
            'ip_address' =&gt; request()-&gt;ip(),
            'user_agent' =&gt; request()-&gt;userAgent(),
            'timestamp' =&gt; now()
        ]);
    }
}
</code></pre>
<h2 id="gdpr-compliance">GDPR Compliance</h2>
<h3 id="data-privacy">Data Privacy</h3>
<pre><code class="language-php">// Personal data export
class GDPRExportService
{
    public function exportUserData($customer)
    {
        return [
            'personal_info' =&gt; $this-&gt;getPersonalInfo($customer),
            'appointments' =&gt; $this-&gt;getAppointments($customer),
            'communications' =&gt; $this-&gt;getCommunications($customer),
            'consent_history' =&gt; $this-&gt;getConsentHistory($customer)
        ];
    }
}

// Right to be forgotten
class GDPRDeletionService
{
    public function deleteUserData($customer)
    {
        DB::transaction(function () use ($customer) {
            // Anonymize instead of delete for audit trail
            $customer-&gt;update([
                'name' =&gt; 'DELETED_USER',
                'email' =&gt; 'deleted@example.com',
                'phone' =&gt; '0000000000',
                'anonymized_at' =&gt; now()
            ]);

            // Delete related personal data
            $customer-&gt;communications()-&gt;delete();
            $customer-&gt;consent_records()-&gt;delete();
        });
    }
}
</code></pre>
<h3 id="consent-management">Consent Management</h3>
<pre><code class="language-php">class ConsentManager
{
    public function recordConsent($customer, $type, $granted)
    {
        ConsentRecord::create([
            'customer_id' =&gt; $customer-&gt;id,
            'consent_type' =&gt; $type,
            'granted' =&gt; $granted,
            'ip_address' =&gt; request()-&gt;ip(),
            'timestamp' =&gt; now(),
            'version' =&gt; config('gdpr.consent_version')
        ]);
    }
}
</code></pre>
<h2 id="security-headers">Security Headers</h2>
<pre><code class="language-php">// Security headers middleware
class SecurityHeaders
{
    public function handle($request, Closure $next)
    {
        $response = $next($request);

        $response-&gt;headers-&gt;set('X-Frame-Options', 'DENY');
        $response-&gt;headers-&gt;set('X-Content-Type-Options', 'nosniff');
        $response-&gt;headers-&gt;set('X-XSS-Protection', '1; mode=block');
        $response-&gt;headers-&gt;set('Referrer-Policy', 'strict-origin-when-cross-origin');
        $response-&gt;headers-&gt;set('Permissions-Policy', 'geolocation=(), microphone=(), camera=()');
        $response-&gt;headers-&gt;set(
            'Strict-Transport-Security',
            'max-age=31536000; includeSubDomains; preload'
        );

        return $response;
    }
}
</code></pre>
<h2 id="incident-response">Incident Response</h2>
<h3 id="response-plan">Response Plan</h3>
<pre><code class="language-mermaid">flowchart TB
    DETECT[Detect Incident] --&gt; ASSESS[Assess Severity]
    ASSESS --&gt; CONTAIN[Contain Threat]
    CONTAIN --&gt; INVESTIGATE[Investigate Cause]
    INVESTIGATE --&gt; REMEDIATE[Remediate]
    REMEDIATE --&gt; RECOVER[Recover Services]
    RECOVER --&gt; REVIEW[Post-Mortem Review]
    REVIEW --&gt; IMPROVE[Improve Security]
</code></pre>
<h3 id="security-contacts">Security Contacts</h3>
<pre><code class="language-yaml">Security Team:
  Email: security@askproai.de
  Phone: +49-30-SECURITY

Incident Response:
  Email: incident@askproai.de
  Hotline: +49-30-INCIDENT

Bug Bounty:
  Program: https://askproai.de/security/bug-bounty
  Email: bugbounty@askproai.de
</code></pre>
<h2 id="security-checklist">Security Checklist</h2>
<h3 id="development">Development</h3>
<ul>
<li>[ ] Input validation on all user inputs</li>
<li>[ ] Output encoding for XSS prevention</li>
<li>[ ] Parameterized queries for database access</li>
<li>[ ] Authentication on all endpoints</li>
<li>[ ] Authorization checks for resources</li>
<li>[ ] Audit logging for sensitive operations</li>
</ul>
<h3 id="deployment">Deployment</h3>
<ul>
<li>[ ] SSL/TLS certificates valid</li>
<li>[ ] Security headers configured</li>
<li>[ ] Rate limiting enabled</li>
<li>[ ] Monitoring alerts active</li>
<li>[ ] Backup encryption verified</li>
<li>[ ] Access logs configured</li>
</ul>
<h3 id="maintenance">Maintenance</h3>
<ul>
<li>[ ] Security patches applied</li>
<li>[ ] Dependencies updated</li>
<li>[ ] Access reviews completed</li>
<li>[ ] Penetration test scheduled</li>
<li>[ ] Security training current</li>
<li>[ ] Incident response tested</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../database-schema/" class="btn btn-neutral float-left" title="Database Schema"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../performance/" class="btn btn-neutral float-right" title="Performance">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../database-schema/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../performance/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
