{
  "agent_name": "Friseur1 Fixed V2 (LOOP_BUG_FIXED)",
  "channel": "voice",
  "response_engine": {
    "type": "conversation-flow",
    "version": 32,
    "conversation_flow_id": "conversation_flow_a58405e3f67a"
  },
  "webhook_url": "https://api.askproai.de/api/webhooks/retell",
  "language": "de-DE",
  "opt_out_sensitive_data_storage": false,
  "data_storage_setting": "everything",
  "opt_in_signed_url": false,
  "end_call_after_silence_ms": 60000,
  "voice_id": "11labs-Carola",
  "voice_temperature": 0.02,
  "voice_speed": 1,
  "volume": 1,
  "enable_backchannel": true,
  "reminder_trigger_ms": 10000,
  "reminder_max_count": 2,
  "max_call_duration_ms": 1800000,
  "interruption_sensitivity": 1,
  "responsiveness": 1,
  "allow_user_dtmf": true,
  "user_dtmf_options": {},
  "post_call_analysis_model": "gpt-4o-mini",
  "pii_config": {
    "mode": "post_call",
    "categories": []
  },
  "conversationFlow": {
    "conversation_flow_id": "conversation_flow_a58405e3f67a",
    "version": 32,
    "global_prompt": "# Friseur 1 - Intelligenter Terminassistent V5 (State Persistence)\n\n## Deine Rolle\nDu bist der Terminassistent von **Friseur 1**.\nSprich freundlich und natürlich auf Deutsch.\n\n## WICHTIG: State Management\n\n**Du hast Zugriff auf Dynamic Variables:**\n- {{customer_name}} - Name des Kunden\n- {{service_name}} - Gewünschter Service\n- {{appointment_date}} - Gewünschtes Datum\n- {{appointment_time}} - Gewünschte Uhrzeit\n- {{cancel_datum}} - Datum für Stornierung\n- {{cancel_uhrzeit}} - Uhrzeit für Stornierung\n- {{old_datum}} - Alter Termin Datum für Verschiebung\n- {{old_uhrzeit}} - Alter Termin Uhrzeit für Verschiebung\n- {{new_datum}} - Neuer Termin Datum für Verschiebung\n- {{new_uhrzeit}} - Neuer Termin Uhrzeit für Verschiebung\n\n**IMMER ZUERST PRÜFEN:**\n1. Was steht bereits in den Variablen?\n2. Was hat der Kunde im Transcript gesagt?\n3. NUR nach FEHLENDEN Daten fragen!\n\n## Services\n- Herrenhaarschnitt (30 Min, 25€)\n- Damenhaarschnitt (45 Min, 35€)\n- Färben (90 Min, 65€)\n\n## Du kannst helfen bei:\n1. **Neuen Termin buchen** - Sammle fehlende Daten und buche\n2. **Termine anzeigen** - Zeige bestehende Termine\n3. **Termin stornieren** - Finde und storniere Termin\n4. **Termin verschieben** - Verschiebe auf neues Datum/Uhrzeit\n5. **Services auflisten** - Zeige was wir anbieten\n\n## NIEMALS\n- ❌ Verfügbarkeit raten oder erfinden\n- ❌ Termin ohne Bestätigung buchen\n- ❌ Nach Daten fragen die bereits bekannt sind (in Variablen)\n- ❌ Tools manuell aufrufen (macht der Flow!)",
    "nodes": [
      {
        "name": "Begrüßung",
        "edges": [
          {
            "destination_node_id": "intent_router",
            "id": "edge_greeting_to_intent",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Customer responded"
            }
          }
        ],
        "id": "node_greeting",
        "type": "conversation",
        "display_position": {
          "x": 550,
          "y": 290
        },
        "instruction": {
          "type": "prompt",
          "text": "Begrüße den Kunden freundlich: 'Willkommen bei Friseur 1! Wie kann ich Ihnen helfen?'"
        },
        "knowledge_base_ids": []
      },
      {
        "name": "Intent Erkennung",
        "edges": [
          {
            "destination_node_id": "node_collect_booking_info",
            "id": "edge_intent_to_book",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to BOOK a new appointment (keywords: buchen, Termin vereinbaren, Haarschnitt, Färben)"
            }
          },
          {
            "destination_node_id": "func_get_appointments",
            "id": "edge_intent_to_check",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to CHECK existing appointments (keywords: Welche Termine, meine Termine, zeigen, anzeigen)"
            }
          },
          {
            "destination_node_id": "node_collect_cancel_info",
            "id": "edge_intent_to_cancel",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to CANCEL an appointment (keywords: stornieren, absagen, nicht kommen)"
            }
          },
          {
            "destination_node_id": "node_collect_reschedule_info",
            "id": "edge_intent_to_reschedule",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to RESCHEDULE an appointment (keywords: verschieben, umbuchen, anderen Tag)"
            }
          },
          {
            "destination_node_id": "func_get_services",
            "id": "edge_intent_to_services",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to INQUIRE about services (keywords: Was bieten Sie an, Services, Preise, Kosten)"
            }
          }
        ],
        "id": "intent_router",
        "type": "conversation",
        "display_position": {
          "x": 1100,
          "y": 160
        },
        "instruction": {
          "type": "prompt",
          "text": "Verstehe die Absicht des Kunden:\n\n**Wenn Kunde sagt:**\n- 'Termin buchen', 'Haarschnitt', 'Färben' → BOOK\n- 'Welche Termine', 'Meine Termine' → CHECK\n- 'Stornieren', 'Absagen' → CANCEL\n- 'Verschieben', 'Umbuchen' → RESCHEDULE\n- 'Was bieten Sie an', 'Preise' → SERVICES\n\n**Du musst NICHT antworten** - transition direkt zum passenden Node!"
        },
        "knowledge_base_ids": []
      },
      {
        "name": "Buchungsdaten sammeln",
        "edges": [
          {
            "destination_node_id": "func_check_availability",
            "id": "edge_collect_booking_to_check",
            "transition_condition": {
              "type": "prompt",
              "prompt": "ALL variables are filled (not empty): {{customer_name}} AND {{service_name}} AND {{appointment_date}} AND {{appointment_time}}"
            }
          }
        ],
        "id": "node_collect_booking_info",
        "type": "conversation",
        "display_position": {
          "x": 1785.3846153846152,
          "y": -484.9980207589956
        },
        "instruction": {
          "type": "prompt",
          "text": "## SCHRITT 1: ANALYSIERE USER'S AKTUELLE AUSSAGE\n\n**Prüfe ZUERST was der User GERADE gesagt hat:**\n- Lies die letzte User-Nachricht im Transcript\n- Extrahiere ALLE vorhandenen Informationen\n- Setze diese Informationen in die Variablen\n\n**Beispiele für Extraktion:**\nUser: \"Herrenhaarschnitt für morgen 9 Uhr, Schuster\"\n→ Erkenne: Name=\"Schuster\", Service=\"Herrenhaarschnitt\", Datum=\"morgen\", Zeit=\"9 Uhr\"\n\nUser: \"Um 06:55\"\n→ Erkenne: Zeit=\"06:55\"\n\n## SCHRITT 2: PRÜFE BEREITS GESETZTE VARIABLEN\n\n**Bereits gesammelte Informationen:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n- Datum: {{appointment_date}}\n- Uhrzeit: {{appointment_time}}\n\n## SCHRITT 3: FRAGE NUR NACH FEHLENDEN DATEN\n\n**NUR wenn eine Variable WIRKLICH leer ist:**\n- Wenn {{customer_name}} leer → \"Wie ist Ihr Name?\"\n- Wenn {{service_name}} leer → \"Welche Dienstleistung möchten Sie?\" (Herrenhaarschnitt/Damenhaarschnitt/Färben)\n- Wenn {{appointment_date}} leer → \"Für welchen Tag?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{appointment_time}} leer → \"Um wie viel Uhr?\" (HH:MM)\n\n**NIEMALS redundante Fragen:**\n❌ \"Ist es morgen, wie Sie gesagt haben?\" (wenn User schon \"morgen\" sagte)\n❌ \"Sie haben gesagt, um neun Uhr, richtig?\" (wenn User schon \"neun Uhr\" sagte)\n✅ Nutze die Info direkt!\n\n## SCHRITT 4: TRANSITION\n\n**Sobald ALLE 4 Variablen gefüllt sind:**\n→ Sage: \"Perfekt! Einen Moment, ich prüfe die Verfügbarkeit...\"\n→ Transition zu func_check_availability\n\n**Akzeptiere natürliche Eingaben:**\n- \"heute\", \"morgen\", \"Montag\", \"nächsten Freitag\" → als Datum\n- \"15 Uhr\", \"halb drei\", \"14:30\", \"neun\" → als Uhrzeit"
        },
        "knowledge_base_ids": []
      },
      {
        "tool_id": "tool-check-availability",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment bitte, ich prüfe die Verfügbarkeit..."
        },
        "name": "Verfügbarkeit prüfen",
        "edges": [
          {
            "destination_node_id": "node_present_result",
            "id": "edge_check_to_present",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Availability check completed"
            }
          }
        ],
        "parameter_mapping": {
          "name": "{{customer_name}}",
          "datum": "{{appointment_date}}",
          "dienstleistung": "{{service_name}}",
          "uhrzeit": "{{appointment_time}}"
        },
        "id": "func_check_availability",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 2212.3076923076924,
          "y": 183.84615384615387
        },
        "wait_for_result": true
      },
      {
        "name": "Ergebnis zeigen",
        "edges": [
          {
            "destination_node_id": "node_extract_alternative_selection",
            "id": "edge_present_to_extract",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User selected one of the presented alternative time slots (e.g., \"Um 06:55\", \"Den ersten Termin\", \"14:30\")"
            }
          },
          {
            "destination_node_id": "func_book_appointment",
            "id": "edge_present_to_book",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User explicitly confirmed booking (said Ja, Gerne, Buchen, Passt, etc.)"
            }
          },
          {
            "destination_node_id": "node_collect_booking_info",
            "id": "edge_present_to_retry",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants different time or declined"
            }
          }
        ],
        "id": "node_present_result",
        "type": "conversation",
        "display_position": {
          "x": 2750,
          "y": 180
        },
        "instruction": {
          "type": "prompt",
          "text": "Zeige das Ergebnis der Verfügbarkeitsprüfung:\n\n**WENN VERFÜGBAR:**\n\"Der Termin am {{appointment_date}} um {{appointment_time}} für {{service_name}} ist verfügbar. Soll ich den Termin für Sie buchen?\"\n\n**WENN NICHT VERFÜGBAR mit ALTERNATIVEN:**\nPräsentiere die Alternativen EINMAL klar und knapp.\nBeispiel: \"Leider ist {{appointment_date}} um {{appointment_time}} nicht verfügbar. Ich habe jedoch folgende Alternativen für Sie: [Liste]. Welcher Termin würde Ihnen besser passen?\"\n\n**WICHTIG - Wenn User Alternative wählt:**\n- User sagt z.B. \"Um 06:55\" oder \"Den ersten Termin\"\n- ✅ AKZEPTIERE SOFORT - keine erneute Bestätigung!\n- ✅ UPDATE {{appointment_time}} mit der neuen Zeit\n- ✅ Sage einfach: \"Einen Moment, ich prüfe die Verfügbarkeit...\"\n- ✅ Transition direkt zurück zu func_check_availability\n\n**NUR wenn User explizit buchen möchte:**\n- \"Ja\", \"Gerne\", \"Buchen Sie\", \"Passt\" → func_book_appointment\n\n**KEINE redundanten Bestätigungen wie:**\n❌ \"Also, um das klarzustellen: Sie möchten den Termin...\"\n❌ \"Ist das richtig?\"\n✅ Vertraue dem User - wenn er eine Zeit nennt, nutze sie!"
        },
        "knowledge_base_ids": []
      },
      {
        "tool_id": "tool-book-appointment",
        "instruction": {
          "type": "static_text",
          "text": "Perfekt! Einen Moment, ich buche den Termin..."
        },
        "name": "Termin buchen",
        "edges": [
          {
            "destination_node_id": "node_booking_success",
            "id": "edge_book_to_success",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Booking successful"
            }
          }
        ],
        "parameter_mapping": {
          "name": "{{customer_name}}",
          "datum": "{{appointment_date}}",
          "dienstleistung": "{{service_name}}",
          "uhrzeit": "{{selected_alternative_time || appointment_time}}"
        },
        "id": "func_book_appointment",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 3300,
          "y": 290
        },
        "wait_for_result": true
      },
      {
        "name": "Buchung erfolgreich",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_booking_success_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_booking_success",
        "type": "conversation",
        "display_position": {
          "x": 3850,
          "y": 280
        },
        "instruction": {
          "type": "static_text",
          "text": "Wunderbar! Ihr Termin ist gebucht. Sie erhalten eine Bestätigung per E-Mail. Vielen Dank und einen schönen Tag!"
        },
        "knowledge_base_ids": []
      },
      {
        "tool_id": "tool-get-appointments",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich schaue nach Ihren Terminen..."
        },
        "name": "Termine abrufen",
        "edges": [
          {
            "destination_node_id": "node_show_appointments",
            "id": "edge_get_to_show",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Appointments retrieved"
            }
          }
        ],
        "parameter_mapping": [],
        "id": "func_get_appointments",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 1671.295117948137,
          "y": 895.0069163913706
        },
        "wait_for_result": true
      },
      {
        "name": "Termine anzeigen",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_show_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User acknowledged or wants to end"
            }
          },
          {
            "destination_node_id": "intent_router",
            "id": "edge_show_to_intent",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to modify a shown appointment"
            }
          }
        ],
        "id": "node_show_appointments",
        "type": "conversation",
        "display_position": {
          "x": 2320.9524193092784,
          "y": 946.1408686208118
        },
        "instruction": {
          "type": "prompt",
          "text": "Zeige die Termine dem Kunden:\n\n**WENN TERMINE VORHANDEN:**\n\"Sie haben folgende Termine: [LISTE MIT DATUM, UHRZEIT, SERVICE]. Möchten Sie einen davon verschieben oder stornieren?\"\n\n**WENN KEINE TERMINE:**\n\"Sie haben derzeit keine bevorstehenden Termine. Möchten Sie einen Termin buchen?\""
        },
        "knowledge_base_ids": []
      },
      {
        "name": "Stornierungsdaten sammeln",
        "edges": [
          {
            "destination_node_id": "func_cancel_appointment",
            "id": "edge_collect_cancel_to_func",
            "transition_condition": {
              "type": "prompt",
              "prompt": "ALL variables filled: {{cancel_datum}} AND {{cancel_uhrzeit}}"
            }
          }
        ],
        "id": "node_collect_cancel_info",
        "type": "conversation",
        "display_position": {
          "x": 2728.581342413982,
          "y": 1458.9087868949744
        },
        "instruction": {
          "type": "prompt",
          "text": "## WICHTIG: Prüfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Datum für Stornierung: {{cancel_datum}}\n- Uhrzeit für Stornierung: {{cancel_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin möchte der Kunde stornieren?\n2. **PRÜFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{cancel_datum}} leer → Frage: \"Für welchen Tag möchten Sie stornieren?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{cancel_uhrzeit}} leer → Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n\n**WENN Variable bereits gefüllt:**\n- ✅ ÜBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich möchte meinen Termin morgen um 14 Uhr stornieren\"\n→ cancel_datum = \"morgen\"\n→ cancel_uhrzeit = \"14:00\"\n→ Antworte: \"Verstanden. Einen Moment, ich storniere Ihren Termin...\"\n→ Transition zu func_cancel_appointment\n\n**Transition:**\n- Sobald BEIDE Variablen gefüllt ({{cancel_datum}} AND {{cancel_uhrzeit}}) → func_cancel_appointment"
        },
        "knowledge_base_ids": []
      },
      {
        "tool_id": "tool-cancel-appointment",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich storniere den Termin..."
        },
        "name": "Termin stornieren",
        "edges": [
          {
            "destination_node_id": "node_cancel_confirmation",
            "id": "edge_cancel_to_confirm",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Cancellation completed"
            }
          }
        ],
        "parameter_mapping": {
          "datum": "{{cancel_datum}}",
          "uhrzeit": "{{cancel_uhrzeit}}"
        },
        "id": "func_cancel_appointment",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 3300,
          "y": 1310
        },
        "wait_for_result": true
      },
      {
        "name": "Stornierung bestätigt",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_cancel_confirm_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_cancel_confirmation",
        "type": "conversation",
        "display_position": {
          "x": 3850,
          "y": 1300
        },
        "instruction": {
          "type": "prompt",
          "text": "Bestätige die Stornierung: 'Ihr Termin wurde storniert. Sie erhalten eine Bestätigung per E-Mail. Vielen Dank!'"
        },
        "knowledge_base_ids": []
      },
      {
        "name": "Verschiebungsdaten sammeln",
        "edges": [
          {
            "destination_node_id": "func_reschedule_appointment",
            "id": "edge_collect_reschedule_to_func",
            "transition_condition": {
              "type": "prompt",
              "prompt": "ALL variables filled: {{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}"
            }
          }
        ],
        "id": "node_collect_reschedule_info",
        "type": "conversation",
        "display_position": {
          "x": 2848.273840688789,
          "y": 1996.706417929124
        },
        "instruction": {
          "type": "prompt",
          "text": "## WICHTIG: Prüfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Alter Termin Datum: {{old_datum}}\n- Alter Termin Uhrzeit: {{old_uhrzeit}}\n- Neuer Termin Datum: {{new_datum}}\n- Neuer Termin Uhrzeit: {{new_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin möchte der Kunde verschieben und auf wann?\n2. **PRÜFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{old_datum}} leer → Frage: \"Welcher Termin soll verschoben werden? An welchem Tag?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{old_uhrzeit}} leer → Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n- Wenn {{new_datum}} leer → Frage: \"Auf welchen Tag möchten Sie verschieben?\" (heute/morgen/DD.MM.YYYY)\n- Wenn {{new_uhrzeit}} leer → Frage: \"Um welche Uhrzeit?\" (HH:MM)\n\n**WENN Variable bereits gefüllt:**\n- ✅ ÜBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich möchte meinen Termin morgen 14 Uhr auf Donnerstag 16 Uhr verschieben\"\n→ old_datum = \"morgen\"\n→ old_uhrzeit = \"14:00\"\n→ new_datum = \"Donnerstag\"\n→ new_uhrzeit = \"16:00\"\n→ Antworte: \"Perfekt! Einen Moment, ich verschiebe den Termin...\"\n→ Transition zu func_reschedule_appointment\n\n**Transition:**\n- Sobald ALLE 4 Variablen gefüllt ({{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}) → func_reschedule_appointment"
        },
        "knowledge_base_ids": []
      },
      {
        "tool_id": "tool-reschedule-appointment",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich verschiebe Ihren Termin..."
        },
        "name": "Termin verschieben",
        "edges": [
          {
            "destination_node_id": "node_reschedule_confirmation",
            "id": "edge_reschedule_to_confirm",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Rescheduling completed"
            }
          }
        ],
        "parameter_mapping": {
          "old_uhrzeit": "{{old_uhrzeit}}",
          "old_datum": "{{old_datum}}",
          "new_datum": "{{new_datum}}",
          "new_uhrzeit": "{{new_uhrzeit}}"
        },
        "id": "func_reschedule_appointment",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 3300,
          "y": 1820
        },
        "wait_for_result": true
      },
      {
        "name": "Verschiebung bestätigt",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_reschedule_confirm_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Always end"
            }
          }
        ],
        "id": "node_reschedule_confirmation",
        "type": "conversation",
        "display_position": {
          "x": 3850,
          "y": 1810
        },
        "instruction": {
          "type": "prompt",
          "text": "Bestätige die Verschiebung: 'Perfekt! Ihr Termin wurde erfolgreich verschoben auf {{new_datum}} um {{new_uhrzeit}} Uhr. Bestätigung folgt per E-Mail.'"
        },
        "knowledge_base_ids": []
      },
      {
        "tool_id": "tool-get-services",
        "instruction": {
          "type": "static_text",
          "text": "Einen Moment, ich hole die Service-Liste..."
        },
        "name": "Services abrufen",
        "edges": [
          {
            "destination_node_id": "node_show_services",
            "id": "edge_get_services_to_show",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Services retrieved"
            }
          }
        ],
        "parameter_mapping": [],
        "id": "func_get_services",
        "type": "function",
        "tool_type": "local",
        "speak_during_execution": true,
        "display_position": {
          "x": 1447.1527134500643,
          "y": 1432.321220005798
        },
        "wait_for_result": true
      },
      {
        "name": "Services anzeigen",
        "edges": [
          {
            "destination_node_id": "node_end",
            "id": "edge_show_services_to_end",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User acknowledged or wants to end"
            }
          },
          {
            "destination_node_id": "intent_router",
            "id": "edge_show_services_to_intent",
            "transition_condition": {
              "type": "prompt",
              "prompt": "User wants to book after seeing services"
            }
          }
        ],
        "id": "node_show_services",
        "type": "conversation",
        "display_position": {
          "x": 1682.1724548321513,
          "y": 1874.7916079326671
        },
        "instruction": {
          "type": "prompt",
          "text": "Zeige die Services:\n\n\"Wir bieten folgende Services an: [LISTE MIT NAMEN, DAUER, PREIS]. Möchten Sie einen Termin buchen?\""
        },
        "knowledge_base_ids": []
      },
      {
        "name": "Ende",
        "edges": [],
        "id": "node_end",
        "type": "end",
        "display_position": {
          "x": 4400,
          "y": 1355
        },
        "instruction": {
          "type": "static_text",
          "text": ""
        }
      },
      {
        "name": "Alternative extrahieren",
        "edges": [
          {
            "destination_node_id": "node_confirm_alternative",
            "id": "edge_extract_to_confirm",
            "transition_condition": {
              "type": "equation",
              "equations": [
                {
                  "left": "selected_alternative_time",
                  "operator": "exists"
                }
              ],
              "operator": "&&"
            }
          }
        ],
        "variables": [
          {
            "type": "string",
            "name": "selected_alternative_time",
            "description": "Die vom Kunden gewählte alternative Uhrzeit (z.B. \"06:55\", \"14:30\", \"den ersten Termin\")"
          }
        ],
        "id": "node_extract_alternative_selection",
        "type": "extract_dynamic_variables",
        "display_position": {
          "x": 3050,
          "y": -20
        }
      },
      {
        "name": "Alternative bestätigen",
        "edges": [
          {
            "destination_node_id": "func_book_appointment",
            "id": "edge_confirm_to_book",
            "transition_condition": {
              "type": "prompt",
              "prompt": "Alternative confirmed"
            }
          }
        ],
        "id": "node_confirm_alternative",
        "type": "conversation",
        "display_position": {
          "x": 3400,
          "y": -20
        },
        "instruction": {
          "type": "prompt",
          "text": "Sage: \"Perfekt! Ich buche den Termin für {{selected_alternative_time}} Uhr...\" und transition direkt zu book_appointment."
        },
        "knowledge_base_ids": []
      }
    ],
    "start_node_id": "node_greeting",
    "start_speaker": "agent",
    "tools": [
      {
        "tool_id": "tool-check-availability",
        "timeout_ms": 15000,
        "name": "check_availability_v17",
        "description": "Prüft Verfügbarkeit für einen Termin",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "description": "Kundenname"
            },
            "datum": {
              "type": "string",
              "description": "Datum: heute, morgen, Montag, oder DD.MM.YYYY"
            },
            "dienstleistung": {
              "type": "string",
              "description": "Service (z.B. Herrenhaarschnitt)"
            },
            "uhrzeit": {
              "type": "string",
              "description": "Uhrzeit im Format HH:MM"
            }
          },
          "required": [
            "name",
            "datum",
            "uhrzeit",
            "dienstleistung"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-book-appointment",
        "timeout_ms": 15000,
        "name": "book_appointment_v17",
        "description": "Bucht einen Termin",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "description": "Kundenname"
            },
            "datum": {
              "type": "string",
              "description": "Datum: heute, morgen, Montag, oder DD.MM.YYYY"
            },
            "dienstleistung": {
              "type": "string",
              "description": "Service"
            },
            "uhrzeit": {
              "type": "string",
              "description": "Uhrzeit im Format HH:MM"
            }
          },
          "required": [
            "name",
            "datum",
            "uhrzeit",
            "dienstleistung"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-get-appointments",
        "timeout_ms": 15000,
        "name": "get_customer_appointments",
        "description": "Ruft bestehende Termine des Kunden ab",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            },
            "customer_name": {
              "type": "string",
              "description": "Optional: Kundenname zur Filterung"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-cancel-appointment",
        "timeout_ms": 15000,
        "name": "cancel_appointment",
        "description": "Storniert einen bestehenden Termin",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "datum": {
              "type": "string",
              "description": "Optional: Datum (heute, morgen, oder DD.MM.YYYY)"
            },
            "appointment_id": {
              "type": "string",
              "description": "Optional: Appointment ID"
            },
            "uhrzeit": {
              "type": "string",
              "description": "Optional: Uhrzeit HH:MM"
            },
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-reschedule-appointment",
        "timeout_ms": 15000,
        "name": "reschedule_appointment",
        "description": "Verschiebt einen Termin auf neues Datum/Uhrzeit",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "new_uhrzeit": {
              "type": "string",
              "description": "Required: Neue Uhrzeit HH:MM"
            },
            "appointment_id": {
              "type": "string",
              "description": "Optional: Appointment ID"
            },
            "old_datum": {
              "type": "string",
              "description": "Optional: Altes Datum DD.MM.YYYY"
            },
            "old_uhrzeit": {
              "type": "string",
              "description": "Optional: Alte Uhrzeit HH:MM"
            },
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            },
            "new_datum": {
              "type": "string",
              "description": "Required: Neues Datum (heute, morgen, oder DD.MM.YYYY)"
            }
          },
          "required": [
            "call_id",
            "new_datum",
            "new_uhrzeit"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      },
      {
        "tool_id": "tool-get-services",
        "timeout_ms": 15000,
        "name": "get_available_services",
        "description": "Listet alle verfügbaren Services auf",
        "type": "custom",
        "parameters": {
          "type": "object",
          "properties": {
            "call_id": {
              "type": "string",
              "description": "Call ID from system"
            }
          },
          "required": [
            "call_id"
          ]
        },
        "url": "https://api.askproai.de/api/webhooks/retell/function"
      }
    ],
    "model_choice": {
      "type": "cascading",
      "model": "gpt-4o-mini"
    },
    "model_temperature": 0.3,
    "kb_config": {
      "top_k": 3,
      "filter_score": 0.6
    },
    "begin_tag_display_position": {
      "x": 0,
      "y": 335
    },
    "is_published": true,
    "knowledge_base_ids": []
  }
}
