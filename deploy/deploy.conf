# AskProAI Deployment Configuration
# This file contains deployment-specific settings

# Paths
APP_DIR="/var/www/api-gateway"
BACKUP_DIR="/var/backups/askproai"
LOG_DIR="/var/log/askproai"

# Deployment Settings
DEPLOYMENT_USER="www-data"
DEPLOYMENT_GROUP="www-data"
PHP_VERSION="8.2"

# Backup Settings
MAX_BACKUP_AGE_DAYS=30
BACKUP_COMPRESSION="gzip"
BACKUP_ENCRYPTION=true
BACKUP_ENCRYPTION_KEY=""  # Set in environment

# Timeouts
DEPLOYMENT_TIMEOUT=1800  # 30 minutes
HEALTH_CHECK_RETRIES=5
HEALTH_CHECK_DELAY=10
MIGRATION_TIMEOUT=600  # 10 minutes

# Notifications
SLACK_WEBHOOK_URL=""  # Set in environment
DEPLOYMENT_EMAIL=""   # Set in environment
PAGERDUTY_TOKEN=""    # Set in environment

# Services
PHP_FPM_SERVICE="php8.2-fpm"
NGINX_SERVICE="nginx"
REDIS_SERVICE="redis-server"
MYSQL_SERVICE="mysql"

# URLs
PRODUCTION_URL="https://api.askproai.de"
STAGING_URL="https://staging.askproai.de"
HEALTH_CHECK_PATH="/api/health"
METRICS_ENDPOINT=""  # Optional metrics collection endpoint

# Git Settings
GIT_REMOTE="origin"
GIT_BRANCH_PRODUCTION="main"
GIT_BRANCH_STAGING="staging"
GIT_BRANCH_DEVELOP="develop"

# Performance
OPCACHE_RESET=true
REDIS_FLUSH_ON_DEPLOY=false
QUEUE_RESTART_DELAY=5

# Security
MAINTENANCE_MODE_SECRET=""  # Generated per deployment
SSL_CERT_PATH="/etc/ssl/certs/askproai.crt"
SSL_KEY_PATH="/etc/ssl/private/askproai.key"

# Feature Flags
ENABLE_ZERO_DOWNTIME=true
ENABLE_SMART_MIGRATIONS=true
ENABLE_AUTO_ROLLBACK=true
ENABLE_PERFORMANCE_MONITORING=true

# Database Migration Settings
MIGRATION_BATCH_SIZE=1000
MIGRATION_LOCK_TIMEOUT=60
ENABLE_ONLINE_SCHEMA_CHANGE=true

# Monitoring
DATADOG_API_KEY=""  # If using Datadog
NEW_RELIC_LICENSE=""  # If using New Relic
PROMETHEUS_PUSHGATEWAY=""  # If using Prometheus

# Deployment Strategies
BLUE_GREEN_ENABLED=false
CANARY_DEPLOYMENT_ENABLED=false
ROLLING_UPDATE_ENABLED=true

# Resource Limits
MAX_MEMORY_USAGE="80%"
MAX_CPU_USAGE="90%"
MAX_DISK_USAGE="85%"

# Clean up settings
CLEANUP_OLD_RELEASES=true
KEEP_RELEASES=5
CLEANUP_OLD_LOGS=true
LOG_RETENTION_DAYS=30

# Custom Commands
PRE_DEPLOY_COMMANDS=(
    # "php artisan custom:pre-deploy"
)

POST_DEPLOY_COMMANDS=(
    # "php artisan custom:post-deploy"
)

# Environment-specific overrides
case "${DEPLOY_ENV:-production}" in
    production)
        DEPLOY_TARGET="origin/main"
        HEALTH_CHECK_URL="$PRODUCTION_URL$HEALTH_CHECK_PATH"
        ;;
    staging)
        DEPLOY_TARGET="origin/staging"
        HEALTH_CHECK_URL="$STAGING_URL$HEALTH_CHECK_PATH"
        ENABLE_DEBUG_MODE=true
        ;;
    *)
        echo "Unknown deployment environment: $DEPLOY_ENV"
        exit 1
        ;;
esac