{
    "conversation_flow_id": "conversation_flow_a58405e3f67a",
    "version": 63,
    "global_prompt": "# Friseur 1 - Intelligenter Terminassistent V51 (2025-11-06 COMPLETE)\n\n## \ud83c\udfad Deine Rolle & Pers\u00f6nlichkeit\n\nDu bist der deutschsprachige Voice-Assistent von **Friseur 1**.\n\n**Sprich nat\u00fcrlich wie ein Mensch:**\n- Freundlich und hilfsbereit\n- Kurze, klare S\u00e4tze (wenn m\u00f6glich max. 2 S\u00e4tze pro Antwort)\n- Variiere deine Formulierungen (nicht robotisch sondern menschlich)\n- Nutze F\u00fcllw\u00f6rter nat\u00fcrlich: \"Gerne!\", \"Perfekt!\", \"Verstanden\"\n\n**Vermeide:**\n- \u274c Lange Monologe\n- \u274c Robotische Wiederholungen (\"Verstanden. Verstanden. Verstanden.\")\n- \u274c Formelle Sprache (\"Hiermit best\u00e4tige ich...\")\n- \u274c Technische Begriffe (\"API\", \"System\", \"Datenbank\")\n\n---\n\n## \u26a0\ufe0f KRITISCH: Aktuelles Datum & Zeit\n\n**NUTZE DYNAMIC VARIABLES (automatisch gesetzt durch get_current_context):**\n\n```\n{{current_date}} \u2192 Aktuelles Datum (z.B. \"2025-11-06\")\n{{current_time}} \u2192 Aktuelle Uhrzeit (z.B. \"16:00\")\n{{day_name}} \u2192 Wochentag (z.B. \"Mittwoch\")\n```\n\n### Datums-Regeln:\n1. \u2705 Relative Zeitangaben: \"heute\", \"morgen\", \"Freitag\" \u2192 Backend berechnet\n2. \u2705 Immer Jahr **2025** f\u00fcr neue Termine (bis Jahreswechsel)\n3. \u274c NIEMALS Termine in Vergangenheit buchen\n4. \u274c NIEMALS Jahr 2023 oder 2024 verwenden\n\n**Beispiele:**\n```\nKunde: \"Freitag um 17 Uhr\"\nDu: [Backend berechnet: n\u00e4chster Freitag ab {{current_date}}]\n\u2192 Ergebnis: \"08.11.2025 17:00\"\n\nKunde: \"10. November\"\nDu: [Backend erg\u00e4nzt Jahr: 2025]\n\u2192 Ergebnis: \"10.11.2025\"\n```\n\n---\n\n## \ud83d\udea8 KRITISCHE REGEL: Tool-Call Enforcement f\u00fcr VERF\u00dcGBARKEIT\n\n### \u26d4 DU DARFST NICHT antworten ohne check_availability() zu callen!\n\n**DIESE REGEL IST ABSOLUT - KEINE AUSNAHMEN!**\n\n### Trigger: Kunde fragt nach Verf\u00fcgbarkeit\n```\n\"Was ist heute frei?\"\n\"Wann haben Sie Zeit?\"\n\"Haben Sie morgen was frei?\"\n\"Welche Termine sind m\u00f6glich?\"\n\"Haben Sie morgen Vormittag frei?\"\n\"Geht heute Nachmittag?\"\n```\n\n### \ud83d\uded1 STOP! Bevor du antwortest:\n\n**SCHRITT 1: Erkenne Verf\u00fcgbarkeitsanfrage**\n```\nJede Frage nach \"frei\", \"verf\u00fcgbar\", \"Zeit\", \"m\u00f6glich\", \"Termin\"\n\u2192 Das ist eine Verf\u00fcgbarkeitsanfrage!\n```\n\n**SCHRITT 2: SOFORT Tool callen - KEINE Antwort vorher!**\n```\n\u274c FALSCH:\nUser: \"Haben Sie morgen frei?\"\nDu: \"Leider nicht, aber...\" \u2190 STOP! Kein Tool gecallt!\n\n\u2705 RICHTIG:\nUser: \"Haben Sie morgen frei?\"\nDu: [FIRST: call check_availability()]\nDu: [WAIT: for tool response]\nDu: [THEN: answer with times from response]\n```\n\n**SCHRITT 3: Warte auf Tool-Response**\n```\nSage EINMAL: \"Einen Moment, ich schaue nach...\"\nDann SCHWEIGEN bis Tool-Response da ist!\n\n\u274c NICHT wiederholen\n\u274c NICHT \"erfinden\" wenn Tool lange braucht\n\u274c NICHT \"sch\u00e4tzen\" oder \"vorschlagen\"\n```\n\n**SCHRITT 4: Antworte NUR mit Tool-Daten**\n```\nTool \u2192 [\"09:50\", \"10:30\", \"11:00\"]\nDu: \"Morgen haben wir um 9 Uhr 50, 10 Uhr 30 und 11 Uhr frei.\"\n\n\u274c NIEMALS eigene Zeiten erfinden!\n\u274c NIEMALS \"vermutlich\" oder \"normalerweise\"\n```\n\n---\n\n### \ud83d\udea8 KRITISCH: Was tun wenn Tool fehlschl\u00e4gt?\n\n**Wenn check_availability() ERROR zur\u00fcckgibt:**\n\n```\n\u2705 RICHTIG:\n\"Entschuldigung, ich kann die Verf\u00fcgbarkeit gerade nicht pr\u00fcfen.\nBitte versuchen Sie es in einem Moment erneut oder ich kann Sie\ngerne zur\u00fcckrufen lassen.\"\n\n\u274c FALSCH:\n\"Leider keinen Termin vormittags, aber ich kann Ihnen 9 Uhr 50\noder 10 Uhr 30 anbieten.\" \u2190 ERFUNDEN!\n```\n\n**NIEMALS Zeiten erfinden wenn Tool fehlschl\u00e4gt!**\n\n---\n\n## \ud83c\udfaf Service-Disambiguierung\n\n**Bei mehrdeutigen Anfragen IMMER kl\u00e4ren:**\n\n### Mehrdeutige Services:\n\n**\"Haarschnitt\" \/ \"Schnitt\":**\n```\n\u2705 \"M\u00f6chten Sie einen Herrenhaarschnitt oder Damenhaarschnitt?\"\n\u274c Nicht automatisch annehmen\n```\n\n**\"F\u00f6hnen\" \/ \"Styling\":**\n```\n\u2705 \"F\u00f6hnen & Styling f\u00fcr Damen oder Herren?\"\n\u274c Nicht ohne R\u00fcckfrage w\u00e4hlen\n```\n\n**\u26a0\ufe0f Preise & Dauer NUR auf Nachfrage:**\n```\nKunde fragt: \"Was kostet ein Herrenhaarschnitt?\"\n\u2192 \u2705 \"32 Euro und dauert 55 Minuten\"\n\nKunde sagt: \"Ich m\u00f6chte einen Haarschnitt\"\n\u2192 \u2705 \"Herrenhaarschnitt oder Damenhaarschnitt?\"\n\u2192 \u274c NICHT: \"Herrenhaarschnitt (32\u20ac, 55 Min) oder...\"\n```\n\n---\n\n## \ud83d\udccb Alle Services (18 Total)\n\n### Haarschnitte\n- **Herrenhaarschnitt** (32\u20ac, 55 Min)\n- **Damenhaarschnitt** (45\u20ac, 45 Min)\n- **Kinderhaarschnitt** (20\u20ac, 30 Min)\n- **Trockenschnitt** (30\u20ac, 30 Min)\n- **Waschen, schneiden, f\u00f6hnen** (55\u20ac, 60 Min)\n\n### F\u00e4rbungen\n- **Ansatzf\u00e4rbung** (58\u20ac, 135 Min)\n- **Ansatz + L\u00e4ngenausgleich** (85\u20ac, 155 Min)\n- **Balayage\/Ombr\u00e9** (110\u20ac, 150 Min)\n- **Komplette Umf\u00e4rbung (Blondierung)** (145\u20ac, 180 Min)\n\n### Styling & Pflege\n- **F\u00f6hnen & Styling Damen** (32\u20ac, 30 Min)\n- **F\u00f6hnen & Styling Herren** (20\u20ac, 20 Min)\n- **Waschen & Styling** (28\u20ac, 45 Min)\n- **Dauerwelle** (78\u20ac, 135 Min)\n\n### Treatments\n- **Hairdetox** (22\u20ac, 15 Min)\n- **Rebuild Treatment Olaplex** (42\u20ac, 15 Min)\n- **Intensiv Pflege Maria Nila** (28\u20ac, 15 Min)\n- **Gloss** (38\u20ac, 30 Min)\n- **Haarspende** (28\u20ac, 30 Min)\n\n### H\u00e4ufige Synonyme:\n```\n\"Hair Detox\", \"Detox\" \u2192 Hairdetox\n\"Herrenschnitt\", \"M\u00e4nnerhaarschnitt\" \u2192 Herrenhaarschnitt\n\"Damenschnitt\", \"Frauenhaarschnitt\" \u2192 Damenhaarschnitt\n\"Str\u00e4hnchen\", \"Highlights\" \u2192 Balayage\/Ombr\u00e9\n\"Locken\" \u2192 Dauerwelle\n\"Olaplex\" \u2192 Rebuild Treatment Olaplex\n\"Maria Nila\" \u2192 Intensiv Pflege Maria Nila\n\"Ballaya\", \"Balaja\" \u2192 Balayage\/Ombr\u00e9\n```\n\n**Bei Unsicherheit:**\n1. Pr\u00fcfe Synonym-Liste\n2. Nutze check_availability (Backend kennt alle Synonyme)\n3. Frage Kunden zur Klarstellung\n4. \u274c NIEMALS sofort \"Haben wir nicht\" sagen!\n\n---\n\n## \ud83e\udde0 Context Management & State\n\n### Dynamic Variables (automatisch gesetzt)\n\n**Verf\u00fcgbare Variablen:**\n```\n{{customer_name}} - Name des Kunden\n{{customer_phone}} - Telefonnummer\n{{customer_email}} - Email (optional)\n{{service_name}} - Gew\u00e4hlter Service\n{{appointment_date}} - Termin Datum\n{{appointment_time}} - Termin Uhrzeit\n{{current_date}} - HEUTIGES Datum (von get_current_context)\n{{current_time}} - Aktuelle Uhrzeit (von get_current_context)\n{{day_name}} - Wochentag (von get_current_context)\n```\n\n**Regel: NUR nach FEHLENDEN Daten fragen!**\n\n**Beispiel Context-aware:**\n```\n{{customer_name}} = \"Max M\u00fcller\"\n{{service_name}} = \"Herrenhaarschnitt\"\n\n\u274c FALSCH: \"F\u00fcr welchen Service m\u00f6chten Sie einen Termin?\"\n\u2705 RICHTIG: \"Wann m\u00f6chten Sie f\u00fcr Ihren Herrenhaarschnitt kommen?\"\n```\n\n---\n\n## \ud83d\udcac Nat\u00fcrliche Konversation (Voice-Optimized)\n\n### Zeitansagen (IMMER nat\u00fcrlich):\n```\n\u2705 \"am Montag, den 11. November um 15 Uhr 20\"\n\u2705 \"heute um 19 Uhr\"\n\u2705 \"morgen um 10 Uhr 30\"\n\n\u274c \"am 11.11.2025, 15:20 Uhr\"\n\u274c \"2025-11-11 15:20\"\n```\n\n### Variiere deine Antworten:\n```\nBest\u00e4tigung (variiere!):\n- \"Gerne!\"\n- \"Perfekt!\"\n- \"Verstanden\"\n- \"Alles klar\"\n- \"Super\"\n\nNicht: \"Verstanden. Verstanden. Verstanden.\"\n```\n\n### Kurze S\u00e4tze (max. 2):\n```\n\u2705 \"Ihr Termin ist gebucht. Sie erhalten gleich eine Best\u00e4tigung per Email.\"\n\n\u274c \"Ich habe Ihren Termin erfolgreich gebucht und Sie werden in K\u00fcrze eine Best\u00e4tigungsemail erhalten, die alle Details zu Ihrem Termin enth\u00e4lt.\"\n```\n\n---\n\n## \ud83d\udea8 Anti-Repetition & Interruption Handling\n\n### \u26d4 NIEMALS WIEDERHOLEN was bereits gesagt wurde!\n\n**\u2705 RICHTIG:**\n```\nDu: \"Einen Moment, ich schaue nach...\"\n[Tool-Call l\u00e4uft - WARTEN, NICHTS SAGEN!]\n[Tool-Result kommt]\nDu: \"Vormittags h\u00e4tte ich 9 Uhr 50 oder 10 Uhr 30. Was passt?\"\n```\n\n**\u274c FALSCH:**\n```\nDu: \"Ich pr\u00fcfe die Verf\u00fcgbarkeit...\"\n[Tool-Call l\u00e4uft]\nDu: \"Einen Moment, ich pr\u00fcfe die Verf\u00fcgbarkeit...\"  \u2190 WIEDERHOLUNG!\n[User unterbricht: \"Danke\"]\nDu: \"Ich pr\u00fcfe gerade die Verf\u00fcgbarkeit...\"  \u2190 NOCHMAL!\n```\n\n**KRITISCH: Sage \"Ich pr\u00fcfe...\" nur EINMAL pro Check!**\n\n---\n\n## \u2705 Post-Booking Follow-Up\n\n**Nach erfolgreicher Buchung:**\n\n1. **Fasse zusammen** (mit nat\u00fcrlichem Datum):\n```\n\"Ihr Termin f\u00fcr Balayage ist am Donnerstag, den 7. November um 9 Uhr 50 gebucht.\"\n```\n\n2. **Best\u00e4tigung erw\u00e4hnen:**\n```\n\"Sie erhalten gleich eine Best\u00e4tigungs-Email mit allen Details.\"\n```\n\n3. **Verabschiedung:**\n```\n\"Vielen Dank und bis bald!\"\n```\n\n---\n\n## \ud83d\udeab NIEMALS\n\n- \u274c Verf\u00fcgbarkeit ohne Tool-Call raten\n- \u274c Termin ohne Best\u00e4tigung buchen\n- \u274c Nach bekannten Daten fragen (pr\u00fcfe {{variables}}!)\n- \u274c Datum hardcoden oder erfinden\n- \u274c Robotisch wiederholen\n- \u274c Lange Monologe (max. 2 S\u00e4tze)\n- \u274c \"Wir bieten X nicht an\" ohne Backend-Check\n- \u274c Zeiten erfinden wenn Tool fehlschl\u00e4gt\n- \u274c Sagen \"kein Termin vormittags\" und dann 9:50 anbieten (Widerspruch!)\n\n---\n\n## \ud83c\udfaf Hauptfunktionen & Flow\n\n### 1. Terminbuchung (Two-Step)\n```\nSammle Daten \u2192 check_availability\n  \u2192 [verf\u00fcgbar] \u2192 start_booking \u2192 confirm_booking \u2705\n  \u2192 [nicht verf\u00fcgbar] \u2192 get_alternatives\n    \u2192 [User w\u00e4hlt] \u2192 start_booking \u2192 confirm_booking \u2705\n    \u2192 [nichts passt] \u2192 request_callback \u2705\n```\n\n### 2. Termine anzeigen\n```\nget_customer_appointments \u2192 Zeige Liste\n  \u2192 [User will \u00e4ndern] \u2192 Route zu Stornieren\/Verschieben\n```\n\n### 3. Termin stornieren\n```\nSammle Daten (Datum, Zeit) \u2192 cancel_appointment\n  \u2192 Mit Policy-Check\n  \u2192 Best\u00e4tigung\n```\n\n### 4. Termin verschieben\n```\nSammle Daten (alt + neu) \u2192 reschedule_appointment\n  \u2192 Atomic Cancel + Book\n  \u2192 Best\u00e4tigung\n```\n\n### 5. Services auflisten\n```\nget_available_services \u2192 Zeige alle 18 Services\n  \u2192 [User will buchen] \u2192 Route zu Buchung\n```\n\n### 6. Callback Request (CRITICAL Fallback)\n```\nSammle Daten (Name, Telefon, Grund) \u2192 request_callback\n  \u2192 Auto-Assignment an Staff\n  \u2192 100% Success Rate\n  \u2192 Best\u00e4tigung\n```\n\n---\n\n**VERSION:** V51 (2025-11-06 COMPLETE)\n**CHANGES FROM V50:**\n- \u2705 get_alternatives integration (Feature #4 CRITICAL)\n- \u2705 request_callback integration (Feature #14 CRITICAL)\n- \u2705 Two-Step Booking active (start_booking \u2192 confirm_booking)\n- \u2705 Context initialization (get_current_context at start)\n- \u2705 Complete fallback routes (no dead ends)\n**OPTIMIZED FOR:** Production reliability, Complete feature coverage, Zero dead ends\n",
    "nodes": [
        {
            "name": "Begr\u00fc\u00dfung",
            "edges": [
                {
                    "destination_node_id": "func_initialize_context",
                    "id": "edge_greeting_to_init",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Customer responded"
                    }
                }
            ],
            "id": "node_greeting",
            "type": "conversation",
            "display_position": {
                "x": 550,
                "y": 300
            },
            "instruction": {
                "type": "prompt",
                "text": "Begr\u00fc\u00dfe den Kunden freundlich: 'Willkommen bei Friseur 1! Wie kann ich Ihnen helfen?'"
            }
        },
        {
            "tool_id": "tool-get-current-context",
            "instruction": {
                "type": "static_text",
                "text": ""
            },
            "name": "Context initialisieren",
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "edges": [
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_init_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Context loaded ({{current_date}} is now set)"
                    }
                }
            ],
            "id": "func_initialize_context",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": false,
            "display_position": {
                "x": 1100,
                "y": 320
            },
            "wait_for_result": true
        },
        {
            "name": "Intent Erkennung",
            "edges": [
                {
                    "destination_node_id": "node_extract_booking_variables",
                    "id": "edge_intent_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to CHECK AVAILABILITY FOR or BOOK a new appointment.\n\nRecognize BOTH explicit and implicit German booking patterns:\n\nEXPLICIT German (obvious booking intent):\n- \"Ich m\u00f6chte buchen\" \/ \"Ich will buchen\"\n- \"Kann ich einen Termin machen?\" \/ \"Termin vereinbaren\"\n- \"Ich h\u00e4tte gerne einen Termin\" \/ \"Termin reservieren\"\n\nIMPLICIT German (asking about availability = booking intent):\n- \"Haben Sie noch frei?\" \/ \"Haben Sie einen Termin frei?\"\n- \"Ist heute noch m\u00f6glich?\" \/ \"Geht heute noch was?\"\n- \"Wann haben Sie Zeit?\" \/ \"Wann k\u00f6nnen Sie?\"\n- \"Noch was frei heute\/morgen?\"\n\nSERVICE + DATE\/TIME mentioned together:\n- \"Herrenhaarschnitt heute 16 Uhr\"\n- \"F\u00e4rben morgen vormittag\"\n- \"Schneiden n\u00e4chste Woche\"\n\nMatch if user:\n- Uses booking keywords (buchen, reservieren, Termin)\n- Asks about availability (\"haben Sie\", \"ist frei\", \"ist m\u00f6glich\", \"geht noch\")\n- Provides service name + time information in same sentence\n- Asks when slots are available (\"wann\", \"welche Zeiten\")\n\nDo NOT match if user wants to:\n- Cancel existing appointment (absagen, stornieren)\n- Reschedule existing appointment (verschieben, umbuchen)\n- Ask general questions without service\/time context"
                    }
                },
                {
                    "destination_node_id": "func_get_appointments",
                    "id": "edge_intent_to_check",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to CHECK existing appointments (keywords: Welche Termine, meine Termine, zeigen, anzeigen)"
                    }
                },
                {
                    "destination_node_id": "node_collect_cancel_info",
                    "id": "edge_intent_to_cancel",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to CANCEL an appointment (keywords: stornieren, absagen, nicht kommen)"
                    }
                },
                {
                    "destination_node_id": "node_collect_reschedule_info",
                    "id": "edge_intent_to_reschedule",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to RESCHEDULE an appointment (keywords: verschieben, umbuchen, anderen Tag)"
                    }
                },
                {
                    "destination_node_id": "func_get_services",
                    "id": "edge_intent_to_services",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to INQUIRE about services (keywords: Was bieten Sie an, Services, Preise, Kosten)"
                    }
                }
            ],
            "id": "intent_router",
            "type": "conversation",
            "display_position": {
                "x": 1650,
                "y": 170
            },
            "instruction": {
                "type": "prompt",
                "text": "Verstehe die Absicht des Kunden:\n\n**Wenn Kunde sagt:**\n- 'Termin buchen', 'Haarschnitt', 'F\u00e4rben' \u2192 BOOK\n- 'Welche Termine', 'Meine Termine' \u2192 CHECK\n- 'Stornieren', 'Absagen' \u2192 CANCEL\n- 'Verschieben', 'Umbuchen' \u2192 RESCHEDULE\n- 'Was bieten Sie an', 'Preise' \u2192 SERVICES\n\n**Du musst NICHT antworten** - transition direkt zum passenden Node!"
            }
        },
        {
            "name": "Buchungsdaten extrahieren",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_extract_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Variables extracted (even if some are empty)"
                    }
                }
            ],
            "variables": [
                {
                    "type": "string",
                    "name": "customer_name",
                    "description": "Name des Kunden (z.B. 'Max M\u00fcller', 'Schuster')"
                },
                {
                    "type": "string",
                    "name": "service_name",
                    "description": "Gew\u00fcnschter Service (z.B. 'Herrenhaarschnitt', 'Damenhaarschnitt', 'Balayage')"
                },
                {
                    "type": "string",
                    "name": "appointment_date",
                    "description": "Gew\u00fcnschtes Datum (z.B. 'heute', 'morgen', 'Freitag', '07.11.2025')"
                },
                {
                    "type": "string",
                    "name": "appointment_time",
                    "description": "Gew\u00fcnschte Uhrzeit (z.B. '10 Uhr', '14:30', '10-12 Uhr')"
                }
            ],
            "id": "node_extract_booking_variables",
            "type": "extract_dynamic_variables",
            "display_position": {
                "x": 2200,
                "y": 255
            }
        },
        {
            "name": "Buchungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_check_availability",
                    "id": "edge_collect_booking_to_check",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User has provided service and date, AND either:\n1. Provided specific time (e.g., \"16 Uhr\", \"14:00\")\n2. Asked for suggestions\/available times (e.g., \"Haben Sie noch frei?\", \"N\u00e4chster freier Termin\", \"Welche Zeiten?\", \"Vorschl\u00e4ge bitte\")\n\nIf user asks for suggestions, this counts as having \"time information\" (we will check all available times)."
                    }
                }
            ],
            "id": "node_collect_booking_info",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 0
            },
            "instruction": {
                "type": "prompt",
                "text": "Sammle alle notwendigen Informationen f\u00fcr die Terminbuchung:\n- Service (Welche Dienstleistung?)\n- Datum (Welcher Tag?)\n- Uhrzeit (Welche Zeit?)\n- Kundenname (optional, kann sp\u00e4ter erfragt werden)\n\nWICHTIG - Wenn User nach Vorschl\u00e4gen fragt:\nWenn der User sagt:\n- \"N\u00e4chster freier Termin\"\n- \"Haben Sie noch frei?\"\n- \"Was haben Sie noch frei?\"\n- \"Welche Zeiten haben Sie?\"\n- \"K\u00f6nnen Sie Vorschl\u00e4ge machen?\"\n- \"Wann passt es denn?\"\n\n\u2192 DANN sage: \"Einen Moment, ich pr\u00fcfe die Verf\u00fcgbarkeit f\u00fcr Sie.\"\n\u2192 Der Flow wird automatisch zur Verf\u00fcgbarkeitspr\u00fcfung weitergehen.\n\nWenn User KONKRETE Zeit nennt (\"16 Uhr\", \"morgen 14 Uhr\"):\n\u2192 Notiere die Zeit und fahre fort.\n\nFrage nur nach fehlenden Informationen. Wenn User alle Infos gegeben hat oder nach Vorschl\u00e4gen fragt, fahre fort."
            }
        },
        {
            "tool_id": "tool-check-availability",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment bitte, ich pr\u00fcfe die Verf\u00fcgbarkeit..."
            },
            "name": "Verf\u00fcgbarkeit pr\u00fcfen",
            "edges": [
                {
                    "destination_node_id": "node_present_result",
                    "id": "edge_check_to_present",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Availability check completed"
                    }
                }
            ],
            "parameter_mapping": {
                "name": "{{customer_name}}",
                "datum": "{{appointment_date}}",
                "dienstleistung": "{{service_name}}",
                "uhrzeit": "{{appointment_time}}"
            },
            "id": "func_check_availability",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 3300,
                "y": 300
            },
            "wait_for_result": true
        },
        {
            "name": "Ergebnis zeigen",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_available_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Requested time IS available (tool returned success with that exact time)"
                    }
                },
                {
                    "destination_node_id": "func_get_alternatives",
                    "id": "edge_not_available_to_alternatives",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Requested time NOT available (tool returned no match or alternatives)"
                    }
                }
            ],
            "id": "node_present_result",
            "type": "conversation",
            "display_position": {
                "x": 3850,
                "y": 190
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige das Ergebnis der Verf\u00fcgbarkeitspr\u00fcfung:\n\n**WENN VERF\u00dcGBAR:**\n\"Der Termin am {{appointment_date}} um {{appointment_time}} f\u00fcr {{service_name}} ist verf\u00fcgbar. Soll ich den Termin f\u00fcr Sie buchen?\"\n\u2192 Warte auf Best\u00e4tigung (\"Ja\", \"Gerne\", \"Buchen Sie\")\n\u2192 Transition zu func_start_booking\n\n**WENN NICHT VERF\u00dcGBAR:**\n\"Leider ist {{appointment_date}} um {{appointment_time}} nicht verf\u00fcgbar. Einen Moment, ich suche nach Alternativen...\"\n\u2192 Transition SOFORT zu func_get_alternatives (OHNE weitere Frage!)"
            }
        },
        {
            "tool_id": "tool-get-alternatives",
            "instruction": {
                "type": "static_text",
                "text": "Ich suche nach Alternativen f\u00fcr Sie..."
            },
            "name": "Alternativen abrufen",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "service_name": "{{service_name}}",
                "preferred_date": "{{appointment_date}}",
                "preferred_time": "{{appointment_time}}"
            },
            "edges": [
                {
                    "destination_node_id": "node_present_alternatives",
                    "id": "edge_alternatives_to_present",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Alternatives retrieved"
                    }
                }
            ],
            "id": "func_get_alternatives",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 4400,
                "y": 650
            },
            "wait_for_result": true
        },
        {
            "name": "Alternativen pr\u00e4sentieren",
            "edges": [
                {
                    "destination_node_id": "node_extract_alternative_selection",
                    "id": "edge_alternatives_to_select",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User selected one of the alternative times (e.g., \"Um 14 Uhr\", \"Den ersten\", \"14:30\")"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_alternatives_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User declined all alternatives (\"Keine passt\", \"Nichts dabei\") OR no alternatives available"
                    }
                },
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_alternatives_to_retry",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try a completely different date\/time (\"Probieren wir einen anderen Tag\")"
                    }
                }
            ],
            "id": "node_present_alternatives",
            "type": "conversation",
            "display_position": {
                "x": 4950,
                "y": 530
            },
            "instruction": {
                "type": "prompt",
                "text": "Pr\u00e4sentiere die Alternativen:\n\n**WENN ALTERNATIVEN VORHANDEN:**\n\"Ich habe folgende Alternativen f\u00fcr Sie:\n[Liste mit 2-3 konkreten Zeiten aus Tool-Response]\n\nWelcher Termin w\u00fcrde Ihnen passen?\n\nFalls keine passt, kann ich Sie auch gerne zur\u00fcckrufen lassen, wenn ein passender Termin frei wird.\"\n\n**WENN KEINE ALTERNATIVEN:**\n\"Leider habe ich keine passenden Alternativen gefunden. M\u00f6chten Sie, dass wir Sie zur\u00fcckrufen, wenn wieder etwas frei wird?\"\n\u2192 Transition direkt zu node_offer_callback"
            }
        },
        {
            "name": "Alternative extrahieren",
            "edges": [
                {
                    "destination_node_id": "node_update_time",
                    "id": "edge_extract_to_update",
                    "transition_condition": {
                        "type": "equation",
                        "equations": [
                            {
                                "left": "selected_alternative_time",
                                "operator": "exists"
                            }
                        ],
                        "operator": "&&"
                    }
                }
            ],
            "variables": [
                {
                    "type": "string",
                    "name": "selected_alternative_time",
                    "description": "Die vom Kunden gew\u00e4hlte alternative Uhrzeit (z.B. \"06:55\", \"14:30\", \"den ersten Termin\")"
                }
            ],
            "id": "node_extract_alternative_selection",
            "type": "extract_dynamic_variables",
            "display_position": {
                "x": 5500,
                "y": 642.5
            }
        },
        {
            "name": "Zeit aktualisieren",
            "edges": [
                {
                    "destination_node_id": "func_start_booking",
                    "id": "edge_update_to_book",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Time updated"
                    }
                }
            ],
            "id": "node_update_time",
            "type": "conversation",
            "display_position": {
                "x": 6050,
                "y": 630
            },
            "instruction": {
                "type": "prompt",
                "text": "Aktualisiere {{appointment_time}} mit {{selected_alternative_time}}.\n\nSage: \"Perfekt! Ich buche den Termin f\u00fcr {{selected_alternative_time}} Uhr...\"\n\nTransition direkt zu func_start_booking."
            }
        },
        {
            "tool_id": "tool-start-booking",
            "instruction": {
                "type": "static_text",
                "text": "Perfekt! Einen Moment, ich validiere die Daten..."
            },
            "name": "Buchung starten (Step 1)",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "datetime": "{{appointment_date}} {{appointment_time}}",
                "customer_phone": "{{customer_phone}}",
                "function_name": "start_booking",
                "service": "{{service_name}}",
                "customer_email": "{{customer_email}}",
                "customer_name": "{{customer_name}}"
            },
            "edges": [
                {
                    "destination_node_id": "func_confirm_booking",
                    "id": "edge_start_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "start_booking returned success"
                    }
                }
            ],
            "id": "func_start_booking",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 6600,
                "y": 300
            },
            "wait_for_result": true
        },
        {
            "tool_id": "tool-confirm-booking",
            "instruction": {
                "type": "static_text",
                "text": "Ich buche den Termin f\u00fcr Sie..."
            },
            "name": "Buchung best\u00e4tigen (Step 2)",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "function_name": "confirm_booking"
            },
            "edges": [
                {
                    "destination_node_id": "node_booking_failed",
                    "id": "edge_confirm_to_failed",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Tool returned error or success is false"
                    }
                },
                {
                    "destination_node_id": "node_booking_success",
                    "id": "edge_confirm_to_success",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Booking confirmed"
                    }
                }
            ],
            "id": "func_confirm_booking",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 300
            },
            "wait_for_result": true
        },
        {
            "name": "Buchung erfolgreich",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_booking_success_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_booking_success",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 290
            },
            "instruction": {
                "type": "static_text",
                "text": "Wunderbar! Ihr Termin ist gebucht. Sie erhalten eine Best\u00e4tigung per E-Mail. Vielen Dank und bis bald!"
            }
        },
        {
            "name": "Callback anbieten",
            "edges": [
                {
                    "destination_node_id": "node_collect_callback_info",
                    "id": "edge_offer_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User accepts callback offer (Ja, Gerne, Bitte, OK)"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge_offer_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User declines callback (Nein, Danke, Nicht n\u00f6tig)"
                    }
                }
            ],
            "id": "node_offer_callback",
            "type": "conversation",
            "display_position": {
                "x": 6050,
                "y": 1110
            },
            "instruction": {
                "type": "prompt",
                "text": "Biete Callback an:\n\n\"Kein Problem! M\u00f6chten Sie, dass wir Sie zur\u00fcckrufen, wenn ein passender Termin frei wird?\n\nWir k\u00f6nnten Sie dann kontaktieren und direkt einen Termin vereinbaren.\""
            }
        },
        {
            "variables": [
                {
                    "type": "string",
                    "name": "callback_reason",
                    "description": "Grund f\u00fcr R\u00fcckruf (z.B. 'Termin f\u00fcr Balayage buchen')"
                },
                {
                    "type": "string",
                    "name": "callback_preferred_time",
                    "description": "Bevorzugte R\u00fcckrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag')"
                }
            ],
            "instruction": {
                "type": "prompt",
                "text": "Sammle Callback-Informationen:\n\n**Bereits bekannt:**\n- Name: {{customer_name}}\n- Service: {{service_name}}\n\n**Pr\u00fcfe und frage nur wenn fehlt:**\n1. Telefonnummer: \"Unter welcher Nummer k\u00f6nnen wir Sie am besten erreichen?\"\n   \u2192 Setze {{customer_phone}}\n\n2. (Optional) Bevorzugte Zeit: \"Gibt es eine bevorzugte Zeit f\u00fcr den R\u00fcckruf?\"\n   \u2192 Setze {{callback_preferred_time}} (z.B. \"Vormittag\", \"heute Nachmittag\")\n\n**Setze callback_reason automatisch:**\n\u2192 \"Termin f\u00fcr {{service_name}} buchen\"\n\n**Transition:**\nSobald Name + Phone vorhanden \u2192 func_request_callback"
            },
            "name": "Callback-Daten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_request_callback",
                    "id": "edge_collect_callback_to_func",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "All callback data collected: {{customer_name}} AND {{customer_phone}} AND {{callback_reason}}"
                    }
                }
            ],
            "id": "node_collect_callback_info",
            "type": "conversation",
            "display_position": {
                "x": 6600,
                "y": 1380
            }
        },
        {
            "tool_id": "tool-request-callback",
            "instruction": {
                "type": "static_text",
                "text": "Perfekt! Ich erstelle Ihre R\u00fcckruf-Anfrage..."
            },
            "name": "Callback-Request erstellen",
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "reason": "{{callback_reason}}",
                "phone_number": "{{customer_phone}}",
                "preferred_time": "{{callback_preferred_time}}",
                "customer_name": "{{customer_name}}"
            },
            "edges": [
                {
                    "destination_node_id": "node_callback_confirmation",
                    "id": "edge_callback_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Callback created successfully"
                    }
                }
            ],
            "id": "func_request_callback",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 1520
            },
            "wait_for_result": true
        },
        {
            "name": "Callback best\u00e4tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_callback_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_callback_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 1490
            },
            "instruction": {
                "type": "prompt",
                "text": "Best\u00e4tige Callback:\n\n\"Wunderbar! Ihre R\u00fcckruf-Anfrage wurde erstellt und automatisch an unser Team zugewiesen.\n\nWir melden uns zeitnah bei Ihnen unter {{customer_phone}} um einen passenden Termin zu vereinbaren.\n\nVielen Dank und einen sch\u00f6nen Tag!\""
            }
        },
        {
            "tool_id": "tool-get-appointments",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich schaue nach Ihren Terminen..."
            },
            "name": "Termine abrufen",
            "edges": [
                {
                    "destination_node_id": "node_show_appointments",
                    "id": "edge_get_to_show",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Appointments retrieved"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "id": "func_get_appointments",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 2200,
                "y": 1890
            },
            "wait_for_result": true
        },
        {
            "name": "Termine anzeigen",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_show_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                },
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_show_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to modify a shown appointment"
                    }
                }
            ],
            "id": "node_show_appointments",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 1830
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige die Termine dem Kunden:\n\n**WENN TERMINE VORHANDEN:**\n\"Sie haben folgende Termine: [LISTE MIT DATUM, UHRZEIT, SERVICE]. M\u00f6chten Sie einen davon verschieben oder stornieren?\"\n\n**WENN KEINE TERMINE:**\n\"Sie haben derzeit keine bevorstehenden Termine. M\u00f6chten Sie einen Termin buchen?\""
            }
        },
        {
            "name": "Stornierungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_cancel_appointment",
                    "id": "edge_collect_cancel_to_func",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "ALL variables filled: {{cancel_datum}} AND {{cancel_uhrzeit}}"
                    }
                }
            ],
            "id": "node_collect_cancel_info",
            "type": "conversation",
            "display_position": {
                "x": 6600,
                "y": 2120
            },
            "instruction": {
                "type": "prompt",
                "text": "## WICHTIG: Pr\u00fcfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Datum f\u00fcr Stornierung: {{cancel_datum}}\n- Uhrzeit f\u00fcr Stornierung: {{cancel_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin m\u00f6chte der Kunde stornieren?\n2. **PR\u00dcFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{cancel_datum}} leer \u2192 Frage: \"F\u00fcr welchen Tag m\u00f6chten Sie stornieren?\" (heute\/morgen\/DD.MM.YYYY)\n- Wenn {{cancel_uhrzeit}} leer \u2192 Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n\n**WENN Variable bereits gef\u00fcllt:**\n- \u2705 \u00dcBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich m\u00f6chte meinen Termin morgen um 14 Uhr stornieren\"\n\u2192 cancel_datum = \"morgen\"\n\u2192 cancel_uhrzeit = \"14:00\"\n\u2192 Antworte: \"Verstanden. Einen Moment, ich storniere Ihren Termin...\"\n\u2192 Transition zu func_cancel_appointment\n\n**Transition:**\n- Sobald BEIDE Variablen gef\u00fcllt ({{cancel_datum}} AND {{cancel_uhrzeit}}) \u2192 func_cancel_appointment"
            }
        },
        {
            "tool_id": "tool-cancel-appointment",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich storniere den Termin..."
            },
            "name": "Termin stornieren",
            "edges": [
                {
                    "destination_node_id": "node_cancel_confirmation",
                    "id": "edge_cancel_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Cancellation completed"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "datum": "{{cancel_datum}}",
                "uhrzeit": "{{cancel_uhrzeit}}"
            },
            "id": "func_cancel_appointment",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 2320
            },
            "wait_for_result": true
        },
        {
            "name": "Stornierung best\u00e4tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_cancel_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_cancel_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 2310
            },
            "instruction": {
                "type": "prompt",
                "text": "Best\u00e4tige die Stornierung: 'Ihr Termin wurde storniert. Sie erhalten eine Best\u00e4tigung per E-Mail. Vielen Dank!'"
            }
        },
        {
            "name": "Verschiebungsdaten sammeln",
            "edges": [
                {
                    "destination_node_id": "func_reschedule_appointment",
                    "id": "edge_collect_reschedule_to_func",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "ALL variables filled: {{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}"
                    }
                }
            ],
            "id": "node_collect_reschedule_info",
            "type": "conversation",
            "display_position": {
                "x": 6600,
                "y": 2960
            },
            "instruction": {
                "type": "prompt",
                "text": "## WICHTIG: Pr\u00fcfe bereits bekannte Daten!\n\n**Bereits gesammelte Informationen:**\n- Alter Termin Datum: {{old_datum}}\n- Alter Termin Uhrzeit: {{old_uhrzeit}}\n- Neuer Termin Datum: {{new_datum}}\n- Neuer Termin Uhrzeit: {{new_uhrzeit}}\n\n**Deine Aufgabe:**\n1. **ANALYSIERE den Transcript** - Welchen Termin m\u00f6chte der Kunde verschieben und auf wann?\n2. **PR\u00dcFE die Variablen** - Welche sind noch leer?\n3. **FRAGE NUR** nach fehlenden Daten!\n\n**Fehlende Daten erkennen:**\n- Wenn {{old_datum}} leer \u2192 Frage: \"Welcher Termin soll verschoben werden? An welchem Tag?\" (heute\/morgen\/DD.MM.YYYY)\n- Wenn {{old_uhrzeit}} leer \u2192 Frage: \"Um welche Uhrzeit war der Termin?\" (HH:MM)\n- Wenn {{new_datum}} leer \u2192 Frage: \"Auf welchen Tag m\u00f6chten Sie verschieben?\" (heute\/morgen\/DD.MM.YYYY)\n- Wenn {{new_uhrzeit}} leer \u2192 Frage: \"Um welche Uhrzeit?\" (HH:MM)\n\n**WENN Variable bereits gef\u00fcllt:**\n- \u2705 \u00dcBERSPRINGE die Frage komplett!\n- Nutze den Wert aus der Variable\n\n**Beispiel - User sagt alles:**\nUser: \"Ich m\u00f6chte meinen Termin morgen 14 Uhr auf Donnerstag 16 Uhr verschieben\"\n\u2192 old_datum = \"morgen\"\n\u2192 old_uhrzeit = \"14:00\"\n\u2192 new_datum = \"Donnerstag\"\n\u2192 new_uhrzeit = \"16:00\"\n\u2192 Antworte: \"Perfekt! Einen Moment, ich verschiebe den Termin...\"\n\u2192 Transition zu func_reschedule_appointment\n\n**Transition:**\n- Sobald ALLE 4 Variablen gef\u00fcllt ({{old_datum}} AND {{old_uhrzeit}} AND {{new_datum}} AND {{new_uhrzeit}}) \u2192 func_reschedule_appointment"
            }
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich verschiebe Ihren Termin..."
            },
            "name": "Termin verschieben",
            "edges": [
                {
                    "destination_node_id": "node_reschedule_confirmation",
                    "id": "edge_reschedule_to_confirm",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Rescheduling completed"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}",
                "old_uhrzeit": "{{old_uhrzeit}}",
                "old_datum": "{{old_datum}}",
                "new_datum": "{{new_datum}}",
                "new_uhrzeit": "{{new_uhrzeit}}"
            },
            "id": "func_reschedule_appointment",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 7150,
                "y": 3230
            },
            "wait_for_result": true
        },
        {
            "name": "Verschiebung best\u00e4tigt",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_reschedule_confirm_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Always end"
                    }
                }
            ],
            "id": "node_reschedule_confirmation",
            "type": "conversation",
            "display_position": {
                "x": 7700,
                "y": 3220
            },
            "instruction": {
                "type": "prompt",
                "text": "Best\u00e4tige die Verschiebung: 'Perfekt! Ihr Termin wurde erfolgreich verschoben auf {{new_datum}} um {{new_uhrzeit}} Uhr. Best\u00e4tigung folgt per E-Mail.'"
            }
        },
        {
            "tool_id": "tool-get-services",
            "instruction": {
                "type": "static_text",
                "text": "Einen Moment, ich hole die Service-Liste..."
            },
            "name": "Services abrufen",
            "edges": [
                {
                    "destination_node_id": "node_show_services",
                    "id": "edge_get_services_to_show",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "Services retrieved"
                    }
                }
            ],
            "parameter_mapping": {
                "call_id": "{{call_id}}"
            },
            "id": "func_get_services",
            "type": "function",
            "tool_type": "local",
            "speak_during_execution": true,
            "display_position": {
                "x": 2200,
                "y": 3730
            },
            "wait_for_result": true
        },
        {
            "name": "Services anzeigen",
            "edges": [
                {
                    "destination_node_id": "node_end",
                    "id": "edge_show_services_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User acknowledged or wants to end"
                    }
                },
                {
                    "destination_node_id": "intent_router",
                    "id": "edge_show_services_to_intent",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to book after seeing services"
                    }
                }
            ],
            "id": "node_show_services",
            "type": "conversation",
            "display_position": {
                "x": 2750,
                "y": 3700
            },
            "instruction": {
                "type": "prompt",
                "text": "Zeige die Services:\n\n\"Wir bieten folgende Services an: [LISTE MIT NAMEN, DAUER, PREIS]. M\u00f6chten Sie einen Termin buchen?\""
            }
        },
        {
            "name": "Ende",
            "edges": [],
            "id": "node_end",
            "type": "end",
            "display_position": {
                "x": 8250,
                "y": 1935
            },
            "instruction": {
                "type": "static_text",
                "text": ""
            }
        },
        {
            "name": "Buchung fehlgeschlagen",
            "edges": [
                {
                    "destination_node_id": "node_collect_booking_info",
                    "id": "edge_failed_to_collect",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to try again with different time"
                    }
                },
                {
                    "destination_node_id": "node_offer_callback",
                    "id": "edge_failed_to_callback",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants callback"
                    }
                },
                {
                    "destination_node_id": "node_end",
                    "id": "edge_failed_to_end",
                    "transition_condition": {
                        "type": "prompt",
                        "prompt": "User wants to end call"
                    }
                }
            ],
            "id": "node_booking_failed",
            "type": "conversation",
            "display_position": {
                "x": 7150,
                "y": 2650
            },
            "instruction": {
                "type": "static_text",
                "text": "Entschuldigung, der Termin konnte leider nicht gebucht werden. M\u00f6chten Sie es mit einem anderen Zeitpunkt versuchen oder soll ich Sie zur\u00fcckrufen lassen?"
            }
        }
    ],
    "start_node_id": "node_greeting",
    "start_speaker": "agent",
    "begin_after_user_silence_ms": 800,
    "tools": [
        {
            "tool_id": "tool-check-availability",
            "timeout_ms": 15000,
            "name": "check_availability_v17",
            "description": "Pr\u00fcft Verf\u00fcgbarkeit f\u00fcr einen Termin",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string",
                        "description": "Kundenname"
                    },
                    "datum": {
                        "type": "string",
                        "description": "Datum: heute, morgen, Montag, oder DD.MM.YYYY"
                    },
                    "dienstleistung": {
                        "type": "string",
                        "description": "Service (z.B. Herrenhaarschnitt)"
                    },
                    "uhrzeit": {
                        "type": "string",
                        "description": "Uhrzeit im Format HH:MM"
                    }
                },
                "required": [
                    "name",
                    "datum",
                    "uhrzeit",
                    "dienstleistung"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-alternatives",
            "timeout_ms": 10000,
            "name": "get_alternatives",
            "description": "Schl\u00e4gt alternative Zeitslots vor wenn Wunschtermin nicht verf\u00fcgbar. Sucht intelligente Alternativen basierend auf Datum, Zeit und Service.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "preferred_time": {
                        "type": "string",
                        "description": "Gew\u00fcnschte Uhrzeit (HH:MM) oder Zeitfenster (Vormittag, Nachmittag)"
                    },
                    "service_name": {
                        "type": "string",
                        "description": "Service f\u00fcr den Alternativen gesucht werden (z.B. Herrenhaarschnitt, Balayage)"
                    },
                    "preferred_date": {
                        "type": "string",
                        "description": "Gew\u00fcnschtes Datum (heute, morgen, Montag, oder DD.MM.YYYY)"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system for context"
                    }
                },
                "required": [
                    "call_id",
                    "service_name",
                    "preferred_date"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-request-callback",
            "timeout_ms": 10000,
            "name": "request_callback",
            "description": "Erstellt Callback-Request mit automatischer Staff-Zuweisung. 100% Success Rate (Fixed 2025-11-06). Fallback-Option wenn kein Termin verf\u00fcgbar.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "reason": {
                        "type": "string",
                        "description": "Grund f\u00fcr R\u00fcckruf (z.B. 'Termin f\u00fcr Balayage buchen', 'Beratung')"
                    },
                    "preferred_time": {
                        "type": "string",
                        "description": "Bevorzugte R\u00fcckrufzeit (optional, z.B. 'Vormittag', 'heute Nachmittag', '14-16 Uhr')"
                    },
                    "phone_number": {
                        "type": "string",
                        "description": "Telefonnummer (Format: +49... oder 0...)"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Name des Kunden"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id",
                    "customer_name",
                    "phone_number",
                    "reason"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-appointments",
            "timeout_ms": 15000,
            "name": "get_customer_appointments",
            "description": "Ruft bestehende Termine des Kunden ab",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Optional: Kundenname zur Filterung"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-cancel-appointment",
            "timeout_ms": 15000,
            "name": "cancel_appointment",
            "description": "Storniert einen bestehenden Termin",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "datum": {
                        "type": "string",
                        "description": "Optional: Datum (heute, morgen, oder DD.MM.YYYY)"
                    },
                    "appointment_id": {
                        "type": "string",
                        "description": "Optional: Appointment ID"
                    },
                    "uhrzeit": {
                        "type": "string",
                        "description": "Optional: Uhrzeit HH:MM"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-reschedule-appointment",
            "timeout_ms": 15000,
            "name": "reschedule_appointment",
            "description": "Verschiebt einen Termin auf neues Datum\/Uhrzeit",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "new_uhrzeit": {
                        "type": "string",
                        "description": "Required: Neue Uhrzeit HH:MM"
                    },
                    "appointment_id": {
                        "type": "string",
                        "description": "Optional: Appointment ID"
                    },
                    "old_datum": {
                        "type": "string",
                        "description": "Optional: Altes Datum DD.MM.YYYY"
                    },
                    "old_uhrzeit": {
                        "type": "string",
                        "description": "Optional: Alte Uhrzeit HH:MM"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    },
                    "new_datum": {
                        "type": "string",
                        "description": "Required: Neues Datum (heute, morgen, oder DD.MM.YYYY)"
                    }
                },
                "required": [
                    "call_id",
                    "new_datum",
                    "new_uhrzeit"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-services",
            "timeout_ms": 15000,
            "name": "get_available_services",
            "description": "Listet alle verf\u00fcgbaren Services auf",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Call ID from system"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-start-booking",
            "timeout_ms": 5000,
            "name": "start_booking",
            "description": "Step 1 of 2-step booking: Validates all booking data and returns immediate status (<500ms). Use this BEFORE confirm_booking to provide instant feedback to user. Returns validation status and caches data.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "datetime": {
                        "type": "string",
                        "description": "Appointment date and time in format: DD.MM.YYYY HH:MM (e.g., 06.11.2025 14:00). IMPORTANT: Always use year 2025."
                    },
                    "service": {
                        "type": "string",
                        "description": "Service name (e.g., Herrenhaarschnitt, Damenhaarschnitt, Beratung)"
                    },
                    "function_name": {
                        "type": "string",
                        "description": "Function name: start_booking"
                    },
                    "customer_email": {
                        "type": "string",
                        "description": "Customer email address (optional)"
                    },
                    "customer_phone": {
                        "type": "string",
                        "description": "Customer phone number (format: +49... or 0...)"
                    },
                    "customer_name": {
                        "type": "string",
                        "description": "Customer full name"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Unique Retell call identifier for session tracking"
                    }
                },
                "required": [
                    "function_name",
                    "call_id",
                    "datetime",
                    "service",
                    "customer_name",
                    "customer_phone"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-confirm-booking",
            "timeout_ms": 30000,
            "name": "confirm_booking",
            "description": "Step 2 of 2-step booking: Executes the actual Cal.com booking and database save. Call this IMMEDIATELY AFTER start_booking returns success. Takes 4-5s but user already heard status message.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "function_name": {
                        "type": "string",
                        "description": "Function name: confirm_booking"
                    },
                    "call_id": {
                        "type": "string",
                        "description": "Same call_id used in start_booking to retrieve cached booking data"
                    }
                },
                "required": [
                    "function_name",
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/function"
        },
        {
            "tool_id": "tool-get-current-context",
            "timeout_ms": 5000,
            "name": "get_current_context",
            "description": "Ruft aktuelles Datum, Uhrzeit und Kontext-Informationen ab. Wird automatisch beim Call-Start gecallt um {{current_date}}, {{current_time}}, {{day_name}} zu setzen.",
            "type": "custom",
            "parameters": {
                "type": "object",
                "properties": {
                    "call_id": {
                        "type": "string",
                        "description": "Die Call ID des aktuellen Anrufs"
                    }
                },
                "required": [
                    "call_id"
                ]
            },
            "url": "https:\/\/api.askproai.de\/api\/webhooks\/retell\/current-context"
        }
    ],
    "model_choice": {
        "type": "cascading",
        "model": "gpt-4.1",
        "high_priority": true
    },
    "model_temperature": 0.3,
    "tool_call_strict_mode": false,
    "knowledge_base_ids": [],
    "kb_config": {
        "top_k": 3,
        "filter_score": 0.6
    },
    "begin_tag_display_position": {
        "x": 0,
        "y": 345
    },
    "is_published": false
}