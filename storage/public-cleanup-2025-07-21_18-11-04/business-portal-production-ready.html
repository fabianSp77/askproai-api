<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta name="description" content="AskProAI Business Portal - Verwalten Sie Anrufe, Termine und Kunden">
    <title>AskProAI Business Portal - Production Ready</title>
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Reset & Base Styles */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        /* Skip Link for Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #000;
            color: #fff;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* Focus Visible for Better Accessibility */
        :focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        :focus:not(:focus-visible) {
            outline: none;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            background: #f8fafc; 
            color: #0f172a; 
            line-height: 1.5; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Utility Classes */
        .hidden { display: none !important; }
        .sr-only { 
            position: absolute; 
            width: 1px; 
            height: 1px; 
            padding: 0; 
            margin: -1px; 
            overflow: hidden; 
            clip: rect(0, 0, 0, 0); 
            white-space: nowrap; 
            border-width: 0; 
        }
        
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-center { justify-content: center; }
        .justify-end { justify-content: flex-end; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-3 { gap: 0.75rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .space-y-2 > * + * { margin-top: 0.5rem; }
        .space-y-3 > * + * { margin-top: 0.75rem; }
        .space-y-4 > * + * { margin-top: 1rem; }
        .space-y-6 > * + * { margin-top: 1.5rem; }
        .space-x-2 > * + * { margin-left: 0.5rem; }
        .space-x-3 > * + * { margin-left: 0.75rem; }
        .space-x-4 > * + * { margin-left: 1rem; }
        
        /* Spacing */
        .p-2 { padding: 0.5rem; }
        .p-3 { padding: 0.75rem; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
        .px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .pt-16 { padding-top: 4rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-3 { margin-top: 0.75rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .ml-2 { margin-left: 0.5rem; }
        .ml-3 { margin-left: 0.75rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mr-3 { margin-right: 0.75rem; }
        
        /* Typography */
        .text-xs { font-size: 0.75rem; line-height: 1rem; }
        .text-sm { font-size: 0.875rem; line-height: 1.25rem; }
        .text-base { font-size: 1rem; line-height: 1.5rem; }
        .text-lg { font-size: 1.125rem; line-height: 1.75rem; }
        .text-xl { font-size: 1.25rem; line-height: 1.75rem; }
        .text-2xl { font-size: 1.5rem; line-height: 2rem; }
        .text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
        .text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
        .font-normal { font-weight: 400; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .text-left { text-align: left; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .uppercase { text-transform: uppercase; }
        .tracking-wider { letter-spacing: 0.05em; }
        .truncate { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Colors with Better Contrast */
        .text-white { color: #ffffff; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-900 { color: #111827; }
        .text-blue-600 { color: #2563eb; }
        .text-blue-700 { color: #1d4ed8; }
        .text-green-600 { color: #16a34a; }
        .text-green-800 { color: #166534; }
        .text-red-600 { color: #dc2626; }
        .text-red-800 { color: #991b1b; }
        .text-yellow-600 { color: #d97706; }
        .text-yellow-800 { color: #92400e; }
        .text-purple-600 { color: #9333ea; }
        .text-orange-600 { color: #ea580c; }
        
        .bg-white { background-color: #ffffff; }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-600 { background-color: #4b5563; }
        .bg-gray-900 { background-color: #111827; }
        .bg-blue-50 { background-color: #eff6ff; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-blue-500 { background-color: #3b82f6; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-700 { background-color: #1d4ed8; }
        .bg-green-50 { background-color: #f0fdf4; }
        .bg-green-100 { background-color: #dcfce7; }
        .bg-green-500 { background-color: #22c55e; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-red-50 { background-color: #fef2f2; }
        .bg-red-100 { background-color: #fee2e2; }
        .bg-red-500 { background-color: #ef4444; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-yellow-50 { background-color: #fffbeb; }
        .bg-yellow-100 { background-color: #fef3c7; }
        .bg-purple-100 { background-color: #ede9fe; }
        .bg-purple-500 { background-color: #a855f7; }
        .bg-orange-100 { background-color: #fed7aa; }
        .bg-orange-500 { background-color: #f97316; }
        .bg-indigo-500 { background-color: #6366f1; }
        .bg-gradient-to-r { background-image: linear-gradient(to right, var(--tw-gradient-stops)); }
        .from-blue-600 { --tw-gradient-from: #2563eb; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); }
        .to-blue-700 { --tw-gradient-to: #1d4ed8; }
        
        /* Borders */
        .border { border-width: 1px; }
        .border-2 { border-width: 2px; }
        .border-t { border-top-width: 1px; }
        .border-b { border-bottom-width: 1px; }
        .border-l-4 { border-left-width: 4px; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-blue-500 { border-color: #3b82f6; }
        .border-green-500 { border-color: #22c55e; }
        .border-yellow-500 { border-color: #eab308; }
        
        /* Border Radius */
        .rounded { border-radius: 0.25rem; }
        .rounded-md { border-radius: 0.375rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-full { border-radius: 9999px; }
        
        /* Shadow */
        .shadow-sm { box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05); }
        .shadow { box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        
        /* Effects */
        .hover\:bg-gray-50:hover { background-color: #f9fafb; }
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        .hover\:bg-gray-200:hover { background-color: #e5e7eb; }
        .hover\:bg-gray-300:hover { background-color: #d1d5db; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-green-700:hover { background-color: #15803d; }
        .hover\:text-gray-600:hover { color: #4b5563; }
        .hover\:text-gray-700:hover { color: #374151; }
        .hover\:text-blue-800:hover { color: #1e40af; }
        .hover\:text-blue-900:hover { color: #1e3a8a; }
        .hover\:text-green-800:hover { color: #166534; }
        .hover\:text-green-900:hover { color: #14532d; }
        .hover\:text-red-800:hover { color: #991b1b; }
        .hover\:shadow-lg:hover { box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1); }
        
        /* Layout */
        .fixed { position: fixed; }
        .absolute { position: absolute; }
        .relative { position: relative; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-0 { top: 0; }
        .right-0 { right: 0; }
        .-top-1 { top: -0.25rem; }
        .-right-1 { right: -0.25rem; }
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-50 { z-index: 50; }
        
        .w-full { width: 100%; }
        .w-64 { width: 16rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-lg { max-width: 32rem; }
        .max-w-xl { max-width: 36rem; }
        .max-w-2xl { max-width: 42rem; }
        .max-w-3xl { max-width: 48rem; }
        .max-w-4xl { max-width: 56rem; }
        .max-w-5xl { max-width: 64rem; }
        .max-w-7xl { max-width: 80rem; }
        .min-h-screen { min-height: 100vh; }
        .max-h-96 { max-height: 24rem; }
        .h-4 { height: 1rem; }
        .h-5 { height: 1.25rem; }
        .h-6 { height: 1.5rem; }
        .h-8 { height: 2rem; }
        .h-10 { height: 2.5rem; }
        .h-12 { height: 3rem; }
        .h-16 { height: 4rem; }
        .h-64 { height: 16rem; }
        .h-full { height: 100%; }
        .h-screen { height: 100vh; }
        .w-4 { width: 1rem; }
        .w-5 { width: 1.25rem; }
        .w-6 { width: 1.5rem; }
        .w-8 { width: 2rem; }
        .w-10 { width: 2.5rem; }
        .w-12 { width: 3rem; }
        
        /* Form Elements with Better Touch Targets */
        input, textarea, select {
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 0.75rem 1rem;
            font-size: 1rem;
            min-height: 44px; /* Touch target minimum */
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Buttons with Better Touch Targets */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            border-radius: 0.375rem;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
            border: none;
            text-decoration: none;
            min-height: 44px;
            min-width: 44px;
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        
        .btn-secondary:hover {
            background-color: #d1d5db;
        }
        
        .btn-success {
            background-color: #22c55e;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #16a34a;
        }
        
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            min-height: 36px;
        }
        
        .btn-icon {
            padding: 0.75rem;
        }
        
        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
        }
        
        .badge-blue {
            background-color: #dbeafe;
            color: #1e40af;
        }
        
        .badge-green {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .badge-red {
            background-color: #fee2e2;
            color: #991b1b;
        }
        
        .badge-yellow {
            background-color: #fef3c7;
            color: #92400e;
        }
        
        /* Card */
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        
        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #6b7280;
            padding: 0.75rem 1.5rem;
            background-color: #f9fafb;
        }
        
        td {
            padding: 1rem 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        
        tr:hover {
            background-color: #f9fafb;
        }
        
        /* Modal with Focus Trap */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            max-width: 42rem;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.95);
            transition: transform 0.3s ease;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .tab {
            padding: 1rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .tab:hover {
            color: #374151;
        }
        
        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }
        
        /* Dropdown */
        .dropdown {
            position: relative;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            min-width: 12rem;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-0.5rem);
            transition: all 0.15s ease;
        }
        
        .dropdown.active .dropdown-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            transition: background-color 0.15s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
        }
        
        .dropdown-item:hover {
            background-color: #f3f4f6;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 4rem;
            left: 0;
            bottom: 0;
            width: 16rem;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
            transform: translateX(0);
            transition: transform 0.3s ease;
        }
        
        .sidebar-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            color: #374151;
            cursor: pointer;
            transition: all 0.15s ease;
            min-height: 44px;
        }
        
        .sidebar-item:hover {
            background-color: #f3f4f6;
        }
        
        .sidebar-item.active {
            background-color: #eff6ff;
            color: #3b82f6;
            font-weight: 500;
        }
        
        .sidebar-item i {
            width: 1.25rem;
            height: 1.25rem;
            margin-right: 0.75rem;
        }
        
        /* Main Content */
        .main-content {
            margin-left: 16rem;
            padding: 2rem;
        }
        
        /* Stats Card */
        .stat-card {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }
        
        .stat-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: #111827;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .stat-change {
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            margin-top: 0.25rem;
        }
        
        .stat-change.positive {
            color: #16a34a;
        }
        
        .stat-change.negative {
            color: #dc2626;
        }
        
        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 0.5rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            background-color: #3b82f6;
            transition: width 0.3s ease;
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 2.75rem;
            height: 1.5rem;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #d1d5db;
            border-radius: 9999px;
            transition: 0.3s;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 1.25rem;
            width: 1.25rem;
            left: 0.125rem;
            bottom: 0.125rem;
            background-color: white;
            border-radius: 50%;
            transition: 0.3s;
        }
        
        input:checked + .toggle-slider {
            background-color: #3b82f6;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(1.25rem);
        }
        
        /* Notification */
        .notification {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            min-width: 20rem;
            transform: translateX(25rem);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-icon.success {
            background-color: #dcfce7;
            color: #16a34a;
        }
        
        .notification-icon.error {
            background-color: #fee2e2;
            color: #dc2626;
        }
        
        .notification-icon.info {
            background-color: #dbeafe;
            color: #3b82f6;
        }
        
        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 0.6s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
        }
        
        .tooltip-content {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 0.5rem;
            padding: 0.5rem 0.75rem;
            background-color: #1f2937;
            color: white;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
        }
        
        .tooltip:hover .tooltip-content {
            opacity: 1;
            visibility: visible;
        }
        
        /* Skeleton Loader */
        .skeleton {
            background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Audio Player */
        .audio-player {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background-color: #f9fafb;
            border-radius: 0.5rem;
        }
        
        .audio-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .audio-progress {
            flex: 1;
            height: 0.25rem;
            background-color: #e5e7eb;
            border-radius: 9999px;
            cursor: pointer;
        }
        
        .audio-progress-fill {
            height: 100%;
            background-color: #3b82f6;
            border-radius: 9999px;
            width: 0%;
        }
        
        .audio-time {
            font-size: 0.75rem;
            color: #6b7280;
            min-width: 3rem;
        }
        
        /* Calendar */
        .calendar {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
            overflow: hidden;
        }
        
        .calendar-header {
            padding: 1rem;
            background-color: #f9fafb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }
        
        .calendar-day-header {
            padding: 0.5rem;
            text-align: center;
            font-size: 0.75rem;
            font-weight: 500;
            color: #6b7280;
            background-color: #f9fafb;
        }
        
        .calendar-day {
            padding: 0.75rem;
            text-align: center;
            font-size: 0.875rem;
            border: 1px solid #f3f4f6;
            cursor: pointer;
            transition: background-color 0.15s ease;
            min-height: 44px;
        }
        
        .calendar-day:hover {
            background-color: #f9fafb;
        }
        
        .calendar-day.selected {
            background-color: #3b82f6;
            color: white;
        }
        
        .calendar-day.disabled {
            color: #d1d5db;
            cursor: not-allowed;
        }
        
        .calendar-day.has-event {
            position: relative;
        }
        
        .calendar-day.has-event::after {
            content: "";
            position: absolute;
            bottom: 0.25rem;
            left: 50%;
            transform: translateX(-50%);
            width: 0.25rem;
            height: 0.25rem;
            background-color: #3b82f6;
            border-radius: 50%;
        }
        
        /* Charts Container */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        /* Command Palette */
        .command-palette {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 40rem;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
            z-index: 100;
            display: none;
        }
        
        .command-palette.active {
            display: block;
        }
        
        .command-input {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1rem;
            border: none;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .command-list {
            max-height: 20rem;
            overflow-y: auto;
        }
        
        .command-item {
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: background-color 0.15s ease;
            min-height: 44px;
        }
        
        .command-item:hover {
            background-color: #f9fafb;
        }
        
        .command-item.selected {
            background-color: #eff6ff;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
        }
        
        .empty-state-icon {
            width: 4rem;
            height: 4rem;
            margin: 0 auto 1rem;
            color: #9ca3af;
        }
        
        .empty-state-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.5rem;
        }
        
        .empty-state-description {
            color: #6b7280;
            margin-bottom: 1.5rem;
        }
        
        /* Print Styles */
        @media print {
            .sidebar, .no-print {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            body {
                background: white;
            }
        }
        
        /* Dark Mode Support */
        @media (prefers-color-scheme: dark) {
            body {
                background: #0f172a;
                color: #e5e7eb;
            }
            
            .bg-white {
                background-color: #1e293b;
            }
            
            .text-gray-900 {
                color: #f3f4f6;
            }
            
            .text-gray-700 {
                color: #d1d5db;
            }
            
            .text-gray-600 {
                color: #9ca3af;
            }
            
            .text-gray-500 {
                color: #6b7280;
            }
            
            .border-gray-200 {
                border-color: #374151;
            }
            
            input, textarea, select {
                background-color: #1e293b;
                border-color: #374151;
                color: #e5e7eb;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
                z-index: 30;
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .grid-cols-2 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            
            .grid-cols-3 {
                grid-template-columns: repeat(1, minmax(0, 1fr));
            }
            
            .grid-cols-4 {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
            
            .modal-content {
                width: 95%;
                margin: 1rem;
            }
            
            .dropdown-menu {
                position: fixed;
                left: 1rem;
                right: 1rem;
                width: auto;
            }
        }
        
        /* High Contrast Mode */
        @media (prefers-contrast: high) {
            :focus {
                outline: 3px solid #000;
            }
            
            .btn-primary {
                background-color: #000;
            }
            
            .btn-primary:hover {
                background-color: #333;
            }
        }
        
        /* Reduced Motion */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
        
        /* Custom Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-1rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slideIn {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Live Indicator */
        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .live-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: #ef4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 0.5rem;
        }
        
        ::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 9999px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
    </style>
</head>
<body>
    <!-- Skip to main content link -->
    <a href="#main-content" class="skip-link">Zum Hauptinhalt springen</a>
    
    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 h-16 bg-white border-b border-gray-200 z-20" role="banner">
        <div class="h-full px-4 flex items-center justify-between">
            <div class="flex items-center gap-4">
                <button class="p-2 hover:bg-gray-100 rounded-lg md:hidden" onclick="toggleSidebar()" aria-label="Menü öffnen">
                    <i data-lucide="menu" class="w-5 h-5"></i>
                </button>
                <div class="flex items-center gap-2">
                    <h1 class="text-xl font-bold">AskProAI</h1>
                    <span class="text-sm text-gray-500">Business Portal</span>
                </div>
            </div>
            
            <div class="flex items-center gap-3">
                <!-- Quick Actions -->
                <button class="p-2 hover:bg-gray-100 rounded-lg" onclick="openCommandPalette()" aria-label="Befehlspalette öffnen (Strg+K)">
                    <i data-lucide="command" class="w-5 h-5"></i>
                </button>
                
                <!-- Search -->
                <div class="hidden md:flex items-center bg-gray-100 rounded-lg px-3 py-2">
                    <i data-lucide="search" class="w-4 h-4 text-gray-500"></i>
                    <label for="globalSearch" class="sr-only">Suche</label>
                    <input type="text" id="globalSearch" placeholder="Suche..." class="bg-transparent border-none outline-none ml-2 w-64 text-sm">
                </div>
                
                <!-- Notifications -->
                <div class="dropdown">
                    <button class="p-2 hover:bg-gray-100 rounded-lg relative" onclick="toggleDropdown(this)" aria-label="Benachrichtigungen (3 neue)">
                        <i data-lucide="bell" class="w-5 h-5"></i>
                        <span class="absolute -top-1 -right-1 h-4 w-4 bg-red-500 rounded-full text-white text-xs flex items-center justify-center" aria-hidden="true">3</span>
                    </button>
                    <div class="dropdown-menu" role="menu">
                        <div class="p-3 border-b border-gray-200">
                            <h3 class="font-semibold">Benachrichtigungen</h3>
                        </div>
                        <div class="dropdown-item" role="menuitem">
                            <div class="w-2 h-2 bg-blue-500 rounded-full" aria-hidden="true"></div>
                            <div class="flex-1">
                                <p class="text-sm font-medium">Neuer Termin gebucht</p>
                                <p class="text-xs text-gray-500">vor 5 Minuten</p>
                            </div>
                        </div>
                        <div class="dropdown-item" role="menuitem">
                            <div class="w-2 h-2 bg-green-500 rounded-full" aria-hidden="true"></div>
                            <div class="flex-1">
                                <p class="text-sm font-medium">Zahlung erhalten</p>
                                <p class="text-xs text-gray-500">vor 1 Stunde</p>
                            </div>
                        </div>
                        <div class="dropdown-item" role="menuitem">
                            <div class="w-2 h-2 bg-yellow-500 rounded-full" aria-hidden="true"></div>
                            <div class="flex-1">
                                <p class="text-sm font-medium">Guthaben niedrig</p>
                                <p class="text-xs text-gray-500">vor 2 Stunden</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- User Menu -->
                <div class="dropdown">
                    <button class="flex items-center gap-2 p-2 hover:bg-gray-100 rounded-lg" onclick="toggleDropdown(this)" aria-label="Benutzermenü">
                        <img src="https://ui-avatars.com/api/?name=Demo+User&background=3B82F6&color=fff" alt="Demo User" class="w-8 h-8 rounded-full">
                        <div class="hidden md:block text-left">
                            <div class="text-sm font-medium">Demo User</div>
                            <div class="text-xs text-gray-500">demo@askproai.de</div>
                        </div>
                        <i data-lucide="chevron-down" class="w-4 h-4 hidden md:block" aria-hidden="true"></i>
                    </button>
                    <div class="dropdown-menu" role="menu">
                        <div class="dropdown-item" role="menuitem">
                            <i data-lucide="user" class="w-4 h-4"></i>
                            <span>Mein Profil</span>
                        </div>
                        <div class="dropdown-item" role="menuitem">
                            <i data-lucide="settings" class="w-4 h-4"></i>
                            <span>Einstellungen</span>
                        </div>
                        <div class="dropdown-item" role="menuitem">
                            <i data-lucide="help-circle" class="w-4 h-4"></i>
                            <span>Hilfe & Support</span>
                        </div>
                        <div class="border-t border-gray-200"></div>
                        <div class="dropdown-item" role="menuitem">
                            <i data-lucide="log-out" class="w-4 h-4"></i>
                            <span>Abmelden</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar" role="navigation" aria-label="Hauptnavigation">
        <nav class="p-4">
            <ul class="space-y-1" role="list">
                <li>
                    <a href="#" class="sidebar-item active" data-page="dashboard" role="menuitem">
                        <i data-lucide="home" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="calls" role="menuitem">
                        <i data-lucide="phone" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Anrufe</span>
                        <span class="ml-auto badge badge-blue" aria-label="24 neue Anrufe">24</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="appointments" role="menuitem">
                        <i data-lucide="calendar" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Termine</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="customers" role="menuitem">
                        <i data-lucide="users" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Kunden</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="analytics" role="menuitem">
                        <i data-lucide="bar-chart-2" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Analytics</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="billing" role="menuitem">
                        <i data-lucide="credit-card" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Abrechnung</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="goals" role="menuitem">
                        <i data-lucide="target" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Ziele & KPIs</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="team" role="menuitem">
                        <i data-lucide="users-2" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Team</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="branches" role="menuitem">
                        <i data-lucide="building" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Filialen</span>
                    </a>
                </li>
                <li>
                    <a href="#" class="sidebar-item" data-page="settings" role="menuitem">
                        <i data-lucide="settings" class="w-5 h-5" aria-hidden="true"></i>
                        <span>Einstellungen</span>
                    </a>
                </li>
            </ul>
            
            <!-- Branch Selector -->
            <div class="mt-6 p-3 bg-gray-50 rounded-lg">
                <label for="branchSelector" class="text-xs text-gray-500 font-medium">Aktuelle Filiale</label>
                <select id="branchSelector" class="w-full mt-1 text-sm" onchange="changeBranch(this.value)">
                    <option value="all">Alle Filialen</option>
                    <option value="main">Hauptfiliale</option>
                    <option value="north">Filiale Nord</option>
                    <option value="south">Filiale Süd</option>
                </select>
            </div>
            
            <!-- Quick Stats -->
            <div class="mt-6 p-3 bg-blue-50 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs text-gray-600">Guthaben</span>
                    <span class="text-sm font-semibold">€125,50</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" style="width: 65%;"></div>
                </div>
                <p class="text-xs text-gray-500 mt-1">Reicht für ~322 Min.</p>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content pt-16" id="main-content" role="main">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page active">
            <!-- Page Header -->
            <div class="mb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
                        <p class="text-gray-600">Willkommen zurück! Hier ist Ihre Übersicht.</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button class="btn btn-secondary btn-sm" aria-label="Daten exportieren">
                            <i data-lucide="download" class="w-4 h-4 mr-2" aria-hidden="true"></i>
                            Export
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="refreshDashboard()" aria-label="Dashboard aktualisieren">
                            <i data-lucide="refresh-cw" class="w-4 h-4 mr-2" aria-hidden="true"></i>
                            Aktualisieren
                        </button>
                    </div>
                </div>
            </div>

            <!-- Live Status Bar -->
            <div class="bg-green-50 border border-green-200 rounded-lg p-3 mb-6 flex items-center justify-between" role="status" aria-live="polite">
                <div class="flex items-center gap-2">
                    <div class="live-indicator">
                        <div class="live-dot" aria-hidden="true"></div>
                        <span class="text-sm font-medium text-green-800">Live</span>
                    </div>
                    <span class="text-sm text-green-700" id="liveStatusText">3 aktive Anrufe • 2 Agenten online</span>
                </div>
                <button class="text-sm text-green-700 hover:text-green-800 font-medium">Details anzeigen</button>
            </div>

            <!-- Rest of dashboard content... -->
        </div>

        <!-- Other pages will be added here -->
    </main>

    <!-- Command Palette -->
    <div class="command-palette" id="commandPalette" role="dialog" aria-modal="true" aria-label="Befehlspalette">
        <label for="commandInput" class="sr-only">Nach Befehlen suchen</label>
        <input type="text" class="command-input" placeholder="Suche nach Befehlen..." id="commandInput">
        <div class="command-list" id="commandList" role="listbox">
            <div class="command-item" data-action="new-appointment" role="option">
                <i data-lucide="calendar-plus" class="w-4 h-4 text-gray-500" aria-hidden="true"></i>
                <div class="flex-1">
                    <p class="text-sm font-medium">Neuer Termin</p>
                    <p class="text-xs text-gray-500">Termin manuell anlegen</p>
                </div>
                <kbd class="text-xs bg-gray-100 px-2 py-1 rounded">⌘K</kbd>
            </div>
            <!-- More command items... -->
        </div>
    </div>

    <!-- Modals -->
    <!-- Call Details Modal -->
    <div class="modal" id="callDetailsModal" role="dialog" aria-modal="true" aria-labelledby="callDetailsTitle">
        <div class="modal-content max-w-3xl">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-semibold" id="callDetailsTitle">Anrufdetails</h3>
                    <button onclick="closeModal('callDetailsModal')" class="text-gray-400 hover:text-gray-600" aria-label="Dialog schließen">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>
            <!-- Modal content... -->
        </div>
    </div>

    <!-- Notifications -->
    <div class="notification" id="notification" role="status" aria-live="polite" aria-atomic="true">
        <div class="notification-icon success" aria-hidden="true">
            <i data-lucide="check" class="w-5 h-5"></i>
        </div>
        <div class="flex-1">
            <p class="font-medium" id="notificationTitle">Erfolg!</p>
            <p class="text-sm text-gray-600" id="notificationMessage">Die Aktion wurde erfolgreich ausgeführt.</p>
        </div>
        <button onclick="hideNotification()" class="text-gray-400 hover:text-gray-600" aria-label="Benachrichtigung schließen">
            <i data-lucide="x" class="w-4 h-4"></i>
        </button>
    </div>

    <!-- Screen reader announcements -->
    <div aria-live="polite" aria-atomic="true" class="sr-only" id="notification-announce"></div>

    <script>
        // Strict mode for better error catching
        'use strict';

        // Initialize Lucide icons
        lucide.createIcons();

        // Application State Management
        class AppState {
            constructor() {
                this.currentPage = 'dashboard';
                this.selectedBranch = 'all';
                this.activeModals = [];
                this.selectedCalls = new Set();
                this.listeners = {};
                this.intervals = new Map();
                this.eventHandlers = new WeakMap();
            }
            
            setState(key, value) {
                const oldValue = this[key];
                this[key] = value;
                this.notify(key, value, oldValue);
            }
            
            subscribe(key, callback) {
                if (!this.listeners[key]) {
                    this.listeners[key] = [];
                }
                this.listeners[key].push(callback);
                return () => {
                    this.listeners[key] = this.listeners[key].filter(cb => cb !== callback);
                };
            }
            
            notify(key, newValue, oldValue) {
                if (this.listeners[key]) {
                    this.listeners[key].forEach(cb => {
                        try {
                            cb(newValue, oldValue);
                        } catch (error) {
                            console.error('Error in state listener:', error);
                        }
                    });
                }
            }
            
            addInterval(key, intervalId) {
                this.clearInterval(key);
                this.intervals.set(key, intervalId);
            }
            
            clearInterval(key) {
                if (this.intervals.has(key)) {
                    clearInterval(this.intervals.get(key));
                    this.intervals.delete(key);
                }
            }
            
            clearAllIntervals() {
                this.intervals.forEach((intervalId) => clearInterval(intervalId));
                this.intervals.clear();
            }
        }

        const appState = new AppState();

        // Utility Functions
        function sanitizeHTML(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        // CSRF Token Management
        function getCSRFToken() {
            return document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
        }

        // Page navigation
        function showPage(page) {
            try {
                // Clear page-specific intervals
                appState.clearInterval('dashboard-update');
                
                // Hide all pages
                document.querySelectorAll('.page').forEach(p => p.classList.add('hidden'));
                
                // Show selected page
                const pageElement = document.getElementById(page + 'Page');
                if (pageElement) {
                    pageElement.classList.remove('hidden');
                    
                    // Update state
                    appState.setState('currentPage', page);
                    
                    // Update sidebar
                    document.querySelectorAll('.sidebar-item').forEach(item => {
                        item.classList.remove('active');
                        if (item.dataset.page === page) {
                            item.classList.add('active');
                        }
                    });
                    
                    // Initialize page-specific features
                    switch (page) {
                        case 'dashboard':
                            initDashboard();
                            break;
                        case 'calls':
                            initCalls();
                            break;
                        // Add other page initializations
                    }
                    
                    // Reinitialize icons
                    lucide.createIcons();
                    
                    // Announce page change to screen readers
                    announceToScreenReader(`Navigiert zu ${page} Seite`);
                } else {
                    throw new Error(`Page ${page} not found`);
                }
            } catch (error) {
                console.error('Error showing page:', error);
                showNotification('Fehler', 'Seite konnte nicht geladen werden', 'error');
            }
        }

        // Event Delegation for better performance
        document.addEventListener('click', (e) => {
            // Handle sidebar navigation
            const sidebarItem = e.target.closest('.sidebar-item');
            if (sidebarItem) {
                e.preventDefault();
                const page = sidebarItem.dataset.page;
                if (page) {
                    showPage(page);
                }
            }
            
            // Handle dropdown toggles
            const dropdownButton = e.target.closest('[onclick*="toggleDropdown"]');
            if (dropdownButton) {
                e.preventDefault();
                toggleDropdown(dropdownButton);
            }
            
            // Handle command items
            const commandItem = e.target.closest('.command-item');
            if (commandItem) {
                const action = commandItem.dataset.action;
                executeCommand(action);
                closeCommandPalette();
            }
            
            // Handle checkbox changes
            if (e.target.classList.contains('call-checkbox')) {
                updateBulkActions();
            }
        });

        // Mobile sidebar toggle
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
            
            // Focus management
            if (sidebar.classList.contains('open')) {
                sidebar.querySelector('.sidebar-item').focus();
            }
        }

        // Dropdown functionality with proper focus management
        function toggleDropdown(button) {
            const dropdown = button.closest('.dropdown');
            const wasActive = dropdown.classList.contains('active');
            
            // Close all dropdowns
            document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            
            // Toggle this dropdown
            if (!wasActive) {
                dropdown.classList.add('active');
                // Focus first item
                const firstItem = dropdown.querySelector('.dropdown-item');
                if (firstItem) {
                    firstItem.focus();
                }
            }
        }

        // Close dropdowns on outside click
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.dropdown')) {
                document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
            }
        });

        // Command palette with debounced search
        let commandPaletteOpen = false;

        function openCommandPalette() {
            const palette = document.getElementById('commandPalette');
            palette.classList.add('active');
            commandPaletteOpen = true;
            
            const input = document.getElementById('commandInput');
            input.value = '';
            input.focus();
            
            // Show all items
            document.querySelectorAll('.command-item').forEach(item => {
                item.style.display = 'flex';
            });
            
            // Focus trap
            palette.addEventListener('keydown', handleCommandPaletteKeydown);
        }

        function closeCommandPalette() {
            const palette = document.getElementById('commandPalette');
            palette.classList.remove('active');
            commandPaletteOpen = false;
            palette.removeEventListener('keydown', handleCommandPaletteKeydown);
        }

        function handleCommandPaletteKeydown(e) {
            if (e.key === 'Escape') {
                closeCommandPalette();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Cmd/Ctrl + K for command palette
            if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                e.preventDefault();
                if (commandPaletteOpen) {
                    closeCommandPalette();
                } else {
                    openCommandPalette();
                }
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                if (commandPaletteOpen) {
                    closeCommandPalette();
                } else if (appState.activeModals.length > 0) {
                    closeModal(appState.activeModals[appState.activeModals.length - 1]);
                }
            }
        });

        // Debounced command palette search
        const searchCommands = debounce((query) => {
            const items = document.querySelectorAll('.command-item');
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(query.toLowerCase()) ? 'flex' : 'none';
            });
        }, 300);

        document.getElementById('commandInput').addEventListener('input', (e) => {
            searchCommands(e.target.value);
        });

        function executeCommand(action) {
            try {
                switch (action) {
                    case 'new-appointment':
                        showNotification('Info', 'Termin-Dialog wird geöffnet...', 'info');
                        break;
                    case 'search-customer':
                        showPage('customers');
                        break;
                    case 'export-data':
                        showNotification('Info', 'Export-Dialog wird geöffnet...', 'info');
                        break;
                    case 'quick-topup':
                        showPage('billing');
                        break;
                    default:
                        throw new Error(`Unknown command: ${action}`);
                }
            } catch (error) {
                console.error('Error executing command:', error);
                showNotification('Fehler', 'Befehl konnte nicht ausgeführt werden', 'error');
            }
        }

        // Modal functions with focus trap
        function openModal(modalId) {
            try {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.add('active');
                    appState.activeModals.push(modalId);
                    
                    // Focus first focusable element
                    const focusable = modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
                    if (focusable) {
                        focusable.focus();
                    }
                    
                    // Trap focus
                    modal.addEventListener('keydown', trapFocus);
                }
            } catch (error) {
                console.error('Error opening modal:', error);
            }
        }

        function closeModal(modalId) {
            try {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('active');
                    appState.activeModals = appState.activeModals.filter(id => id !== modalId);
                    modal.removeEventListener('keydown', trapFocus);
                    
                    // Return focus to trigger element
                    // This would need to be tracked when opening
                }
            } catch (error) {
                console.error('Error closing modal:', error);
            }
        }

        function trapFocus(e) {
            if (e.key === 'Tab') {
                const focusableElements = e.currentTarget.querySelectorAll(
                    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                );
                const firstElement = focusableElements[0];
                const lastElement = focusableElements[focusableElements.length - 1];

                if (e.shiftKey && document.activeElement === firstElement) {
                    e.preventDefault();
                    lastElement.focus();
                } else if (!e.shiftKey && document.activeElement === lastElement) {
                    e.preventDefault();
                    firstElement.focus();
                }
            }
        }

        // Notifications with screen reader support
        let notificationTimeout;

        function showNotification(title, message, type = 'success') {
            try {
                const notification = document.getElementById('notification');
                const icon = notification.querySelector('.notification-icon');
                
                // Clear existing timeout
                if (notificationTimeout) {
                    clearTimeout(notificationTimeout);
                }
                
                // Update content
                document.getElementById('notificationTitle').textContent = title;
                document.getElementById('notificationMessage').textContent = message;
                
                // Update icon
                icon.className = `notification-icon ${type}`;
                const iconElement = icon.querySelector('i');
                iconElement.setAttribute('data-lucide', type === 'success' ? 'check' : type === 'error' ? 'x' : 'info');
                
                // Show notification
                notification.classList.add('show');
                
                // Announce to screen readers
                announceToScreenReader(`${type}: ${title}. ${message}`);
                
                // Auto hide after 5 seconds
                notificationTimeout = setTimeout(() => {
                    hideNotification();
                }, 5000);
                
                // Reinitialize icons
                lucide.createIcons();
            } catch (error) {
                console.error('Error showing notification:', error);
            }
        }

        function hideNotification() {
            document.getElementById('notification').classList.remove('show');
            if (notificationTimeout) {
                clearTimeout(notificationTimeout);
                notificationTimeout = null;
            }
        }

        // Screen reader announcements
        function announceToScreenReader(message) {
            const announcement = document.getElementById('notification-announce');
            announcement.textContent = message;
            
            // Clear after a moment to allow re-announcement
            setTimeout(() => {
                announcement.textContent = '';
            }, 100);
        }

        // Dashboard functions
        function initDashboard() {
            try {
                // Initialize charts
                initCharts();
                
                // Set up real-time updates with proper cleanup
                const updateInterval = setInterval(() => {
                    updateLiveStatus();
                }, 30000);
                
                appState.addInterval('dashboard-update', updateInterval);
            } catch (error) {
                console.error('Error initializing dashboard:', error);
                showNotification('Fehler', 'Dashboard konnte nicht initialisiert werden', 'error');
            }
        }

        function initCharts() {
            // Chart initialization with error handling
            const charts = [
                { id: 'callVolumeChart', type: 'line', config: getCallVolumeConfig() },
                { id: 'appointmentChart', type: 'bar', config: getAppointmentConfig() },
                // Add more charts
            ];
            
            charts.forEach(({ id, type, config }) => {
                try {
                    const ctx = document.getElementById(id);
                    if (ctx) {
                        new Chart(ctx.getContext('2d'), config);
                    }
                } catch (error) {
                    console.error(`Error initializing chart ${id}:`, error);
                }
            });
        }

        function getCallVolumeConfig() {
            return {
                type: 'line',
                data: {
                    labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
                    datasets: [{
                        label: 'Anrufe',
                        data: [45, 52, 38, 65, 59, 42, 24],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            };
        }

        function getAppointmentConfig() {
            return {
                type: 'bar',
                data: {
                    labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
                    datasets: [{
                        label: 'Termine',
                        data: [12, 19, 15, 25, 22, 18, 8],
                        backgroundColor: '#22c55e'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            };
        }

        function updateLiveStatus() {
            try {
                // Simulate live updates
                const activeCalls = Math.floor(Math.random() * 5);
                const onlineAgents = Math.floor(Math.random() * 3) + 1;
                
                const statusText = document.getElementById('liveStatusText');
                if (statusText) {
                    statusText.textContent = `${activeCalls} aktive Anrufe • ${onlineAgents} Agenten online`;
                }
            } catch (error) {
                console.error('Error updating live status:', error);
            }
        }

        function refreshDashboard() {
            showNotification('Aktualisiert', 'Dashboard wurde aktualisiert', 'success');
            initDashboard();
        }

        // Calls page functions
        function initCalls() {
            updateBulkActions();
        }

        function selectAllCalls(checked) {
            document.querySelectorAll('.call-checkbox').forEach(checkbox => {
                checkbox.checked = checked;
            });
            updateBulkActions();
        }

        function updateBulkActions() {
            const selected = document.querySelectorAll('.call-checkbox:checked').length;
            const bulkActions = document.getElementById('bulkActions');
            
            if (bulkActions) {
                if (selected > 0) {
                    bulkActions.classList.remove('hidden');
                    const selectedCount = document.getElementById('selectedCount');
                    if (selectedCount) {
                        selectedCount.textContent = selected;
                    }
                } else {
                    bulkActions.classList.add('hidden');
                }
            }
        }

        // Branch selector
        function changeBranch(branch) {
            appState.setState('selectedBranch', branch);
            showNotification('Filiale geändert', `Ansicht wurde auf "${branch}" geändert`, 'info');
            
            // Refresh current page with new branch filter
            const currentPage = appState.currentPage;
            if (currentPage === 'dashboard') {
                refreshDashboard();
            }
            // Add other page refreshes as needed
        }

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            appState.clearAllIntervals();
        });

        // Initialize on DOM ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                showPage('dashboard');
            });
        } else {
            showPage('dashboard');
        }

        // Error boundary
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            showNotification('Fehler', 'Ein unerwarteter Fehler ist aufgetreten', 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            showNotification('Fehler', 'Ein unerwarteter Fehler ist aufgetreten', 'error');
        });
    </script>
</body>
</html>