<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Dokumentations-Hub - AskPro AI Gateway</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #3498db; --primary-dark: #2980b9; --success: #27ae60; --warning: #f39c12;
            --danger: #e74c3c; --info: #3498db; --bg-main: #f5f7fa; --bg-card: #ffffff; --bg-sidebar: #2c3e50;
            --text-main: #333333; --text-secondary: #7f8c8d; --text-sidebar: #ecf0f1;
            --border: #dee2e6; --shadow: rgba(0,0,0,0.1);
            --sidebar-width: 300px;
            /* Accessibility colors */
            --green: #27ae60; --yellow: #f39c12; --red: #e74c3c; --blue: #3498db;
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            :root {
                --primary: #0066cc; --text-main: #000000; --bg-card: #ffffff;
                --border: #000000;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            line-height: 1.6;
            font-size: clamp(14px, 1vw, 16px);
        }

        .layout { display: flex; min-height: 100vh; }

        /* Accessibility Controls */
        .accessibility-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--bg-sidebar);
            color: var(--text-sidebar);
            padding: 0.5rem 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            z-index: 2000;
            box-shadow: 0 2px 4px var(--shadow);
        }

        .accessibility-bar button {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            min-height: 44px;
            min-width: 44px;
        }

        .accessibility-bar button:hover {
            background: rgba(255,255,255,0.2);
        }

        .accessibility-bar button:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        body.font-large { font-size: 18px; }
        body.font-xlarge { font-size: 20px; }
        body.high-contrast { --bg-card: #000; --text-main: #fff; --bg-main: #111; }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-sidebar);
            color: var(--text-sidebar);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: clamp(1rem, 2vw, 1.5rem);
            padding-top: 4rem;
            box-shadow: 2px 0 10px var(--shadow);
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar-header h1 {
            font-size: clamp(1.2em, 2vw, 1.5em);
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .sidebar-header p {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .search-box {
            margin: 1.25rem 0;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem 2.5rem 0.75rem 0.75rem;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            background: rgba(255,255,255,0.1);
            color: var(--text-sidebar);
            font-size: 0.9em;
            transition: all 0.2s;
            min-height: 44px;
        }

        .search-box input:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
            background: rgba(255,255,255,0.15);
            border-color: var(--primary);
        }

        .search-box input::placeholder { color: rgba(255,255,255,0.6); }

        .search-clear {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: var(--text-sidebar);
            cursor: pointer;
            padding: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
            min-height: 44px;
            min-width: 44px;
        }

        .search-clear.visible { opacity: 0.7; }
        .search-clear:hover { opacity: 1; }
        .search-clear:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        .search-results-count {
            font-size: 0.75em;
            opacity: 0.8;
            margin-top: 0.5rem;
            display: none;
        }

        .search-results-count.visible { display: block; }

        .nav-section { margin-top: 1.5rem; }

        .nav-section-title {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.6;
            margin-bottom: 0.5rem;
            padding-left: 0.75rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.6rem 0.75rem;
            color: var(--text-sidebar);
            text-decoration: none;
            border-radius: 6px;
            margin-bottom: 0.25rem;
            transition: all 0.2s;
            font-size: 0.9em;
            min-height: 44px;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(3px);
        }

        .nav-link:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        .nav-link.active {
            background: var(--primary);
            color: white;
            font-weight: 500;
        }

        .nav-link .icon {
            font-size: 1.2em;
            width: 1.5em;
            text-align: center;
        }

        .nav-link .count {
            margin-left: auto;
            background: rgba(255,255,255,0.2);
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.85em;
        }

        .nav-link.active .count {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            margin-top: 3rem;
            flex: 1;
            padding: clamp(1.5rem, 3vw, 2.5rem);
            max-width: 1600px;
        }

        /* Breadcrumbs */
        .breadcrumbs {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        .breadcrumbs a {
            color: var(--primary);
            text-decoration: none;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
        }

        .breadcrumbs a:hover {
            text-decoration: underline;
        }

        .breadcrumbs a:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        .breadcrumbs .separator {
            opacity: 0.5;
        }

        /* Enhanced Status Dashboard */
        .status-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .status-card {
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
        }

        .status-card.healthy {
            border-left: 4px solid var(--green);
        }

        .status-card.info {
            border-left: 4px solid var(--blue);
        }

        .status-card.upcoming {
            border-left: 4px solid var(--warning);
        }

        .status-card.metric {
            border-left: 4px solid var(--info);
        }

        .status-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
        }

        .status-icon {
            font-size: 2.5em;
            margin-bottom: 0.5rem;
        }

        .status-card h3 {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .status-detail {
            font-size: 0.85em;
            color: var(--text-secondary);
        }

        /* Tooltip System */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 250px;
            background-color: #2c3e50;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85em;
            line-height: 1.4;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }

        .tooltip:hover .tooltip-text,
        .tooltip:focus .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Status Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.current {
            background: var(--green);
            color: white;
        }

        .badge.archived {
            background: var(--text-secondary);
            color: white;
        }

        .badge.important {
            background: var(--danger);
            color: white;
        }

        .badge.beginner {
            background: var(--green);
            color: white;
        }

        .badge.advanced {
            background: var(--warning);
            color: white;
        }

        .badge.expert {
            background: var(--danger);
            color: white;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .quick-action-btn {
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
            background: var(--bg-card);
            color: var(--text-main);
            border: 1px solid var(--border);
            min-height: 44px;
        }

        .quick-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .quick-action-btn:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        /* Categories */
        .category-section {
            margin-bottom: 2.5rem;
            scroll-margin-top: 6rem;
        }

        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background: var(--bg-card);
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 2px 4px var(--shadow);
            transition: all 0.3s ease;
            min-height: 44px;
        }

        .category-header:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .category-header:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        .category-header h2 {
            font-size: clamp(1em, 2vw, 1.25em);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
        }

        .category-header .badge {
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 500;
        }

        .category-header:hover .badge {
            background: white;
            color: var(--primary);
        }

        .category-header .toggle-icon {
            transition: transform 0.3s ease;
            font-size: 1.2em;
        }

        .category-header .toggle-icon.expanded {
            transform: rotate(180deg);
        }

        .category-content {
            padding: 1.5rem 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s ease;
            opacity: 0;
        }

        .category-content.expanded {
            max-height: 10000px;
            opacity: 1;
        }

        /* Enhanced File Cards */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(min(350px, 100%), 1fr));
            gap: clamp(1rem, 2vw, 1.5rem);
        }

        .file-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: clamp(1rem, 2vw, 1.25rem);
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .file-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px var(--shadow);
            border-color: var(--primary);
        }

        .file-card:hover::before {
            transform: scaleY(1);
        }

        .file-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .file-card-badges {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .file-card-title {
            font-size: clamp(1em, 1.5vw, 1.1em);
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
            line-height: 1.3;
        }

        .file-card-description {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .file-card-meta {
            display: flex;
            gap: clamp(0.75rem, 1.5vw, 1rem);
            margin-bottom: 1rem;
            font-size: 0.85em;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .file-card-meta span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .reading-time {
            background: var(--bg-main);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .file-card-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            padding: 0.5rem 0.75rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85em;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
            white-space: nowrap;
            min-height: 44px;
            min-width: 44px;
        }

        .btn:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--text-secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #6c7a7b;
            transform: translateY(-1px);
        }

        .btn-copy {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-main);
        }

        .btn-copy:hover {
            background: var(--bg-main);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Back to Top Button */
        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            box-shadow: 0 4px 12px var(--shadow);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            background: var(--primary-dark);
            transform: translateY(-4px);
        }

        .back-to-top:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: clamp(2rem, 5vw, 4rem) 1rem;
        }

        .spinner {
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.25rem;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .copy-tooltip {
            position: fixed;
            background: var(--success);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            font-size: 0.85em;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 10000;
            pointer-events: none;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .copy-tooltip.show { opacity: 1; }

        /* Mobile Hamburger */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            width: 3rem;
            height: 3rem;
            background: var(--bg-sidebar);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            z-index: 1001;
            box-shadow: 0 2px 8px var(--shadow);
            min-height: 44px;
            min-width: 44px;
        }

        .mobile-menu-toggle:focus {
            outline: 2px solid var(--warning);
            outline-offset: 2px;
        }

        .mobile-menu-toggle .icon {
            font-size: 1.5em;
        }

        /* Skip to Content Link */
        .skip-to-content {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: white;
            padding: 8px;
            text-decoration: none;
            z-index: 3000;
        }

        .skip-to-content:focus {
            top: 0;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            :root { --sidebar-width: 260px; }
            .file-grid { grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); }
        }

        @media (max-width: 992px) {
            .mobile-menu-toggle { display: flex; }

            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                padding-top: 5rem;
            }

            .back-to-top {
                bottom: 5rem;
                right: 1rem;
            }
        }

        @media (max-width: 768px) {
            :root { --sidebar-width: 100%; }

            .file-grid {
                grid-template-columns: 1fr;
            }

            .status-dashboard {
                grid-template-columns: repeat(2, 1fr);
            }

            .quick-actions {
                flex-direction: column;
            }

            .quick-action-btn {
                width: 100%;
                justify-content: center;
            }

            .accessibility-bar {
                flex-wrap: wrap;
                padding: 0.5rem;
            }

            .accessibility-bar button {
                font-size: 0.75em;
                padding: 0.3rem 0.6rem;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .back-to-top,
            .mobile-menu-toggle,
            .quick-actions,
            .file-card-actions,
            .accessibility-bar {
                display: none;
            }

            .main-content {
                margin-left: 0;
            }

            .category-content {
                max-height: none !important;
                opacity: 1 !important;
            }

            .file-card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Skip to Content -->
    <a href="#main-content" class="skip-to-content">Zum Inhalt springen</a>

    <!-- Accessibility Bar -->
    <div class="accessibility-bar" role="toolbar" aria-label="Barrierefreiheit">
        <span style="font-weight: 600;">Ansicht:</span>
        <button onclick="adjustFontSize('normal')" aria-label="Normale Schriftgröße" title="Normale Schriftgröße">A</button>
        <button onclick="adjustFontSize('large')" aria-label="Große Schriftgröße" title="Große Schriftgröße">A+</button>
        <button onclick="adjustFontSize('xlarge')" aria-label="Sehr große Schriftgröße" title="Sehr große Schriftgröße">A++</button>
        <button onclick="toggleHighContrast()" aria-label="Hoher Kontrast" title="Hohen Kontrast umschalten">◐</button>
        <span style="margin-left: auto; font-size: 0.85em;">Tastatur: / = Suchen, Esc = Schließen</span>
    </div>

    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Menü öffnen/schließen">
        <span class="icon">☰</span>
    </button>

    <div class="layout">
        <aside class="sidebar" id="sidebar" role="navigation" aria-label="Hauptnavigation">
            <div class="sidebar-header">
                <h1>📚 Dokumentations-Hub</h1>
                <p>AskPro AI Gateway</p>
            </div>

            <div class="search-box">
                <input type="text" id="searchInput" placeholder="🔍 Dokumentation durchsuchen..." aria-label="Suche" />
                <button class="search-clear" id="searchClear" onclick="clearSearch()" aria-label="Suche löschen">✕</button>
            </div>

            <div class="search-results-count" id="searchResultsCount" role="status" aria-live="polite"></div>

            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Schnellzugriff</div>
                    <a href="#status" class="nav-link" data-section="status">
                        <span class="icon">📊</span>
                        <span>System-Status</span>
                    </a>
                    <a href="/docs/backup-system/documentation-index.html" class="nav-link">
                        <span class="icon">📚</span>
                        <span>Dokumentations-Index</span>
                    </a>
                    <a href="/docs/backup-system/Zero-Loss-Backups-and-Deployment.pdf" class="nav-link" target="_blank">
                        <span class="icon">📄</span>
                        <span>Backup-Dokumentation (PDF)</span>
                    </a>
                </div>

                <div class="nav-section">
                    <div class="nav-section-title">Kategorien</div>
                    <div id="navLinks"></div>
                </div>
            </nav>
        </aside>

        <main class="main-content" id="main-content" role="main">
            <nav class="breadcrumbs" aria-label="Breadcrumb">
                <a href="/">Start</a>
                <span class="separator">›</span>
                <a href="/docs/backup-system">Backup-System</a>
                <span class="separator">›</span>
                <span>Dokumentation</span>
            </nav>

            <div id="status" class="status-dashboard" role="region" aria-label="System-Status">
                <div class="status-card healthy">
                    <div class="status-icon">✅</div>
                    <h3>System-Status</h3>
                    <div class="status-value">Gesund</div>
                    <div class="status-detail">Alle Systeme funktionieren normal</div>
                </div>

                <div class="status-card info">
                    <div class="status-icon">💾</div>
                    <h3>Letztes Backup</h3>
                    <div class="status-value" id="lastBackupValue">Lädt...</div>
                    <div class="status-detail" id="lastBackupDetail">-</div>
                </div>

                <div class="status-card upcoming">
                    <div class="status-icon">📅</div>
                    <h3>Nächstes Backup</h3>
                    <div class="status-value" id="nextBackupValue">Lädt...</div>
                    <div class="status-detail" id="nextBackupDetail">-</div>
                </div>

                <div class="status-card metric">
                    <div class="status-icon">📊</div>
                    <h3>Binlog-Status</h3>
                    <div class="status-value" id="binlogValue">Lädt...</div>
                    <div class="status-detail">Letztes Log-Eintrag</div>
                </div>
            </div>

            <div class="quick-actions">
                <button class="quick-action-btn" onclick="expandAll()">
                    <span>▼</span> Alle erweitern
                </button>
                <button class="quick-action-btn" onclick="collapseAll()">
                    <span>▲</span> Alle zuklappen
                </button>
                <button class="quick-action-btn" onclick="window.print()">
                    <span>🖨</span> Druckansicht
                </button>
            </div>

            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Dokumentation wird geladen...</p>
            </div>

            <div id="categories" style="display:none;"></div>
        </main>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()" aria-label="Nach oben">
        ↑
    </button>

    <div class="copy-tooltip" id="copyTooltip" role="status" aria-live="polite">✓ Kopiert!</div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ startOnLoad: true, theme: 'default' });

        let allFiles = [];
        let expandedCategories = new Set();

        // German date/time formatter
        function formatGermanDate(timestamp) {
            const date = new Date(timestamp * 1000);
            return new Intl.DateTimeFormat('de-DE', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                timeZone: 'Europe/Berlin'
            }).format(date) + ' Uhr';
        }

        // Relative time in German
        function formatRelativeTime(timestamp) {
            const now = new Date();
            const date = new Date(timestamp * 1000);
            const diff = now - date;
            const absDiff = Math.abs(diff);
            const minutes = Math.floor(absDiff / 60000);
            const hours = Math.floor(absDiff / 3600000);
            const days = Math.floor(absDiff / 86400000);

            // Future times (diff < 0)
            if (diff < 0) {
                if (minutes < 1) return 'in wenigen Sekunden';
                if (minutes < 60) return `in ${minutes} ${minutes === 1 ? 'Minute' : 'Minuten'}`;
                if (hours < 24) return `in ${hours} ${hours === 1 ? 'Stunde' : 'Stunden'}`;
                if (days < 30) return `in ${days} ${days === 1 ? 'Tag' : 'Tagen'}`;
                return formatGermanDate(timestamp);
            }

            // Past times (diff >= 0)
            if (minutes < 1) return 'gerade eben';
            if (minutes < 60) return `vor ${minutes} ${minutes === 1 ? 'Minute' : 'Minuten'}`;
            if (hours < 24) return `vor ${hours} ${hours === 1 ? 'Stunde' : 'Stunden'}`;
            if (days < 30) return `vor ${days} ${days === 1 ? 'Tag' : 'Tagen'}`;
            return formatGermanDate(timestamp);
        }

        // Estimate reading time
        function estimateReadingTime(size) {
            const wordsPerMinute = 200;
            const words = size / 5; // Rough estimate: 5 chars per word
            const minutes = Math.ceil(words / wordsPerMinute);
            return `${minutes} Min. Lesezeit`;
        }

        // Safe date parsing helper
        function safeParseDate(dateString) {
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) {
                    console.error('Invalid date:', dateString);
                    return null;
                }
                // Return Unix timestamp in seconds (not milliseconds) for consistency
                return Math.floor(date.getTime() / 1000);
            } catch (e) {
                console.error('Date parsing error:', e, dateString);
                return null;
            }
        }

        // Load status from API
        async function loadStatus() {
            try {
                const res = await fetch('/docs/backup-system/status.json', {
                    credentials: 'include'
                });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                // Parse last backup timestamp (ISO-8601 string)
                if (data.last_backup?.timestamp) {
                    const timestamp = safeParseDate(data.last_backup.timestamp);
                    if (timestamp) {
                        document.getElementById('lastBackupValue').textContent = formatRelativeTime(timestamp);
                        document.getElementById('lastBackupDetail').textContent = formatGermanDate(timestamp);
                    } else {
                        document.getElementById('lastBackupValue').textContent = 'Fehler beim Laden';
                        document.getElementById('lastBackupDetail').textContent = 'Ungültiges Datum';
                    }
                }

                // Parse next backup timestamp (ISO-8601 string)
                if (data.next_backup_localtime) {
                    const timestamp = safeParseDate(data.next_backup_localtime);
                    if (timestamp) {
                        document.getElementById('nextBackupValue').textContent = formatRelativeTime(timestamp);
                        document.getElementById('nextBackupDetail').textContent = formatGermanDate(timestamp);
                    } else {
                        document.getElementById('nextBackupValue').textContent = data.next_backup_localtime;
                        document.getElementById('nextBackupDetail').textContent = 'Geplant';
                    }
                }

                // Binlog status
                if (data.binlog?.last_file) {
                    document.getElementById('binlogValue').textContent = data.binlog.last_file;

                    // Parse binlog timestamp if available
                    if (data.binlog?.timestamp) {
                        const timestamp = safeParseDate(data.binlog.timestamp);
                        if (timestamp) {
                            const detail = document.getElementById('binlogDetail');
                            if (detail) {
                                detail.textContent = formatGermanDate(timestamp);
                            }
                        }
                    }
                }
            } catch (e) {
                console.error('Status load error:', e);
                document.getElementById('lastBackupValue').textContent = 'Nicht verfügbar';
                document.getElementById('nextBackupValue').textContent = 'Nicht verfügbar';
                document.getElementById('binlogValue').textContent = 'Nicht verfügbar';
            }
        }

        // Load files from API
        async function loadFiles() {
            try {
                const res = await fetch('/docs/backup-system/api/files', {
                    credentials: 'include'
                });
                if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                const data = await res.json();
                allFiles = data.files;
                renderCategories(allFiles);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('categories').style.display = 'block';

                handleHashNavigation();
                restoreExpandedState();
            } catch (e) {
                console.error('Files load error:', e);
                document.getElementById('loading').innerHTML = `
                    <p style="color:var(--danger);">Laden fehlgeschlagen: ${e.message}. Bitte Seite neu laden.</p>
                `;
            }
        }

        // Render categories
        function renderCategories(files) {
            const cats = [...new Set(files.map(f => f.category))].sort();
            const icons = {
                'Hub & Index': '🏠',
                'Executive / Management': '👔',
                'Backup & PITR': '💾',
                'Deployment & Gates': '🚀',
                'Testing & Validation': '🧪',
                'E-Mail & Notifications': '📧',
                'Incident Reports & Fixes': '🔥',
                'Security & Access': '🔒',
                'UX & Documentation': '🎨',
                'Validierung & Reports': '✅',
                'Other': '📄'
            };

            const categoriesHtml = cats.map(cat => {
                const catFiles = files.filter(f => f.category === cat);
                const catId = categoryToId(cat);
                const isExpanded = expandedCategories.has(catId);

                return `
                    <div class="category-section" id="cat-${catId}">
                        <div class="category-header" onclick="toggleCategory('${catId}')" role="button" tabindex="0" aria-expanded="${isExpanded}">
                            <h2>
                                <span class="icon">${icons[cat] || '📄'}</span>
                                <span>${cat}</span>
                                <span class="badge">${catFiles.length}</span>
                            </h2>
                            <span class="toggle-icon ${isExpanded ? 'expanded' : ''}">▼</span>
                        </div>
                        <div class="category-content ${isExpanded ? 'expanded' : ''}" id="content-${catId}">
                            <div class="file-grid">${catFiles.map(renderCard).join('')}</div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('categories').innerHTML = categoriesHtml;
            updateNavLinks(cats, icons);
        }

        // Convert category name to valid ID
        function categoryToId(cat) {
            return cat.toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^a-z0-9-]/g, '')
                .replace(/^-+|-+$/g, '');
        }

        // Update navigation links
        function updateNavLinks(categories, icons) {
            const navHtml = categories.map(cat => {
                const catId = categoryToId(cat);
                const catFiles = allFiles.filter(f => f.category === cat);

                return `
                    <a href="#${catId}" class="nav-link" data-section="${catId}">
                        <span class="icon">${icons[cat] || '📄'}</span>
                        <span>${cat}</span>
                        <span class="count">${catFiles.length}</span>
                    </a>
                `;
            }).join('');

            document.getElementById('navLinks').innerHTML = navHtml;
        }

        // Format date for display (short German format)
        function formatShortDate(timestamp) {
            const date = new Date(timestamp * 1000);
            return new Intl.DateTimeFormat('de-DE', {
                day: 'numeric',
                month: 'short',
                year: 'numeric',
                timeZone: 'Europe/Berlin'
            }).format(date);
        }

        // Get age badge based on days
        function getAgeBadge(ageDays) {
            if (ageDays <= 7) {
                return '<span class="badge" style="background: var(--green);">🆕 Neu</span>';
            } else if (ageDays > 90) {
                return '<span class="badge" style="background: var(--warning); color: #333;">⚠️ Veraltet</span>';
            }
            return '';
        }

        // Render file card
        function renderCard(f) {
            const kb = (f.size / 1024).toFixed(1);
            const modifiedDate = formatShortDate(f.mtime);
            const createdDate = formatShortDate(f.ctime);
            const relativeDate = formatRelativeTime(f.mtime);
            const sha = f.sha256.substring(0, 12) + '...';
            const fileIcon = getFileIcon(f.type);
            const readingTime = estimateReadingTime(f.size);
            const ageBadge = getAgeBadge(f.age_days);

            // Determine which timestamp to show
            const isHtml = f.type === 'html';
            const timestampLabel = isHtml ? 'Erstellt' : 'Aktualisiert';
            const timestampDate = isHtml ? createdDate : modifiedDate;
            const fullDate = isHtml ? formatGermanDate(f.ctime) : formatGermanDate(f.mtime);

            return `
                <article class="file-card">
                    <div class="file-card-header">
                        <div class="file-card-badges">
                            ${ageBadge}
                        </div>
                    </div>
                    <h3 class="file-card-title">${fileIcon} ${f.title}</h3>
                    <div class="file-card-meta">
                        <span>📦 ${kb} KB</span>
                        <span class="tooltip">
                            📅 ${relativeDate}
                            <span class="tooltip-text">${fullDate}</span>
                        </span>
                        <span class="reading-time">⏱️ ${readingTime}</span>
                    </div>
                    <div class="file-card-meta" style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border);">
                        <span class="tooltip" style="font-weight: 500; color: var(--text-main);">
                            📆 ${timestampLabel}: ${timestampDate}
                            <span class="tooltip-text">${fullDate}</span>
                        </span>
                    </div>
                    <div class="file-card-meta">
                        <span class="tooltip" title="${f.sha256}">🔐 ${sha}</span>
                    </div>
                    <div class="file-card-actions">
                        <a href="/docs/backup-system/${f.path}" class="btn btn-primary" target="_blank">
                            📄 Öffnen
                        </a>
                        ${f.type === 'pdf' ? `
                            <button class="btn btn-secondary" onclick="window.open('/docs/backup-system/${f.path}', '_blank')">
                                📕 PDF anzeigen
                            </button>
                        ` : ''}
                        <button class="btn btn-copy" onclick="copyText('https://api.askproai.de/docs/backup-system/${f.path}', event, 'URL kopiert!')">
                            📋 URL kopieren
                        </button>
                        <button class="btn btn-copy" onclick="copyText('${f.sha256}', event, 'SHA256 kopiert!')">
                            🔐 SHA256
                        </button>
                    </div>
                </article>
            `;
        }

        // Get file icon based on extension
        function getFileIcon(ext) {
            const icons = {
                'pdf': '📕',
                'md': '📝',
                'html': '🌐',
                'json': '📊',
                'txt': '📄',
                'log': '📋'
            };
            return icons[ext] || '📄';
        }

        // Toggle category
        function toggleCategory(catId) {
            const content = document.getElementById(`content-${catId}`);
            const header = document.querySelector(`#cat-${catId} .category-header`);
            const icon = document.querySelector(`#cat-${catId} .toggle-icon`);

            if (content.classList.contains('expanded')) {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
                header.setAttribute('aria-expanded', 'false');
                expandedCategories.delete(catId);
            } else {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                header.setAttribute('aria-expanded', 'true');
                expandedCategories.add(catId);
            }

            saveExpandedState();
        }

        // Expand all categories
        function expandAll() {
            document.querySelectorAll('.category-content').forEach(content => {
                content.classList.add('expanded');
            });
            document.querySelectorAll('.toggle-icon').forEach(icon => {
                icon.classList.add('expanded');
            });
            document.querySelectorAll('.category-header').forEach(header => {
                header.setAttribute('aria-expanded', 'true');
            });

            document.querySelectorAll('.category-section').forEach(section => {
                const catId = section.id.replace('cat-', '');
                expandedCategories.add(catId);
            });

            saveExpandedState();
        }

        // Collapse all categories
        function collapseAll() {
            document.querySelectorAll('.category-content').forEach(content => {
                content.classList.remove('expanded');
            });
            document.querySelectorAll('.toggle-icon').forEach(icon => {
                icon.classList.remove('expanded');
            });
            document.querySelectorAll('.category-header').forEach(header => {
                header.setAttribute('aria-expanded', 'false');
            });

            expandedCategories.clear();
            saveExpandedState();
        }

        // Save expanded state to sessionStorage
        function saveExpandedState() {
            sessionStorage.setItem('expandedCategories', JSON.stringify([...expandedCategories]));
        }

        // Restore expanded state from sessionStorage
        function restoreExpandedState() {
            try {
                const saved = sessionStorage.getItem('expandedCategories');
                if (saved) {
                    expandedCategories = new Set(JSON.parse(saved));
                }
            } catch (e) {
                console.error('Failed to restore expanded state:', e);
            }
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', e => {
            const q = e.target.value.toLowerCase().trim();
            const clearBtn = document.getElementById('searchClear');
            const resultsCount = document.getElementById('searchResultsCount');

            if (q) {
                clearBtn.classList.add('visible');
            } else {
                clearBtn.classList.remove('visible');
            }

            if (q) {
                const filtered = allFiles.filter(f =>
                    f.title.toLowerCase().includes(q) ||
                    f.description.toLowerCase().includes(q) ||
                    f.filename.toLowerCase().includes(q) ||
                    f.category.toLowerCase().includes(q)
                );

                renderCategories(filtered);

                resultsCount.textContent = `${filtered.length} ${filtered.length === 1 ? 'Ergebnis' : 'Ergebnisse'} gefunden`;
                resultsCount.classList.add('visible');

                if (filtered.length > 0) {
                    setTimeout(expandAll, 100);
                }
            } else {
                renderCategories(allFiles);
                resultsCount.classList.remove('visible');
            }
        });

        // Clear search
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchClear').classList.remove('visible');
            document.getElementById('searchResultsCount').classList.remove('visible');
            renderCategories(allFiles);
        }

        // Copy to clipboard with feedback
        function copyText(text, event, message = 'Kopiert!') {
            navigator.clipboard.writeText(text).then(() => {
                const tooltip = document.getElementById('copyTooltip');
                tooltip.textContent = message;
                tooltip.style.left = event.pageX + 'px';
                tooltip.style.top = (event.pageY - 40) + 'px';
                tooltip.classList.add('show');
                setTimeout(() => tooltip.classList.remove('show'), 2000);
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('Kopieren fehlgeschlagen');
            });
        }

        // Smooth scroll to section
        function scrollToSection(sectionId) {
            const element = document.getElementById(`cat-${sectionId}`) || document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });

                if (sectionId !== 'status') {
                    const content = document.getElementById(`content-${sectionId}`);
                    const icon = document.querySelector(`#cat-${sectionId} .toggle-icon`);
                    const header = document.querySelector(`#cat-${sectionId} .category-header`);

                    if (content && !content.classList.contains('expanded')) {
                        content.classList.add('expanded');
                        icon.classList.add('expanded');
                        header.setAttribute('aria-expanded', 'true');
                        expandedCategories.add(sectionId);
                        saveExpandedState();
                    }
                }
            }
        }

        // Handle hash navigation
        function handleHashNavigation() {
            const hash = window.location.hash.slice(1);
            if (hash) {
                setTimeout(() => scrollToSection(hash), 300);
            }
        }

        // Update active nav link on scroll
        function updateActiveNavLink() {
            const sections = document.querySelectorAll('.category-section, #status');
            let currentSection = '';

            sections.forEach(section => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= 200 && rect.bottom > 200) {
                    currentSection = section.id.replace('cat-', '');
                }
            });

            document.querySelectorAll('.nav-link').forEach(link => {
                const section = link.dataset.section;
                if (section === currentSection) {
                    link.classList.add('active');
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.classList.remove('active');
                    link.removeAttribute('aria-current');
                }
            });
        }

        // Back to top button
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Show/hide back to top button
        window.addEventListener('scroll', () => {
            const backToTop = document.getElementById('backToTop');
            if (window.scrollY > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }

            updateActiveNavLink();
        });

        // Handle hash changes
        window.addEventListener('hashchange', handleHashNavigation);

        // Mobile menu toggle
        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Close mobile menu when clicking nav link
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('nav-link') && window.innerWidth <= 992) {
                document.getElementById('sidebar').classList.remove('open');
            }
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            // / key to focus search
            if (e.key === '/' && !['INPUT', 'TEXTAREA'].includes(e.target.tagName)) {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }

            // Escape to clear search or close mobile menu
            if (e.key === 'Escape') {
                const searchInput = document.getElementById('searchInput');
                if (searchInput.value) {
                    clearSearch();
                } else if (window.innerWidth <= 992) {
                    document.getElementById('sidebar').classList.remove('open');
                }
            }

            // Enter key on category headers
            if (e.key === 'Enter' && e.target.classList.contains('category-header')) {
                e.target.click();
            }
        });

        // Handle navigation link clicks
        document.addEventListener('click', (e) => {
            if (e.target.closest('.nav-link')) {
                e.preventDefault();
                const href = e.target.closest('.nav-link').getAttribute('href');
                const sectionId = href.slice(1);

                window.location.hash = sectionId;
                scrollToSection(sectionId);
            }
        });

        // Accessibility functions
        function adjustFontSize(size) {
            document.body.classList.remove('font-large', 'font-xlarge');
            if (size === 'large') document.body.classList.add('font-large');
            if (size === 'xlarge') document.body.classList.add('font-xlarge');
            localStorage.setItem('fontSize', size);
        }

        function toggleHighContrast() {
            document.body.classList.toggle('high-contrast');
            const enabled = document.body.classList.contains('high-contrast');
            localStorage.setItem('highContrast', enabled);
        }

        // Restore accessibility preferences
        window.addEventListener('DOMContentLoaded', () => {
            const fontSize = localStorage.getItem('fontSize');
            if (fontSize) adjustFontSize(fontSize);

            const highContrast = localStorage.getItem('highContrast');
            if (highContrast === 'true') document.body.classList.add('high-contrast');
        });

        // Initialize
        loadStatus();
        loadFiles();

        // Update status every 5 minutes
        setInterval(loadStatus, 5 * 60 * 1000);
    </script>
</body>
</html>
