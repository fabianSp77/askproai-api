<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Business Portal Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .status { font-weight: bold; }
        .ok { color: green; }
        .error { color: red; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üß™ Business Portal Fix Test</h1>
    
    <div class="test-section">
        <h2>1. Direct Page Test</h2>
        <button onclick="testDirectPage()">Test Business Portal Admin Page</button>
        <div id="directResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Emergency Fix Function Test</h2>
        <button onclick="testEmergencyFix()">Test Emergency Fix Functions</button>
        <div id="fixResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Manual Test Instructions</h2>
        <ol>
            <li>Open <a href="/admin/business-portal-admin" target="_blank">Business Portal Admin</a></li>
            <li>Open Browser Console (F12)</li>
            <li>Check for "Emergency Fix" messages in console</li>
            <li>Test Company Dropdown - should be clickable</li>
            <li>Test "Portal √∂ffnen" button - should trigger redirect</li>
            <li>Run: <code>window.emergencyFix.status()</code> in console</li>
        </ol>
    </div>
    
    <script>
        function testDirectPage() {
            const result = document.getElementById('directResult');
            result.innerHTML = '<p>Opening Business Portal Admin in new tab...</p>';
            window.open('/admin/business-portal-admin', '_blank');
            
            setTimeout(() => {
                result.innerHTML += '<p>Please check the new tab and verify:</p>';
                result.innerHTML += '<ul>';
                result.innerHTML += '<li>No JavaScript errors in console</li>';
                result.innerHTML += '<li>Company dropdown is functional</li>';
                result.innerHTML += '<li>Portal button is clickable</li>';
                result.innerHTML += '<li>Emergency fix messages appear in console</li>';
                result.innerHTML += '</ul>';
            }, 1000);
        }
        
        function testEmergencyFix() {
            const result = document.getElementById('fixResult');
            
            // Load emergency fix script
            const script = document.createElement('script');
            script.src = '/js/emergency-business-portal-fix.js?test=' + Date.now();
            script.onload = () => {
                result.innerHTML = '<p class="status ok">‚úÖ Emergency fix script loaded</p>';
                
                if (typeof window.emergencyFix !== 'undefined') {
                    result.innerHTML += '<p class="status ok">‚úÖ Emergency fix object available</p>';
                    result.innerHTML += '<p>Available functions:</p>';
                    result.innerHTML += '<ul>';
                    result.innerHTML += '<li>window.emergencyFix.status()</li>';
                    result.innerHTML += '<li>window.emergencyFix.reapply()</li>';
                    result.innerHTML += '<li>window.emergencyFix.testPortalButton()</li>';
                    result.innerHTML += '<li>window.emergencyFix.testCompanySelect()</li>';
                    result.innerHTML += '</ul>';
                } else {
                    result.innerHTML += '<p class="status error">‚ùå Emergency fix object NOT available</p>';
                }
            };
            script.onerror = () => {
                result.innerHTML = '<p class="status error">‚ùå Failed to load emergency fix script</p>';
            };
            document.head.appendChild(script);
        }
    </script>
</body>
</html>