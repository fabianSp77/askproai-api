<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin UI Live Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #3B82F6;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #2563EB;
        }
        button.success {
            background: #10B981;
        }
        button.danger {
            background: #EF4444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .status.info {
            background: #E0F2FE;
            color: #0369A1;
        }
        .status.success {
            background: #D1FAE5;
            color: #065F46;
        }
        .status.error {
            background: #FEE2E2;
            color: #991B1B;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: none;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Admin UI Live Test</h1>
        
        <div class="controls">
            <h3>üìä Status Checks</h3>
            <div class="grid">
                <button onclick="checkIframeScripts()">Check Scripts</button>
                <button onclick="checkAlpineStatus()">Check Alpine</button>
                <button onclick="checkLivewireStatus()">Check Livewire</button>
                <button onclick="checkUIFixes()">Check UI Fixes</button>
            </div>
            
            <h3>üß™ Direct Tests</h3>
            <div class="grid">
                <button onclick="testMobileMenu()" class="success">Test Mobile Menu</button>
                <button onclick="testCompanySelector()" class="success">Test Company Dropdown</button>
                <button onclick="testPortalButton()" class="success">Test Portal Button</button>
                <button onclick="applyEmergencyFix()" class="danger">Apply Emergency Fix</button>
            </div>
            
            <h3>üîç Debug Actions</h3>
            <div class="grid">
                <button onclick="showAllClickable()">Show Clickable Elements</button>
                <button onclick="injectDebugScript()">Inject Debug Helper</button>
                <button onclick="reloadIframe()">Reload Page</button>
                <button onclick="clearStatus()">Clear Status</button>
            </div>
            
            <div id="status"></div>
        </div>
        
        <iframe id="adminFrame" src="/admin/business-portal-admin"></iframe>
    </div>
    
    <script>
        const iframe = document.getElementById('adminFrame');
        const statusDiv = document.getElementById('status');
        
        function log(message, type = 'info') {
            const msg = document.createElement('div');
            msg.className = `status ${type}`;
            msg.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            statusDiv.appendChild(msg);
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        function clearStatus() {
            statusDiv.innerHTML = '';
        }
        
        function getIframeWindow() {
            try {
                return iframe.contentWindow;
            } catch (e) {
                log('Cannot access iframe window: ' + e.message, 'error');
                return null;
            }
        }
        
        function checkIframeScripts() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Checking scripts in iframe...', 'info');
            
            try {
                const scripts = Array.from(win.document.querySelectorAll('script')).map(s => s.src || 'inline');
                log(`Total scripts: ${scripts.length}`, 'info');
                
                const uiFixes = scripts.filter(s => 
                    s.includes('unified-ui-fix') || 
                    s.includes('emergency-button-fix')
                );
                
                if (uiFixes.length > 0) {
                    log(`‚úÖ Found ${uiFixes.length} UI fix scripts`, 'success');
                    uiFixes.forEach(s => log(`  - ${s.split('/').pop()}`, 'info'));
                } else {
                    log('‚ùå No UI fix scripts found', 'error');
                }
            } catch (e) {
                log('Error checking scripts: ' + e.message, 'error');
            }
        }
        
        function checkAlpineStatus() {
            const win = getIframeWindow();
            if (!win) return;
            
            if (win.Alpine) {
                log('‚úÖ Alpine.js is loaded', 'success');
                if (win.Alpine.store && win.Alpine.store('sidebar')) {
                    log('‚úÖ Sidebar store exists', 'success');
                } else {
                    log('‚ùå Sidebar store not found', 'error');
                }
            } else {
                log('‚ùå Alpine.js not loaded', 'error');
            }
        }
        
        function checkLivewireStatus() {
            const win = getIframeWindow();
            if (!win) return;
            
            if (win.Livewire) {
                log('‚úÖ Livewire v3 is loaded', 'success');
            } else if (win.livewire) {
                log('‚úÖ Livewire v2 is loaded', 'success');
            } else {
                log('‚ùå Livewire not loaded', 'error');
            }
        }
        
        function checkUIFixes() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Checking UI fixes...', 'info');
            
            if (win.unifiedUIFixV2) {
                log('‚úÖ Unified UI Fix V2 is loaded', 'success');
                win.unifiedUIFixV2.status();
            } else {
                log('‚ùå Unified UI Fix V2 not found', 'error');
            }
            
            if (win.emergencyButtonFix) {
                log('‚úÖ Emergency Button Fix is loaded', 'success');
            } else {
                log('‚ùå Emergency Button Fix not found', 'error');
            }
        }
        
        function testMobileMenu() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Testing mobile menu...', 'info');
            
            if (win.emergencyButtonFix) {
                win.emergencyButtonFix.testMobileMenu();
                log('Mobile menu test executed', 'success');
            } else if (win.unifiedUIFixV2) {
                win.unifiedUIFixV2.test.mobileMenu();
                log('Mobile menu test executed via V2', 'success');
            } else {
                log('No UI fix available for testing', 'error');
            }
        }
        
        function testCompanySelector() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Testing company selector...', 'info');
            
            if (win.emergencyButtonFix) {
                win.emergencyButtonFix.testCompanySelect();
                log('Company selector test executed', 'success');
            } else if (win.unifiedUIFixV2) {
                win.unifiedUIFixV2.test.companySelect();
                log('Company selector test executed via V2', 'success');
            } else {
                log('No UI fix available for testing', 'error');
            }
        }
        
        function testPortalButton() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Testing portal button...', 'info');
            
            if (win.emergencyButtonFix) {
                // Find and click portal button directly
                const btn = win.document.querySelector('button[wire\\:click*="openCustomerPortal"], button[wire\\:click*="openPortal"]');
                if (btn) {
                    btn.click();
                    log('Portal button clicked', 'success');
                } else {
                    log('Portal button not found', 'error');
                }
            } else {
                log('No UI fix available for testing', 'error');
            }
        }
        
        function applyEmergencyFix() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Applying emergency fix...', 'info');
            
            if (win.emergencyButtonFix) {
                win.emergencyButtonFix.applyAll();
                log('Emergency fix applied', 'success');
            } else {
                log('Emergency button fix not available', 'error');
            }
        }
        
        function showAllClickable() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Highlighting clickable elements...', 'info');
            
            win.document.body.classList.add('debug-clickable');
            log('Added debug-clickable class - buttons should have red borders', 'success');
        }
        
        function injectDebugScript() {
            const win = getIframeWindow();
            if (!win) return;
            
            log('Injecting debug helper...', 'info');
            
            const script = win.document.createElement('script');
            script.textContent = `
                console.log('Debug helper injected');
                window.debugUI = {
                    findButtons: () => document.querySelectorAll('button'),
                    findSelects: () => document.querySelectorAll('select'),
                    findWireElements: () => {
                        const all = document.querySelectorAll('*');
                        return Array.from(all).filter(el => 
                            Array.from(el.attributes).some(attr => 
                                attr.name.includes('wire:')
                            )
                        );
                    },
                    testClick: (selector) => {
                        const el = document.querySelector(selector);
                        if (el) {
                            el.click();
                            console.log('Clicked:', el);
                        } else {
                            console.log('Element not found:', selector);
                        }
                    }
                };
                console.log('Debug functions available: window.debugUI');
            `;
            win.document.head.appendChild(script);
            log('Debug helper injected - check iframe console', 'success');
        }
        
        function reloadIframe() {
            log('Reloading iframe...', 'info');
            iframe.src = iframe.src;
        }
        
        // Wait for iframe to load
        iframe.onload = function() {
            log('Iframe loaded', 'success');
            setTimeout(() => {
                checkIframeScripts();
                checkAlpineStatus();
                checkLivewireStatus();
                checkUIFixes();
            }, 1000);
        };
    </script>
</body>
</html>