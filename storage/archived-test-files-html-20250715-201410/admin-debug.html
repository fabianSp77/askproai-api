<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal Debug Tool</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f3f4f6;
        }
        .debug-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        .status-ok { color: #10b981; }
        .status-error { color: #ef4444; }
        .status-warning { color: #f59e0b; }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background: #2563eb;
        }
        .log-output {
            background: #1f2937;
            color: #f3f4f6;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background: #f9fafb;
        }
    </style>
</head>
<body>
    <h1>Admin Portal Debug Tool</h1>
    
    <div class="debug-card">
        <h2>System Status</h2>
        <div id="system-status">Checking...</div>
    </div>
    
    <div class="debug-card">
        <h2>Test Portal Button</h2>
        <button onclick="testPortalRedirect()">Test Portal Redirect</button>
        <button onclick="testLivewireEvent()">Test Livewire Event</button>
        <button onclick="testDirectRedirect()">Test Direct Redirect</button>
        <div id="portal-test-result"></div>
    </div>
    
    <div class="debug-card">
        <h2>Test Dropdown Functions</h2>
        <button onclick="testDropdowns()">Check All Dropdowns</button>
        <button onclick="fixAllDropdowns()">Fix All Dropdowns</button>
        <button onclick="testAlpine()">Test Alpine.js</button>
        <div id="dropdown-test-result"></div>
    </div>
    
    <div class="debug-card">
        <h2>Console Log</h2>
        <div class="log-output" id="console-log"></div>
    </div>
    
    <script>
        // Console log capture
        const logOutput = document.getElementById('console-log');
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addLog(type, ...args) {
            const timestamp = new Date().toLocaleTimeString();
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            logOutput.innerHTML += `[${timestamp}] ${type}: ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog('LOG', ...args);
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog('ERROR', ...args);
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLog('WARN', ...args);
        };
        
        // System status check
        function checkSystemStatus() {
            const status = document.getElementById('system-status');
            let html = '';
            
            // Check Livewire
            if (typeof Livewire !== 'undefined') {
                html += '<div class="test-result"><span class="status-ok">✓</span> Livewire loaded</div>';
            } else {
                html += '<div class="test-result"><span class="status-error">✗</span> Livewire not loaded</div>';
            }
            
            // Check Alpine
            if (typeof Alpine !== 'undefined') {
                html += '<div class="test-result"><span class="status-ok">✓</span> Alpine.js loaded</div>';
            } else {
                html += '<div class="test-result"><span class="status-error">✗</span> Alpine.js not loaded</div>';
            }
            
            // Check admin portal fixes
            if (typeof window.adminPortalFixes !== 'undefined') {
                html += '<div class="test-result"><span class="status-ok">✓</span> Admin Portal Fixes loaded</div>';
            } else {
                html += '<div class="test-result"><span class="status-warning">⚠</span> Admin Portal Fixes not loaded</div>';
            }
            
            // Check operations center fixes
            if (typeof window.operationsCenterFixes !== 'undefined') {
                html += '<div class="test-result"><span class="status-ok">✓</span> Operations Center Fixes loaded</div>';
            } else {
                html += '<div class="test-result"><span class="status-warning">⚠</span> Operations Center Fixes not loaded</div>';
            }
            
            status.innerHTML = html;
        }
        
        // Portal redirect tests
        function testPortalRedirect() {
            console.log('Testing portal redirect...');
            const result = document.getElementById('portal-test-result');
            
            // Dispatch event
            const event = new CustomEvent('redirect-to-portal', {
                detail: { url: '/business/dashboard?test=1' }
            });
            window.dispatchEvent(event);
            
            result.innerHTML = '<div class="test-result"><span class="status-ok">✓</span> Event dispatched. Check if redirect happens.</div>';
        }
        
        function testLivewireEvent() {
            console.log('Testing Livewire event...');
            const result = document.getElementById('portal-test-result');
            
            if (typeof Livewire !== 'undefined') {
                Livewire.dispatch('redirect-to-portal', { url: '/business/dashboard?test=2' });
                result.innerHTML = '<div class="test-result"><span class="status-ok">✓</span> Livewire event dispatched.</div>';
            } else {
                result.innerHTML = '<div class="test-result"><span class="status-error">✗</span> Livewire not available.</div>';
            }
        }
        
        function testDirectRedirect() {
            console.log('Testing direct redirect...');
            if (confirm('This will redirect you to /business/dashboard. Continue?')) {
                window.location.href = '/business/dashboard?test=3';
            }
        }
        
        // Dropdown tests
        function testDropdowns() {
            console.log('Testing dropdowns...');
            const result = document.getElementById('dropdown-test-result');
            
            const dropdowns = document.querySelectorAll('[x-data*="open"]');
            let html = `<div class="test-result">Found ${dropdowns.length} dropdowns:</div>`;
            
            dropdowns.forEach((dropdown, index) => {
                const hasAlpine = !!dropdown.__x;
                const isOpen = hasAlpine ? dropdown.__x.$data.open : 'N/A';
                
                html += `<div class="test-result">
                    Dropdown ${index + 1}: 
                    Alpine: <span class="${hasAlpine ? 'status-ok' : 'status-error'}">${hasAlpine ? 'Yes' : 'No'}</span>, 
                    Open: ${isOpen}
                </div>`;
            });
            
            result.innerHTML = html;
        }
        
        function fixAllDropdowns() {
            console.log('Fixing all dropdowns...');
            const result = document.getElementById('dropdown-test-result');
            
            if (window.adminPortalFixes) {
                window.adminPortalFixes.fixDropdowns();
                result.innerHTML = '<div class="test-result"><span class="status-ok">✓</span> Admin portal dropdown fix applied.</div>';
            }
            
            if (window.operationsCenterFixes) {
                window.operationsCenterFixes.fixDropdowns();
                result.innerHTML += '<div class="test-result"><span class="status-ok">✓</span> Operations center dropdown fix applied.</div>';
            }
        }
        
        function testAlpine() {
            console.log('Testing Alpine.js...');
            const result = document.getElementById('dropdown-test-result');
            
            if (typeof Alpine !== 'undefined') {
                const components = document.querySelectorAll('[x-data]');
                let initialized = 0;
                let uninitialized = 0;
                
                components.forEach(component => {
                    if (component.__x) {
                        initialized++;
                    } else {
                        uninitialized++;
                    }
                });
                
                result.innerHTML = `<div class="test-result">
                    <span class="status-ok">✓</span> Alpine.js loaded<br>
                    Total components: ${components.length}<br>
                    Initialized: ${initialized}<br>
                    Uninitialized: ${uninitialized}
                </div>`;
                
                if (uninitialized > 0 && window.Alpine) {
                    Alpine.initTree(document.body);
                    result.innerHTML += '<div class="test-result"><span class="status-warning">⚠</span> Attempted to initialize uninitialized components.</div>';
                }
            } else {
                result.innerHTML = '<div class="test-result"><span class="status-error">✗</span> Alpine.js not loaded.</div>';
            }
        }
        
        // Initial check
        setTimeout(checkSystemStatus, 1000);
        
        // Monitor page
        console.log('Admin Debug Tool loaded');
        console.log('Current URL:', window.location.href);
        console.log('User Agent:', navigator.userAgent);
    </script>
</body>
</html>